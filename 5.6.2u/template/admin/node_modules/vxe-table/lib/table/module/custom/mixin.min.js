Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function calcMaxHeight(e){var t=e.customStore,e=e.$refs.refElem;let i=0;e&&(i=e.clientHeight-28),t.maxHeight=Math.max(88,i)}function emitCustomEvent(e,t,i){(e.$xeGrid||e).dispatchEvent("custom",{type:t},i)}var _default=exports.default={methods:{_openCustom(){let e=this;var{initStore:t,customStore:i}=e;return i.visible=!0,t.custom=!0,e.handleUpdateCustomColumn(),e.checkCustomStatus(),calcMaxHeight(e),e.$nextTick().then(()=>calcMaxHeight(e))},_closeCustom(){var e=this,t=e.customStore,i=e.computeCustomOpts;return t.visible&&(t.visible=!1,i.immediate||e.handleCustom()),e.$nextTick()},_saveCustom(){let e=this;var{customOpts:t,customColumnList:i}=this;let{allowVisible:o,allowSort:r,allowFixed:u,allowResizable:a}=t;return _xeUtils.default.eachTree(i,(e,t,i,s,l)=>{l?e.fixed=l.fixed:(r&&(e.renderSortNumber=t+1),u&&(e.fixed=e.renderFixed)),a&&e.renderVisible&&(!e.children||e.children.length)&&e.renderResizeWidth!==e.renderWidth&&(e.resizeWidth=e.renderResizeWidth,e.renderWidth=e.renderResizeWidth),o&&(e.visible=e.renderVisible)}),e.isCustomStatus=!0,e.isDragColMove=!0,setTimeout(()=>{e.isDragColMove=!1},1e3),this.saveCustomStore("confirm")},_cancelCustom(){var e=this,{customColumnList:t,customStore:i}=e;let{oldSortMaps:l,oldFixedMaps:o,oldVisibleMaps:r}=i,{allowVisible:u,allowSort:a,allowFixed:m,allowResizable:d}=e.computeCustomOpts;return _xeUtils.default.eachTree(t,e=>{var t=e.getKey(),i=!!r[t],s=o[t]||"";u&&(e.renderVisible=i,e.visible=i),m&&(e.renderFixed=s,e.fixed=s),a&&(e.renderSortNumber=l[t]||0),d&&(e.renderResizeWidth=e.renderWidth)},{children:"children"}),e.$nextTick()},_resetCustom(e){let t=this;var i=t,s=t.collectColumn;let l=t.computeCustomOpts.checkMethod,o=Object.assign({visible:!0,resizable:!0===e,fixed:!0===e,sort:!0===e},e);return _xeUtils.default.eachTree(s,e=>{o.resizable&&(e.resizeWidth=0),o.fixed&&(e.fixed=e.defaultFixed),o.sort&&(e.renderSortNumber=e.sortNumber),l&&!l({$table:t,column:e})||(e.visible=e.defaultVisible),e.renderResizeWidth=e.renderWidth}),i.isCustomStatus=!1,t.saveCustomStore("reset"),t.handleCustom()},_toggleCustomAllCheckbox(){var e=this.customStore,e=!e.isAll;return this.setCustomAllCheckbox(e)},_setCustomAllCheckbox(e){let t=this;var i=t,s=i.customStore,l=i.customColumnList,o=t.computeCustomOpts;let{checkMethod:r,visibleMethod:u}=o,a=!!e;o.immediate?(_xeUtils.default.eachTree(l,e=>{u&&!u({$table:t,column:e})||r&&!r({$table:t,column:e})||(e.visible=a,e.renderVisible=a,e.halfVisible=!1)}),s.isAll=a,i.isCustomStatus=!0,t.handleCustom(),t.saveCustomStore("update:visible")):(_xeUtils.default.eachTree(l,e=>{u&&!u({$table:t,column:e})||r&&!r({$table:t,column:e})||(e.renderVisible=a,e.halfVisible=!1)}),s.isAll=a),t.checkCustomStatus()},checkCustomStatus(){let t=this;var e=t.customStore,i=t.collectColumn;let s=t.computeCustomOpts.checkMethod;e.isAll=i.every(e=>!!s&&!s({$table:t,column:e})||e.renderVisible),e.isIndeterminate=!e.isAll&&i.some(e=>(!s||s({$table:t,column:e}))&&(e.renderVisible||e.halfVisible))},emitCustomEvent(e,t){(this.$xeGrid||this).dispatchEvent("custom",{type:e},t)},triggerCustomEvent(e){var t=this.customStore;t.visible?(this.closeCustom(),emitCustomEvent(this,"close",e)):(t.btnEl=e.target,this.openCustom(),emitCustomEvent(this,"open",e))},customOpenEvent(e){var t=this.customStore;t.visible&&(t.activeBtn=!0,t.btnEl=e.target,this.openCustom(),emitCustomEvent(this,"open",e))},customCloseEvent(e){var t=this.customStore;t.visible&&(t.activeBtn=!1,this.closeCustom(),emitCustomEvent(this,"close",e))},handleUpdateCustomColumn(){var e=this,t=e.customStore,o=this.collectColumn;if(t.visible){let i={},s={},l={};_xeUtils.default.eachTree(o,e=>{var t=e.getKey();e.renderFixed=e.fixed,e.renderVisible=e.visible,e.renderResizeWidth=e.renderWidth,i[t]=e.renderSortNumber,s[t]=e.fixed,l[t]=e.visible}),t.oldSortMaps=i,t.oldFixedMaps=s,t.oldVisibleMaps=l,e.customColumnList=o.slice(0)}}}};