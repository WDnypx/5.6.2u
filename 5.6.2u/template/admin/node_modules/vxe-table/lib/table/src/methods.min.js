Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_dom=require("../../ui/src/dom"),_utils=require("../../ui/src/utils"),_ui=require("../../ui"),_cell=_interopRequireDefault(require("./cell")),_util=require("./util"),_vn=require("../../ui/src/vn"),_log=require("../../ui/src/log");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let{getConfig,getI18n,renderer,formats,interceptor,createEvent}=_ui.VxeUI,browseObj=_xeUtils.default.browse(),supportMaxRow=5e6,customStorageKey="VXE_CUSTOM_STORE",maxYHeight=5e6,maxXWidth=5e6;function eqCellValue(e,t,l){e=_xeUtils.default.get(e,l),t=_xeUtils.default.get(t,l);return!(!(0,_utils.eqEmptyValue)(e)||!(0,_utils.eqEmptyValue)(t))||(_xeUtils.default.isString(e)||_xeUtils.default.isNumber(e)?""+e==""+t:_xeUtils.default.isEqual(e,t))}function getNextSortOrder(e,t){var{orders:e=[]}=e.computeSortOpts,t=t.order||null,t=e.indexOf(t)+1;return e[t<e.length?t:0]}let getCustomStorageMap=e=>{var t=getConfig().version,l=_xeUtils.default.toStringJSON(localStorage.getItem(customStorageKey)||""),l=l&&l._v===t?l:{_v:t};return(e?l[e]:l)||{}},setCustomStorageMap=(e,t)=>{var l=getConfig().version,r=getCustomStorageMap();r[e]=t||void 0,r._v=l,localStorage.setItem(customStorageKey,_xeUtils.default.toJSONString(r))},getRecoverRowMaps=(e,t)=>{let l=e.fullAllDataRowIdData,r={};return _xeUtils.default.each(t,(e,t)=>{l[t]&&(r[t]=e)}),r};function handleReserveRow(e,t){let l=e.fullDataRowIdData,r=[];return _xeUtils.default.each(t,(e,t)=>{l[t]&&-1===r.indexOf(l[t].row)&&r.push(l[t].row)}),r}function handleVirtualXVisible(o){var{isScrollXBig:a,scrollXWidth:i}=o,{elemStore:n,visibleColumn:d,fullColumnIdData:s}=o,u=o.computeLeftFixedWidth,o=o.computeRightFixedWidth,n=(0,_util.getRefElem)(n["main-body-scroll"]);if(n){var c=n.clientWidth;let e=n.scrollLeft;var h=(e=a?Math.ceil((i-c)*Math.min(1,e/(maxXWidth-c))):e)+u,g=e+c-o;let t=0,l=d.length;for(;t<l;){var p=Math.floor((t+l)/2);(s[d[p].id]||{}).oLeft<=h?t=p+1:l=p}let r=0;n=t===d.length?t:Math.max(0,t<d.length?t-2:0);for(let e=n,t=d.length;e<t;e++){var f=s[d[e].id]||{};if(r++,f.oLeft>g||60<=r)break}return{toVisibleIndex:Math.max(0,n),visibleSize:Math.max(1,r)}}return{toVisibleIndex:0,visibleSize:6}}function handleCustomRestore(e,t){var l=e,r=e.collectColumn;let{resizableData:i,sortData:n,visibleData:d,fixedData:s}=t,u=!1;i||n||d||s?(_xeUtils.default.eachTree(r,(e,t,l,r,o)=>{var a=e.getKey();o||(s&&void 0!==s[a]&&(e.fixed=s[a]),n&&_xeUtils.default.isNumber(n[a])&&(u=!0,e.renderSortNumber=n[a])),i&&_xeUtils.default.isNumber(i[a])&&(e.resizeWidth=i[a]),d&&_xeUtils.default.isBoolean(d[a])&&(e.visible=d[a])}),u&&(r=_xeUtils.default.orderBy(r,"renderSortNumber"),e.collectColumn=r,e.tableFullColumn=getColumnList(r)),l.isCustomStatus=!0):l.isCustomStatus=!1}function restoreCustomStorage(t){var e=t.customConfig,l=t.computeTableId,r=t.computeCustomOpts,{storage:o,restoreStore:a}=r,i=!0===o,o=i?{}:Object.assign({},o||{}),n=i||o.resizable,d=i||o.visible,s=i||o.fixed,i=i||o.sort;if((e?(0,_utils.isEnableConf)(r):r.enabled)&&(n||d||s||i)){if(l)return o=getCustomStorageMap(l),a?Promise.resolve(a({$table:t,id:l,type:"restore",storeData:o})).then(e=>{if(e)return handleCustomRestore(t,e)}).catch(e=>e):handleCustomRestore(t,o);(0,_log.errLog)("vxe.error.reqProp",["id"])}}function cacheColumnMap(e){var t=e,l=e,r=e,{tableFullColumn:o,collectColumn:a}=r;let c=r.fullColumnIdData={},h=r.fullColumnFieldData={};var r=e.computeMouseOpts,i=e.computeExpandOpts;let g=e.computeColumnOpts,{isCrossDrag:p,isSelfToChildDrag:f}=e.computeColumnDragOpts,m=e.computeCustomOpts.storage;var e=e.computeRowOpts,n=a.some(_utils.hasChildrenList);let x=!!t.showOverflow,v,w,C,R,b,E,_,d=(e,t,l,r,o)=>{var{id:a,field:i,fixed:n,type:d,treeNode:s,rowGroupNode:u}=e,t={$index:-1,_index:-1,column:e,colid:a,index:t,items:l,parent:o||null,width:0,oLeft:0};i?(h[i]&&(0,_log.errLog)("vxe.error.colRepet",["field",i]),h[i]=t):(m&&!d||g.drag&&(p||f))&&(0,_log.errLog)("vxe.error.reqProp",[`${e.getTitle()||d||""} -> column.field=?`]),!_&&n&&(_=n),E||"html"!==d||(E=e),s&&(C&&(0,_log.warnLog)("vxe.error.colRepet",["tree-node",s]),C=C||e),u&&(C&&(0,_log.warnLog)("vxe.error.colRepet",["row-group-node",u]),v=v||e),"expand"===d&&(w&&(0,_log.warnLog)("vxe.error.colRepet",["type",d]),w=w||e),"checkbox"===d?(R&&(0,_log.warnLog)("vxe.error.colRepet",["type",d]),R=R||e):"radio"===d&&(b&&(0,_log.warnLog)("vxe.error.colRepet",["type",d]),b=b||e),x&&!1===e.showOverflow&&(x=!1),c[a]&&(0,_log.errLog)("vxe.error.colRepet",["colId",a]),c[a]=t};n?_xeUtils.default.eachTree(a,(e,t,l,r,o,a)=>{e.level=a.length,d(e,t,l,0,o)}):o.forEach(d),w&&"fixed"!==i.mode&&r.area&&(0,_log.errLog)("vxe.error.errConflicts",["mouse-config.area","column.type=expand"]),E&&(g.useKey||(0,_log.errLog)("vxe.error.reqProp",["column-config.useKey & column.type=html"]),e.useKey||(0,_log.errLog)("vxe.error.reqProp",["row-config.useKey & column.type=html"])),l.isGroup=n,l.rowGroupColumn=v,l.treeNodeColumn=C,l.expandColumn=w,l.isAllOverflow=x}function updateScrollXStatus(e,t){var l=e,r=e.computeVirtualXOpts,t=t||e.tableFullColumn,e=!!r.enabled&&-1<r.gt&&(0===r.gt||r.gt<t.length);return l.scrollXLoad=e}function updateScrollYStatus(e,t){var l=e,r=e.treeConfig,o=e.computeVirtualYOpts,a=e.computeTreeOpts.transform,t=t||e.tableFullData,e=(a||!r)&&!!o.enabled&&-1<o.gt&&(0===o.gt||o.gt<t.length);return l.scrollYLoad=e}function handleBaseTreeExpand(r,e,t){var l=r;let o=l.treeNodeColumn,{fullAllDataRowIdData:a,tableFullTreeData:i,treeExpandedMaps:n,treeExpandLazyLoadedMaps:d}=r;var s=r.computeTreeOpts;let{reserve:u,lazy:c,accordion:h,toggleMethod:g}=s,p=s.children||s.childrenField,f=s.hasChild||s.hasChildField,m=[],x=r.getColumnIndex(o),v=r.getVMColumnIndex(o),w=(0,_util.createHandleGetRowId)(r).handleGetRowId,C=g?e.filter(e=>g({$table:r,expanded:t,column:o,columnIndex:x,$columnIndex:v,row:e})):e;return h&&(C=C.length?[C[C.length-1]]:[],s=_xeUtils.default.findTree(i,e=>e===C[0],{children:p}))&&s.items.forEach(e=>{e=w(e);n[e]&&delete n[e]}),t?C.forEach(e=>{var t,l=w(e);n[l]||(t=a[l])&&(c&&e[f]&&!t.treeLoaded&&!d[l]?m.push(handleAsyncTreeExpandChilds(r,e)):e[p]&&e[p].length&&(n[l]=e))}):C.forEach(e=>{e=w(e);n[e]&&delete n[e]}),u&&C.forEach(e=>handleTreeExpandReserve(r,e,t)),l.treeExpandedFlag++,Promise.all(m).then(()=>r.recalculate())}function handleVirtualTreeExpand(e,t,l){let r=e;return handleBaseTreeExpand(e,t,l).then(()=>(handleVirtualTreeToList(e),e.handleTableData(),r.treeExpandedFlag++,updateAfterDataIndex(e),e.$nextTick())).then(()=>e.recalculate(!0)).then(()=>{setTimeout(()=>{e.updateCellAreas()},30)})}function handleRowGroupBaseExpand(t,e,l){var r=t;let{fullAllDataRowIdData:o,tableFullGroupData:a,rowGroupExpandedMaps:i}=t,{mapChildrenField:n,accordion:d}=t.computeAggregateOpts,s=(0,_util.createHandleGetRowId)(t).handleGetRowId,u=e;return n&&(d&&(u=u.length?[u[u.length-1]]:[],e=_xeUtils.default.findTree(a,e=>(0,_util.getRowid)(t,e)===(0,_util.getRowid)(t,u[0]),{children:n}))&&e.items.forEach(e=>{e=s(e);i[e]&&delete i[e]}),l?u.forEach(e=>{var t=s(e);i[t]||o[t]&&e[n]&&e[n].length&&(i[t]=e)}):u.forEach(e=>{e=s(e);i[e]&&delete i[e]})),r.rowGroupExpandedFlag++,t.recalculate()}function handleRowGroupVirtualExpand(e,t,l){let r=e;return handleRowGroupBaseExpand(e,t,l).then(()=>(handleVirtualTreeToList(e),e.handleTableData(),r.rowGroupExpandedFlag++,updateAfterDataIndex(e),e.$nextTick())).then(()=>e.recalculate(!0)).then(()=>{setTimeout(()=>{e.updateCellAreas()},30)})}function updateAfterListIndex(e){var t=e;let a=e.treeConfig,{afterFullData:l,fullDataRowIdData:i,fullAllDataRowIdData:n}=t,d=(0,_util.createHandleGetRowId)(e).handleGetRowId,s={};l.forEach((e,t)=>{var l=d(e),r=n[l],o=t+1;r?(a||(r.seq=o),r._index=t):(r={row:e,rowid:l,seq:o,index:-1,$index:-1,_index:t,treeIndex:-1,items:[],parent:null,level:0,height:0,resizeHeight:0,oTop:0,expandHeight:0},n[l]=r,i[l]=r),s[l]=e}),t.afterFullRowMaps=s}function updateAfterDataIndex(e){var t=e;let r=e.treeConfig,{fullDataRowIdData:n,fullAllDataRowIdData:d,afterFullData:l,afterTreeFullData:o}=t;var a=e.computeTreeOpts,s=a.transform,u=a.children||a.childrenField;let c={};if(r){let i=(0,_util.createHandleGetRowId)(e).handleGetRowId;_xeUtils.default.eachTree(o,(e,t,l,r)=>{var o=i(e),a=d[o],r=r.map((e,t)=>t%2==0?Number(e)+1:".").join("");a?(a.seq=r,a.treeIndex=t):(a={row:e,rowid:o,seq:r,index:-1,$index:-1,_index:-1,treeIndex:-1,items:[],parent:null,level:0,height:0,resizeHeight:0,oTop:0,expandHeight:0},d[o]=a,n[o]=a),c[o]=e},{children:s?a.mapChildrenField:u}),s&&l.forEach((e,t)=>{var e=i(e),e=d[e],l=t+1;e&&(r||(e.seq=l),e._index=t)}),t.afterFullRowMaps=c}else updateAfterListIndex(e)}function handleVirtualTreeToList(e){var t=e,l=e.treeConfig,r=e.isRowGroupStatus;let{fullAllDataRowIdData:n,treeExpandedMaps:d,rowGroupExpandedMaps:s}=t;var o=e.computeAggregateOpts,a=e.computeTreeOpts;let u=(0,_util.createHandleGetRowId)(e).handleGetRowId,c=[],h={};return l&&a.transform?(l=a.children||a.childrenField,_xeUtils.default.eachTree(t.afterTreeFullData,(e,t,l,r,o)=>{var a=u(e),i=u(o);(!o||h[i]&&d[i])&&((o=n[a])&&(o._index=c.length),h[a]=1,c.push(e))},{children:l}),updateScrollYStatus(e,t.afterFullData=c),c):r?(a=o.childrenField,_xeUtils.default.eachTree(t.afterGroupFullData,(e,t,l,r,o)=>{var a=u(e),i=u(o);(!o||h[i]&&s[i])&&((o=n[a])&&(o._index=c.length),h[a]=1,c.push(e))},{children:a}),updateScrollYStatus(e,t.afterFullData=c),c):t.afterFullData}function updateAfterFullData(u){var e=u,t=u.treeConfig,l=u.isRowGroupStatus,{tableFullColumn:r,tableFullData:o,tableFullTreeData:n,tableFullGroupData:d}=e,s=u.computeFilterOpts,c=u.computeAggregateOpts,h=u.computeTreeOpts,g=h.children||h.childrenField,{transform:h,rowField:p,parentField:f,mapChildrenField:m}=h;let{isEvery:x,remote:v,filterMethod:w}=s,{remote:C,sortMethod:R,multiple:b,chronological:E}=u.computeSortOpts,_=[],T=[];if(v&&C)l?(T=_xeUtils.default.searchTree(d,()=>!0,{original:!0,isEvery:!0,children:c.mapChildrenField,mapChildren:c.childrenField}),_=T):t&&h?(T=_xeUtils.default.searchTree(n,()=>!0,{original:!0,isEvery:x,children:m,mapChildren:g}),_=T):(_=(t?n:o).slice(0),T=_);else{let a=[],i=[];if(r.forEach(e=>{var{field:t,sortable:l,order:r,filters:o}=e;if(!v&&o&&o.length){let t=[],l=[];o.forEach(e=>{e.checked&&(l.push(e),t.push(e.value))}),l.length&&a.push({column:e,valueList:t,itemList:l})}!C&&l&&r&&i.push({column:e,field:t,property:t,order:r,sortTime:e.sortTime})}),b&&E&&1<i.length&&(i=_xeUtils.default.orderBy(i,"sortTime")),!v&&a.length?(s=s=>a.every(({column:t,valueList:e,itemList:l})=>{let{filterMethod:r,filterRender:o}=t;var a=(0,_utils.isEnableConf)(o)?renderer.get(o.name):null;let i=a?a.tableFilterMethod||a.filterMethod:null,n=a?a.tableFilterDefaultMethod||a.defaultTableFilterMethod||a.defaultFilterMethod:null,d=(0,_util.getCellValue)(s,t);return r?l.some(e=>r({value:e.value,option:e,cellValue:d,row:s,column:t,$table:u})):i?l.some(e=>i({value:e.value,option:e,cellValue:d,row:s,column:t,$table:u})):w?w({$table:u,options:l,values:e,cellValue:d,row:s,column:t}):n?l.some(e=>n({value:e.value,option:e,cellValue:d,row:s,column:t,$table:u})):-1<e.indexOf(_xeUtils.default.get(s,t.field))}),l?(T=_xeUtils.default.searchTree(d,s,{original:!0,isEvery:!0,children:c.mapChildrenField,mapChildren:c.childrenField}),_=T):t&&h?(T=_xeUtils.default.searchTree(n,s,{original:!0,isEvery:x,children:m,mapChildren:g}),_=T):(_=(t?n:o).filter(s),T=_)):l?(T=_xeUtils.default.searchTree(d,()=>!0,{original:!0,isEvery:!0,children:c.mapChildrenField,mapChildren:c.childrenField}),_=T):t&&h?(T=_xeUtils.default.searchTree(n,()=>!0,{original:!0,isEvery:x,children:m,mapChildren:g}),_=T):(_=(t?n:o).slice(0),T=_),!C&&i.length)if(l)T=R?(r=R({data:T,sortList:i,$table:u}),_xeUtils.default.isArray(r)?r:T):(s=_xeUtils.default.toTreeArray(T,{key:c.rowField,parentKey:c.parentField,children:c.mapChildrenField}),_xeUtils.default.toArrayTree(_xeUtils.default.orderBy(s,i.map(({column:e,order:t})=>[getOrderField(u,e),t])),{key:c.rowField,parentKey:c.parentField,children:c.childrenField,mapChildren:c.mapChildrenField})),_=T;else if(t&&h)T=R?(d=R({data:T,sortList:i,$table:u}),_xeUtils.default.isArray(d)?d:T):(n=_xeUtils.default.toTreeArray(T,{children:m}),_xeUtils.default.toArrayTree(_xeUtils.default.orderBy(n,i.map(({column:e,order:t})=>[getOrderField(u,e),t])),{key:p,parentKey:f,children:g,mapChildren:m})),_=T;else{if(R){o=R({data:_,sortList:i,$table:u});_=_xeUtils.default.isArray(o)?o:_}else{if(b)_=_xeUtils.default.orderBy(_,i.map(({column:e,order:t})=>[getOrderField(u,e),t]));else{let t=i[0],e;_xeUtils.default.isArray(t.sortBy)&&(e=t.sortBy.map(e=>[e,t.order])),_=_xeUtils.default.orderBy(_,e||[t].map(({column:e,order:t})=>[getOrderField(u,e),t]))}_=_xeUtils.default.orderBy(_,i.map(({column:e,order:t})=>[getOrderField(u,e),t]))}T=_}}e.afterFullData=_,e.afterTreeFullData=T,e.afterGroupFullData=T,updateAfterDataIndex(u)}function updateStyle(t){let{showHeaderOverflow:v,showFooterOverflow:w,mouseConfig:e,spanMethod:C,footerSpanMethod:R}=t,{isGroup:b,currentRow:l,tableColumn:E,scrollXLoad:_,scrollYLoad:T,overflowX:S,scrollbarWidth:r,overflowY:o,scrollbarHeight:a,scrollXWidth:y,columnStore:i,editStore:n,isAllOverflow:D,expandColumn:I,isColLoading:F}=t,{visibleColumn:k,tableHeight:M,headerHeight:O,footerHeight:$,elemStore:A,customHeight:L,customMinHeight:d,customMaxHeight:U}=t;var s=t.$refs.refElem;if(s){let h=o?r:0,g=S?a:0;var u=t.$refs.refEmptyPlaceholder,c=t.computeMouseOpts;let p=t.computeExpandOpts;var H=(0,_util.getRefElem)(A["main-body-wrapper"]),z=(0,_util.getRefElem)(A["main-body-table"]);u&&(u.style.top=O+"px",u.style.height=H?H.offsetHeight-g+"px":"");let f=0,m=0,x=d-O-$-g;U&&(m=Math.max(x,U-O-$-g)),(f=L?L-O-$-g:f)||z&&(f=z.clientHeight),f&&(m&&(f=Math.min(m,f)),f=Math.max(x,f));var u=t.$refs.computeScrollbarXToTop,H=t.$refs.refScrollXLeftCornerElem,z=t.$refs.refScrollXRightCornerElem,V=t.$refs.refScrollXVirtualElem,V=(V&&(V.style.height=g+"px",V.style.visibility=S?"visible":"hidden"),t.$refs.refScrollXWrapperElem),V=(V&&(V.style.left=u?h+"px":"",V.style.width=s.clientWidth-h+"px"),H&&(H.style.width=u?h+"px":"",H.style.display=u&&S&&g?"block":""),z&&(z.style.width=u?"":h+"px",z.style.display=!u&&S&&g?"block":""),t.$refs.refScrollYVirtualElem),s=(V&&(V.style.width=h+"px",V.style.height=f+O+$+"px",V.style.visibility=o?"visible":"hidden"),t.$refs.refScrollYTopCornerElem),H=(s&&(s.style.height=O+"px",s.style.display=o&&O?"block":""),t.$refs.refScrollYWrapperElem),z=(H&&(H.style.height=f+"px",H.style.top=O+"px"),t.$refs.refScrollYBottomCornerElem),u=(z&&(z.style.height=$+"px",z.style.top=O+f+"px",z.style.display=o&&$?"block":""),t.$refs.refRowExpandElem);return u&&(u.style.height=f+"px",u.style.top=O+"px"),["main","left","right"].forEach((d,e)=>{let s=0<e?d:"";e="left"===s;let u=[],c;s&&(u=e?i.leftList:i.rightList,c=e?t.$refs.refLeftContainer:t.$refs.refRightContainer),["header","body","footer"].forEach(l=>{var r=(0,_util.getRefElem)(A[d+`-${l}-wrapper`]),o=(0,_util.getRefElem)(A[d+`-${l}-scroll`]),a=(0,_util.getRefElem)(A[d+`-${l}-table`]);if("header"===l){let e=E,t=!1;b?e=k:(_&&v&&(C||R||(t=!0)),t&&(F||!s&&S)||(e=k),s&&t&&(e=u||[]));var i=e.reduce((e,t)=>e+t.renderWidth,0);s&&(!b&&t?r&&(r.style.width=i?i+"px":""):r&&(r.style.width=y?y+"px":"")),o&&(o.style.height=O+"px"),a&&(a.style.width=i?i+"px":"")}else if("body"===l){o&&(o.style.maxHeight=U?m+"px":"",o.style.height=L?f+"px":"",o.style.minHeight=x+"px"),c&&(r&&(r.style.top=O+"px"),c.style.height=`${0<L?L:M+O+$+g}px`,c.style.width=u.reduce((e,t)=>e+t.renderWidth,0)+"px");let e=E,t=!1;!(_||T||D)||I&&"fixed"!==p.mode||C||R||(t=!0);var i=(e=s&&(e=k,t)?u||[]:e).reduce((e,t)=>e+t.renderWidth,0),n=(s&&(t?r&&(r.style.width=i?i+"px":""):r&&(r.style.width=y?y+"px":"")),a&&(a.style.width=i?i+"px":"",a.style.paddingRight=h&&s&&(browseObj.firefox||browseObj.safari)?h+"px":""),(0,_util.getRefElem)(A[d+`-${l}-emptyBlock`]));n&&(n.style.width=i?i+"px":"")}else if("footer"===l){let e=E,t=!1;_&&w&&(C||R||(t=!0)),t&&(F||!s&&S)||(e=k);n=(e=s&&t?u||[]:e).reduce((e,t)=>e+t.renderWidth,0);s&&(t?r&&(r.style.width=n?n+"px":""):r&&(r.style.width=y?y+"px":"")),o&&(o.style.height=$+"px",c)&&r&&(r.style.top=`${0<L?L-$-g:M+O}px`),a&&(a.style.width=n?n+"px":"")}})}),l&&t.setCurrentRow(l),e&&c.selected&&n.selected.row&&n.selected.column&&t.addCellSelectedClass(),t.$nextTick()}}function checkValidate(e,t){return e.triggerValidate?e.triggerValidate(t):e.$nextTick()}function handleChangeCell(e,t,l){checkValidate(e,"blur").catch(e=>e).then(()=>{e.handleEdit(l,t).then(()=>checkValidate(e,"change")).catch(e=>e)})}function handleDefaultSort(r){var t=r.sortConfig;if(t){var l=r.computeSortOpts;let e=l.defaultSort;e&&(e=_xeUtils.default.isArray(e)?e:[e]).length&&((t.multiple?e:e.slice(0,1)).forEach((e,t)=>{var{field:e,order:l}=e;e&&l&&(e=r.getColumnByField(e))&&e.sortable&&(e.order=l,e.sortTime=Date.now()+t)}),l.remote||r.handleTableData(!0).then(updateStyle))}}function handleDefaultSelectionChecked(e){var t=e.checkboxConfig;if(t){let l=e.fullDataRowIdData;var{checkAll:t,checkRowKeys:r}=e.computeCheckboxOpts;if(t)handleCheckedAllCheckboxRow(e,!0,!0);else if(r){let t=[];r.forEach(e=>{l[e]&&t.push(l[e].row)}),handleCheckedCheckboxRow(e,t,!0,!0)}}}function handleDefaultRadioChecked(e){var t,l,r=e,o=e.radioConfig;o&&(o=r.fullDataRowIdData,{checkRowKey:t,reserve:l}=e.computeRadioOpts,t)&&(o[t]&&handleCheckedRadioRow(o[t].row,!0),l)&&(o=(0,_util.getRowkey)(e),r.radioReserveRow={[o]:t})}function handleDefaultRowExpand(e){var t=e.expandConfig;if(t){let l=e.fullDataRowIdData;var{expandAll:t,expandRowKeys:r}=e.computeExpandOpts;if(t)e.setAllRowExpand(!0);else if(r){let t=[];r.forEach(e=>{l[e]&&t.push(l[e].row)}),e.setRowExpand(t,!0)}}}function handleRadioReserveRow(e,t){var l=e;e.computeRadioOpts.reserve&&(l.radioReserveRow=t)}function handleCheckboxReserveRow(e,t,l){var r=e.checkboxReserveRowMap;e.computeCheckboxOpts.reserve&&(e=(0,_util.getRowid)(e,t),l?r[e]=t:r[e]&&delete r[e])}function handleCheckedRadioRow(e,t,l){var r=e,o=e.computeRadioOpts.checkMethod;return t&&(l||!o||o({$table:e,row:t}))&&handleRadioReserveRow(e,r.selectRadioRow=t),e.$nextTick()}function handleCheckedCheckboxRow(e,t,l,r){return t&&!_xeUtils.default.isArray(t)&&(t=[t]),e.handleBatchSelectRows(t,!!l,r),e.checkSelectionStatus(),e.$nextTick()}function handleCheckedAllCheckboxRow(l,t,r){var e=l,o=l;let a=l.treeConfig,i=e.isRowGroupStatus,{afterFullData:n,afterTreeFullData:d,afterGroupFullData:s,checkboxReserveRowMap:u,selectCheckboxMaps:c}=o;var h=l.computeTreeOpts,g=l.computeAggregateOpts,h=h.children||h.childrenField,p=l.computeCheckboxOpts;let{checkField:f,reserve:m,checkMethod:x}=p,v=(0,_util.createHandleGetRowId)(l).handleGetRowId,w=p.indeterminateField||p.halfField,C={};return f?(p=e=>{!r&&x&&!x({$table:l,row:e})||(t&&(C[v(e)]=e),_xeUtils.default.set(e,f,t)),(a||i)&&w&&_xeUtils.default.set(e,w,!1)},a||i?_xeUtils.default.eachTree(n,p,{children:h}):n.forEach(p)):i?t?_xeUtils.default.eachTree(s,e=>{var t;!r&&x&&!x({$table:l,row:e})||(t=v(e),C[t]=e)},{children:g.mapChildrenField}):!r&&x&&_xeUtils.default.eachTree(s,e=>{var t=v(e);!x({$table:l,row:e})&&c[t]&&(C[t]=e)},{children:g.mapChildrenField}):a?t?_xeUtils.default.eachTree(d,e=>{var t;!r&&x&&!x({$table:l,row:e})||(t=v(e),C[t]=e)},{children:h}):!r&&x&&_xeUtils.default.eachTree(d,e=>{var t=v(e);!x({$table:l,row:e})&&c[t]&&(C[t]=e)},{children:h}):t?!r&&x?n.forEach(e=>{var t=v(e);(c[t]||x({$table:l,row:e}))&&(C[t]=e)}):n.forEach(e=>{var t=v(e);C[t]=e}):!r&&x&&n.forEach(e=>{var t=v(e);!x({$table:l,row:e})&&c[t]&&(C[t]=e)}),m&&(t?_xeUtils.default.each(C,(e,t)=>{u[t]=e}):n.forEach(e=>handleCheckboxReserveRow(l,e,!1))),e.updateCheckboxFlag++,o.selectCheckboxMaps=f?{}:C,e.isAllSelected=t,e.isIndeterminate=!1,o.treeIndeterminateRowMaps={},l.checkSelectionStatus(),l.$nextTick()}function handleReserveStatus(e){var t=e,l=e,r=e.treeConfig,{expandColumn:o,currentRow:a,selectRadioRow:i}=t,{fullDataRowIdData:n,fullAllDataRowIdData:d,radioReserveRow:s,selectCheckboxMaps:u,treeExpandedMaps:c,rowExpandedMaps:h}=l,g=e.computeExpandOpts,p=e.computeTreeOpts,f=e.computeRadioOpts,m=e.computeCheckboxOpts;i&&!d[(0,_util.getRowid)(e,i)]&&(t.selectRadioRow=null),f.reserve&&s&&n[i=(0,_util.getRowid)(e,s)]&&handleCheckedRadioRow(e,n[i].row,!0),l.selectCheckboxMaps=getRecoverRowMaps(e,u),t.updateCheckboxFlag++,m.reserve&&handleCheckedCheckboxRow(e,handleReserveRow(e,l.checkboxReserveRowMap),!0,!0),a&&!d[(0,_util.getRowid)(e,a)]&&(t.currentRow=null),l.rowExpandedMaps=o?getRecoverRowMaps(e,h):{},t.rowExpandedFlag++,o&&g.reserve&&e.setRowExpand(handleReserveRow(e,l.rowExpandedReserveRowMap),!0),l.treeExpandedMaps=r?getRecoverRowMaps(e,c):{},t.treeExpandedFlag++,r&&p.reserve&&e.setTreeExpand(handleReserveRow(e,l.treeExpandedReserveRowMap),!0)}let handleDefaultTreeExpand=e=>{var t=e.treeConfig;if(t){let o=e.tableFullData;var t=e.computeTreeOpts,{expandAll:l,expandRowKeys:i}=t;let a=t.children||t.childrenField;if(l)e.setAllTreeExpand(!0);else if(i){let l=[],r=(0,_util.getRowkey)(e);i.forEach(t=>{var e=_xeUtils.default.findTree(o,e=>t===_xeUtils.default.get(e,r),{children:a});e&&l.push(e.item)}),e.setTreeExpand(l,!0)}}},handleAsyncTreeExpandChilds=(a,i)=>{let n=a,d=a;let{transform:s,loadMethod:u}=a.computeTreeOpts,c=a.computeCheckboxOpts.checkStrictly;return new Promise(o=>{if(u){let{fullAllDataRowIdData:e,treeExpandLazyLoadedMaps:t}=d,l=(0,_util.getRowid)(a,i),r=e[l];t[l]=i,Promise.resolve(u({$table:a,row:i})).then(e=>{if(r&&(r.treeLoaded=!0),t[l]&&delete t[l],e=_xeUtils.default.isArray(e)?e:[])return a.loadTreeChildren(i,e).then(e=>{var t=d.treeExpandedMaps;return e.length&&!t[l]&&(t[l]=i),n.treeExpandedFlag++,!c&&a.isCheckedByCheckboxRow(i)&&handleCheckedCheckboxRow(a,e,!0),a.$nextTick().then(()=>{if(s)return a.handleTableData(),updateAfterDataIndex(a),a.$nextTick()})})}).catch(()=>{var e=d.treeExpandLazyLoadedMaps;r&&(r.treeLoaded=!1),e[l]&&delete e[l]}).finally(()=>{n.treeExpandedFlag++,a.$nextTick().then(()=>a.recalculate()).then(()=>o())})}else o()})},handleTreeExpandReserve=(e,t,l)=>{var r=e.treeExpandedReserveRowMap;e.computeTreeOpts.reserve&&(e=(0,_util.getRowid)(e,t),l?r[e]=t:r[e]&&delete r[e])},handleAsyncRowExpand=(i,n)=>{let d=i,s=i;return new Promise(r=>{var e=i.computeExpandOpts.loadMethod;if(e){var{fullAllDataRowIdData:o,rowExpandLazyLoadedMaps:a}=s;let t=(0,_util.getRowid)(i,n),l=o[t];a[t]=n,e({$table:i,row:n,rowIndex:i.getRowIndex(n),$rowIndex:i.getVMRowIndex(n)}).then(()=>{var e=s.rowExpandedMaps;l&&(l.expandLoaded=!0),e[t]=n,d.rowExpandedFlag++}).catch(()=>{l&&(l.expandLoaded=!1)}).finally(()=>{var e=s.rowExpandLazyLoadedMaps;e[t]&&delete e[t],d.rowExpandedFlag++,i.$nextTick().then(()=>i.recalculate()).then(()=>i.updateCellAreas()).then(()=>r())})}else r()})};function calcVarRowHeightConfig(e,t,l){e=e.rowHeightStore;l&&l.clientHeight&&(e[t]=l.clientHeight)}function computeRowHeight(e){var t=e.isAllOverflow,l=e.$refs.refTableHeader,r=e.$refs.refTableBody,r=r?r.$el:null,e=e.computeDefaultRowHeight;let o=0;if(t){if(r){t=l?l.$el:null;let e;(e=!(e=r.querySelector("tr"))&&t?t.querySelector("tr"):e)&&(o=e.clientHeight)}o=o||e}else o=e;return Math.max(18,o)}function handleVirtualYVisible(t){var{isAllOverflow:l,expandColumn:a,isScrollYBig:i,scrollYHeight:n}=t,{elemStore:d,isResizeCellHeight:s,afterFullData:u,fullAllDataRowIdData:c}=t,h=t.computeRowOpts,g=t.computeCellOpts,p=t.computeDefaultRowHeight,d=(0,_util.getRefElem)(d["main-body-scroll"]);if(d){var f=d.clientHeight;let e=d.scrollTop;var m=e=i?Math.ceil((n-f)*Math.min(1,e/(maxYHeight-f))):e,x=e+f;let r=-1,o=0;if(s||g.height||h.height||a||!l){var v=(0,_util.createHandleGetRowId)(t).handleGetRowId;let l=0,e=u.length;for(;l<e;){var w=Math.floor((l+e)/2);(c[v(u[w])]||{}).oTop<=m?l=w+1:e=w}for(let e=r=l===u.length?l:Math.max(0,l<u.length?l-2:0),t=u.length;e<t;e++){var C=c[v(u[e])]||{};if(o++,C.oTop>x||100<=o)break}}else r=Math.floor(m/p)-1,o=Math.ceil(f/p)+1;return{toVisibleIndex:Math.max(0,r),visibleSize:Math.max(6,o)}}return{toVisibleIndex:0,visibleSize:6}}function calculateMergerOffsetIndex(l,r,o){for(let e=0,t=l.length;e<t;e++){var a=l[e],{startIndex:i,endIndex:n}=r,d=a[o],a=d+a[o+"span"];d<i&&i<a&&(r.startIndex=d),d<n&&n<a&&(r.endIndex=a),r.startIndex===i&&r.endIndex===n||(e=-1)}}function buildMergeData(t){var l={};if(t&&t.length)for(let e=0;e<t.length;e++){var{row:r,col:o,rowspan:a,colspan:i}=t[e];for(let t=0;t<a;t++)for(let e=0;e<i;e++)l[r+t+":"+(o+e)]=t||e?{rowspan:0,colspan:0}:{rowspan:a,colspan:i}}return l}let handleBodyMerge=(e,t)=>{let{fullAllDataRowIdData:d,fullColumnIdData:s,visibleColumn:u,afterFullData:c,mergeBodyList:h,mergeBodyMaps:g}=e;if(t){let n=(0,_util.createHandleGetRowId)(e).handleGetRowId;(t=_xeUtils.default.isArray(t)?t:[t]).forEach(l=>{let{row:e,col:t,rowspan:r,colspan:o}=l,a=-1,i=-1;if(_xeUtils.default.isNumber(e)?a=e:(l=(l=e?n(e):null)?d[l]:null)&&(a=l._index),_xeUtils.default.isNumber(t)?i=t:(l=(l=t?t.id:null)?s[l]:null)&&(i=l._index),-1<a&&-1<i&&(r||o)&&(r=_xeUtils.default.toNumber(r)||1,o=_xeUtils.default.toNumber(o)||1,1<r||1<o)){let e=c[a];l=u[i];let t=g[a+":"+i];t?(t.rowspan=r,t.colspan=o,t._rowspan=r,t._colspan=o):(t={row:a,col:i,rowspan:r,colspan:o,_row:e,_col:l,_rowspan:r,_colspan:o},g[a+":"+i]=t,h.push(t))}})}},handleFooterMerge=(e,t)=>{let d=e.footerTableData,{mergeFooterList:s,mergeFooterMaps:u,fullColumnIdData:c}=e;if(t){let n=e.visibleColumn;(t=_xeUtils.default.isArray(t)?t:[t]).forEach(t=>{var{row:t,col:l,rowspan:r,colspan:o}=t,t=_xeUtils.default.isNumber(t)?t:-1;let a=-1;if(_xeUtils.default.isNumber(l)?a=l:(l=(l=l?l.id:null)?c[l]:null)&&(a=l._index),-1<t&&-1<a&&(r||o)&&(r=_xeUtils.default.toNumber(r)||1,o=_xeUtils.default.toNumber(o)||1,1<r||1<o)){var l=d[t],i=n[a];let e=u[t+":"+a];e?(e.rowspan=r,e.colspan=o,e._rowspan=r,e._colspan=o):(e={row:t,col:a,rowspan:r,colspan:o,_row:l,_col:i,_rowspan:r,_colspan:o},u[t+":"+a]=e,s.push(e))}})}};function removeBodyMerges(e,t){let{mergeBodyList:a,fullColumnIdData:i,fullAllDataRowIdData:n,mergeBodyMaps:d}=e,s=[];if(t){let o=(0,_util.createHandleGetRowId)(e).handleGetRowId;(t=_xeUtils.default.isArray(t)?t:[t]).forEach(e=>{var{row:e,col:t}=e;let l=-1,r=-1;_xeUtils.default.isNumber(e)?l=e:(e=(e=e?o(e):null)?n[e]:null)&&(l=e._index),_xeUtils.default.isNumber(t)?r=t:(t=(e=t?t.id:null)?i[e]:null)&&(r=t._index);t=_xeUtils.default.findIndexOf(a,e=>e.row===l&&e.col===r);if(-1<t){t=a.splice(t,1);let e=t[0];e&&(s.push(t[0]),d[l+":"+r])&&delete d[l+":"+r]}})}return s}function removeFooterMerges(e,t){let{mergeFooterList:o,fullColumnIdData:a,mergeFooterMaps:i}=e,n=[];return t&&(t=_xeUtils.default.isArray(t)?t:[t]).forEach(e=>{var{row:e,col:t}=e;let l=_xeUtils.default.isNumber(e)?e:-1,r=-1;_xeUtils.default.isNumber(t)?r=t:(t=(e=t?t.id:null)?a[e]:null)&&(r=t._index);t=_xeUtils.default.findIndexOf(o,e=>e.row===l&&e.col===r);if(-1<t){let e=o.splice(t,1)[0];e&&(n.push(e),i[l+":"+r])&&delete i[l+":"+r]}}),n}function handleSortEvent(i,e,t,l){let{multiple:r,remote:o,orders:n}=i.computeSortOpts;if((t=_xeUtils.default.isArray(t)?t:[t])&&t.length){r||(t=[t[0]],clearAllSort(i));let a=null;return t.forEach((e,t)=>{let{field:l,order:r}=e,o=l;_xeUtils.default.isString(l)&&(o=i.getColumnByField(l)),a=a||o,o&&o.sortable&&(n&&-1===n.indexOf(r)&&(r=getNextSortOrder(i,o)),o.order!==r&&(o.order=r),o.sortTime=Date.now()+t)}),l&&!o&&i.handleTableData(!0),e&&i.handleColumnSortEvent(e,a),i.$nextTick().then(()=>(updateRowOffsetTop(i),i.updateCellAreas(),updateStyle(i)))}return i.$nextTick()}function clearAllSort(e){e=e.tableFullColumn;e.forEach(e=>{e.order=null})}function calcTableHeight(e,t){var l=e.parentHeight,t=e[t];let r=0;return r=t?"100%"===t||"auto"===t?l:(e=e.getExcludeHeight(),r=(0,_dom.isScale)(t)?Math.floor((_xeUtils.default.toInteger(t)||1)/100*l):_xeUtils.default.toNumber(t),Math.max(40,r-e)):r}function autoCellWidth(e){var t=e,o=e,a=e.elemStore,a=(0,_util.getRefElem)(a["main-body-wrapper"]);if(a){var i=e.$refs.refScrollYHandleElem;if(i)if(e.$refs.refScrollXHandleElem){let l=0;i=a.clientWidth,a=i;let r=a/100;var t=t.fit,n=o.columnStore,{resizeList:n,pxMinList:d,autoMinList:s,pxList:u,scaleList:c,scaleMinList:h,autoList:g,remainList:p}=n;if(d.forEach(e=>{var t=_xeUtils.default.toInteger(e.minWidth);l+=t,e.renderWidth=t}),s.forEach(e=>{var t=Math.max(60,_xeUtils.default.toInteger(e.renderAutoWidth));l+=t,e.renderWidth=t}),h.forEach(e=>{var t=Math.floor(_xeUtils.default.toInteger(e.minWidth)*r);l+=t,e.renderWidth=t}),c.forEach(e=>{var t=Math.floor(_xeUtils.default.toInteger(e.width)*r);l+=t,e.renderWidth=t}),u.forEach(e=>{var t=_xeUtils.default.toInteger(e.width);l+=t,e.renderWidth=t}),g.forEach(e=>{var t=Math.max(60,_xeUtils.default.toInteger(e.renderAutoWidth));l+=t,e.renderWidth=t}),n.forEach(e=>{var t=_xeUtils.default.toInteger(e.resizeWidth);l+=t,e.renderWidth=t}),a-=l,r=0<a?Math.floor(a/(h.length+d.length+s.length+p.length)):0,t?0<a&&h.concat(d).concat(s).forEach(e=>{l+=r,e.renderWidth+=r}):r=40,p.forEach(e=>{var t=Math.max(r,40);e.renderWidth=t,l+=t}),t){var f=c.concat(h).concat(d).concat(s).concat(p);let t=f.length-1;if(0<t){let e=i-l;if(0<e){for(;0<e&&0<=t;)e--,f[t--].renderWidth++;l=i}}}o.scrollXWidth=l,o.resizeWidthFlag++,updateColumnOffsetLeft(e),updateHeight(e)}}}let calcCellAutoHeight=(e,t)=>{var l=t.querySelectorAll(`.vxe-cell--wrapper[rowid="${e.rowid}"]`);let r=e.height;for(let e=0;e<l.length;e++){var o=l[e],a=o.parentElement,a=Math.ceil(_xeUtils.default.toNumber(a.style.paddingTop)+_xeUtils.default.toNumber(a.style.paddingBottom)),o=o?o.clientHeight:0;r=Math.max(r-a,Math.ceil(o))}return r},calcCellHeight=e=>{var t=e;let{tableData:r,isAllOverflow:l,scrollYLoad:o,scrollXLoad:a}=t,i=e.fullAllDataRowIdData,n=e.computeDefaultRowHeight,d=e.$refs.refElem;if(!l&&o&&d){let l=(0,_util.createHandleGetRowId)(e).handleGetRowId;r.forEach(e=>{var t,e=l(e),e=i[e];e&&(t=calcCellAutoHeight(e,d),e.height=Math.max(n,a?Math.max(e.height,t):t))}),t.calcCellHeightFlag++}};function getOrderField(l,r){let{sortBy:o,sortType:a}=r;return e=>{let t;return t=o?_xeUtils.default.isFunction(o)?o({row:e,column:r}):_xeUtils.default.get(e,o):l.getCellLabel(e,r),a&&"auto"!==a?"number"===a?_xeUtils.default.toNumber(t):"string"===a?_xeUtils.default.toValueString(t):t:isNaN(t)?t:_xeUtils.default.toNumber(t)}}function handleTargetEnterEvent(e,t){var l=e.$refs.refTooltip;clearTimeout(e.tooltipTimeout),t?e.closeTooltip():l&&l.setActived&&l.setActived(!0)}function clearDragStatus(e){var t=e,{dragRow:l,dragCol:r}=t;(l||r)&&(clearColDropOrigin(e),clearRowDropOrigin(e),hideDropTip(e),t.dragRow=null,t.dragCol=null,t.isDragColMove=!1,t.isDragRowMove=!1)}function clearRowDropOrigin(e){e=e.$el;if(e){let t="row--drag-origin";_xeUtils.default.arrayEach(e.querySelectorAll("."+t),e=>{(e.draggable=!1,_dom.removeClass)(e,t)})}}function updateRowDropOrigin(e,t){var l=e.$el;if(l){e=(0,_util.getRowid)(e,t);_xeUtils.default.arrayEach(l.querySelectorAll(`[rowid="${e}"]`),e=>{(0,_dom.addClass)(e,"row--drag-origin")})}}function updateRowDropTipContent(e,t){var l=e,r=e.dragConfig,o=l.dragRow,a=e.computeRowDragOpts.tooltipMethod,a=a||(r?r.rowTooltipMethod:null);let i="";i=a?""+(a({$table:e,row:o})||""):getI18n("vxe.table.dragTip",[t.textContent||""]),l.dragTipText=i}function updateColDropOrigin(e,l){e=e.$el;if(e){let t=[];_xeUtils.default.eachTree([l],e=>{t.push(`[colid="${e.id}"]`)});_xeUtils.default.arrayEach(e.querySelectorAll(t.join(",")),e=>{(0,_dom.addClass)(e,"col--drag-origin")})}}function clearColDropOrigin(e){e=e.$el;if(e){let t="col--drag-origin";_xeUtils.default.arrayEach(e.querySelectorAll("."+t),e=>{(e.draggable=!1,_dom.removeClass)(e,t)})}}function updateColDropTipContent(e,t){var l=e,r=l.dragCol,o=e.computeColumnDragOpts.tooltipMethod;let a="";a=o?""+(o({$table:e,column:r})||""):getI18n("vxe.table.dragTip",[t.textContent||""]),l.dragTipText=a}function showDropTip(l,e,r,o,t,a){var i=l,n=l,d=l.$refs.refElem;if(d){var{overflowX:i,scrollbarWidth:s,overflowY:u,scrollbarHeight:c}=i,n=n.prevDragToChild,h=d.getBoundingClientRect(),u=u?s:0,s=i?c:0,i=d.clientWidth,c=d.clientHeight;if(r){var g=l.$refs.refDragRowLineElem;if(g)if(t){var p=l.computeScrollbarYToLeft,f=r.getBoundingClientRect();let e=r.clientHeight;r=Math.max(1,f.y-h.y);r+e>c-s&&(e=c-r-s),g.style.display="block",g.style.left=`${p?u:0}px`,g.style.top=r+"px",g.style.height=e+"px",g.style.width=i-u+"px",g.setAttribute("drag-pos",a),g.setAttribute("drag-to-child",n?"y":"n")}else g.style.display=""}else if(o){f=l.$refs.refDragColLineElem;if(f)if(t){var p=l.computeScrollbarXToTop,r=l.$refs.refLeftContainer,g=r?r.clientWidth:0,r=l.$refs.refRightContainer,r=r?r.clientWidth:0,m=o.getBoundingClientRect();let e=o.clientWidth;o=Math.max(0,m.y-h.y);let t=m.x-h.x;t<g&&(e-=g-t,t=g);g=i-r-(r?0:u);t+e>g&&(e=g-t),f.style.display="block",f.style.top=o+"px",f.style.left=t+"px",f.style.width=e+"px",f.style.height=n?m.height+"px":c-o-(p?0:s)+"px",f.setAttribute("drag-pos",a),f.setAttribute("drag-to-child",n?"y":"n")}else f.style.display=""}i=l.$refs.refDragTipElem;i&&(i.style.display="block",i.style.top=Math.min(d.clientHeight-d.scrollTop-i.clientHeight,e.clientY-h.y)+"px",i.style.left=Math.min(d.clientWidth-d.scrollLeft-i.clientWidth-16,e.clientX-h.x)+"px",i.setAttribute("drag-status",t?n?"sub":"normal":"disabled"))}}function hideDropTip(e){var t=e.$refs.refDragTipElem,l=e.$refs.refDragRowLineElem,e=e.$refs.refDragColLineElem;t&&(t.style.display=""),l&&(l.style.display=""),e&&(e.style.display="")}function handleTooltip(r,e,o,a,i,n){var d=r;let s=a||o;if(s){n.cell=o;var a=d.tooltipStore,{column:o,row:d}=n,{showAll:u,contentMethod:c}=r.computeTooltipOpts,n=c?c(n):null,c=c&&!_xeUtils.default.eqNull(n);let t=c?n:_xeUtils.default.toString("html"===o.type?s.innerText:s.textContent).trim(),l=s.scrollWidth>s.clientWidth;t&&(u||c||l)&&(Object.assign(a,{row:d,column:o,visible:!0,currOpts:{}}),r.$nextTick(()=>{var e=r.$refs.refTooltip;e&&e.open&&e.open(l?s:i,(0,_utils.formatText)(t))}))}return r.$nextTick()}function handleScrollToRowColumn(e,t,l){var r=e.fullColumnIdData,t=(0,_util.handleFieldOrColumn)(e,t);return t&&r[t.id]?(0,_util.colToVisible)(e,t,l):e.$nextTick()}function handleRowExpandReserve(e,t,l){var r=e.rowExpandedReserveRowMap;e.computeExpandOpts.reserve&&(e=(0,_util.getRowid)(e,t),l?r[e]=t:r[e]&&delete r[e])}function handleDefaultMergeCells(e){var t=e.mergeCells;t&&e.setMergeCells(t)}function handleDefaultMergeFooterItems(e){var t=e.mergeFooterItems;t&&e.setMergeFooterItems(t)}function computeScrollLoad(d){let s=d,u=d;return d.$nextTick().then(()=>{var e,{scrollXLoad:t,scrollYLoad:l}=s,{scrollXStore:r,scrollYStore:o}=u,a=d.computeVirtualYOpts,i=d.computeVirtualXOpts,i=(t?({toVisibleIndex:t,visibleSize:e}=handleVirtualXVisible(d),n=Math.max(0,i.oSize?_xeUtils.default.toNumber(i.oSize):0),r.preloadSize=_xeUtils.default.toNumber(i.preSize),r.offsetSize=n,r.visibleSize=e,r.endIndex=Math.max(r.startIndex+r.visibleSize+n,r.endIndex),r.visibleStartIndex=Math.max(r.startIndex,t),r.visibleEndIndex=Math.min(r.endIndex,t+e),d.updateScrollXData().then(()=>{loadScrollXData(d)})):d.updateScrollXSpace(),computeRowHeight(d)),{toVisibleIndex:n,visibleSize:r}=(o.rowHeight=i,s.rowHeight=i,handleVirtualYVisible(d));l?(t=Math.max(0,a.oSize?_xeUtils.default.toNumber(a.oSize):0),o.preloadSize=_xeUtils.default.toNumber(a.preSize),o.offsetSize=t,o.visibleSize=r,o.endIndex=Math.max(o.startIndex+r+t,o.endIndex),o.visibleStartIndex=Math.max(o.startIndex,n),o.visibleEndIndex=Math.min(o.endIndex,n+r),d.updateScrollYData().then(()=>{loadScrollYData(d)})):d.updateScrollYSpace()})}function calcScrollbar(e){var t=e,l=e,{scrollXWidth:r,scrollYHeight:o}=t,a=l.elemStore,i=e.computeScrollbarOpts,n=(0,_util.getRefElem)(a["main-body-wrapper"]),d=(0,_util.getRefElem)(a["main-header-table"]),a=(0,_util.getRefElem)(a["main-footer-table"]),s=e.$refs.refScrollXHandleElem,u=e.$refs.refScrollYHandleElem;let c=!1;n&&(o=o>n.clientHeight,u&&(t.scrollbarWidth=i.width||u.offsetWidth-u.clientWidth||14),t.overflowY=o,c=r>n.clientWidth,s&&(t.scrollbarHeight=i.height||s.offsetHeight-s.clientHeight||14),t.overflowX=c,u=d?d.clientHeight:0,o=a?a.clientHeight:0,l.tableHeight=n.offsetHeight,l.headerHeight=u,l.footerHeight=o,t.parentHeight=Math.max(l.headerHeight+o+20,e.getParentHeight())),c&&e.checkScrolling()}function handleRecalculateLayout(e,t){var l,r,o=e,a=e.$refs.refElem;return o.rceRunTime=Date.now(),a&&a.clientWidth?((o=e.$refs.refVarElem)&&([a,o,l,r]=o.children,calcVarRowHeightConfig(e,"default",a),calcVarRowHeightConfig(e,"medium",o),calcVarRowHeightConfig(e,"small",l),calcVarRowHeightConfig(e,"mini",r)),calcCellWidth(e),autoCellWidth(e),calcScrollbar(e),updateStyle(e),updateRowExpandStyle(e),computeScrollLoad(e).then(()=>{if(calcCellWidth(e),t&&autoCellWidth(e),calcScrollbar(e),updateStyle(e),t&&updateRowOffsetTop(e),updateRowExpandStyle(e),t)return computeScrollLoad(e)})):e.$nextTick()}let handleUpdateRowGroup=(e,t)=>{e.rowGroupList=t?(_xeUtils.default.isArray(t)?t:[t]).map(e=>({field:e})):[]};function handleeGroupSummary(e,t){let l=e.computeAggregateOpts.mapChildrenField;l&&(_xeUtils.default.lastEach(t,e=>{let t=0;_xeUtils.default.each(e[l],e=>{e.isAggregate?t+=e.childCount||0:t++}),e.childCount=t}),e.handlePivotTableAggregateData)&&e.handlePivotTableAggregateData(t)}function updateGroupData(e){var{aggregateConfig:t,rowGroupConfig:l}=e,r=e.isRowGroupStatus,o=e.tableFullGroupData,a=e.computeAggregateOpts.mapChildrenField;if((t||l)&&r){let t=[];_xeUtils.default.eachTree(o,e=>{e.isAggregate&&t.push(e)},{children:a}),handleeGroupSummary(e,t)}}function handleGroupData(p,e,f){let m=e,x=e;if(f){let{rowField:d,parentField:s,childrenField:u,mapChildrenField:c}=p.computeAggregateOpts;var t=p.computeCheckboxOpts;let h=t.checkField,g=t.indeterminateField||t.halfField;t=f[0];if(t&&d&&s&&u&&c){m=[],x=[];let r=t.field,o=p.getColumnByField(r),a={},i=[],n=(0,_util.getRowkey)(p);e.forEach(e=>{var t=o?p.getCellLabel(e,o):_xeUtils.default.get(e,r),t=_xeUtils.default.eqNull(t)?"":t;let l=a[t];l||(l=[],a[t]=l),e.isAggregate&&(e.isAggregate=void 0),l.push(e)}),_xeUtils.default.objectEach(a,(e,t)=>{var{fullData:e,treeData:l}=handleGroupData(p,e,f.slice(1)),t={isAggregate:!0,aggData:{},groupContent:t,groupField:r,childCount:0,[d]:(0,_util.getRowUniqueId)(),[s]:null,[n]:(0,_util.getRowUniqueId)(),[u]:l,[c]:l};h&&(t[h]=!1),g&&(t[g]=!1),i.push(t),x.push(t),m.push(t),e.length&&m.push(...e)}),handleeGroupSummary(p,i)}}return{treeData:x,fullData:m}}function loadTableData(r,e,t){let l=r,o=r;var a=r,{keepSource:i,treeConfig:n,aggregateConfig:d,rowGroupConfig:s}=l;let{rowGroupList:u,scrollYLoad:c}=o,{scrollYStore:h,scrollXStore:g,lastScrollLeft:p,lastScrollTop:f}=a;var m=r.computeRowOpts,x=r.computeTreeOpts;let v=r.computeExpandOpts;var w=x.transform,C=x.children||x.childrenField;let R=[],b=e?e.slice(0):[];if(b.length>supportMaxRow&&(0,_log.errLog)("vxe.error.errMaxRow",[supportMaxRow]),n&&u.length)return(0,_log.errLog)("vxe.error.noTree",["aggregate-config"]),r.$nextTick();if(m.drag&&u.length)return(0,_log.errLog)("vxe.error.errConflicts",["row-config.drag","aggregate-config"]),r.$nextTick();let E=!1,_=(n?w?(x.rowField||(0,_log.errLog)("vxe.error.reqProp",["tree-config.rowField"]),x.parentField||(0,_log.errLog)("vxe.error.reqProp",["tree-config.parentField"]),C||(0,_log.errLog)("vxe.error.reqProp",["tree-config.childrenField"]),x.mapChildrenField||(0,_log.errLog)("vxe.error.reqProp",["tree-config.mapChildrenField"]),C===x.mapChildrenField&&(0,_log.errLog)("vxe.error.errConflicts",["tree-config.childrenField","tree-config.mapChildrenField"]),R=_xeUtils.default.toArrayTree(b,{key:x.rowField,parentKey:x.parentField,children:C,mapChildren:x.mapChildrenField}),b=R.slice(0)):R=b.slice(0):(d||s)&&u.length&&(m=handleGroupData(r,b,u),R=m.treeData,b=m.fullData,E=!0),o.isRowGroupStatus=E,h.startIndex=0,h.endIndex=1,g.startIndex=0,g.endIndex=1,a.cvCacheMaps={},o.isRowLoading=!0,o.scrollVMLoading=!1,a.treeExpandedMaps={},o.treeExpandedFlag++,a.rowExpandedMaps={},o.rowExpandedFlag++,a.insertRowMaps={},o.insertRowFlag++,a.removeRowMaps={},o.removeRowFlag++,updateScrollYStatus(r,b));return o.isDragColMove=!1,o.isDragRowMove=!1,a.tableFullData=b,a.tableFullTreeData=E?[]:R,a.tableFullGroupData=E?R:[],r.cacheRowMap(t),a.tableSynchData=e,t&&(a.isResizeCellHeight=!1),i&&r.cacheSourceMap(b),r.clearCellAreas&&l.mouseConfig&&(r.clearCellAreas(),r.clearCopyCellArea()),r.clearMergeCells(),r.clearMergeFooterItems(),r.handleTableData(!0),r.updateFooter(),r.handleUpdateBodyMerge(),r.$nextTick().then(()=>{updateHeight(r),updateStyle(r)}).then(()=>{computeScrollLoad(r)}).then(()=>(_&&(h.endIndex=h.visibleSize),_&&(o.expandColumn&&"fixed"!==v.mode&&(0,_log.errLog)("vxe.error.notConflictProp",['column.type="expand','expand-config.mode="fixed"']),l.height||l.maxHeight||(0,_log.errLog)("vxe.error.reqProp",["height | max-height | virtual-y-config={enabled: false}"]),l.spanMethod)&&(0,_log.errLog)("vxe.error.scrollErrProp",["table.span-method"]),handleReserveStatus(r),r.checkSelectionStatus(),new Promise(l=>{r.$nextTick().then(()=>handleRecalculateLayout(r,!1)).then(()=>(calcCellHeight(r),updateRowOffsetTop(r),handleRecalculateLayout(r,!1))).then(()=>{let e=p,t=f;r.computeVirtualXOpts.scrollToLeftOnChange&&(e=0),r.computeVirtualYOpts.scrollToTopOnChange&&(t=0),o.isRowLoading=!1,handleRecalculateLayout(r,!1),c===_?(0,_util.restoreScrollLocation)(r,e,t).then(()=>{calcCellHeight(r),updateRowOffsetTop(r),l()}):setTimeout(()=>{(0,_util.restoreScrollLocation)(r,e,t).then(()=>{calcCellHeight(r),updateRowOffsetTop(r),l()})})})})))}function handleLoadDefaults(e){handleDefaultSelectionChecked(e),handleDefaultRadioChecked(e),handleDefaultRowExpand(e),handleDefaultTreeExpand(e),handleDefaultMergeCells(e),handleDefaultMergeFooterItems(e),e.$nextTick(()=>setTimeout(()=>e.recalculate()))}function handleInitDefaults(e){handleDefaultSort(e)}function handleTableColumn(e){var t=e,l=t.scrollXLoad;let{visibleColumn:r,scrollXStore:o,fullColumnIdData:a}=e;e=l?r.slice(o.startIndex,o.endIndex):r.slice(0);e.forEach((e,t)=>{e=e.id,e=a[e];e&&(e.$index=t)}),t.tableColumn=e}function handleUpdateColumn(e){var t=e,l=_xeUtils.default.orderBy(t.collectColumn,"renderSortNumber"),l=getColumnList(t.collectColumn=l);t.tableFullColumn=l,cacheColumnMap(e)}function loadScrollXData(e){var t=e.isScrollXBig,{mergeBodyList:l,mergeFooterList:r,scrollXStore:o}=e,{preloadSize:a,startIndex:i,endIndex:n,offsetSize:d}=o,{toVisibleIndex:s,visibleSize:u}=handleVirtualXVisible(e),t={startIndex:Math.max(0,t?s-1:s-1-d-a),endIndex:t?s+u:s+u+d+a},{startIndex:d,endIndex:a}=(o.visibleStartIndex=s-1,o.visibleEndIndex=s+u+1,calculateMergerOffsetIndex(l.concat(r),t,"col"),t);!(s<=i||n-u-1<=s)||i===d&&n===a||(o.startIndex=d,o.endIndex=a,e.updateScrollXData()),e.closeTooltip()}function getColumnList(e){let t=[];return e.forEach(e=>{t.push(...e.children&&e.children.length?getColumnList(e.children):[e])}),t}function parseColumns(e,t){var l=e,o=e,r=e;let i=[],n=[],d=[];var{isGroup:a,columnStore:s}=o;let{collectColumn:u,tableFullColumn:c,scrollXStore:h,fullColumnIdData:g}=r;if(a){let t=[],l=[],r=[];_xeUtils.default.eachTree(u,(e,t,l,r,o)=>{var a=(0,_utils.hasChildrenList)(e);o&&o.fixed&&(e.fixed=o.fixed),o&&e.fixed!==o.fixed&&(0,_log.errLog)("vxe.error.groupFixed"),a?e.visible=!!_xeUtils.default.findTree(e.children,e=>!(0,_utils.hasChildrenList)(e)&&e.visible):e.visible&&("left"===e.fixed?i:"right"===e.fixed?d:n).push(e)}),u.forEach(e=>{e.visible&&("left"===e.fixed?t:"right"===e.fixed?r:l).push(e)}),o.tableGroupColumn=t.concat(l).concat(r)}else c.forEach(e=>{e.visible&&("left"===e.fixed?i:"right"===e.fixed?d:n).push(e)});let p=i.concat(n).concat(d);r.visibleColumn=p,updateColumnOffsetLeft(e);a=updateScrollXStatus(e);return o.hasFixedColumn=0<i.length||0<d.length,Object.assign(s,{leftList:i,centerList:n,rightList:d}),a&&(l.spanMethod&&(0,_log.warnLog)("vxe.error.scrollErrProp",["span-method"]),l.footerSpanMethod&&(0,_log.warnLog)("vxe.error.scrollErrProp",["footer-span-method"]),t)&&(o=handleVirtualXVisible(e).visibleSize,h.startIndex=0,h.endIndex=o,h.visibleSize=o,h.visibleStartIndex=0,h.visibleEndIndex=o),p.length===r.visibleColumn.length&&r.visibleColumn.every((e,t)=>e===p[t])||(e.clearMergeCells(),e.clearMergeFooterItems()),p.forEach((e,t)=>{e=e.id,e=g[e];e&&(e._index=t)}),handleTableColumn(e),t?e.updateFooter().then(()=>e.recalculate()).then(()=>(e.updateCellAreas(),e.recalculate())):e.updateFooter()}function initColumnSort(e){e=e.collectColumn;e.forEach((e,t)=>{t+=1;e.sortNumber=t,e.renderSortNumber=t})}function handleColumn(r,e){let o=r.$refs.$xeToolbar,a=r,i=r,n=r.computeExpandOpts;e=getColumnList(i.collectColumn=e);return i.tableFullColumn=e,a.isColLoading=!0,a.isDragColMove=!1,initColumnSort(r),Promise.resolve(restoreCustomStorage(r)).then(()=>{var{scrollXLoad:e,scrollYLoad:t,expandColumn:l}=a;return cacheColumnMap(r),parseColumns(r,!0).then(()=>{a.scrollXLoad&&loadScrollXData(r)}),r.clearMergeCells(),r.clearMergeFooterItems(),r.handleTableData(!0),r.handleAggregateSummaryData(),(e||t)&&l&&"fixed"!==n.mode&&(0,_log.warnLog)("vxe.error.scrollErrProp",["column.type=expand"]),r.$nextTick().then(()=>(o&&o.syncUpdate({collectColumn:i.collectColumn,$table:r}),r.handleUpdateCustomColumn&&r.handleUpdateCustomColumn(),a.isColLoading=!1,r.recalculate()))})}function loadScrollYData(e){var{isAllOverflow:t,isScrollYBig:l}=e,{mergeBodyList:r,scrollYStore:o}=e,{preloadSize:a,startIndex:i,endIndex:n,offsetSize:d}=o,t=t?d:d+1,{toVisibleIndex:s,visibleSize:u}=handleVirtualYVisible(e),d={startIndex:Math.max(0,l?s-1:s-1-d-a),endIndex:l?s+u:s+u+t+a},{startIndex:l,endIndex:t}=(o.visibleStartIndex=s-1,o.visibleEndIndex=s+u+1,calculateMergerOffsetIndex(r,d,"row"),d);!(s<=i||n-u-1<=s)||i===l&&n===t||(o.startIndex=l,o.endIndex=t,e.updateScrollYData())}let createGetRowCacheProp=l=>function(e){var t=this.fullAllDataRowIdData;if(e){t=t[(0,_util.getRowid)(this,e)];if(t)return t[l]}return-1},createGetColumnCacheProp=l=>function(e){var t=this.fullColumnIdData;if(e){t=t[e.id];if(t)return t[l]}return-1};function lazyScrollXData(e){let t=e;var{lxTimeout:l,lxRunTime:r,scrollXStore:o}=t,o=o.visibleSize,o=26<o?26:16<o?14:6;l&&clearTimeout(l),(!r||r+o<Date.now())&&(t.lxRunTime=Date.now(),loadScrollXData(e)),t.lxTimeout=setTimeout(()=>{t.lxTimeout=void 0,t.lxRunTime=void 0,loadScrollXData(e)},o)}function lazyScrollYData(e){let t=e;var{lyTimeout:l,lyRunTime:r,scrollYStore:o}=t,o=o.visibleSize,o=30<o?32:20<o?18:8;l&&clearTimeout(l),(!r||r+o<Date.now())&&(t.lyRunTime=Date.now(),loadScrollYData(e)),t.lyTimeout=setTimeout(()=>{t.lyTimeout=void 0,t.lyRunTime=void 0,loadScrollYData(e)},o)}function checkLastSyncScroll(e,t,l){let r=e,{scrollXLoad:o,scrollYLoad:a,isAllOverflow:i}=e;var n=r.lcsTimeout;n&&clearTimeout(n),r.lcsTimeout=setTimeout(()=>{r.lcsRunTime=Date.now(),r.lcsTimeout=void 0,r.intoRunScroll=!1,r.inVirtualScroll=!1,r.inWheelScroll=!1,r.inHeaderScroll=!1,r.inBodyScroll=!1,r.inFooterScroll=!1,r.scrollRenderType="",i||(calcCellHeight(e),updateRowOffsetTop(e)),t&&o&&e.updateScrollXData(),l&&a&&e.updateScrollYData().then(()=>{i||(calcCellHeight(e),updateRowOffsetTop(e)),e.updateScrollYSpace()}),e.updateCellAreas()},200)}let getWheelSpeed=e=>{let t=1;var l=Date.now();return l<e+25?t=1.18:l<e+30?t=1.15:l<e+40?t=1.12:l<e+55?t=1.09:l<e+75?t=1.06:l<e+100&&(t=1.03),t},wheelScrollLeftTo=(e,t)=>{requestAnimationFrame(()=>{t(e)})},wheelScrollTopTo=(l,r)=>{let o=Math.abs(l),a=performance.now(),i=0,n=e=>{let t=(e-a)/o;1<t&&(t=1);e=Math.pow(t,2),e=Math.floor(l*e)-i;i+=e,r(e),t<1&&requestAnimationFrame(n)};requestAnimationFrame(n)};function updateHeight(e){var t=e,l=e;l.customHeight=calcTableHeight(e,"height"),l.customMinHeight=calcTableHeight(e,"minHeight"),l.customMaxHeight=calcTableHeight(e,"maxHeight"),!t.scrollYLoad||l.customHeight||l.customMinHeight||(l.customHeight=300)}function calcColumnAutoWidth(e,t){var l=t.querySelectorAll(`.vxe-cell--wrapper[colid="${e.id}"]`);let r=0;var t=l[0];t&&t.parentElement&&(t=getComputedStyle(t.parentElement),r=Math.ceil(_xeUtils.default.toNumber(t.paddingLeft)+_xeUtils.default.toNumber(t.paddingRight)));let o=e.renderAutoWidth-r;for(let e=0;e<l.length;e++){var a=l[e];o=Math.max(o,a?Math.ceil(a.scrollWidth)+4:0)}return o+r}function calcCellWidth(e){var t=e.computeAutoWidthColumnList;let r=e.fullColumnIdData,o=e.$refs.refElem;o&&(o.setAttribute("data-calc-col","Y"),t.forEach(e=>{var t=e.id,t=r[t],l=calcColumnAutoWidth(e,o);t&&(t.width=Math.max(l,t.width)),e.renderAutoWidth=l}),e.analyColumnWidth(),o.removeAttribute("data-calc-col"))}function handleUpdateColResize(e,t,l){e.analyColumnWidth(),e.recalculate().then(()=>{e.saveCustomStore("update:width"),e.updateCellAreas(),e.dispatchEvent("column-resizable-change",l,t),e.dispatchEvent("resizable-change",l,t),setTimeout(()=>e.recalculate(!0),300)})}function handleUpdateRowResize(e,t,l){e.resizeHeightFlag++,e.recalculate().then(()=>{e.updateCellAreas(),e.dispatchEvent("row-resizable-change",l,t),setTimeout(()=>e.recalculate(!0),300)})}function updateColumnOffsetLeft(e){var{visibleColumn:l,fullColumnIdData:r}=e;let o=0;for(let e=0,t=l.length;e<t;e++){var a=l[e],i=r[a.id];i&&(i.oLeft=o),o+=a.renderWidth}}function updateRowOffsetTop(e){var l=e.expandColumn,{afterFullData:r,fullAllDataRowIdData:o,rowExpandedMaps:a}=e,i=e.computeExpandOpts,n=e.computeRowOpts,d=e.computeCellOpts,s=e.computeDefaultRowHeight,u=(0,_util.createHandleGetRowId)(e).handleGetRowId;let c=0;for(let e=0,t=r.length;e<t;e++){var h=u(r[e]),g=o[h]||{};g.oTop=c,c+=g.resizeHeight||d.height||n.height||g.height||s,l&&a[h]&&(c+=g.expandHeight||i.height||0)}}function updateRowExpandStyle(t){var l=t;let{expandColumn:e,scrollYLoad:d,scrollYTop:s,isScrollYBig:u}=l;var r=t.computeExpandOpts;let c=t.computeRowOpts,h=t.computeCellOpts,g=t.computeDefaultRowHeight;r=r.mode;if(e&&"fixed"===r){let{elemStore:e,fullAllDataRowIdData:i}=t;r=t.$refs.refRowExpandElem;let n=(0,_util.getRefElem)(e["main-body-scroll"]);if(r&&n){let a=!1;_xeUtils.default.arrayEach(r.children,t=>{var l=t.getAttribute("rowid")||"",r=i[l];if(r){var o=t.offsetHeight+1,l=n.querySelector(`.vxe-body--row[rowid="${l}"]`);let e=0;d?e=u&&l?l.offsetTop+l.offsetHeight:r.oTop+(r.resizeHeight||h.height||c.height||r.height||g):l&&(e=l.offsetTop+l.offsetHeight),u&&(e+=s),t.style.top=(0,_dom.toCssUnit)(e),a||r.expandHeight!==o&&(a=!0),r.expandHeight=o}}),a&&(l.rowExpandHeightFlag++,t.$nextTick(()=>{updateRowOffsetTop(t)}))}}}function handleRowExpandScroll(e){var t=e.elemStore,e=e.$refs.refRowExpandElem,t=(0,_util.getRefElem)(t["main-body-scroll"]);e&&t&&(e.scrollTop=t.scrollTop)}let Methods={callSlot(e,t,l,r){var o=this.$xeGrid;if(e){if(o)return o.callSlot(e,t,l,r);if(_xeUtils.default.isFunction(e))return(0,_vn.getSlotVNs)(e.call(this,t,l,r))}return[]},getEl(){return this.$refs.refElem},getParentElem(){var e=this.$xeGrid,t=this.$el;return(e?e.$el:t).parentNode},getParentHeight(){var t=this.$xeGrid,l=this.height,r=this.$refs.refElem;if(r){r=r.parentNode,l="100%"===l||"auto"===l?(0,_dom.getPaddingTopBottomSize)(r):0;let e=0;return r&&(e=t&&(0,_dom.hasClass)(r,"vxe-grid--table-wrapper")?t.getParentHeight():r.clientHeight),Math.floor(e-l)}return 0},getExcludeHeight(){var e=this.$xeGrid;return e?e.getExcludeHeight():0},clearAll(){return(0,_util.clearTableAllStatus)(this)},handleUpdateRowGroup(e){handleUpdateRowGroup(this,e)},syncData(){let e=this,t=e,l=e;return(0,_log.errLog)("vxe.error.delFunc",["syncData","getData"]),e.$nextTick().then(()=>(t.tableData=[],e.$nextTick().then(()=>loadTableData(e,l.tableFullData,!0))))},updateData(){let e=this;let{scrollXLoad:t,scrollYLoad:l}=e;return e.handleTableData(!0).then(()=>{if(e.updateFooter(),t||l)return t&&e.updateScrollXSpace(),l&&e.updateScrollYSpace(),e.refreshScroll()}).then(()=>(e.updateCellAreas(),e.recalculate(!0))).then(()=>{setTimeout(()=>e.recalculate(),50)})},handleTableData(e){let o=this;var t=o,l=o,r=t.scrollYLoad;let{scrollYStore:a,fullDataRowIdData:i}=l,n=l.afterFullData;e&&(updateAfterFullData(o),n=handleVirtualTreeToList(o));e=r?n.slice(a.startIndex,a.endIndex):n.slice(0);let d={};return e.forEach((e,t)=>{var l=(0,_util.getRowid)(o,e),r=i[l];r&&(r.$index=t),d[l]=e}),t.tableData=e,l.visibleDataRowIdData=d,o.$nextTick()},loadTableData(e,t){return loadTableData(this,e,t)},loadData(e){let t=this,l=this.initStatus;return loadTableData(t,e,!1).then(()=>(this.inited=!0,this.initStatus=!0,l||handleLoadDefaults(t),this.recalculate()))},reloadData(e){let t=this;return this.clearAll().then(()=>(this.inited=!0,this.initStatus=!0,loadTableData(t,e,!0))).then(()=>(handleLoadDefaults(t),this.recalculate()))},setRow(t,l){if(l){let e=t;(e=_xeUtils.default.isArray(t)?e:[t]).forEach(e=>Object.assign(e,l))}return this.$nextTick()},reloadRow(e,t,l){var r=this,o=r,a=r.keepSource,i=o.tableData,n=r.sourceDataRowIdData;if(a){if(r.isAggregateRecord(e))return r.$nextTick();a=n[(0,_util.getRowid)(r,e)];a&&e&&(l?(n=_xeUtils.default.clone(_xeUtils.default.get(t||e,l),!0),_xeUtils.default.set(e,l,n),_xeUtils.default.set(a,l,n)):(l=(0,_util.getRowkey)(r),n=(0,_util.getRowid)(r,e),t=_xeUtils.default.clone(Object.assign({},t),!0),_xeUtils.default.set(t,l,n),_xeUtils.default.destructuring(a,Object.assign(e,t)))),o.tableData=i.slice(0)}else(0,_log.errLog)("vxe.error.reqProp",["keep-source"]);return r.$nextTick()},loadColumn(e){let o=this;let{lastScrollLeft:a,lastScrollTop:i}=o;e=_xeUtils.default.mapTree(e,e=>_cell.default.createColumn(o,e),{children:"children"});return handleColumn(o,e).then(()=>{let e=a,t=i;var l=o.computeVirtualXOpts,r=o.computeVirtualYOpts;l.scrollToLeftOnChange&&(e=0),r.scrollToTopOnChange&&(t=0),(0,_util.restoreScrollLocation)(o,e,t)})},reloadColumn(e){return this.clearAll().then(()=>this.loadColumn(e))},handleColumn(e){return handleColumn(this,e)},cacheRowMap(e){var t=this,l=t,r=t;let u=t.treeConfig;var o=l.isRowGroupStatus;let{fullAllDataRowIdData:a,tableFullData:i,tableFullTreeData:c,tableFullGroupData:n,treeExpandedMaps:h}=r,s=e?{}:Object.assign({},a),g={},p=(0,_util.createHandleUpdateRowId)(t).handleUpdateRowId,f=(e,t,l,r,o,a,i,n)=>{let d=s[a];(d=d||{row:e,rowid:a,seq:n,index:-1,_index:-1,$index:-1,treeIndex:t,items:l,parent:o,level:i,height:0,resizeHeight:0,oTop:0,expandHeight:0}).treeLoaded=!1,d.expandLoaded=!1,d.row=e,d.items=l,d.parent=o,d.level=i,d.index=r,d.treeIndex=t,g[a]=d,s[a]=d};if(u){var e=t.computeTreeOpts;let n=e.lazy,d=e.children||e.childrenField,s=e.hasChild||e.hasChildField;_xeUtils.default.eachTree(c,(e,t,l,r,o,a)=>{var i=p(e);u&&n&&(e[s]&&void 0===e[d]&&(e[d]=null),!h[i]||e[d]&&e[d].length||delete h[i]),f(e,t,l,o?-1:t,o,i,a.length-1,(0,_util.toTreePathSeq)(r))},{children:d})}else o?(e=t.computeAggregateOpts.mapChildrenField,_xeUtils.default.eachTree(n,(e,t,l,r,o,a)=>{var i=p(e);f(e,t,l,o?-1:t,o,i,a.length-1,(0,_util.toTreePathSeq)(r))},{children:e})):i.forEach((e,t,l)=>{f(e,t,l,t,null,p(e),0,t+1)});r.fullDataRowIdData=g,r.fullAllDataRowIdData=s,l.treeExpandedFlag++},cacheSourceMap(e){var t=this,l=this.treeConfig,r=this.computeTreeOpts,e=_xeUtils.default.clone(e,!0);let o=(0,_util.createHandleUpdateRowId)(this).handleUpdateRowId,a={};var i=e=>{var t=o(e);a[t]=e};l?(l=r.children||r.childrenField,_xeUtils.default.eachTree(e,i,{children:r.transform?r.mapChildrenField:l})):e.forEach(i),t.sourceDataRowIdData=a,t.tableSourceData=e},getParams(){return this.params},loadTreeChildren(r,e){let n=this;var t=n,l=n;let o=t.keepSource,{tableSourceData:a,fullDataRowIdData:d,fullAllDataRowIdData:s,sourceDataRowIdData:i}=l;t=n.computeTreeOpts;let{transform:u,mapChildrenField:c}=t,h=t.children||t.childrenField,g=s[(0,_util.getRowid)(n,r)],p=g?g.level:0;return this.createData(e).then(e=>{if(o){let t=(0,_util.getRowid)(this,r);var l=_xeUtils.default.findTree(a,e=>t===(0,_util.getRowid)(this,e),{children:h});l&&(l.item[h]=_xeUtils.default.clone(e,!0)),e.forEach(e=>{var t=(0,_util.getRowid)(this,e);i[t]=_xeUtils.default.clone(e,!0)})}return _xeUtils.default.eachTree(e,(e,t,l,r,o,a)=>{var i=(0,_util.getRowid)(n,e),e={row:e,rowid:i,seq:-1,index:t,_index:-1,$index:-1,treeIndex:-1,items:l,parent:o||g.row,level:p+a.length,height:0,resizeHeight:0,oTop:0,expandHeight:0};d[i]=e,s[i]=e},{children:h}),r[h]=e,u&&(r[c]=_xeUtils.default.clone(e,!1)),updateAfterDataIndex(n),e})},getRowNode(e){if(e){var t=this.fullAllDataRowIdData,e=e.getAttribute("rowid");if(e){t=t[e];if(t)return{rowid:t.rowid,item:t.row,index:t.index,items:t.items,parent:t.parent}}}return null},getColumnNode(e){if(e){var t=this.fullColumnIdData,e=e.getAttribute("colid");if(e){t=t[e];if(t)return{colid:t.colid,item:t.column,index:t.index,items:t.items,parent:t.parent}}}return null},getRowSeq:createGetRowCacheProp("seq"),getRowIndex:createGetRowCacheProp("index"),getVTRowIndex:createGetRowCacheProp("_index"),getVMRowIndex:createGetRowCacheProp("$index"),_getRowIndex(e){return(0,_log.warnLog)("vxe.error.delFunc",["_getRowIndex","getVTRowIndex"]),this.getVTRowIndex(e)},$getRowIndex(e){return(0,_log.warnLog)("vxe.error.delFunc",["$getRowIndex","getVMRowIndex"]),this.getVMRowIndex(e)},getColumnIndex:createGetColumnCacheProp("index"),getVTColumnIndex:createGetColumnCacheProp("_index"),getVMColumnIndex:createGetColumnCacheProp("$index"),_getColumnIndex(e){return(0,_log.warnLog)("vxe.error.delFunc",["_getColumnIndex","getVTColumnIndex"]),this.getVTColumnIndex(e)},$getColumnIndex(e){return(0,_log.warnLog)("vxe.error.delFunc",["$getColumnIndex","getVMColumnIndex"]),this.getVMColumnIndex(e)},isSeqColumn(e){return e&&"seq"===e.type},defineField(e){var t=this;let l=t,r=t.treeConfig,a=t.computeExpandOpts,i=t.computeTreeOpts,n=t.computeRadioOpts,d=t.computeCheckboxOpts,s=i.children||i.childrenField,u=(0,_util.getRowkey)(t);return(e=_xeUtils.default.isArray(e)?e:[e||{}]).map(o=>(l.tableFullColumn.forEach(t=>{var{field:l,editRender:r}=t;if(l&&!_xeUtils.default.has(o,l)){let e=null;r&&(r=r.defaultValue,_xeUtils.default.isFunction(r)?e=r({column:t}):_xeUtils.default.isUndefined(r)||(e=r)),_xeUtils.default.set(o,l,e)}}),[n.labelField,d.checkField,d.labelField,a.labelField].forEach(e=>{e&&(0,_utils.eqEmptyValue)(_xeUtils.default.get(o,e))&&_xeUtils.default.set(o,e,null)}),r&&i.lazy&&_xeUtils.default.isUndefined(o[s])&&(o[s]=null),(0,_utils.eqEmptyValue)(_xeUtils.default.get(o,u))&&_xeUtils.default.set(o,u,(0,_util.getRowUniqueId)()),o))},createData(e){let t=this;return t.$nextTick().then(()=>t.defineField(e))},createRow(e){let t=_xeUtils.default.isArray(e);return t||(e=[e]),this.createData(e).then(e=>t?e:e[0])},revertData(e,r){let o=this;var t=o,l=o,{keepSource:t,treeConfig:a}=t;let{fullAllDataRowIdData:i,fullDataRowIdData:n,tableSourceData:d,sourceDataRowIdData:s,tableFullData:u,afterFullData:c,removeRowMaps:h}=o;var g=o.computeTreeOpts.transform;let p=(0,_util.createHandleGetRowId)(o).handleGetRowId;if(!t)return(0,_log.errLog)("vxe.error.reqProp",["keep-source"]),o.$nextTick();let f=e,m=(e?_xeUtils.default.isArray(e)||(f=[e]):f=_xeUtils.default.toArray(o.getUpdateRecords()),!1);return f.length&&f.forEach(e=>{var t,e=p(e),l=i[e];l&&(l=l.row,o.isInsertByRow(l)||(t=s[e])&&l&&(r?_xeUtils.default.set(l,r,_xeUtils.default.clone(_xeUtils.default.get(t,r),!0)):_xeUtils.default.destructuring(l,_xeUtils.default.clone(t,!0)),!n[e])&&o.isRemoveByRow(l)&&(h[e]&&delete h[e],u.unshift(l),c.unshift(l),m=!0))}),e?(m&&(l.removeRowFlag++,o.updateFooter(),o.cacheRowMap(!1),o.handleTableData(a&&g),a&&g||o.updateAfterDataIndex(),o.checkSelectionStatus(),l.scrollYLoad)&&o.updateScrollYSpace(),o.$nextTick().then(()=>(o.updateCellAreas(),o.recalculate()))):o.reloadData(d)},clearData(e,t){let{tableFullData:l,visibleColumn:r}=this;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=l,t?e.forEach(e=>_xeUtils.default.set(e,t,null)):e.forEach(t=>{r.forEach(e=>{e.field&&(0,_util.setCellValue)(t,e,null)})}),this.$nextTick()},getCellElement(e,t){var l=this.elemStore,t=(0,_util.handleFieldOrColumn)(this,t);if(!t)return null;var e=(0,_util.getRowid)(this,e),r=(0,_util.getRefElem)(l["main-body-scroll"]),o=(0,_util.getRefElem)(l["left-body-scroll"]),l=(0,_util.getRefElem)(l["right-body-scroll"]);let a;return t&&(t.fixed&&("left"===t.fixed?o&&(a=o):l&&(a=l)),a=a||r)?a.querySelector(`.vxe-body--row[rowid="${e}"] .`+t.id):null},getCellLabel(t,l){l=(0,_util.handleFieldOrColumn)(this,l);if(!l)return null;var r=l.formatter,o=(0,_util.getCellValue)(t,l);let a=o;if(r){let e;var i=this.fullAllDataRowIdData,n=(0,_util.getRowid)(this,t),d=l.id,s=i[n];if(s&&(e=(e=s.formatData)||(i[n].formatData={}),s)&&e[d]&&e[d].value===o)return e[d].label;i={cellValue:o,row:t,rowIndex:this.getRowIndex(t),column:l,columnIndex:this.getColumnIndex(l)};a=_xeUtils.default.isString(r)?(s=(n=formats.get(r))?n.tableCellFormatMethod||n.cellFormatMethod:null)?s(i):"":_xeUtils.default.isArray(r)?(l=(t=formats.get(r[0]))?t.tableCellFormatMethod||t.cellFormatMethod:null)?l(i,...r.slice(1)):"":r(i),e&&(e[d]={value:o,label:a})}return a},isInsertByRow(e){e=(0,_util.getRowid)(this,e);return!!this.insertRowFlag&&!!this.insertRowMaps[e]},isRemoveByRow(e){e=(0,_util.getRowid)(this,e);return!!this.removeRowFlag&&!!this.removeRowMaps[e]},removeInsertRow(){var e=this.insertRowMaps;return this.remove(_xeUtils.default.values(e))},isUpdateByRow(e,t){var l=this.keepSource,{tableFullColumn:r,fullDataRowIdData:o,sourceDataRowIdData:a}=this;if(l){l=_xeUtils.default.isString(e)||_xeUtils.default.isNumber(e)?e:(0,_util.getRowid)(this,e),e=o[l];if(!e)return!1;var i=e.row,n=a[l];if(n){if(1<arguments.length)return!eqCellValue(n,i,t);for(let e=0,t=r.length;e<t;e++){var d=r[e].field;if(d&&!eqCellValue(n,i,d))return!0}}}return!1},getColumns(e){var t=this.visibleColumn;return _xeUtils.default.isUndefined(e)?t.slice(0):t[e]},getColid(e){e=(0,_util.handleFieldOrColumn)(this,e);return e?e.id:null},getColumnById(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField(e){var t=this.fullColumnFieldData;return t[e]?t[e].column:null},getParentColumn(e){var t=this.fullColumnIdData,e=(0,_util.handleFieldOrColumn)(this,e);return e&&e.parentId&&t[e.parentId]?t[e.parentId].column:null},getTableColumn(){var e=this,t=this;return{collectColumn:t.collectColumn.slice(0),fullColumn:t.tableFullColumn.slice(0),visibleColumn:t.visibleColumn.slice(0),tableColumn:e.tableColumn.slice(0)}},moveColumnTo(e,l,t){var{fullColumnIdData:r,visibleColumn:o}=this,{dragToChild:t,dragPos:a,isCrossDrag:i}=Object.assign({},t),e=(0,_util.handleFieldOrColumn)(this,e);let n=null;var d=e?r[e.id]:null;let s="left";if(_xeUtils.default.isNumber(l)){if(d&&l){let e=d.items,t=d._index+l;i&&(e=o,t=d._index+l),0<t&&t<e.length-1&&(n=e[t]),0<l&&(s="right")}}else{i=(n=(0,_util.handleFieldOrColumn)(this,l))?r[n.id]:null;d&&i&&i._index>d._index&&(s="right")}return this.handleColDragSwapEvent(null,!0,e,n,a||s,!0===t)},moveRowTo(e,l,t){var r=this,o=r.treeConfig,{fullAllDataRowIdData:a,afterFullData:i}=r,{dragToChild:t,dragPos:n,isCrossDrag:d}=Object.assign({},t),s=r.computeTreeOpts,e=(0,_util.handleRowidOrRow)(r,e);let u=null,c="top";var h=e?a[(0,_util.getRowid)(r,e)]:null;if(_xeUtils.default.isNumber(l)){if(h&&l){let e=i,t=h._index+l;o&&(e=h.items,s.transform)&&(t=h.treeIndex+l,d)&&(e=i,t=h._index+l),0<=t&&t<=e.length-1&&(u=e[t]),0<l&&(c="bottom")}}else{o=(u=(0,_util.handleRowidOrRow)(r,l))?a[(0,_util.getRowid)(r,u)]:null;h&&o&&o._index>h._index&&(c="bottom")}return r.handleRowDragSwapEvent(null,!0,e,u,n||c,!0===t)},getFullColumns(){var e=this.collectColumn;return e.slice(0)},getData(e){var t=this.data||this.tableSynchData;return _xeUtils.default.isUndefined(e)?t.slice(0):t[e]},getCheckboxRecords(e){var t=this,r=t.treeConfig,l=t.updateCheckboxFlag;let{tableFullData:o,afterFullData:a,tableFullTreeData:i,fullDataRowIdData:n,afterFullRowMaps:d,selectCheckboxMaps:s}=t;var u=t.computeTreeOpts,{transform:c,mapChildrenField:h}=u;let g=t.computeCheckboxOpts.checkField;t=u.children||u.childrenField;let p=[];if(l)if(g)p=r?_xeUtils.default.filterTree(e?c?i:o:c?i:a,e=>_xeUtils.default.get(e,g),{children:c?h:t}):(e?o:a).filter(e=>_xeUtils.default.get(e,g));else{let l=e||r&&!c?n:d;_xeUtils.default.each(s,(e,t)=>{l[t]&&p.push(n[t].row)})}return p},updateAfterDataIndex(){updateAfterDataIndex(this)},getTreeRowChildren(t){var l=this.treeConfig,r=this.fullAllDataRowIdData,o=this.computeTreeOpts,{transform:a,mapChildrenField:i}=o,o=o.children||o.childrenField;if(t&&l){let e;if(e=_xeUtils.default.isString(t)?t:(0,_util.getRowid)(this,t)){l=r[e],t=l?l.row:null;if(t)return t[a?i:o]||[]}}return[]},getTreeParentRow(t){var l=this.treeConfig,r=this.fullAllDataRowIdData;if(t&&l){let e;if(e=_xeUtils.default.isString(t)?t:(0,_util.getRowid)(this,t))return(l=r[e])?l.parent:null}return null},getParentRow(e){return(0,_log.warnLog)("vxe.error.delFunc",["getParentRow","getTreeParentRow"]),this.getTreeParentRow(e)},getRowById(e){var t=this.fullAllDataRowIdData,e=_xeUtils.default.eqNull(e)?"":encodeURIComponent(e);return t[e]?t[e].row:null},getRowid(e){return(0,_util.getRowid)(this,e)},getTableData(){var{tableData:e,footerTableData:t}=this,{tableFullData:l,afterFullData:r,tableFullTreeData:o}=this;return{fullData:(this.treeConfig?o:l).slice(0),visibleData:r.slice(0),tableData:e.slice(0),footerData:t.slice(0)}},getFullData(){var e,t,l,r,o=this.treeConfig,{tableFullData:a,tableFullTreeData:i}=this;return o?({transform:e,mapChildrenField:t,rowField:l,parentField:r}=o=this.computeTreeOpts,o=o.children||o.childrenField,e?_xeUtils.default.toArrayTree(_xeUtils.default.toTreeArray(i,{children:t}),{key:l,parentKey:r,children:o,mapChildren:t}):i.slice(0)):a.slice(0)},handleLoadDefaults(){handleLoadDefaults(this)},handleInitDefaults(){handleInitDefaults(this)},setColumnFixed(e,t){var l=this;let r=!1;var o=_xeUtils.default.isArray(e)?e:[e],a=l.computeColumnOpts,i=l.computeIsMaxFixedColumn;for(let e=0;e<o.length;e++){var n=o[e],n=(0,_util.handleFieldOrColumn)(l,n),n=(0,_util.getRootColumn)(l,n);if(n&&n.fixed!==t){if(!n.fixed&&i)return _ui.VxeUI.modal&&_ui.VxeUI.modal.message({status:"error",content:getI18n("vxe.table.maxFixedCol",[a.maxFixedSize])}),l.$nextTick();_xeUtils.default.eachTree([n],e=>{e.fixed=t,e.renderFixed=t}),l.saveCustomStore("update:fixed"),r=r||!0}}return r?l.refreshColumn():l.$nextTick()},clearColumnFixed(e){let t=this,l=!1;return(_xeUtils.default.isArray(e)?e:[e]).forEach(e=>{e=(0,_util.handleFieldOrColumn)(t,e),e=(0,_util.getRootColumn)(t,e);e&&e.fixed&&(_xeUtils.default.eachTree([e],e=>{e.fixed=null,e.renderFixed=null}),t.saveCustomStore("update:fixed"),l=l||!0)}),l?t.refreshColumn():t.$nextTick()},hideColumn(e){let t=this,l=!1;return(_xeUtils.default.isArray(e)?e:[e]).forEach(e=>{e=(0,_util.handleFieldOrColumn)(t,e);e&&e.visible&&(e.visible=!1,l=l||!0)}),l?t.handleCustom():t.$nextTick()},showColumn(e){let t=this,l=!1;return(_xeUtils.default.isArray(e)?e:[e]).forEach(e=>{e=(0,_util.handleFieldOrColumn)(t,e);e&&!e.visible&&(e.visible=!0,l=l||!0)}),l?t.handleCustom():t.$nextTick()},setColumnWidth(e,t){let l=this;var r=l.elemStore;let o=!1;e=_xeUtils.default.isArray(e)?e:[e];let a=_xeUtils.default.toInteger(t);return(0,_dom.isScale)(t)&&(r=(t=(0,_util.getRefElem)(r["main-body-scroll"]))?t.clientWidth-1:0,a=Math.floor(a*r)),(a&&(e.forEach(e=>{e=(0,_util.handleFieldOrColumn)(l,e);e&&(e.resizeWidth=a,o=o||!0)}),o)?l.refreshColumn():l.$nextTick()).then(()=>({status:o}))},getColumnWidth(e){e=(0,_util.handleFieldOrColumn)(this,e);return e?e.renderWidth:0},resetColumn(e){return(0,_log.warnLog)("vxe.error.delFunc",["resetColumn","resetCustom"]),this.resetCustom(e)},handleCustom(){var e=this,t=e.mouseConfig;return t&&(e.clearSelected&&e.clearSelected(),e.clearCellAreas)&&(e.clearCellAreas(),e.clearCopyCellArea()),e.analyColumnWidth(),e.refreshColumn(!0)},restoreCustomStorage(){let t=this;var e=t.customConfig,l=t.computeTableId,r=t.computeCustomOpts,{storage:o,restoreStore:a}=r,i=!0===o,o=i?{}:Object.assign({},o||{}),n=i||o.resizable,d=i||o.visible,s=i||o.fixed,i=i||o.sort;if((e?(0,_utils.isEnableConf)(r):r.enabled)&&(n||d||s||i)){if(l)return o=getCustomStorageMap(l),a?Promise.resolve(a({$table:t,id:l,type:"restore",storeData:o})).then(e=>{if(e)return handleCustomRestore(t,e)}).catch(e=>e):handleCustomRestore(t,o);(0,_log.errLog)("vxe.error.reqProp",["id"])}},getCustomStoreData(){let u=this;var e=u.id,t=u.collectColumn;let{storage:l,checkMethod:c}=u.computeCustomOpts;var r=!0===l,o=r?{}:Object.assign({},l||{});let h=r||o.resizable,g=r||o.visible,p=r||o.fixed,f=r||o.sort,m={},x={},v={},w={};r={resizableData:void 0,sortData:void 0,visibleData:void 0,fixedData:void 0};if(e){let i=0,n=0,d=0,s=0;_xeUtils.default.eachTree(t,(e,t,l,r,o)=>{var a=e.getKey();a?(o||(f&&(n=1,x[a]=e.renderSortNumber),p&&e.fixed!==e.defaultFixed&&(d=1,w[a]=e.fixed)),h&&e.resizeWidth&&(i=1,m[a]=e.renderWidth),!g||c&&!c({$table:u,column:e})||(!e.visible&&e.defaultVisible?(s=1,v[a]=!1):e.visible&&!e.defaultVisible&&(s=1,v[a]=!0))):(0,_log.errLog)("vxe.error.reqProp",[`${e.getTitle()||e.type||""} -> column.field=?`])}),i&&(r.resizableData=m),n&&(r.sortData=x),d&&(r.fixedData=w),s&&(r.visibleData=v)}else(0,_log.errLog)("vxe.error.reqProp",["id"]);return r},saveCustomStore(e){var t=this,l=t,r=t.customConfig,o=t.computeTableId,a=t.computeCustomOpts,{updateStore:i,storage:n}=a,d=!0===n,n=d?{}:Object.assign({},n||{}),s=d||n.resizable,u=d||n.visible,c=d||n.fixed,d=d||n.sort;if("reset"!==e&&(l.isCustomStatus=!0),(r?(0,_utils.isEnableConf)(a):a.enabled)&&(s||u||c||d)){if(!o)return(0,_log.errLog)("vxe.error.reqProp",["id"]),this.$nextTick();n="reset"===e?{resizableData:{},sortData:{},visibleData:{},fixedData:{}}:this.getCustomStoreData();if(i)return i({$table:t,id:o,type:e,storeData:n});setCustomStorageMap(o,"reset"===e?null:n)}return this.$nextTick()},handleUpdateDataQueue(){this.upDataFlag++},handleRefreshColumnQueue(){this.reColumnFlag++},refreshColumn(e){return e&&handleUpdateColumn(this),parseColumns(this,!0).then(()=>this.refreshScroll()).then(()=>this.recalculate())},analyColumnWidth(){var e=this.columnOpts;let{width:t,minWidth:l}=e,r=[],o=[],a=[],i=[],n=[],d=[],s=[],u=[];this.tableFullColumn.forEach(e=>{t&&!e.width&&(e.width=t),l&&!e.minWidth&&(e.minWidth=l),e.visible&&(e.resizeWidth?r:"auto"===e.width?s:(0,_dom.isPx)(e.width)?o:(0,_dom.isScale)(e.width)?n:(0,_dom.isPx)(e.minWidth)?a:"auto"===e.minWidth?i:(0,_dom.isScale)(e.minWidth)?d:u).push(e)}),Object.assign(this.columnStore,{resizeList:r,pxList:o,pxMinList:a,autoMinList:i,scaleList:n,scaleMinList:d,autoList:s,remainList:u})},handleColResizeMousedownEvent(e,t,r){let o=this,E=o,a=o;e.stopPropagation(),e.preventDefault();var l=r.column,{columnStore:i,overflowX:n,scrollbarHeight:_}=E;let{elemStore:d,visibleColumn:T}=a;var{leftList:i,rightList:S}=i;let y=o.computeResizableOpts,D=n?_:0,I=o.$refs.refElem,F=o.$refs.refLeftContainer;n=o.$refs.refRightContainer;let k=o.$refs.refColResizeBar;if(k){let m="left"===t,x="right"===t,v=k.firstElementChild,w=o.computeScrollbarXToTop,C=e.clientX;_=e.target;let R=l;l.children&&l.children.length&&_xeUtils.default.eachTree(l.children,e=>{R=e});t=_.parentNode,l=Object.assign(r,{cell:t});let b=0;if((0,_util.getRefElem)(d["main-body-scroll"])){let d=I.getBoundingClientRect(),s=n?n.getBoundingClientRect():null;var n=t.getBoundingClientRect(),M=_.getBoundingClientRect(),_=_.clientWidth,O=Math.floor(_/2);let u=M.x-d.x+O,c=(0,_util.getColReMinWidth)(l)-O,h=x?0:n.x-d.x+_+c,g=n.x-d.x+t.clientWidth-c,p=0,f=0;if(m||x){let t=!1;var $=m?i:S;for(let e=0;e<$.length;e++){var A=$[e];t?p+=A.renderWidth:(t=A.id===R.id)||(f+=A.renderWidth)}}M=t=>{t.stopPropagation(),t.preventDefault();var l=I.clientHeight,r=t.clientX-C;let e=u+r;m?s&&(e=Math.min(e,s.x-d.x-p-c)):x&&(F&&(e=Math.max(e,F.clientWidth+f+c)),e=Math.min(e,g)),b=Math.max(e,h);r=Math.max(1,b);if(k.style.left=r+"px",k.style.top=`${w?D:0}px`,k.style.height=`${w?l-D:l}px`,y.showDragTip&&v){v.textContent=getI18n("vxe.table.resizeColTip",[Math.floor(R.renderWidth+(x?u-b:b-u))]);var o=I.clientWidth,a=k.clientWidth,i=v.clientWidth,n=v.clientHeight;let e=-i;r<i+a?e=0:o<r&&(e+=o-r),v.style.left=e+"px",v.style.top=Math.min(l-n,Math.max(0,t.clientY-d.y-n/2))+"px"}E.isDragResize=!0};E.isDragResize=!0,(0,_dom.addClass)(I,"col-drag--resize"),k.style.display="block",document.onmousemove=M,document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,k.style.display="none",a._lastResizeTime=Date.now(),setTimeout(()=>{E.isDragResize=!1},50);var t=R.renderWidth+(x?u-b:b-u),l=Object.assign(Object.assign({},r),{resizeWidth:t,resizeColumn:R});"fixed"===y.dragMode&&T.forEach(e=>{e.id===R.id||e.resizeWidth||(e.resizeWidth=e.renderWidth)}),o.handleColResizeCellAreaEvent?o.handleColResizeCellAreaEvent(e,l):(R.resizeWidth=t,handleUpdateColResize(o,e,l)),(0,_dom.removeClass)(I,"col-drag--resize")},M(e),o.closeMenu&&o.closeMenu()}}},handleColResizeDblclickEvent(l,r){var o=this,a=o,i=o,n=o.computeResizableOpts.isDblclickAutoWidth,d=o.$refs.refElem;if(n&&d){l.stopPropagation(),l.preventDefault();var n=i.fullColumnIdData,s=r.column;let t=s;s.children&&s.children.length&&_xeUtils.default.eachTree(s.children,e=>{t=e});s=n[t.id],n=l.target.parentNode,n=Object.assign(r,{cell:n}),n=(0,_util.getColReMinWidth)(n);d.setAttribute("data-calc-col","Y");let e=calcColumnAutoWidth(t,d);d.removeAttribute("data-calc-col"),s&&(e=Math.max(e,s.width)),e=Math.max(n,e);d=Object.assign(Object.assign({},r),{resizeWidth:e,resizeColumn:t});a.isDragResize=!1,i._lastResizeTime=Date.now(),o.handleColResizeDblclickCellAreaEvent?o.handleColResizeDblclickCellAreaEvent(l,d):(t.resizeWidth=e,handleUpdateColResize(o,l,d))}},handleRowResizeMousedownEvent(r,o){let a=this,p=a,i=a,n=(r.stopPropagation(),r.preventDefault(),o).row;var{overflowX:f,scrollbarWidth:m,overflowY:x,scrollbarHeight:v}=p,{elemStore:w,fullAllDataRowIdData:C}=i;let R=x?m:0,b=f?v:0,E=a.computeScrollbarYToLeft,_=a.computeResizableOpts;x=a.computeRowOpts,m=a.computeCellOpts;let T=a.$refs.refElem,S=a.$refs.refRowResizeBar;if(S){let h=r.clientY,g=S.firstElementChild;f=r.currentTarget.parentNode,v=f.parentNode;if((0,_util.getRefElem)(w["main-body-scroll"])){let l=C[(0,_util.getRowid)(a,n)];if(l){w=a.computeDefaultRowHeight;let d=l.resizeHeight||m.height||x.height||l.height||w,s=T.getBoundingClientRect();C=v.getBoundingClientRect();let e=h-C.y-v.clientHeight,u=d;m=f.querySelector(".vxe-cell");let t=0,c=(m&&(x=getComputedStyle(m),t=Math.max(1,Math.ceil(_xeUtils.default.toNumber(x.paddingTop)+_xeUtils.default.toNumber(x.paddingBottom)))),C.y-s.y+t);w=l=>{l.stopPropagation(),l.preventDefault();var r=T.clientWidth-R,o=T.clientHeight-b;let a=l.clientY-s.y-e;if(a<c?a=c:u=Math.max(t,d+l.clientY-h),S.style.left=`${E?R:0}px`,S.style.top=a+"px",S.style.width=r+"px",_.showDragTip&&g){g.textContent=getI18n("vxe.table.resizeRowTip",[u]);var i=g.clientWidth,n=g.clientHeight;let e=Math.max(2,l.clientX-s.x),t=0;e+i>=r-2&&(e=r-i-2),a+n>=o&&(t=o-(a+n)),g.style.left=e+"px",g.style.top=t+"px"}p.isDragResize=!0};p.isDragResize=!0,(0,_dom.addClass)(T,"row-drag--resize"),S.style.display="block",document.onmousemove=w,document.onmouseup=function(e){var t;document.onmousemove=null,document.onmouseup=null,S.style.display="none",i._lastResizeTime=Date.now(),setTimeout(()=>{p.isDragResize=!1},50),u!==d&&(t=Object.assign(Object.assign({},o),{resizeHeight:u,resizeRow:n}),i.isResizeCellHeight=!0,a.handleRowResizeCellAreaEvent?a.handleRowResizeCellAreaEvent(e,t):(l.resizeHeight=u,handleUpdateRowResize(a,e,t),updateRowOffsetTop(a))),(0,_dom.removeClass)(T,"row-drag--resize")},w(r)}}}},handleRowResizeDblclickEvent(o,a){let i=this,n=i,d=i;var e=i.computeResizableOpts.isDblclickAutoHeight;let s=i.$refs.refElem;if(e&&s){o.stopPropagation(),o.preventDefault();var e=n.editStore,t=d.fullAllDataRowIdData,e=e.actived;let l=a.row,r=t[(0,_util.getRowid)(i,l)];r&&(t=()=>{var e=calcCellAutoHeight(r,s),t=Object.assign(Object.assign({},a),{resizeHeight:e,resizeRow:l});n.isDragResize=!1,d._lastResizeTime=Date.now(),i.handleRowResizeDblclickCellAreaEvent?i.handleRowResizeDblclickCellAreaEvent(o,t):(r.resizeHeight=e,handleUpdateRowResize(i,o,t))},e.row||e.column?i.clearEdit().then(t):t())}},setRowHeightConf(e){let t=this;var l=t,r=t;let o=r.fullAllDataRowIdData,a=!1;return e&&(_xeUtils.default.each(e,(e,t)=>{t=o[t];t&&(e=_xeUtils.default.toInteger(e))&&(t.resizeHeight=e,a=a||!0)}),a)&&(r.isResizeCellHeight=!0,l.resizeHeightFlag++),t.$nextTick().then(()=>(updateRowOffsetTop(t),{status:a}))},getRowHeightConf(r){var e=this;let{fullAllDataRowIdData:o,afterFullData:t}=e,a=(0,_util.createHandleGetRowId)(e).handleGetRowId,i=e.computeRowOpts,n=e.computeCellOpts,d=e.computeDefaultRowHeight,s={};return t.forEach(e=>{var t,e=a(e),l=o[e];l&&((t=l.resizeHeight)||r)&&(t=t||n.height||i.height||l.height||d,s[e]=t)}),s},setRowHeight(e,t){var l=this,r=l,o=l;let a=o.fullAllDataRowIdData,i=!1;e=_xeUtils.default.isArray(e)?e:[e];let n=_xeUtils.default.toInteger(t);if((0,_dom.isScale)(t)&&(t=(t=(t=l.$refs.refTableBody)?t.$el:null)?t.clientHeight-1:0,n=Math.floor(n*t)),n){let t=(0,_util.createHandleGetRowId)(l).handleGetRowId;e.forEach(e=>{e=_xeUtils.default.isString(e)||_xeUtils.default.isNumber(e)?e:t(e),e=a[e];e&&(e.resizeHeight=n,i=i||!0)}),i&&(o.isResizeCellHeight=!0,r.resizeHeightFlag++)}return l.$nextTick()},getRowHeight(e){var t=this,l=t.fullAllDataRowIdData,r=t.computeRowOpts,o=t.computeCellOpts,a=t.computeDefaultRowHeight,l=l[_xeUtils.default.isString(e)||_xeUtils.default.isNumber(e)?e:(0,_util.getRowid)(t,e)];return l?l.resizeHeight||o.height||r.height||l.height||a:0},refreshScroll(){let t=this,l=t,{elemStore:e,lastScrollLeft:r,lastScrollTop:o}=l,a=(0,_util.getRefElem)(e["main-header-scroll"]),i=(0,_util.getRefElem)(e["main-body-scroll"]),n=(0,_util.getRefElem)(e["main-footer-scroll"]),d=(0,_util.getRefElem)(e["left-body-scroll"]),s=(0,_util.getRefElem)(e["right-body-scroll"]),u=t.$refs.refScrollXHandleElem,c=t.$refs.refScrollYHandleElem;return new Promise(e=>{if(r||o)return(0,_util.restoreScrollLocation)(t,r,o).then(()=>{setTimeout(e,10)});l.intoRunScroll=!0,(0,_dom.setScrollTop)(c,o),(0,_dom.setScrollTop)(i,o),(0,_dom.setScrollTop)(d,o),(0,_dom.setScrollTop)(s,o),(0,_dom.setScrollLeft)(u,r),(0,_dom.setScrollLeft)(i,r),(0,_dom.setScrollLeft)(a,r),(0,_dom.setScrollLeft)(n,r),setTimeout(()=>{l.intoRunScroll=!1,e()},10)})},recalculate(a){let i=this,n=i;return new Promise(e=>{var{rceTimeout:t,rceRunTime:l}=n,r=i.computeResizeOpts.refreshDelay||20,o=i.$refs.refElem;o&&o.clientWidth&&(autoCellWidth(i),updateRowExpandStyle(i)),!t||(clearTimeout(t),l&&l+(r-5)<Date.now())?e(handleRecalculateLayout(i,!!a)):i.$nextTick(()=>{e()}),n.rceTimeout=setTimeout(()=>{n.rceTimeout=void 0,handleRecalculateLayout(i,!!a)},r)})},updateStyle(){return updateStyle(this)},checkScrolling(){var e=this.elemStore,e=(0,_util.getRefElem)(e["main-body-scroll"]),t=this.$refs.refLeftContainer,l=this.$refs.refRightContainer,e=this.$refs.refScrollXHandleElem||e;e&&(t&&(0<e.scrollLeft?(0,_dom.addClass):(0,_dom.removeClass))(t,"scrolling--middle"),l)&&(e.clientWidth<e.scrollWidth-Math.ceil(e.scrollLeft)?(0,_dom.addClass):(0,_dom.removeClass))(l,"scrolling--middle")},preventEvent(t,e,l,r,o){var a=this.$xeGrid;let i=interceptor.get(e),n=(i.length||"event.clearEdit"!==e||(i=interceptor.get("event.clearActived")).length&&(0,_log.warnLog)("vxe.error.delEvent",["event.clearActived","event.clearEdit"]),null),d=!1;for(let e=0;e<i.length;e++){var s=(0,i[e])(Object.assign({$grid:a,$table:this,$event:t},l));if(!1===s){d=!0;break}if(s&&!1===s.status){n=s.result,d=!0;break}}return d||r&&(n=r()),o&&o(),n},handleGlobalMousedownEvent(l){var e=this.$xeGrid;let{$el:r,$refs:t,$toolbar:o,mouseConfig:a,editStore:i,ctxMenuStore:n,editRules:d,editOpts:s,validOpts:u,areaOpts:c,filterStore:h,customStore:g,getRowNode:p}=this,f=i.actived;var{customWrapper:m,refValidTooltip:x}=t,v=t.refTableFilter,w=t.refTableMenu;if(!v||(0,_dom.getEventTargetNode)(l,r,"vxe-cell--filter").flag||(0,_dom.getEventTargetNode)(l,v.$el).flag||(0,_dom.getEventTargetNode)(l,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(l,"event.clearFilter",h.args,this.closeFilter),!m||g.btnEl===l.target||(0,_dom.getEventTargetNode)(l,document.body,"vxe-toolbar-custom-target").flag||(0,_dom.getEventTargetNode)(l,m.$el).flag||(0,_dom.getEventTargetNode)(l,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(l,"event.clearCustom",{},()=>this.closeCustom()),f.row)!1===s.autoClear||(v=f.args.cell)&&(0,_dom.getEventTargetNode)(l,v).flag||x&&(0,_dom.getEventTargetNode)(l,x.$el).flag||this.lastCallTime&&!(this.lastCallTime+50<Date.now())||(0,_dom.getEventTargetNode)(l,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(l,"event.clearEdit",f.args,()=>{let e;var t;(e=(e=(e="row"===s.mode?!!(t=(0,_dom.getEventTargetNode)(l,r,"vxe-body--row")).flag&&p(t.targetElem).item!==f.args.row:!(0,_dom.getEventTargetNode)(l,r,"col--edit").flag)||(0,_dom.getEventTargetNode)(l,r,"vxe-header--row").flag)||(0,_dom.getEventTargetNode)(l,r,"vxe-footer--row").flag)||!this.height||this.overflowY||(t=l.target,(0,_dom.hasClass)(t,"vxe-table--body-wrapper")&&(e=l.offsetY<t.clientHeight)),!e&&(0,_dom.getEventTargetNode)(l,r).flag||setTimeout(()=>{this.handleClearEdit(l).then(()=>{!this.isActivated&&d&&u.autoClear&&(this.validErrorMaps={})})})});else if(a&&!((0,_dom.getEventTargetNode)(l,r).flag||e&&(0,_dom.getEventTargetNode)(l,e.$el).flag||w&&(0,_dom.getEventTargetNode)(l,w.$el).flag||o&&(0,_dom.getEventTargetNode)(l,o.$el).flag)&&(this.clearSelected&&this.clearSelected(),c.autoClear)&&this.getCellAreas){let e=this.getCellAreas();e&&e.length&&!(0,_dom.getEventTargetNode)(l,document.body,"vxe-table--ignore-areas-clear").flag&&this.preventEvent(l,"event.clearAreas",{},()=>{this.clearCellAreas(),this.clearCopyCellArea(),this.emitEvent("clear-cell-area-selection",{cellAreas:e},l)})}n.visible&&w&&!(0,_dom.getEventTargetNode)(l,w.$el).flag&&this.closeMenu();m=(0,_dom.getEventTargetNode)(l,(e||this).$el).flag;!m&&d&&u.autoClear&&(this.validErrorMaps={}),this.isActivated=m},handleGlobalBlurEvent(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent(){this.closeTooltip(),this.closeMenu()},keydownEvent(t){let{filterStore:e,ctxMenuStore:l,editStore:r,keyboardConfig:o,mouseConfig:a,mouseOpts:i,keyboardOpts:n}=this,d=r.actived;var s=t.keyCode;27===s&&this.preventEvent(t,"event.keydown",null,()=>{if(this.emitEvent("keydown-start",{},t),o&&a&&i.area&&this.handleKeyboardCellAreaEvent)this.handleKeyboardCellAreaEvent(t);else if((d.row||e.visible||l.visible)&&(t.stopPropagation(),this.closeFilter(),this.closeMenu(),o)&&n.isEsc&&d.row){let e=d.args;this.handleClearEdit(t),a&&i.selected&&this.$nextTick(()=>this.handleSelected(e,t))}this.emitEvent("keydown",{},t),this.emitEvent("keydown-end",{},t)})},handleGlobalKeydownEvent(V){let B=this,G=B,W=B,Y=B,P=B.$xeGrid;W.isActivated&&B.preventEvent(V,"event.keydown",null,()=>{var{mouseConfig:t,keyboardConfig:e,treeConfig:l,editConfig:r,highlightCurrentRow:o,highlightCurrentColumn:a}=G;let{ctxMenuStore:i,editStore:L,currentRow:n}=Y;var d=W.afterFullData,s=B.computeIsMenu,u=B.computeBodyMenu,c=B.computeKeyboardOpts,h=B.computeMouseOpts,g=B.computeEditOpts,p=B.computeTreeOpts,f=B.computeMenuList,m=B.computeRowOpts,U=B.computeColumnOpts;let{selected:x,actived:v}=L;var w=V.keyCode,C=8===w,H=9===w,R=13===w,b=27===w,E=32===w,_=37===w,T=38===w,S=39===w,y=40===w,z=46===w,D=113===w,I=93===w,F=(0,_dom.hasControlKey)(V),k=V.shiftKey,M=V.altKey,O=_||T||S||y,s=s&&i.visible&&(R||E||O),$=(0,_utils.isEnableConf)(r)&&v.column&&v.row,p=p.children||p.childrenField;let A=g.beforeEditMethod||g.activeMethod;if(s)V.preventDefault(),i.showChild&&(0,_utils.hasChildrenList)(i.selected)?B.moveCtxMenu(V,i,"selectChild",_,!1,i.selected.children):B.moveCtxMenu(V,i,"selected",S,!0,f);else if(e&&t&&h.area&&B.handleKeyboardCellAreaEvent)B.handleKeyboardCellAreaEvent(V);else if(b){if(B.closeMenu&&B.closeMenu(),B.closeFilter(),e&&c.isEsc&&v.row){let e=v.args;B.handleClearEdit(V),h.selected&&B.$nextTick(()=>B.handleSelected(e,V))}}else if(e&&E&&c.isChecked&&x.row&&x.column&&("checkbox"===x.column.type||"radio"===x.column.type))V.preventDefault(),"checkbox"===x.column.type?B.handleToggleCheckRowEvent(V,x.args):B.triggerRadioRowEvent(V,x.args);else if(D&&(0,_utils.isEnableConf)(r))$||x.row&&x.column&&(V.stopPropagation(),V.preventDefault(),B.handleEdit(x.args,V));else if(I)W._keyCtx=x.row&&x.column&&u.length,clearTimeout(W.keyCtxTimeout),W.keyCtxTimeout=setTimeout(()=>{W._keyCtx=!1},1e3);else if(R&&!M&&e&&c.isEnter&&(x.row||v.row||l&&(m.isCurrent||o)&&n)){var{isLastEnterAppendRow:s,beforeEnterMethod:f,enterMethod:b}=c;if(F){if(v.row){let e=v.args;B.handleClearEdit(V),t&&h.selected&&B.$nextTick(()=>B.handleSelected(e,V))}}else if(x.row||v.row){let t=(x.row?x:v).args;if(k)c.enterToTab?B.moveTabSelected(t,k,V):B.moveEnterSelected(t,_,!0,S,!1,V);else if(c.enterToTab)B.moveTabSelected(t,k,V);else{var D=x.row||v.row,I=x.column||v.column,u=B.getVTRowIndex(D),R={row:D,rowIndex:B.getRowIndex(D),$rowIndex:B.getVMRowIndex(D),_rowIndex:u,column:I,columnIndex:B.getColumnIndex(I),$columnIndex:B.getVMColumnIndex(I),_columnIndex:B.getVTColumnIndex(I),$table:B};if(!f||!1!==f(R)){if(s&&u>=d.length-1)return B.insertAt({},-1).then(({row:e})=>{B.scrollToRow(e,x.column),B.handleSelected(Object.assign(Object.assign({},t),{row:e}),V)}),void B.dispatchEvent("enter-append-row",R,V);B.moveEnterSelected(t,_,!1,S,!0,V),b&&b(R)}}}else if(l&&(m.isCurrent||o)&&n){M=n[p];if(M&&M.length){V.preventDefault();let e=M[0],t={$table:B,row:e,rowIndex:B.getRowIndex(e),$rowIndex:B.getVMRowIndex(e)};B.setTreeExpand(n,!0).then(()=>B.scrollToRow(e)).then(()=>B.triggerCurrentRowEvent(V,t))}}}else if(O&&e&&c.isArrow)$||(h.selected&&x.row&&x.column?B.moveArrowSelected(x.args,_,T,S,y,V):((T||y)&&(m.isCurrent||o)&&B.moveCurrentRow(T,y,V),(_||S)&&(U.isCurrent||a)&&B.moveCurrentColumn(_,S,V)));else if(H&&e&&c.isTab)x.row||x.column?B.moveTabSelected(x.args,k,V):(v.row||v.column)&&B.moveTabSelected(v.args,k,V);else if(e&&c.isDel&&z&&(0,_utils.isEnableConf)(r)&&(x.row||x.column))$||(t=c.delMethod,D={row:x.row,rowIndex:B.getRowIndex(x.row),column:x.column,columnIndex:B.getColumnIndex(x.column),$table:B,$grid:P},A&&!A(D))||(t?t(D):(0,_util.setCellValue)(x.row,x.column,null),B.updateFooter(),B.dispatchEvent("cell-delete-value",D,V));else if(C&&e&&c.isBack&&(0,_utils.isEnableConf)(r)&&(x.row||x.column))$||({editMode:I,backMethod:f}=c,c.isDel&&(0,_utils.isEnableConf)(r)&&(x.row||x.column)&&(s={row:x.row,rowIndex:B.getRowIndex(x.row),column:x.column,columnIndex:B.getColumnIndex(x.column),$table:B,$grid:P},A&&!A(s)||(f?f(s):("insert"!==I&&(0,_util.setCellValue)(x.row,x.column,null),B.handleEdit(x.args,V)),B.dispatchEvent("cell-backspace-value",s,V))));else if(C&&e&&l&&c.isBack&&(m.isCurrent||o)&&n){let t=_xeUtils.default.findTree(W.afterTreeFullData,e=>e===n,{children:p}).parent;if(t){V.preventDefault();let e={row:t,rowIndex:B.getRowIndex(t),$rowIndex:B.getVMRowIndex(t),$table:B,$grid:P};B.setTreeExpand(t,!1).then(()=>B.scrollToRow(t)).then(()=>B.triggerCurrentRowEvent(V,e))}}else if(e&&c.isEdit&&!F&&(E||48<=w&&w<=57||65<=w&&w<=90||96<=w&&w<=111||186<=w&&w<=192||219<=w&&w<=222)){u=c.editMethod;if(x.column&&x.row&&(0,_utils.isEnableConf)(x.column.editRender)){let e=g.beforeEditMethod||g.activeMethod;d={row:x.row,rowIndex:B.getRowIndex(x.row),column:x.column,columnIndex:B.getColumnIndex(x.column),$table:B,$grid:P};e&&!e(d)||(u?u(d):((0,_util.setCellValue)(x.row,x.column,null),B.handleEdit(x.args,V)))}}B.dispatchEvent("keydown",{},V)})},handleGlobalPasteEvent(e){var{isActivated:t,keyboardConfig:l,keyboardOpts:r,mouseConfig:o,mouseOpts:a,editStore:i,filterStore:n}=this,i=i.actived;t&&!n.visible&&(i.row||i.column||l&&r.isClip&&o&&a.area&&this.handlePasteCellAreaEvent&&this.handlePasteCellAreaEvent(e),this.emitEvent("paste",{},e))},handleGlobalCopyEvent(e){var{isActivated:t,keyboardConfig:l,keyboardOpts:r,mouseConfig:o,mouseOpts:a,editStore:i,filterStore:n}=this,i=i.actived;t&&!n.visible&&(i.row||i.column||l&&r.isClip&&o&&a.area&&this.handleCopyCellAreaEvent&&this.handleCopyCellAreaEvent(e),this.emitEvent("copy",{},e))},handleGlobalCutEvent(e){var{isActivated:t,keyboardConfig:l,keyboardOpts:r,mouseConfig:o,mouseOpts:a,editStore:i,filterStore:n}=this,i=i.actived;t&&!n.visible&&(i.row||i.column||l&&r.isClip&&o&&a.area&&this.handleCutCellAreaEvent&&this.handleCutCellAreaEvent(e),this.emitEvent("cut",{},e))},handleGlobalResizeEvent(){this.closeMenu(),this.updateCellAreas(),this.recalculate(!0)},handleUpdateBodyMerge(){var e=this,t=this,l=t.mergeBodyList;t.mergeBodyCellMaps=buildMergeData(l),e.mergeBodyFlag++},handleUpdateFooterMerge(){var e=this,t=this,l=t.mergeFooterList;t.mergeFooterCellMaps=buildMergeData(l),e.mergeFootFlag++},handleAggregateSummaryData(){return updateGroupData(this)},handleTargetLeaveEvent(){let e=this;var t=e,l=e.computeTooltipOpts;let r=e.$refs.refTooltip;r&&r.setActived&&r.setActived(!1),l.enterable?t.tooltipTimeout=setTimeout(()=>{(r=e.$refs.refTooltip)&&r.isActived&&!r.isActived()&&e.closeTooltip()},l.leaveDelay):e.closeTooltip()},triggerHeaderTitleEvent(l,e,r){let o=this;var a=o,i=e.content||e.message;if(i){a=a.tooltipStore,r=r.column;let t=(0,_utils.getFuncText)(i);handleTargetEnterEvent(o,!0),a.row=null,a.column=r,a.visible=!0,a.currOpts=e,o.$nextTick(()=>{var e=o.$refs.refTooltip;e&&e.open&&e.open(l.currentTarget,t)})}},triggerHeaderTooltipEvent(e,t){var l,r,o=this.tooltipStore,a=t.column,i=(handleTargetEnterEvent(this,!0),e.currentTarget);(i=i&&i.parentElement)&&(l=i.parentElement)&&(r=l.parentElement)&&(o.column!==a||!o.visible)&&(a=r.querySelector(".vxe-cell--title"),handleTooltip(this,e,r,((0,_dom.hasClass)(r,"col--ellipsis")?a:i)||i,a||l,t))},triggerBodyTooltipEvent(l,r){var o=this,a=o.editConfig,e=o.editStore,t=o.tooltipStore,i=o.computeEditOpts,e=e.actived,{row:n,column:d}=r,s=l.currentTarget;if(handleTargetEnterEvent(o,t.column!==d||t.row!==n),d.editRender&&(0,_utils.isEnableConf)(a)){if("row"===i.mode&&e.row===n)return;if(e.row===n&&e.column===d)return}if(t.column!==d||t.row!==n||!t.visible){a=s.querySelector(".vxe-cell--wrapper");let e=null,t=s.querySelector("html"===d.type?".vxe-cell--html":".vxe-cell--label");d.treeNode&&(e=s.querySelector(".vxe-tree-cell")),t=t||a,handleTooltip(o,l,s,e||a,t,r)}},triggerFooterTooltipEvent(l,r){var o=r.column,a=this.tooltipStore,i=l.currentTarget;if(handleTargetEnterEvent(this,a.column!==o||!!a.row),a.column!==o||!a.visible){a=i.querySelector(".vxe-cell--wrapper");let e=null,t=i.querySelector("html"===o.type?".vxe-cell--html":".vxe-cell--label");"html"===o.type&&(e=i.querySelector(".vxe-cell--html")),t=t||a,handleTooltip(this,l,i,e||a,t,r)}},openTooltip(e,t){var l=this.$refs,l=l.refCommTooltip;return l?l.open(e,t):this.$nextTick()},closeTooltip(){var e=this.tooltipStore,t=this.$refs.refTooltip,l=this.$refs.refCommTooltip;return e.visible&&(Object.assign(e,{row:null,column:null,content:null,visible:!1,currOpts:{}}),t)&&t.close(),l&&l.close(),this.$nextTick()},isAllCheckboxChecked(){return this.isAllSelected},isAllCheckboxIndeterminate(){return!this.isAllSelected&&this.isIndeterminate},isCheckboxIndeterminate(){return(0,_log.warnLog)("vxe.error.delFunc",["isCheckboxIndeterminate","isAllCheckboxIndeterminate"]),this.isAllCheckboxIndeterminate()},getCheckboxIndeterminateRecords(e){var t=this.treeConfig;let{fullDataRowIdData:o,treeIndeterminateRowMaps:a}=this;if(t){let l=[],r=[];return _xeUtils.default.each(a,(e,t)=>{e&&(l.push(e),o[t])&&r.push(e)}),e?l:r}return[]},handleCheckedCheckboxRow(e,t,l){return handleCheckedCheckboxRow(this,e,t,l)},setCheckboxRow(e,t){return handleCheckedCheckboxRow(this,e=e&&!_xeUtils.default.isArray(e)?[e]:e,t,!0)},setCheckboxRowKey(e,t){let l=this.fullAllDataRowIdData,r=(e&&!_xeUtils.default.isArray(e)&&(e=[e]),[]);return e.forEach(e=>{e=l[e];e&&r.push(e.row)}),handleCheckedCheckboxRow(this,r,t,!0)},isCheckedByCheckboxRow(e){var t=this.updateCheckboxFlag,l=this.selectCheckboxMaps,r=this.computeCheckboxOpts.checkField;return r?_xeUtils.default.get(e,r):!!t&&!!l[(0,_util.getRowid)(this,e)]},isCheckedByCheckboxRowKey(e){var t=this.updateCheckboxFlag,{fullAllDataRowIdData:l,selectCheckboxMaps:r}=this,o=this.computeCheckboxOpts.checkField;return o?!!(l=l[e])&&_xeUtils.default.get(l.row,o):!!t&&!!r[e]},isIndeterminateByCheckboxRow(e){var t=this.treeIndeterminateRowMaps;return!!t[(0,_util.getRowid)(this,e)]&&!this.isCheckedByCheckboxRow(e)},isIndeterminateByCheckboxRowKey(e){var t=this.treeIndeterminateRowMaps;return!!t[e]&&!this.isCheckedByCheckboxRowKey(e)},handleBatchSelectRows(e,l,r){let o=this;var t=o;let a=o;var i=o,t=t.treeConfig,n=a.isRowGroupStatus;let d=i.selectCheckboxMaps;var i=o.computeAggregateOpts,s=o.computeTreeOpts,{transform:u,mapChildrenField:c}=s,s=s.children||s.childrenField,h=o.computeCheckboxOpts;let{checkField:g,checkStrictly:p,checkMethod:f}=h,m=(0,_util.createHandleGetRowId)(o).handleGetRowId,x=h.indeterminateField||h.halfField;if(g)!t&&!n||p?e.forEach(e=>{!r&&f&&!f({$table:o,row:e})||(_xeUtils.default.set(e,g,l),handleCheckboxReserveRow(o,e,l))}):_xeUtils.default.eachTree(e,e=>{!r&&f&&!f({$table:o,row:e})||(_xeUtils.default.set(e,g,l),x&&_xeUtils.default.set(e,x,!1),handleCheckboxReserveRow(o,e,l))},{children:u?c:s}),a.updateCheckboxFlag++;else{if(!p){if(n)return _xeUtils.default.eachTree(e,e=>{var t=m(e);!r&&f&&!f({$table:o,row:e})||(l?d[t]=e:d[t]&&delete d[t],handleCheckboxReserveRow(o,e,l))},{children:i.mapChildrenField}),void a.updateCheckboxFlag++;if(t)return _xeUtils.default.eachTree(e,e=>{var t=m(e);!r&&f&&!f({$table:o,row:e})||(l?d[t]=e:d[t]&&delete d[t],handleCheckboxReserveRow(o,e,l))},{children:u?c:s}),void a.updateCheckboxFlag++}e.forEach(e=>{var t=m(e);!r&&f&&!f({$table:o,row:e})||(l?d[t]||(d[t]=e):d[t]&&delete d[t],handleCheckboxReserveRow(o,e,l),a.updateCheckboxFlag++)})}},handleSelectRow({row:e},t,l){this.handleBatchSelectRows([e],t,l)},handleToggleCheckRowEvent(t,l){var r=this,o=r.selectCheckboxMaps,{checkField:a,trigger:e}=r.computeCheckboxOpts,i=l.row;if("manual"!==e){let e=!1;e=a?!_xeUtils.default.get(i,a):!o[(0,_util.getRowid)(r,i)],t?r.triggerCheckRowEvent(t,l,e):(r.handleBatchSelectRows([i],e),r.checkSelectionStatus())}},triggerCheckRowEvent(t,l,e){let r=this;var o=r.treeConfig,a=l.row,i=r.isRowGroupStatus,n=r.afterFullData,d=r.computeCheckboxOpts,{checkMethod:s,trigger:u}=d;if("manual"!==u){if(t.stopPropagation(),d.isShiftKey&&t.shiftKey&&!o&&!i){u=r.getCheckboxRecords();if(u.length){d=u[0],o=r.getVTRowIndex(a),i=r.getVTRowIndex(d);if(o!==i){r.setAllCheckboxRow(!1);let e=o<i?n.slice(o,i+1):n.slice(i,o+1);return r.$nextTick(()=>{handleCheckedCheckboxRow(r,e,!0,!1)}),void r.dispatchEvent("checkbox-range-select",Object.assign({rangeRecords:e},l),t)}}}s&&!s({$table:r,row:a})||(r.handleBatchSelectRows([a],e),r.checkSelectionStatus(),r.dispatchEvent("checkbox-change",Object.assign({records:()=>r.getCheckboxRecords(),reserves:()=>r.getCheckboxReserveRecords(),indeterminates:()=>r.getCheckboxIndeterminateRecords(),checked:e},l),t))}},toggleCheckboxRow(e){var t=this,l=t.selectCheckboxMaps,r=t.computeCheckboxOpts.checkField,r=r?!_xeUtils.default.get(e,r):!l[(0,_util.getRowid)(t,e)];return t.handleBatchSelectRows([e],r,!0),t.checkSelectionStatus(),t.$nextTick()},setAllCheckboxRow(e){return handleCheckedAllCheckboxRow(this,e,!0)},updateCheckboxStatus(){let d=this;var e=d,t=d,e=e.treeConfig,l=t.isRowGroupStatus;let{afterTreeFullData:s,afterGroupFullData:o,selectCheckboxMaps:u,treeIndeterminateRowMaps:c}=d;var h=d.computeAggregateOpts,g=d.computeTreeOpts;let p=g.children||g.childrenField,{checkField:f,checkStrictly:r,checkMethod:m}=d.computeCheckboxOpts;if(!r){if(l||e){let n=(0,_util.createHandleGetRowId)(d).handleGetRowId,a={},i=[];if(l){let r=h.mapChildrenField;r&&_xeUtils.default.eachTree(o,e=>{var t=n(e),l=e[r];l&&l.length&&!a[t]&&(a[t]=1,i.unshift([e,t,l]))},{children:r})}else if(e){let{transform:r,mapChildrenField:o}=g;_xeUtils.default.eachTree(s,e=>{var t=n(e),l=e[r?o:p];l&&l.length&&!a[t]&&(a[t]=1,i.unshift([e,t,l]))},{children:r?o:p})}i.forEach(e=>{var t=e[0],l=e[1];let r=0,o=0,a=0;e[2].forEach(m?e=>{var t=n(e),l=f?_xeUtils.default.get(e,f):u[t];m({$table:d,row:e})?(l?r++:c[t]&&o++,a++):l?r++:c[t]&&o++}:e=>{var t=n(e);(f?_xeUtils.default.get(e,f):u[t])?r++:c[t]&&o++,a++});var e=r>=a,i=!e&&(1<=r||1<=o);f&&_xeUtils.default.set(t,f,e),e?(f||(u[l]=t),c[l]&&delete c[l]):(f||u[l]&&delete u[l],i?c[l]=t:c[l]&&delete c[l])})}t.updateCheckboxFlag++}},updateAllCheckboxStatus(){let r=this;var e=r,t=r,e=e.treeConfig,l=t.isRowGroupStatus;let{afterFullData:o,afterTreeFullData:a,afterGroupFullData:i,checkboxReserveRowMap:n,selectCheckboxMaps:d,treeIndeterminateRowMaps:s}=r,{checkField:u,checkMethod:c,showReserveStatus:h}=r.computeCheckboxOpts,g=(0,_util.createHandleGetRowId)(r).handleGetRowId,p=0,f=0,m=0;e=e?a:l?i:o,e.forEach(c?e=>{var t=g(e),l=u?_xeUtils.default.get(e,u):d[t];c({$table:r,row:e})?(l?p++:s[t]&&f++,m++):l?p++:s[t]&&f++}:e=>{var t=g(e);(u?_xeUtils.default.get(e,u):d[t])?p++:s[t]&&f++,m++}),l=0<e.length&&(0<m?p>=m:p>=e.length);let x=!l&&(1<=p||1<=f);l||x||!h||(x=!_xeUtils.default.isEmpty(n)),t.isAllSelected=l,t.isIndeterminate=x},checkSelectionStatus(){this.updateCheckboxStatus(),this.updateAllCheckboxStatus()},getRadioReserveRecord(e){var{fullDataRowIdData:t,radioReserveRow:r,radioOpts:l,afterFullData:o,treeConfig:a,treeOpts:i}=this,i=i.children||i.childrenField;if(l.reserve&&r){let l=(0,_util.getRowid)(this,r);if(e){if(!t[l])return r}else{let t=(0,_util.getRowkey)(this);if(a){if(_xeUtils.default.findTree(o,e=>l===_xeUtils.default.get(e,t),{children:i}))return r}else if(!o.some(e=>l===_xeUtils.default.get(e,t)))return r}}return null},clearRadioReserve(){return this.radioReserveRow=null,this.$nextTick()},getCheckboxReserveRecords(r){var e=this,o=e.treeConfig;let{afterFullData:a,fullDataRowIdData:i,checkboxReserveRowMap:n}=e;var t=e.computeCheckboxOpts,d=e.computeTreeOpts,d=d.children||d.childrenField;let s=[];if(t.reserve){let t=(0,_util.createHandleGetRowId)(e).handleGetRowId,l={};o?_xeUtils.default.eachTree(a,e=>{l[t(e)]=1},{children:d}):a.forEach(e=>{l[t(e)]=1}),_xeUtils.default.each(n,(e,t)=>{e&&(r?i[t]||s.push(e):l[t]||s.push(e))})}return s},clearCheckboxReserve(){return this.checkboxReserveRowMap={},this.$nextTick()},handleCheckboxReserveRow(e,t){var{checkboxReserveRowMap:l,checkboxOpts:r}=this;r.reserve&&(r=(0,_util.getRowid)(this,e),t?l[r]=e:l[r]&&delete l[r])},handleCheckAllEvent(e,t){let l=this;handleCheckedAllCheckboxRow(l,t),e&&l.dispatchEvent("checkbox-all",{records:()=>l.getCheckboxRecords(),reserves:()=>l.getCheckboxReserveRecords(),indeterminates:()=>l.getCheckboxIndeterminateRecords(),checked:t},e)},triggerCheckAllEvent(e,t){var l=this.checkboxOpts,l=l.trigger;"manual"!==l&&(e&&e.stopPropagation(),this.handleCheckAllEvent(e,t))},toggleAllCheckboxRow(){return this.handleCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearCheckboxRow(){var e=this,t=e,l=e;let r=e.treeConfig;var o=l.tableFullData,a=e.computeTreeOpts,a=a.children||a.childrenField,e=e.computeCheckboxOpts;let{checkField:i,reserve:n}=e,d=e.indeterminateField||e.halfField;return i&&(e=e=>{r&&d&&_xeUtils.default.set(e,d,!1),_xeUtils.default.set(e,i,!1)},r?_xeUtils.default.eachTree(o,e,{children:a}):o.forEach(e)),n&&o.forEach(e=>this.handleCheckboxReserveRow(e,!1)),t.isAllSelected=!1,t.isIndeterminate=!1,l.selectCheckboxMaps={},l.treeIndeterminateRowMaps={},t.updateCheckboxFlag++,this.$nextTick()},triggerRadioRowEvent(l,r){var o=this,a=o.selectRadioRow,i=r.row,n=o.computeRadioOpts,{trigger:e,checkMethod:t}=n;if("manual"!==e&&(l.stopPropagation(),!t||t({$table:o,row:i}))){let e=i,t=a!==e;t?handleCheckedRadioRow(o,e):n.strict||(t=a===e)&&(e=null,o.clearRadioRow()),t&&o.dispatchEvent("radio-change",Object.assign({oldValue:a,newValue:e},r),l)}},triggerCurrentColumnEvent(e,t){var l=this,r=l.currentColumn,o=l.computeColumnOpts,a=l.computeCurrentColumnOpts,o=a.beforeSelectMethod||o.currentMethod,i=t.column,a=a.trigger;"manual"!==a&&(a=r!==i,!o||o({column:i,$table:l})?(l.setCurrentColumn(i),a&&l.dispatchEvent("current-column-change",Object.assign({oldValue:r,newValue:i},t),e)):l.dispatchEvent("current-column-disabled",t,e))},triggerCurrentRowEvent(e,t){var l=this,r=l.currentRow,o=l.computeRowOpts,a=l.computeCurrentRowOpts,o=a.beforeSelectMethod||o.currentMethod,i=t.row,a=a.trigger;"manual"!==a&&(a=r!==i,!o||o({row:i,$table:l})?(l.setCurrentRow(i),a&&(l.dispatchEvent("current-row-change",Object.assign({oldValue:r,newValue:i},t),e),l.dispatchEvent("current-change",Object.assign({oldValue:r,newValue:i},t),e))):l.dispatchEvent("current-row-disabled",t,e))},setCurrentRow(e){var{$el:t,rowOpts:l}=this;return this.clearCurrentRow(),this.currentRow=e,(l.isCurrent||this.highlightCurrentRow)&&t&&_xeUtils.default.arrayEach(t.querySelectorAll(`[rowid="${(0,_util.getRowid)(this,e)}"]`),e=>(0,_dom.addClass)(e,"row--current")),this.$nextTick()},isCheckedByRadioRow(e){var t=this.selectRadioRow;return!(!e||!t)&&this.eqRow(t,e)},isCheckedByRadioRowKey(e){var t=this.selectRadioRow;return!!t&&e===(0,_util.getRowid)(this,t)},setRadioRow(e){return handleCheckedRadioRow(this,e,!0)},setRadioRowKey(e){var t=this.fullAllDataRowIdData,t=t[e];return t?handleCheckedRadioRow(this,t.row,!0):this.$nextTick()},clearCurrentRow(){var e=this.$el;return this.currentRow=null,this.hoverRow=null,e&&_xeUtils.default.arrayEach(e.querySelectorAll(".row--current"),e=>(0,_dom.removeClass)(e,"row--current")),this.$nextTick()},clearRadioRow(){return this.selectRadioRow=null,this.$nextTick()},getCurrentRecord(){return this.rowOpts.isCurrent||this.highlightCurrentRow?this.currentRow:null},getRadioRecord(e){var{selectRadioRow:t,fullDataRowIdData:l,afterFullRowMaps:r}=this;if(t){var o=(0,_util.getRowid)(this,t);if(e){if(l[o])return t}else if(r[o])return t}return null},triggerHoverEvent(e,{row:t}){this.setHoverRow(t)},setHoverRow(e){var t=this.$el,l=(0,_util.getRowid)(this,e);this.clearHoverRow(),t&&_xeUtils.default.arrayEach(t.querySelectorAll(`.vxe-body--row[rowid="${l}"]`),e=>(0,_dom.addClass)(e,"row--hover")),this.hoverRow=e},clearHoverRow(){var e=this.$el;e&&_xeUtils.default.arrayEach(e.querySelectorAll(".vxe-body--row.row--hover"),e=>(0,_dom.removeClass)(e,"row--hover")),this.hoverRow=null},triggerHeaderCellClickEvent(e,t){var l=this,r=l,o=l._lastResizeTime,a=l.computeSortOpts,i=l.computeColumnOpts,n=l.computeCurrentColumnOpts,d=t.column,s=e.currentTarget,o=o&&o>Date.now()-300,u=(0,_dom.getEventTargetNode)(e,s,"vxe-cell--sort").flag,c=(0,_dom.getEventTargetNode)(e,s,"vxe-cell--filter").flag;return"cell"!==a.trigger||o||u||c||l.triggerSortEvent(e,d,getNextSortOrder(l,d)),l.dispatchEvent("header-cell-click",Object.assign({triggerResizable:o,triggerSort:u,triggerFilter:c,cell:s},t),e),!i.isCurrent&&!r.highlightCurrentColumn||n.trigger&&!["header","default"].includes(n.trigger)||l.triggerCurrentColumnEvent(e,t),l.$nextTick()},triggerHeaderCellDblclickEvent(e,t){this.emitEvent("header-cell-dblclick",Object.assign({cell:e.currentTarget},t),e)},getCurrentColumn(){return this.columnOpts.isCurrent||this.highlightCurrentColumn?this.currentColumn:null},setCurrentColumn(e){let t=this;var l=t,r=t,l=l.mouseConfig,o=t.computeMouseOpts;let a=l&&o.selected;l=(0,_util.handleFieldOrColumn)(t,e);return l&&(t.clearCurrentColumn(),r.currentColumn=l),t.$nextTick().then(()=>{a&&t.addCellSelectedClass()})},clearCurrentColumn(){return this.currentColumn=null,this.$nextTick()},triggerCellClickEvent(e,t){var l,r,o,a,i,n,d,s,u,c,h,g,p,f,m,x,v,w,C,R,b,E,_,T=this,{highlightCurrentRow:S,highlightCurrentColumn:y,editConfig:D}=T,{editStore:I,isDragResize:F}=T;F||(F=T.computeExpandOpts,l=T.computeEditOpts,r=T.computeTreeOpts,o=T.computeRadioOpts,a=T.computeCheckboxOpts,i=T.computeKeyboardOpts,n=T.computeAggregateOpts,d=T.computeRowOpts,s=T.computeColumnOpts,u=T.computeCurrentColumnOpts,{actived:I,focused:c}=I,{row:h,column:g}=t,{type:m,treeNode:p,rowGroupNode:f}=g,x="checkbox"===m,v="expand"===m,w=e.currentTarget,C=(m="radio"===m)&&(0,_dom.getEventTargetNode)(e,w,"vxe-cell--radio").flag,R=x&&(0,_dom.getEventTargetNode)(e,w,"vxe-cell--checkbox").flag,b=p&&(0,_dom.getEventTargetNode)(e,w,"vxe-cell--tree-btn").flag,E=v&&(0,_dom.getEventTargetNode)(e,w,"vxe-table--expanded").flag,_=v&&(0,_dom.getEventTargetNode)(e,w,"vxe-row-group--node-btn").flag,t=Object.assign({cell:w,triggerRadio:C,triggerCheckbox:R,triggerTreeNode:b,triggerExpandNode:E},t),!R&&!C&&(!E&&("row"===F.trigger||v&&"cell"===F.trigger)&&T.triggerRowExpandEvent(e,t),("row"===r.trigger||p&&"cell"===r.trigger)&&T.triggerTreeExpandEvent(e,t),"row"===n.trigger||f&&"cell"===n.trigger)&&T.triggerRowGroupExpandEvent(e,t),b||(E||_||(!d.isCurrent&&!S||R||C||T.triggerCurrentRowEvent(e,t),!s.isCurrent&&!y||u.trigger&&!["cell","default"].includes(u.trigger)||R||C||T.triggerCurrentColumnEvent(e,t),!C&&("row"===o.trigger||m&&"cell"===o.trigger)&&T.triggerRadioRowEvent(e,t),!R&&("row"===a.trigger||x&&"cell"===a.trigger)&&T.handleToggleCheckRowEvent(e,t)),(0,_utils.isEnableConf)(D)&&(i.arrowCursorLock&&e&&"cell"===l.mode&&e.target&&/^input|textarea$/i.test(e.target.tagName)&&(c.column=g,c.row=h),"manual"===l.trigger?I.args&&I.row===h&&g!==I.column&&handleChangeCell(T,e,t):I.args&&h===I.row&&g===I.column||("click"===l.trigger||"dblclick"===l.trigger&&"row"===l.mode&&I.row===h)&&handleChangeCell(T,e,t))),(0,_utils.isEnableConf)(D)&&"dblclick"===l.trigger&&I.row&&I.column&&("row"===l.mode?T.eqRow(I.row,h)||T.handleClearEdit(e):"cell"!==l.mode||T.eqRow(I.row,h)&&I.column.id===g.id||T.handleClearEdit(e)),T.dispatchEvent("cell-click",t,e))},triggerCellDblclickEvent(e,t){let l=this;var r,o=l.editConfig,{editStore:a,isDragResize:i}=l;i||(i=l.computeEditOpts,a=a.actived,r=e.currentTarget,t=Object.assign({cell:r},t),!(0,_utils.isEnableConf)(o)||"dblclick"!==i.trigger||a.args&&e.currentTarget===a.args.cell||("row"===i.mode?checkValidate(l,"blur").catch(e=>e).then(()=>{l.handleEdit(t,e).then(()=>checkValidate(l,"change")).catch(e=>e)}):"cell"===i.mode&&l.handleEdit(t,e).then(()=>checkValidate(l,"change")).catch(e=>e)),this.emitEvent("cell-dblclick",t,e))},handleColumnSortEvent(e,t){var l=this,r=l.mouseConfig,o=l.computeMouseOpts,{field:a,sortable:i,order:n}=t;i&&(i={$table:l,$event:e,column:t,field:a,property:a,order:n,sortList:l.getSortColumns(),sortTime:t.sortTime},r&&o.area&&l.handleSortEvent&&l.handleSortEvent(e,i),n||l.dispatchEvent("clear-sort",i,e),l.dispatchEvent("sort-change",i,e))},triggerSortEvent(e,t,l){var{multiple:r,allowClear:o}=this.computeSortOpts,{field:a,sortable:i}=t;(i||t.remoteSort)&&(l&&t.order!==l?this.sort({field:a,order:l}):o&&this.clearSort(r?t:null),this.handleColumnSortEvent(e,t))},handleCellRuleUpdateStatus(e,t,r){let o=this;let a=o.validStore,{row:i,column:n}=t;if(o.hasCellRules&&o.hasCellRules(e,i,n)){let l=o.getCellElement(i,n);if(l){let t=!_xeUtils.default.isUndefined(r);return o.validCellRules(e,i,n,r).then(()=>{t&&a.visible&&(0,_util.setCellValue)(i,n,r),o.clearValidate(i,n)}).catch(({rule:e})=>{t&&(0,_util.setCellValue)(i,n,r),o.showValidTooltip({rule:e,row:i,column:n,cell:l})})}}return o.$nextTick()},triggerHeaderCellMousedownEvent(e,t){var l=this,r=l.mouseConfig,o=l.computeMouseOpts,a=l.computeColumnOpts,{trigger:i,isCrossDrag:n,isPeerDrag:d,disabledMethod:s}=l.computeColumnDragOpts,u=e.currentTarget,c=u&&u.tagName&&"input"===u.tagName.toLowerCase(),h=(0,_dom.getEventTargetNode)(e,u,"vxe-cell--checkbox").flag,g=(0,_dom.getEventTargetNode)(e,u,"vxe-cell--sort").flag,p=(0,_dom.getEventTargetNode)(e,u,"vxe-cell--filter").flag;let f=!1;a=a.drag&&"cell"===i;c||h||g||p||(i=t.column,!a)||i.fixed||!n&&!d&&i.parentId||s&&s(t)||(f=!0,l.handleHeaderCellDragMousedownEvent(e,t)),!f&&r&&o.area&&l.handleHeaderCellAreaEvent&&l.handleHeaderCellAreaEvent(e,Object.assign({cell:u,triggerSort:g,triggerFilter:p},t)),l.focus(),l.closeMenu&&l.closeMenu()},triggerCellMousedownEvent(e,t){var l=this,r=t.column,{type:o,treeNode:a}=r,i="radio"===o,n="checkbox"===o,o="expand"===o,d=l.computeRowOpts,{trigger:s,isCrossDrag:u,isPeerDrag:c,disabledMethod:h}=l.computeRowDragOpts,g=e.currentTarget,p=(t.cell=g)&&g.tagName&&"input"===g.tagName.toLowerCase(),i=i&&(0,_dom.getEventTargetNode)(e,g,"vxe-cell--radio").flag,n=n&&(0,_dom.getEventTargetNode)(e,g,"vxe-cell--checkbox").flag,a=a&&(0,_dom.getEventTargetNode)(e,g,"vxe-cell--tree-btn").flag,o=o&&(0,_dom.getEventTargetNode)(e,g,"vxe-table--expanded").flag;let f=!1,m=(d.drag&&(f="row"===s||r.dragSort&&"cell"===s),!1);p||i||n||a||o||!f||!u&&!c&&t.level||h&&h(t)||(m=!0,l.handleCellDragMousedownEvent(e,t)),!m&&l.handleCellMousedownEvent&&l.handleCellMousedownEvent(e,t),l.focus(),l.closeFilter(),l.closeMenu&&l.closeMenu()},triggerCellMouseupEvent(){clearDragStatus(this)},handleRowDragDragstartEvent(e){e.dataTransfer&&e.dataTransfer.setDragImage((0,_dom.getTpImg)(),0,0)},handleRowDragSwapEvent(d,e,s,u,c,t){let h=this;var l=h;let g=h,p=h,{treeConfig:f,dragConfig:r}=l;l=h.computeRowDragOpts;let{afterFullData:m,tableFullData:x,fullAllDataRowIdData:v}=p,{isPeerDrag:w,isCrossDrag:C,isSelfToChildDrag:R,dragEndMethod:o,dragToChildMethod:a}=l;l=h.computeTreeOpts;let{transform:b,rowField:E,mapChildrenField:_,parentField:T}=l,S=l.children||l.childrenField;l=o||(r?r.dragEndMethod:null);let y="bottom"===c?1:0,D={status:!1};if(u&&s&&u!==s){var i={oldRow:s,newRow:u,dragRow:s,dragPos:c,dragToChild:!!t,offsetIndex:y};let n=R&&a?a(i):t;return Promise.resolve(!l||l(i)).then(l=>{if(!l)return D;let e=-1,t=-1;if(f){if(b){var l=(0,_util.getRowid)(h,s),l=v[l],r=(0,_util.getRowid)(h,u),o=v[r];if(l&&o){var a=l.level,i=o.level;let t={},e=(_xeUtils.default.eachTree([s],e=>{t[(0,_util.getRowid)(h,e)]=e},{children:_}),!1);if(a&&i)if(w&&!C){if(l.row[T]!==o.row[T])return D}else{if(!C)return D;if(t[r]&&(e=!0,!C||!R))return _ui.VxeUI.modal&&_ui.VxeUI.modal.message({status:"error",content:getI18n("vxe.error.treeDragChild")}),D}else if(a){if(!C)return D}else if(i){if(!C)return D;if(t[r]&&(e=!0,!C||!R))return _ui.VxeUI.modal&&_ui.VxeUI.modal.message({status:"error",content:getI18n("vxe.error.treeDragChild")}),D}l=_xeUtils.default.toTreeArray(p.afterTreeFullData,{key:E,parentKey:T,children:_}),o=h.findRowIndexOf(l,s),a=(l.splice(o,1),h.findRowIndexOf(l,u)),i=a+y;l.splice(i,0,s),e&&C&&R&&_xeUtils.default.each(s[S],e=>{e[T]=s[T]}),s[T]=n?u[E]:u[T],p.tableFullTreeData=_xeUtils.default.toArrayTree(l,{key:E,parentKey:T,children:S,mapChildren:_})}}}else{e=h.findRowIndexOf(m,s);r=h.findRowIndexOf(x,s),o=(m.splice(e,1),x.splice(r,1),h.findRowIndexOf(m,u)),a=h.findRowIndexOf(x,u),i=(t=o+y,a+y);m.splice(t,0,s),x.splice(i,0,s)}return g.isDragRowMove=!0,h.handleTableData(f&&b),h.cacheRowMap(!1),updateScrollYStatus(h),f&&b||updateAfterDataIndex(h),h.checkSelectionStatus(),g.scrollYLoad&&h.updateScrollYSpace(),d&&h.dispatchEvent("row-dragend",{oldRow:s,newRow:u,dragRow:s,dragPos:c,dragToChild:n,offsetIndex:y,_index:{newIndex:t,oldIndex:e}},d),h.$nextTick().then(()=>{h.updateCellAreas(),h.recalculate()}).then(()=>({status:!0}))}).catch(()=>D)}return Promise.resolve(D)},handleRowDragDragendEvent(e){var t=this;let l=t;var r=t,o=t.treeConfig,{fullAllDataRowIdData:a,prevDragToChild:i}=r,n=l.dragRow,d=t.computeTreeOpts,s=d.lazy,d=d.hasChild||d.hasChildField,{prevDragRow:u,prevDragPos:c}=r;o&&s&&i&&(o=a[(0,_util.getRowid)(t,u)],u[d])&&(!o||!o.treeLoaded)||t.handleRowDragSwapEvent(e,!0,n,u,c,i),hideDropTip(t),clearRowDropOrigin(t),r.prevDragToChild=!1,l.dragRow=null,l.dragCol=null,setTimeout(()=>{l.isDragRowMove=!1},500)},handleRowDragDragoverEvent(l){var r=this,o=r,a=r,i=r.treeConfig,n=o.fullAllDataRowIdData;let e=a.dragRow;var d=r.computeTreeOpts,{lazy:s,transform:u,parentField:c}=d,d=d.hasChild||d.hasChildField,{isPeerDrag:h,isCrossDrag:g,isToChildDrag:p}=r.computeRowDragOpts;if(e){var f=(0,_dom.hasControlKey)(l),m=l.currentTarget;let e=m.getAttribute("rowid")||"";var x=n[e];if(x){var v=x.row;let e=(0,_util.getRowid)(r,v);n=n[e];l.preventDefault();let t=a.dragRow;a=l.clientY-m.getBoundingClientRect().y<m.clientHeight/2?"top":"bottom";o.prevDragToChild=!!(i&&u&&p&&f),o.prevDragRow=v,o.prevDragPos=a,r.eqRow(t,v)||f&&i&&s&&v[d]&&n&&!n.treeLoaded||!g&&i&&u&&(h?t[c]!==v[c]:x.level)?showDropTip(r,l,m,null,!1,a):(showDropTip(r,l,m,null,!0,a),r.dispatchEvent("row-dragover",{oldRow:t,targetRow:v,dragPos:a},l))}}else l.preventDefault()},handleCellDragMousedownEvent(e,t){var l=this,r=l,o=l,r=(e.stopPropagation(),r).dragConfig,{trigger:a,dragStartMethod:i}=l.computeRowDragOpts,n=t.row,d=e.currentTarget,d="cell"===a||"row"===a?d:null==(a=d.parentElement)?void 0:a.parentElement,a=d.parentElement,i=i||(r?r.dragStartMethod:null);o.isDragRowMove=!1,clearRowDropOrigin(l),i&&!i(t)?(a.draggable=!1,o.dragRow=null,o.dragCol=null,hideDropTip(l)):(o.dragRow=n,o.dragCol=null,a.draggable=!0,updateRowDropOrigin(l,n),updateRowDropTipContent(l,d),l.dispatchEvent("row-dragstart",t,e))},handleCellDragMouseupEvent(){clearDragStatus(this)},handleHeaderCellDragDragstartEvent(e){e.dataTransfer&&e.dataTransfer.setDragImage((0,_dom.getTpImg)(),0,0)},handleColDragSwapColumn(){let e=this;handleUpdateColumn(e),parseColumns(e,!1).then(()=>{e.updateCellAreas(),e.saveCustomStore("update:sort")})},handleColDragSwapEvent(c,h,e,t,g,l){let p=this;var r=p;let f=p;var o=p;let m=r.mouseConfig,{isPeerDrag:x,isCrossDrag:v,isSelfToChildDrag:w,isToChildDrag:C,dragEndMethod:a,dragToChildMethod:i}=p.computeColumnDragOpts,R=o.collectColumn,b="right"===g?1:0,E={status:!1};if(t&&e&&t!==e){let d=e,s=t;r={oldColumn:d,newColumn:s,dragColumn:d,dragPos:g,dragToChild:!!l,offsetIndex:b};let u=w&&i?i(r):l;return Promise.resolve(!a||a(r)).then(e=>{if(!e)return E;let t=-1,l=-1,r={},o=(_xeUtils.default.eachTree([d],e=>{r[e.id]=e}),!1);if(d.parentId&&s.parentId)if(x&&!v){if(d.parentId!==s.parentId)return E}else{if(!v)return E;if(r[s.id]&&(o=!0,!v||!w))return _ui.VxeUI.modal&&_ui.VxeUI.modal.message({status:"error",content:getI18n("vxe.error.treeDragChild")}),E}else if(d.parentId){if(!v)return E}else if(s.parentId){if(!v)return E;if(r[s.id]&&(o=!0,!v||!w))return _ui.VxeUI.modal&&_ui.VxeUI.modal.message({status:"error",content:getI18n("vxe.error.treeDragChild")}),E}var a,i,n,e=_xeUtils.default.findTree(R,e=>e.id===d.id),e=(o&&v&&w?e&&({items:a,index:n}=e,(i=d.children||[]).forEach(e=>{e.parentId=d.parentId}),a.splice(n,1,...i),d.children=[]):e&&({items:a,index:n,parent:i}=e,a.splice(n,1),i||(t=n)),_xeUtils.default.findTree(R,e=>e.id===s.id));return e&&({items:a,index:i,parent:n}=e,v&&C&&u?(d.parentId=s.id,s.children=(s.children||[]).concat([d])):(d.parentId=s.parentId,a.splice(i+b,0,d)),n||(l=i)),_xeUtils.default.eachTree(R,(e,t,l,r,o)=>{o||(e.renderSortNumber=t+1)}),f.isDragColMove=!0,m&&(p.clearSelected&&p.clearSelected(),p.clearCellAreas)&&(p.clearCellAreas(),p.clearCopyCellArea()),c&&p.dispatchEvent("column-dragend",{oldColumn:d,newColumn:s,dragColumn:d,dragPos:g,dragToChild:u,offsetIndex:b,_index:{newIndex:l,oldIndex:t}},c),h&&p.handleColDragSwapColumn(),{status:!0}}).catch(()=>E)}return Promise.resolve(E)},handleHeaderCellDragDragendEvent(e){let t=this,l=t;var r=t,o=l.dragCol,{prevDragCol:a,prevDragPos:i,prevDragToChild:n}=r;t.handleColDragSwapEvent(e,!0,o,a,i,n),hideDropTip(t),clearColDropOrigin(t),r.prevDragToChild=!1,l.dragRow=null,l.dragCol=null,setTimeout(()=>{l.isDragColMove=!1,t.recalculate().then(()=>{loadScrollXData(t)})},500)},handleHeaderCellDragDragoverEvent(e){var t,l,r,o,a,i=this,n=i,d=i.dragCol,{isToChildDrag:s,isPeerDrag:u,isCrossDrag:c}=i.computeColumnDragOpts;d?(o=(0,_dom.hasControlKey)(e),a=(l=e.currentTarget).getAttribute("colid"),(a=i.getColumnById(a))&&(e.preventDefault(),t=e.clientX,r=t-l.getBoundingClientRect().x<l.clientWidth/2?"left":"right",n.prevDragToChild=!!(c&&s&&o),n.prevDragCol=a,n.prevDragPos=r,a.fixed||d&&d.id===a.id||!c&&(u?d.parentId!==a.parentId:a.parentId)?showDropTip(i,e,null,l,!1,r):(showDropTip(i,e,null,l,!0,r),i.dispatchEvent("column-dragover",{oldColumn:d,targetColumn:a,dragPos:r},e),(s=i.$refs.refElem)&&(o=i.$refs.refScrollXHandleElem,c=(n=i.$refs.refTableBody)?n.$el:null,u=o||c)&&(l=s.getBoundingClientRect(),d=s.clientWidth,r=(a=i.$refs.refLeftContainer)?a.clientWidth:0,o=(n=i.$refs.refRightContainer)?n.clientWidth:0,c=t-(l.x+r),s=l.x+d-o-t,0<c&&c<=28?(a=Math.floor(d/(14<c?240:120)),u.scrollLeft-=a*(28-c)):0<s&&s<=28&&(i=Math.floor(d/(14<s?240:120)),u.scrollLeft+=i*(28-s)))))):e.preventDefault()},handleHeaderCellDragMousedownEvent(e,t){var l=this,r=l,o=(e.stopPropagation(),l.computeColumnDragOpts),{trigger:o,dragStartMethod:a}=o,i=t.column,n=e.currentTarget,n="cell"===o?n:null==(o=n.parentElement)?void 0:o.parentElement;r.isDragColMove=!1,clearColDropOrigin(l),a&&!a(t)?(n.draggable=!1,r.dragRow=null,r.dragCol=null,hideDropTip(l)):(r.dragCol=i,r.dragRow=null,n.draggable=!0,updateColDropOrigin(l,i),updateColDropTipContent(l,n),l.dispatchEvent("column-dragstart",t,e))},handleHeaderCellDragMouseupEvent(){var e=this;clearColDropOrigin(this),hideDropTip(this),e.dragRow=null,e.dragCol=null,e.isDragColMove=!1},setPendingRow(e,t){var l=this;let r=(0,_util.createHandleGetRowId)(this).handleGetRowId,o=this.pendingRowMaps;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),t?e.forEach(e=>{var t=r(e);t&&!o[t]&&(o[t]=e)}):e.forEach(e=>{e=r(e);e&&o[e]&&delete o[e]}),l.pendingRowFlag++,this.$nextTick()},togglePendingRow(e){var t=this;let l=(0,_util.createHandleGetRowId)(this).handleGetRowId,r=this.pendingRowMaps;return(e=e&&!_xeUtils.default.isArray(e)?[e]:e).forEach(e=>{var t=l(e);t&&(r[t]?delete r[t]:r[t]=e)}),t.pendingRowFlag++,this.$nextTick()},hasPendingByRow(e){return this.isPendingByRow(e)},isPendingByRow(e){var t=this.pendingRowMaps;return!!t[(0,_util.getRowid)(this,e)]},getPendingRecords(){let{fullAllDataRowIdData:l,pendingRowMaps:e}=this,r=[];return _xeUtils.default.each(e,(e,t)=>{l[t]&&r.push(e)}),r},clearPendingRow(){var e=this;return this.pendingRowMaps={},e.pendingRowFlag++,this.$nextTick()},sort(e,t){let i=this;let{multiple:l,remote:r,orders:n}=i.computeSortOpts;if(e&&_xeUtils.default.isString(e)&&(e=[{field:e,order:t}]),(e=_xeUtils.default.isArray(e)?e:[e]).length){let a;return l||clearAllSort(i),(l?e:[e[0]]).forEach((e,t)=>{let{field:l,order:r}=e,o=l;(o=_xeUtils.default.isString(l)?i.getColumnByField(l):o)&&(o.sortable||o.remoteSort)&&(a=a||o,n&&-1===n.indexOf(r)&&(r=getNextSortOrder(i,o)),o.order!==r&&(o.order=r),o.sortTime=Date.now()+t)}),(!r||a&&a.remoteSort)&&i.handleTableData(!0),i.$nextTick().then(()=>(updateRowOffsetTop(i),i.updateCellAreas(),updateStyle(i)))}return i.$nextTick()},setSort(e,t){return handleSortEvent(this,new Event("click"),e,t)},setSortByEvent(e,t,l){return handleSortEvent(this,e,t,l)},clearSort(e){let t=this;var l=t.computeSortOpts;return e?(e=(0,_util.handleFieldOrColumn)(t,e))&&(e.order=null):clearAllSort(t),l.remote||t.handleTableData(!0),t.$nextTick().then(()=>(updateRowOffsetTop(t),updateStyle(t)))},clearSortByEvent(e,t){let l=this;var r=l.tableFullColumn,o=l.computeSortOpts;let a=[],i=null;return e&&(t?(i=(0,_util.handleFieldOrColumn)(l,t))&&(i.order=null):r.forEach(e=>{e.order&&(e.order=null,a.push(e))}),o.remote||l.handleTableData(!0),a.length?(t={$table:l,$event:e,cols:a,sortList:[]},l.dispatchEvent("clear-all-sort",t,e)):i&&l.handleColumnSortEvent(e,i)),l.$nextTick().then(()=>(updateRowOffsetTop(l),updateStyle(l)))},getSortColumn(){return(0,_log.warnLog)("vxe.error.delFunc",["getSortColumn","getSortColumns"]),_xeUtils.default.find(this.tableFullColumn,e=>(e.sortable||e.remoteSort)&&e.order)},isSort(e){return e?(e=(0,_util.handleFieldOrColumn)(this,e))&&e.sortable&&!!e.order:0<this.getSortColumns().length},getSortColumns(){var{multiple:e,chronological:t}=this.sortOpts;let r=[];return this.tableFullColumn.forEach(e=>{var{field:t,order:l}=e;(e.sortable||e.remoteSort)&&l&&r.push({column:e,field:t,property:t,order:l,sortTime:e.sortTime})}),e&&t&&1<r.length?_xeUtils.default.orderBy(r,"sortTime"):r},setFilterByEvent(e,t,l,r){t=(0,_util.handleFieldOrColumn)(this,t);return t&&t.filters&&(t.filters=(0,_util.toFilters)(l||[]),r)?this.handleColumnConfirmFilter(t,e):this.$nextTick()},closeFilter(){let e=this;var t=e.filterStore,{column:l,visible:r}=t;return t.isAllSelected=!1,t.isIndeterminate=!1,t.options=[],t.visible=!1,r&&e.dispatchEvent("filter-visible",{column:l,field:l.field,property:l.field,filterList:()=>e.getCheckedFilters(),visible:!1},null),e.$nextTick()},isActiveFilterByColumn(e){e=(0,_util.handleFieldOrColumn)(this,e);return e?e.filters&&e.filters.some(e=>e.checked):0<this.getCheckedFilters().length},isFilter(e){return this.isActiveFilterByColumn(e)},clearFilterByEvent(e,t){let l=this;var r=l.filterStore,o=l.tableFullColumn,a=l.computeFilterOpts;let i=[],n=null;return t?(n=(0,_util.handleFieldOrColumn)(l,t))&&l.handleClearFilter(n):o.forEach(e=>{e.filters&&(i.push(e),l.handleClearFilter(e))}),t&&n===r.column||Object.assign(r,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),a.remote||l.updateData(),i.length?(o={$table:l,$event:e,cols:i,filterList:[]},l.dispatchEvent("clear-all-filter",o,e)):n&&l.dispatchEvent("clear-filter",{filterList:()=>l.getCheckedFilters()},e),l.$nextTick()},isRowExpandLoaded(e){var t=this.fullAllDataRowIdData,t=t[(0,_util.getRowid)(this,e)];return t&&!!t.expandLoaded},clearRowExpandLoaded(e){var t=this,l=t,{fullAllDataRowIdData:r,rowExpandLazyLoadedMaps:o}=t,a=t.computeExpandOpts.lazy,e=(0,_util.getRowid)(t,e),r=r[e];return a&&r&&(r.expandLoaded=!1,delete o[e]),l.rowExpandedFlag++,t.$nextTick()},reloadRowExpand(e){let t=this;var l=t.rowExpandLazyLoadedMaps,r=t.computeExpandOpts.lazy,o=(0,_util.getRowid)(this,e);return r&&!l[o]&&t.clearRowExpandLoaded(e).then(()=>handleAsyncRowExpand(t,e)),t.$nextTick()},reloadExpandContent(e){return(0,_log.warnLog)("vxe.error.delFunc",["reloadExpandContent","reloadRowExpand"]),this.reloadRowExpand(e)},triggerRowExpandEvent(e,t){var l=this,r=l.expandColumn,o=l.rowExpandLazyLoadedMaps,t=t.row,{lazy:a,trigger:i}=l.computeExpandOpts;"manual"===i||(e.stopPropagation(),i=(0,_util.getRowid)(l,t),a&&o[i])||(a=!l.isRowExpandByRow(t),o=r?l.getColumnIndex(r):-1,i=r?l.getVMColumnIndex(r):-1,l.setRowExpand(t,a),l.dispatchEvent("toggle-row-expand",{expanded:a,column:r,columnIndex:o,$columnIndex:i,row:t,rowIndex:l.getRowIndex(t),$rowIndex:l.getVMRowIndex(t)},e))},toggleRowExpand(e){return this.setRowExpand(e,!this.isRowExpandByRow(e))},setAllRowExpand(e){var{treeConfig:t,treeOpts:l,tableFullData:r,tableFullTreeData:o}=this,l=l.children||l.childrenField;let a=[];return t?_xeUtils.default.eachTree(o,e=>{a.push(e)},{children:l}):a=r,this.setRowExpand(a,e)},setRowExpand(e,t){let r=this;var l=r,o=r;let a=l.expandColumn,{fullAllDataRowIdData:i,rowExpandedMaps:n,rowExpandLazyLoadedMaps:d}=o,s=(0,_util.createHandleGetRowId)(r).handleGetRowId,{reserve:u,lazy:c,accordion:h,toggleMethod:g}=r.computeExpandOpts,p=[],f=a?r.getColumnIndex(a):-1,m=a?r.getVMColumnIndex(a):-1;return e&&(_xeUtils.default.isArray(e)||(e=[e]),h&&(n={},o.rowExpandedMaps=n,e=e.slice(e.length-1,e.length)),o=g?e.filter(e=>g({$table:r,expanded:t,column:a,columnIndex:f,$columnIndex:m,row:e,rowIndex:r.getRowIndex(e),$rowIndex:r.getVMRowIndex(e)})):e,t?o.forEach(e=>{var t,l=s(e);n[l]||(t=i[l],c&&!t.expandLoaded&&!d[l]?p.push(handleAsyncRowExpand(r,e)):n[l]=e)}):o.forEach(e=>{e=s(e);n[e]&&delete n[e]}),u)&&o.forEach(e=>handleRowExpandReserve(r,e,t)),l.rowExpandedFlag++,Promise.all(p).then(()=>r.$nextTick()).then(()=>r.recalculate(!0)).then(()=>(updateRowOffsetTop(r),updateRowExpandStyle(r),handleRowExpandScroll(r),r.updateCellAreas()))},isRowExpandByRow(e){var t=this.rowExpandedFlag,l=this.rowExpandedMaps,e=(0,_util.getRowid)(this,e);return!!t&&!!l[e]},isExpandByRow(e){return(0,_log.warnLog)("vxe.error.delFunc",["isExpandByRow","isRowExpandByRow"]),this.isRowExpandByRow(e)},clearRowExpand(){let t=this;var e=t,l=t,r=l.tableFullData,o=t.computeExpandOpts.reserve;let a=t.getRowExpandRecords();return l.rowExpandedMaps={},e.rowExpandedFlag++,o&&r.forEach(e=>handleRowExpandReserve(t,e,!1)),t.$nextTick().then(()=>{if(a.length)return t.recalculate(!0)}).then(()=>(updateRowOffsetTop(t),updateRowExpandStyle(t),handleRowExpandScroll(t),t.updateCellAreas()))},clearRowExpandReserve(){return this.rowExpandedReserveRowMap={},this.$nextTick()},getRowExpandRecords(){let t=[];return _xeUtils.default.each(this.rowExpandedMaps,e=>{e&&t.push(e)}),t},setRowGroups(e){var t=this,l=t,{aggregateConfig:r,rowGroupConfig:o}=t;return r||o?e?(handleUpdateRowGroup(t,(_xeUtils.default.isArray(e)?e:[e]).map(e=>_xeUtils.default.isString(e)?e:e.field)),loadTableData(t,l.tableSynchData,!0)):t.$nextTick():((0,_log.errLog)("vxe.error.reqProp",["aggregate-config"]),t.$nextTick())},clearRowGroups(){var e=this,t=e,{aggregateConfig:l,rowGroupConfig:r}=e;return l||r?(handleUpdateRowGroup(e,[]),loadTableData(e,t.tableSynchData,!0)):((0,_log.errLog)("vxe.error.reqProp",["aggregate-config"]),e.$nextTick())},isRowGroupRecord(e){return(0,_log.warnLog)("vxe.error.delFunc",["isRowGroupRecord","isAggregateRecord"]),this.isAggregateRecord(e)},isRowGroupExpandByRow(e){return(0,_log.warnLog)("vxe.error.delFunc",["isRowGroupExpandByRow","isAggregateExpandByRow"]),this.isAggregateExpandByRow(e)},isAggregateRecord(e){var t=this.isRowGroupStatus;return t&&e.isAggregate},isAggregateExpandByRow(e){var t=this.rowGroupExpandedFlag,l=this.rowGroupExpandedMaps;return!!t&&!!l[(0,_util.getRowid)(this,e)]},setRowGroupExpand(e,t){return e?handleRowGroupVirtualExpand(this,e=_xeUtils.default.isArray(e)?e:[e],t):this.$nextTick()},setAllRowGroupExpand(e){let t=this;var l=t,r=t,o=r.tableFullGroupData;let a=t.computeAggregateOpts.mapChildrenField,i={};return e&&a&&_xeUtils.default.eachTree(o,e=>{e[a]&&e[a].length&&(i[(0,_util.getRowid)(t,e)]=e)},{children:a}),r.rowGroupExpandedMaps=i,handleVirtualTreeToList(t),l.rowGroupExpandedFlag++,t.handleTableData()},clearRowGroupExpand(){var e=this;return this.rowGroupExpandedMaps={},handleVirtualTreeToList(this),e.rowGroupExpandedFlag++,this.handleTableData()},getTreeExpandRecords(){let t=[];return _xeUtils.default.each(this.treeExpandedMaps,e=>{e&&t.push(e)}),t},getTreeStatus(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded(e){var t=this.fullAllDataRowIdData,t=t[(0,_util.getRowid)(this,e)];return t&&!!t.treeLoaded},clearTreeExpandLoaded(e){let l=this;var t=l,r=l;let{fullAllDataRowIdData:o,treeExpandedMaps:a}=r;var i=l.computeTreeOpts.transform;return e?(e=_xeUtils.default.isArray(e)?e:[e]).forEach(e=>{var e=(0,_util.getRowid)(l,e),t=o[e];t&&(t.treeLoaded=!1,a[e])&&delete a[e]}):_xeUtils.default.each(o,e=>{e.treeLoaded=!1}),r.treeExpandedMaps={},i&&(handleVirtualTreeToList(l),l.handleTableData()),t.treeExpandedFlag++,l.$nextTick()},reloadTreeExpand(e){let t=this,l=t;var r=t.treeExpandLazyLoadedMaps,o=t.computeTreeOpts;let{transform:a,lazy:i}=o;var o=o.hasChild||o.hasChildField,n=(0,_util.getRowid)(t,e);return i&&e[o]&&!r[n]?t.clearTreeExpandLoaded(e).then(()=>handleAsyncTreeExpandChilds(t,e)).then(()=>{a&&(handleVirtualTreeToList(t),t.handleTableData()),l.treeExpandedFlag++}).then(()=>t.recalculate()):t.$nextTick()},reloadTreeChilds(e){return(0,_log.warnLog)("vxe.error.delFunc",["reloadTreeChilds","reloadTreeExpand"]),this.reloadTreeExpand(e)},triggerRowGroupExpandEvent(e,t){var l,r=this,o=r.rowGroupExpandedMaps,{row:t,column:a}=t,i=r.computeAggregateOpts.trigger;"manual"!==i&&(e.stopPropagation(),i=!o[(0,_util.getRowid)(r,t)],o=r.getColumnIndex(a),l=r.getVMColumnIndex(a),r.setRowGroupExpand(t,i),r.dispatchEvent("toggle-row-group-expand",{expanded:i,column:a,columnIndex:o,$columnIndex:l,row:t},e))},triggerTreeExpandEvent(e,t){let l=this,r=l;var{treeExpandLazyLoadedMaps:o,treeEATime:a}=r,i=l.computeTreeOpts;let{row:n,column:d}=t,{lazy:s,trigger:u,accordion:c}=i;"manual"===u||(e.stopPropagation(),t=(0,_util.getRowid)(this,n),s&&o[t])||(i=!l.isTreeExpandByRow(n),o=l.getColumnIndex(d),t=l.getVMColumnIndex(d),a&&clearTimeout(a),l.setTreeExpand(n,i).then(()=>{c&&(r.treeEATime=setTimeout(()=>{r.treeEATime=void 0,l.scrollToRow(n)},30))}),l.dispatchEvent("toggle-tree-expand",{expanded:i,column:d,columnIndex:o,$columnIndex:t,row:n},e))},toggleTreeExpand(e){return this.setTreeExpand(e,!this.isTreeExpandByRow(e))},setAllTreeExpand(e){let t=this,l=t;var r=t.tableFullData,o=t.computeTreeOpts;let{transform:a,lazy:i}=o,n=o.children||o.childrenField,d=[];return _xeUtils.default.eachTree(r,e=>{var t=e[n];(i||t&&t.length)&&d.push(e)},{children:n}),t.setTreeExpand(d,e).then(()=>{if(a)return handleVirtualTreeToList(t),l.treeExpandedFlag++,t.recalculate()})},setTreeExpand(e,t){var l=this.treeOpts,l=l.transform;return e&&(e=_xeUtils.default.isArray(e)?e:[e]).length?(l?handleVirtualTreeExpand:handleBaseTreeExpand)(this,e,t):this.$nextTick()},isTreeExpandByRow(e){var t=this.treeExpandedFlag,l=this.treeExpandedMaps;return!!t&&!!l[(0,_util.getRowid)(this,e)]},clearTreeExpand(){let t=this,e=t;var l=t,r=l.tableFullTreeData,o=t.computeTreeOpts,a=o.children||o.childrenField;let{transform:i,reserve:n}=o,d=t.getTreeExpandRecords();return l.treeExpandedMaps={},n&&_xeUtils.default.eachTree(r,e=>handleTreeExpandReserve(t,e,!1),{children:a}),t.handleTableData().then(()=>{i&&(handleVirtualTreeToList(t),t.handleTableData()),e.treeExpandedFlag++}).then(()=>{d.length&&t.recalculate()})},clearTreeExpandReserve(){return this.treeExpandedReserveRowMap={},this.$nextTick()},getScroll(){var{scrollXLoad:e,scrollYLoad:t}=this,l=this.elemStore,l=(0,_util.getRefElem)(l["main-body-scroll"]);return{virtualX:e,virtualY:t,scrollTop:l?l.scrollTop:0,scrollLeft:l?l.scrollLeft:0}},handleScrollEvent(s,u,c,h,g,p){var f=this,m=f,x=f,v=f.highlightHoverRow,{lastScrollLeft:w,lastScrollTop:C}=x,R=f.$refs.refScrollXHandleElem,b=f.$refs.refScrollYHandleElem;if(R&&b){var E=f.computeRowOpts,_=f.$refs.refValidTooltip,T=f.$refs.refTooltip,S=b.clientHeight,y=R.clientWidth,b=b.scrollHeight,R=R.scrollWidth;let e=!1,t=!1,l=!1,r=!1,o="",a=!1,i=!1,n=!1,d=!1;c&&(D=f.computeScrollXThreshold,(l=g<=0)||(r=R<=g+y),w<g?(o="right",R-D<=g+y&&(d=!0)):(o="left",g<=D&&(n=!0)),f.checkScrolling(),x.lastScrollLeft=g),u&&(w=f.computeScrollYThreshold,(e=h<=0)||(t=b<=h+S),C<h?(o="bottom",b-w<=h+S&&(i=!0)):(o="top",h<=w&&(a=!0)),x.lastScrollTop=h),m.isDragColMove=!1,m.isDragRowMove=!1,m.lastScrollTime=Date.now();var D=Object.assign({scrollTop:h,scrollLeft:g,bodyHeight:S,bodyWidth:y,scrollHeight:b,scrollWidth:R,isX:c,isY:u,isTop:e,isBottom:t,isLeft:l,isRight:r,direction:o},p);updateRowExpandStyle(f),checkLastSyncScroll(f,c,u),c&&f.closeFilter(),(E.isHover||v)&&f.clearHoverRow(),_&&_.reactData.visible&&_.close(),T&&T.reactData.visible&&T.close(),(i||a||d||n)&&f.dispatchEvent("scroll-boundary",D,s),f.dispatchEvent("scroll",D,s)}},triggerScrollXEvent(){(this.computeVirtualXOpts.immediate?loadScrollXData:lazyScrollXData)(this)},triggerScrollYEvent(){(this.computeVirtualYOpts.immediate?loadScrollYData:lazyScrollYData)(this)},triggerBodyScrollEvent(l,r){var o=this,a=o,{scrollYLoad:i,scrollXLoad:n}=o,{elemStore:d,intoRunScroll:s,lastScrollTop:u,lastScrollLeft:c,inWheelScroll:h,inVirtualScroll:g,inHeaderScroll:p,inBodyScroll:f,scrollRenderType:e,inFooterScroll:m}=a;if(!(h||g||p||m)){var h=o.$refs.refScrollXHandleElem,g=o.$refs.refScrollYHandleElem,p=(0,_util.getRefElem)(d["left-body-scroll"]),m=(0,_util.getRefElem)(d["main-body-scroll"]),x=(0,_util.getRefElem)(d["right-body-scroll"]),v=(0,_util.getRefElem)(d["main-header-scroll"]),d=(0,_util.getRefElem)(d["main-footer-scroll"]),w=o.$refs.refRowExpandElem;if(!s&&m&&h&&g&&(!f||e===r)){let e=g.scrollTop,t=h.scrollLeft;p&&"left"===r?e=p.scrollTop:x&&"right"===r?e=x.scrollTop:(e=m.scrollTop,t=m.scrollLeft);s=t!==c,f=e!==u;a.inBodyScroll=!0,a.scrollRenderType=r,f&&("left"===r?((0,_dom.setScrollTop)(m,e),(0,_dom.setScrollTop)(x,e)):"right"===r?((0,_dom.setScrollTop)(m,e),(0,_dom.setScrollTop)(p,e)):((0,_dom.setScrollTop)(p,e),(0,_dom.setScrollTop)(x,e)),(0,_dom.setScrollTop)(g,e),(0,_dom.setScrollTop)(w,e),i)&&o.triggerScrollYEvent(l),s&&((0,_dom.setScrollLeft)(h,t),(0,_dom.setScrollLeft)(v,t),(0,_dom.setScrollLeft)(d,t),n)&&o.triggerScrollXEvent(l),o.handleScrollEvent(l,f,s,e,t,{type:"body",fixed:r})}}},triggerHeaderScrollEvent(e,t){var l=this,r=l,o=l.scrollXLoad,{elemStore:a,intoRunScroll:i,inWheelScroll:n,inVirtualScroll:d,inBodyScroll:s,inFooterScroll:u}=r;n||d||s||u||i||(n=l.$refs.refScrollXHandleElem,d=l.$refs.refScrollYHandleElem,s=(0,_util.getRefElem)(a["main-body-scroll"]),u=(0,_util.getRefElem)(a["main-header-scroll"]),i=(0,_util.getRefElem)(a["main-footer-scroll"]),u&&n&&d&&(a=d.scrollTop,d=u.scrollLeft,r.inHeaderScroll=!0,(0,_dom.setScrollLeft)(n,d),(0,_dom.setScrollLeft)(i,d),(0,_dom.setScrollLeft)(s,d),o&&l.triggerScrollXEvent(e),l.handleScrollEvent(e,!1,!0,a,d,{type:"header",fixed:t})))},triggerFooterScrollEvent(e,t){var l=this,r=this.scrollXLoad,{elemStore:o,intoRunScroll:a,inWheelScroll:i,inVirtualScroll:n,inHeaderScroll:d,inBodyScroll:s}=l;i||n||d||s||(i=this.$refs.refScrollXHandleElem,n=this.$refs.refScrollYHandleElem,d=(0,_util.getRefElem)(o["main-body-scroll"]),s=(0,_util.getRefElem)(o["main-header-scroll"]),o=(0,_util.getRefElem)(o["main-footer-scroll"]),a)||o&&i&&n&&(a=n.scrollTop,n=o.scrollLeft,l.inFooterScroll=!0,(0,_dom.setScrollLeft)(i,n),(0,_dom.setScrollLeft)(s,n),(0,_dom.setScrollLeft)(d,n),r&&this.triggerScrollXEvent(e),this.handleScrollEvent(e,!1,!0,a,n,{type:"footer",fixed:t}))},triggerBodyWheelEvent(g){let p=this;var f=p,m=p;let x=p;var{target:v,deltaY:w,deltaX:C,shiftKey:R}=g;if(!v||!/^textarea$/i.test(v.tagName)){v=f.highlightHoverRow;let{scrollXLoad:c,scrollYLoad:h,expandColumn:e}=m;var f=p.computeLeftFixedWidth,b=p.computeRightFixedWidth;if(f||b||e){var{elemStore:f,lastScrollTop:b,lastScrollLeft:E}=x,_=p.computeRowOpts;let r=p.$refs.refScrollXHandleElem,o=p.$refs.refScrollYHandleElem,a=(0,_util.getRefElem)(f["left-body-scroll"]),i=(0,_util.getRefElem)(f["main-header-scroll"]),n=(0,_util.getRefElem)(f["main-body-scroll"]),d=(0,_util.getRefElem)(f["main-footer-scroll"]),s=(0,_util.getRefElem)(f["right-body-scroll"]),u=p.$refs.refRowExpandElem;if(r&&o&&n){f=getWheelSpeed(m.lastScrollTime),m=R?0:Math.ceil(w*f),R=Math.ceil((R&&w||C)*f),w=m<0,C=n.scrollTop;if(!(w?C<=0:C>=n.scrollHeight-n.clientHeight)){f=C+m,w=n.scrollLeft+R;let t=w!==E,l=f!==b;(_.isHover||v)&&p.clearHoverRow(),t&&(g.preventDefault(),x.inWheelScroll=!0,browseObj.firefox||browseObj.safari?((0,_dom.setScrollLeft)(r,m=w),(0,_dom.setScrollLeft)(n,m),(0,_dom.setScrollLeft)(i,m),(0,_dom.setScrollLeft)(d,m),c&&p.triggerScrollXEvent(g),p.handleScrollEvent(g,l,t,n.scrollTop,m,{type:"table",fixed:""})):wheelScrollLeftTo(w,e=>{(0,_dom.setScrollLeft)(r,e),(0,_dom.setScrollLeft)(n,e),(0,_dom.setScrollLeft)(i,e),(0,_dom.setScrollLeft)(d,e),c&&p.triggerScrollXEvent(g),p.handleScrollEvent(g,l,t,n.scrollTop,e,{type:"table",fixed:""})})),l&&(g.preventDefault(),browseObj.firefox||browseObj.safari?((0,_dom.setScrollTop)(o,R=f),(0,_dom.setScrollTop)(n,R),(0,_dom.setScrollTop)(a,R),(0,_dom.setScrollTop)(s,R),(0,_dom.setScrollTop)(u,R),h&&p.triggerScrollYEvent(g),p.handleScrollEvent(g,l,t,R,n.scrollLeft,{type:"table",fixed:""})):wheelScrollTopTo(f-C,e=>{e=n.scrollTop+e;x.inWheelScroll=!0,(0,_dom.setScrollTop)(o,e),(0,_dom.setScrollTop)(n,e),(0,_dom.setScrollTop)(a,e),(0,_dom.setScrollTop)(s,e),(0,_dom.setScrollTop)(u,e),h&&p.triggerScrollYEvent(g),p.handleScrollEvent(g,l,t,e,n.scrollLeft,{type:"table",fixed:""})}))}}}}},triggerVirtualScrollXEvent(t){var l=this,r=this.scrollXLoad,{elemStore:o,inWheelScroll:a,lastScrollTop:i,inHeaderScroll:n,inBodyScroll:d,inFooterScroll:s}=l;if(!(n||d||s||a)){n=(0,_util.getRefElem)(o["main-header-scroll"]),d=(0,_util.getRefElem)(o["main-body-scroll"]),s=(0,_util.getRefElem)(o["main-footer-scroll"]),a=this.$refs.refScrollYHandleElem,o=t.currentTarget.scrollLeft,a=a||d;let e=0;a=(e=a?a.scrollTop:e)!==i;l.inVirtualScroll=!0,(0,_dom.setScrollLeft)(d,o),(0,_dom.setScrollLeft)(n,o),(0,_dom.setScrollLeft)(s,o),r&&this.triggerScrollXEvent(t),this.handleScrollEvent(t,a,!0,e,o,{type:"table",fixed:""})}},triggerVirtualScrollYEvent(t){var l=this,r=this.scrollYLoad,{elemStore:o,inWheelScroll:a,lastScrollLeft:i,inHeaderScroll:n,inBodyScroll:d,inFooterScroll:s}=l;if(!(n||d||s||a)){var n=(0,_util.getRefElem)(o["left-body-scroll"]),d=(0,_util.getRefElem)(o["main-body-scroll"]),s=(0,_util.getRefElem)(o["right-body-scroll"]),a=this.$refs.refRowExpandElem,o=this.$refs.refScrollXHandleElem,u=t.currentTarget.scrollTop,o=o||d;let e=0;o=(e=o?o.scrollLeft:e)!==i;l.inVirtualScroll=!0,(0,_dom.setScrollTop)(d,u),(0,_dom.setScrollTop)(n,u),(0,_dom.setScrollTop)(s,u),(0,_dom.setScrollTop)(a,u),r&&this.triggerScrollYEvent(t),this.handleScrollEvent(t,!0,o,u,e,{type:"table",fixed:""})}},updateScrollXData(){let e=this;let t=e.isAllOverflow;return handleTableColumn(e),e.updateScrollXSpace(),e.$nextTick().then(()=>{handleTableColumn(e),e.updateScrollXSpace(),t||e.updateScrollYSpace()})},updateScrollXSpace(){let o=this;var a=o,i=o;let{scrollXLoad:n,overflowX:d,scrollXWidth:s}=a,{visibleColumn:u,scrollXStore:c,elemStore:h,fullColumnIdData:g}=i;var i=o.computeMouseOpts,p=o.$refs.refTableBody;if(p?p.$el:null){var p=(0,_util.getRefElem)(h["main-body-scroll"]),f=(0,_util.getRefElem)(h["main-body-table"]),m=(0,_util.getRefElem)(h["main-header-table"]),x=(0,_util.getRefElem)(h["main-footer-table"]);let e=0;var v=u[c.startIndex];v&&(v=g[v.id]||{},e=v.oLeft);let t=0,l=(p&&(t=p.clientWidth),!1),r=s;s>maxXWidth&&(e=p&&f&&p.scrollLeft+t>=maxXWidth?maxXWidth-f.clientWidth:(maxXWidth-t)*(e/(s-t)),r=maxXWidth,l=!0),n&&d||(e=0),m&&(m.style.transform=m.getAttribute("xvm")?`translate(${e}px, 0px)`:""),f&&(f.style.transform=`translate(${e}px, ${a.scrollYTop||0}px)`),x&&(x.style.transform=x.getAttribute("xvm")?`translate(${e}px, 0px)`:"");["main"].forEach(t=>{["header","body","footer"].forEach(e=>{e=(0,_util.getRefElem)(h[t+`-${e}-xSpace`]);e&&(e.style.width=n?r+"px":"")})}),a.scrollXLeft=e,a.scrollXWidth=r,a.isScrollXBig=l;v=o.$refs.refScrollXSpaceElem;return v&&(v.style.width=r+"px"),l&&i.area&&(0,_log.errLog)("vxe.error.notProp",["mouse-config.area"]),calcScrollbar(o),o.$nextTick(()=>{updateStyle(o)})}},updateScrollYData(){let e=this;return e.handleTableData(),e.updateScrollYSpace(),e.$nextTick().then(()=>{e.handleTableData(),e.updateScrollYSpace()})},updateScrollYSpace(){let e=this;var t=e,{isAllOverflow:l,scrollYLoad:r,expandColumn:o}=t;let{scrollYStore:a,elemStore:i,isResizeCellHeight:n,afterFullData:d,fullAllDataRowIdData:s,rowExpandedMaps:u}=e;var c=a.startIndex,h=e.computeMouseOpts,g=e.computeExpandOpts,p=e.computeRowOpts,f=e.computeCellOpts,m=e.computeDefaultRowHeight,x=(0,_util.getRefElem)(i["main-body-scroll"]),v=(0,_util.getRefElem)(i["main-body-table"]),w=(0,_util.getRefElem)(i["left-body-table"]),C=(0,_util.getRefElem)(i["right-body-table"]);let R=0,b=0,E=!1,_=(r?n||f.height||p.height||o||!l?(r=d[c],l=s[(0,_util.getRowid)(e,r)]||{},R=l.oTop||0,r=d[d.length-1],l=s[r=(0,_util.getRowid)(e,r)]||{},b=(l.oTop||0)+(l.resizeHeight||f.height||p.height||l.height||m),o&&u[r]&&(b+=l.expandHeight||g.height||0),b>maxYHeight&&(E=!0)):((b=d.length*m)>maxYHeight&&(E=!0),R=Math.max(0,c*m)):v&&(b=v.clientHeight),0),T=(x&&(_=x.clientHeight),b),S=R;E&&(S=x&&v&&x.scrollTop+_>=maxYHeight?maxYHeight-v.clientHeight:(maxYHeight-_)*(R/(b-_)),T=maxYHeight),w&&(w.style.transform=`translate(0px, ${S}px)`),v&&(v.style.transform=`translate(${t.scrollXLeft||0}px, ${S}px)`),C&&(C.style.transform=`translate(0px, ${S}px)`),["main","left","right"].forEach(t=>{["header","body","footer"].forEach(e=>{e=(0,_util.getRefElem)(i[t+`-${e}-ySpace`]);e&&(e.style.height=T?T+"px":"")})});f=e.$refs.refScrollYSpaceElem,f&&(f.style.height=T?T+"px":""),p=e.$refs.refRowExpandYSpaceElem;return p&&(p.style.height=T?T+"px":""),t.scrollYTop=S,t.scrollYHeight=b,(t.isScrollYBig=E)&&h.area&&(0,_log.errLog)("vxe.error.notProp",["mouse-config.area"]),calcScrollbar(e),e.$nextTick().then(()=>{updateStyle(e)})},updateScrollYStatus(){return updateScrollYStatus(this)},scrollTo(e,t){let l=this;var r=l;let o=l;var a=o.elemStore,i=(0,_util.getRefElem)(a["main-header-scroll"]),n=(0,_util.getRefElem)(a["main-body-scroll"]),d=(0,_util.getRefElem)(a["main-footer-scroll"]),s=(0,_util.getRefElem)(a["left-body-scroll"]),a=(0,_util.getRefElem)(a["right-body-scroll"]),u=l.$refs.refScrollXHandleElem,c=l.$refs.refScrollYHandleElem;return o.intoRunScroll=!0,_xeUtils.default.isNumber(e)&&((0,_dom.setScrollLeft)(u,e),(0,_dom.setScrollLeft)(n,e),(0,_dom.setScrollLeft)(i,e),(0,_dom.setScrollLeft)(d,e),loadScrollXData(l)),_xeUtils.default.isNumber(t)&&((0,_dom.setScrollTop)(c,t),(0,_dom.setScrollTop)(n,t),(0,_dom.setScrollTop)(s,t),(0,_dom.setScrollTop)(a,t),loadScrollYData(l)),r.scrollXLoad||r.scrollYLoad?new Promise(e=>{setTimeout(()=>{l.$nextTick(()=>{o.intoRunScroll=!1,e()})},30)}):l.$nextTick()},scrollToRow(e,t){let l=this;var r=l;let{isAllOverflow:o,scrollYLoad:a,scrollXLoad:i}=l;var n=[];return e&&(r.treeConfig?n.push(l.scrollToTreeRow(e)):n.push((0,_util.rowToVisible)(l,e))),t&&n.push(handleScrollToRowColumn(l,t,e)),Promise.all(n).then(()=>{if(e)return o||!a&&!i||(calcCellHeight(l),calcCellWidth(l)),l.$nextTick()})},scrollToColumn(e){return handleScrollToRowColumn(this,e)},scrollToTreeRow(t){let r=this;var e=r.treeConfig,l=r.isRowGroupStatus,o=r.tableFullData;let a=[];if(e||l){var e=r.computeAggregateOpts,i=r.computeTreeOpts,i=i.children||i.childrenField,o=_xeUtils.default.findTree(o,e=>r.eqRow(e,t),{children:l?e.mapChildrenField:i});if(o){let l=o.nodes;l.forEach((e,t)=>{t<l.length-1&&!r.isTreeExpandByRow(e)&&a.push(r.setTreeExpand(e,!0))})}}return Promise.all(a).then(()=>(0,_util.rowToVisible)(r,t))},clearScroll(){let e=this;var{elemStore:t,scrollXStore:l,scrollYStore:r}=e,o=(0,_util.getRefElem)(t["main-header-scroll"]),a=(0,_util.getRefElem)(t["main-body-scroll"]),i=(0,_util.getRefElem)(t["main-footer-scroll"]),n=(0,_util.getRefElem)(t["left-body-scroll"]),t=(0,_util.getRefElem)(t["right-body-scroll"]),d=this.$refs.refScrollXHandleElem,s=this.$refs.refScrollYHandleElem;return e.intoRunScroll=!0,(0,_dom.setScrollLeft)(d,0),(0,_dom.setScrollLeft)(a,0),(0,_dom.setScrollLeft)(o,0),(0,_dom.setScrollLeft)(i,0),(0,_dom.setScrollTop)(s,0),(0,_dom.setScrollTop)(a,0),(0,_dom.setScrollTop)(n,0),(0,_dom.setScrollTop)(t,0),l.startIndex=0,l.visibleStartIndex=0,l.endIndex=l.visibleSize,l.visibleEndIndex=l.visibleSize,r.startIndex=0,r.visibleStartIndex=0,r.endIndex=r.visibleSize,r.visibleEndIndex=r.visibleSize,this.$nextTick().then(()=>{e.intoRunScroll=!1})},updateFooter(){var e=this,t=this.$xeGrid,{showFooter:l,footerData:r,footerMethod:o}=this,{visibleColumn:a,afterFullData:i}=this;let n=[];return l&&r&&r.length?n=r.slice(0):l&&o&&(n=a.length?o({columns:a,data:i,$table:this,$grid:t}):[]),e.footerTableData=n,this.handleUpdateFooterMerge(),this.$nextTick()},updateStatus(t,l){let r=this,o=r;return this.$nextTick().then(()=>{var e=o.editRules;if(t&&e)return r.handleCellRuleUpdateStatus("change",t,l)})},setMergeCells(e){let t=this;return t.spanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-cells","span-method"]),handleBodyMerge(t,e),t.handleUpdateBodyMerge(),t.$nextTick().then(()=>(t.updateCellAreas(),updateStyle(t)))},removeMergeCells(e){let t=this;t.spanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-cells","span-method"]);let l=removeBodyMerges(t,e);return t.handleUpdateBodyMerge(),t.$nextTick().then(()=>(t.updateCellAreas(),updateStyle(t),l))},getMergeCells(){return this.mergeBodyList.slice(0)},clearMergeCells(){let e=this;var t=e,l=e;return l.mergeBodyList=[],l.mergeBodyMaps={},l.mergeBodyCellMaps={},t.mergeBodyFlag++,e.$nextTick().then(()=>updateStyle(e))},setMergeFooterItems(e){let t=this;return t.footerSpanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]),handleFooterMerge(t,e),t.handleUpdateFooterMerge(),t.$nextTick().then(()=>(t.updateCellAreas(),updateStyle(t)))},removeMergeFooterItems(e){let t=this;t.footerSpanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]);let l=removeFooterMerges(t,e);return t.handleUpdateFooterMerge(),t.$nextTick().then(()=>(t.updateCellAreas(),updateStyle(t),l))},getMergeFooterItems(){return this.mergeFooterList.slice(0)},clearMergeFooterItems(){let e=this;var t=e,l=e;return l.mergeFooterList=[],l.mergeFooterMaps={},l.mergeFooterCellMaps={},t.mergeFootFlag++,e.$nextTick().then(()=>updateStyle(e))},updateZindex(){this.zIndex?this.tZindex=this.zIndex:this.tZindex<(0,_utils.getLastZIndex)()&&(this.tZindex=(0,_utils.nextZIndex)())},updateCellAreas(){var e=this.mouseConfig,t=this.computeMouseOpts;return e&&t.area&&this.handleRecalculateCellAreaEvent?this.handleRecalculateCellAreaEvent():this.$nextTick()},dispatchEvent(e,t,l){var r=this.$xeGrid;this.$emit(e,createEvent(l,{$table:this,$grid:r},t))},emitEvent(e,t,l){var r=this.$xeGrid;this.$emit(e,Object.assign({$table:this,$grid:r,$event:l},t))},focus(){return this.isActivated=!0,this.$nextTick()},blur(){return this.isActivated=!1,this.$nextTick()},connect(e){return e&&e.syncUpdate?(e.syncUpdate({collectColumn:this.collectColumn,$table:this}),this.$toolbar=e):(0,_log.errLog)("vxe.error.barUnableLink"),this.$nextTick()},getCell(e,t){return this.getCellElement(e,t)},findRowIndexOf(e,t){return t?_xeUtils.default.findIndexOf(e,e=>this.eqRow(e,t)):-1},eqRow(e,t){return!(!e||!t||e!==t&&(0,_util.getRowid)(this,e)!==(0,_util.getRowid)(this,t))},getSetupOptions(){return getConfig()}},funcs="setFilter,openFilter,clearFilter,saveFilterPanel,saveFilterPanelByEvent,resetFilterPanel,resetFilterPanelByEvent,getCheckedFilters,updateFilterOptionStatus,closeMenu,setActiveCellArea,getActiveCellArea,getCellAreas,clearCellAreas,copyCellArea,cutCellArea,pasteCellArea,getCopyCellArea,getCopyCellAreas,clearCopyCellArea,setCellAreas,openFNR,openFind,openReplace,closeFNR,getSelectedCell,clearSelected,insert,insertAt,insertNextAt,insertChild,insertChildAt,insertChildNextAt,remove,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearEdit,clearActived,getEditRecord,getActiveRecord,isEditByRow,isActiveByRow,setEditRow,setActiveRow,setEditCell,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,fullValidateField,validateField,openExport,closeExport,openPrint,closePrint,getPrintHtml,exportData,openImport,closeImport,importData,saveFile,readFile,importByFile,print,openCustom,closeCustom,saveCustom,cancelCustom,resetCustom,toggleCustomAllCheckbox,setCustomAllCheckbox".split(",");funcs.forEach(t=>{Methods[t]=function(...e){return this["_"+t]||("openExport,openPrint,exportData,openImport,importData,saveFile,readFile,importByFile,print".split(",").includes(t)?(0,_log.errLog)("vxe.error.reqModule",["Export"]):"fullValidate,validate".split(",").includes(t)?(0,_log.errLog)("vxe.error.reqModule",["Validator"]):"setFilter,openFilter,clearFilter,getCheckedFilters".split(",").includes(t)?(0,_log.errLog)("vxe.error.reqModule",["Filter"]):"insert,insertAt,insertNextAt,remove,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,getEditRecord,getActiveRecord,isEditByRow,isActiveByRow,setEditRow,setActiveRow,setEditCell,setActiveCell".split(",").includes(t)?(0,_log.errLog)("vxe.error.reqModule",["Edit"]):"openCustom".split(",").includes(t)&&(0,_log.errLog)("vxe.error.reqModule",["Custom"])),this["_"+t]?this["_"+t](...e):null}});var _default=exports.default=Methods;