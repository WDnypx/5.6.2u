Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_vn=require("../../ui/src/vn"),_log=require("../../ui/src/log");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let{getConfig,getIcon,getI18n,renderer,commands,createEvent,globalMixins,renderEmptyElement}=_ui.VxeUI;var _default=exports.default=(0,_comp.defineVxeComponent)({name:"VxeToolbar",mixins:[globalMixins.sizeMixin],props:{loading:Boolean,refresh:[Boolean,Object],import:[Boolean,Object],export:[Boolean,Object],print:[Boolean,Object],zoom:[Boolean,Object],custom:[Boolean,Object],buttons:{type:Array,default:()=>getConfig().toolbar.buttons},tools:{type:Array,default:()=>getConfig().toolbar.tools},perfect:{type:Boolean,default:()=>getConfig().toolbar.perfect},size:{type:String,default:()=>getConfig().toolbar.size||getConfig().size},className:[String,Function]},inject:{$xeGrid:{default:null}},data(){return{xID:_xeUtils.default.uniqueId(),reactData:{isRefresh:!1,connectFlag:0,columns:[]},internalData:{connectTable:null}}},computed:Object.assign(Object.assign({},{}),{computeRefreshOpts(){return Object.assign({},_xeUtils.default.clone(getConfig().toolbar.refresh,!0),this.refresh)},computeImportOpts(){return Object.assign({},_xeUtils.default.clone(getConfig().toolbar.import,!0),this.import)},computeExportOpts(){return Object.assign({},_xeUtils.default.clone(getConfig().toolbar.export,!0),this.export)},computePrintOpts(){return Object.assign({},_xeUtils.default.clone(getConfig().toolbar.print,!0),this.print)},computeZoomOpts(){return Object.assign({},_xeUtils.default.clone(getConfig().toolbar.zoom,!0),this.zoom)},computeCustomOpts(){return Object.assign({},_xeUtils.default.clone(getConfig().toolbar.custom,!0),this.custom)},computeTableCustomOpts(){var e=this.reactData,t=this.internalData.connectTable;return(e.connectFlag||t)&&t?t.computeCustomOpts:{trigger:""}},computeTrigger(){return this.computeTableCustomOpts.trigger}}),methods:{dispatchEvent(e,t,o){this.$emit(e,createEvent(o,{$toolbar:this},t))},fintTable(){var e=this.$parent.$children;let o=e.indexOf(this);return _xeUtils.default.find(e,(e,t)=>e&&e.loadData&&t>o&&"vxe-table"===e.$vnode.componentOptions.tag)},syncUpdate(e){var t=this.reactData;this.internalData.connectTable=e.$table,t.columns=e.collectColumn,t.connectFlag++},checkTable(){var e=this.internalData.connectTable;if(e)return!0;(0,_log.errLog)("vxe.error.barUnableLink")},handleClickSettingEvent({$event:e}){var t=this.internalData.connectTable;t&&t.triggerCustomEvent&&t.triggerCustomEvent(e)},handleMouseenterSettingEvent({$event:e}){var t=this.internalData.connectTable;t&&t.customOpenEvent(e)},handleMouseleaveSettingEvent({$event:t}){var e=this.internalData.connectTable;let o=e;if(o){let e=o.reactData.customStore;e.activeBtn=!1,setTimeout(()=>{e.activeBtn||e.activeWrapper||o.customCloseEvent(t)},350)}},refreshEvent({$event:e}){let t=this.reactData;var o=this.$xeGrid,r=t.isRefresh,n=this.computeRefreshOpts;if(!r){r=n.queryMethod||n.query;if(r){t.isRefresh=!0;try{Promise.resolve(r({})).catch(e=>e).then(()=>{t.isRefresh=!1})}catch(e){t.isRefresh=!1}}else o&&(t.isRefresh=!0,o.triggerToolbarCommitEvent({code:n.code||"reload"},e).catch(e=>e).then(()=>{t.isRefresh=!1}))}},zoomEvent({$event:e}){var t=this.$xeGrid;t&&t.triggerZoomEvent(e)},btnEvent(e,t){var o=this.internalData,r=this.$xeGrid,o=o.connectTable,n=t.code;n&&(r?r.triggerToolbarBtnEvent(t,e):(t={code:n,button:t,$table:o,$grid:r,$event:e},(o=commands.get(n))&&((r=o.tableCommandMethod||o.commandMethod)?r(t):(0,_log.errLog)("vxe.error.notCommands",[n])),this.dispatchEvent("button-click",t,e)))},tolEvent(e,t){var o=this.internalData,r=this.$xeGrid,o=o.connectTable,n=t.code;n&&(r?r.triggerToolbarTolEvent(t,e):(t={code:n,button:null,tool:t,$table:o,$grid:r,$event:e},(o=commands.get(n))&&((r=o.tableCommandMethod||o.commandMethod)?r(t):(0,_log.errLog)("vxe.error.notCommands",[n])),this.dispatchEvent("tool-click",t,e)))},importEvent(){var e=this.internalData;this.checkTable()&&(e=e.connectTable,e)&&e.openImport()},exportEvent(){var e=this.internalData;this.checkTable()&&(e=e.connectTable,e)&&e.openExport()},printEvent(){var e=this.internalData;this.checkTable()&&(e=e.connectTable,e)&&e.openPrint()},renderDropdowns(o,e,r){let n=_ui.VxeUI.getComponent("VxeButton"),i=this;e=e.dropdowns;return e?e.map((t,e)=>!1!==t.visible&&n?o(n,{key:e,props:{disabled:t.disabled,loading:t.loading,type:t.type,mode:t.mode,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,title:t.title,routerLink:t.routerLink,permissionCode:t.permissionCode,prefixTooltip:t.prefixTooltip,suffixTooltip:t.suffixTooltip},on:{click:({$event:e})=>r?i.btnEvent(e,t):i.tolEvent(e,t)}}):renderEmptyElement(i)):[]},renderLeftBtns(l){let s=_ui.VxeUI.getComponent("VxeButton");var e=this,t=e.$scopedSlots;let a=e.$xeGrid;var o=e.buttons,r=e.internalData.connectTable;let c=r;r=t.buttonPrefix||t["button-prefix"],t=t.buttonSuffix||t["button-suffix"];let p=[];return r&&p.push(...(0,_vn.getSlotVNs)(r.call(e,{buttons:o||[],$grid:a,$table:c}))),o&&o.forEach(t=>{var e,o,r,{dropdowns:n,buttonRender:i}=t;!1!==t.visible&&(e=i?renderer.get(i.name):null,i&&e&&e.renderToolbarButton?(o=e.toolbarButtonClassName,r={$grid:a,$table:c,button:t},p.push(l("span",{class:["vxe-button--item",o?_xeUtils.default.isFunction(o)?o(r):o:""]},(0,_vn.getSlotVNs)(e.renderToolbarButton(l,i,r))))):s&&p.push(l(s,{props:{disabled:t.disabled,loading:t.loading,type:t.type,mode:t.mode,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,title:t.title,routerLink:t.routerLink,permissionCode:t.permissionCode,prefixTooltip:t.prefixTooltip,suffixTooltip:t.suffixTooltip,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer},on:{click:({$event:e})=>this.btnEvent(e,t)},scopedSlots:n&&n.length?{dropdowns:()=>this.renderDropdowns(l,t,!0)}:{}})))}),t&&p.push(...(0,_vn.getSlotVNs)(t.call(e,{buttons:o||[],$grid:a,$table:c}))),p},renderRightTools(a){let c=_ui.VxeUI.getComponent("VxeButton"),p=this;var e=p,t=p.$scopedSlots,o=p.internalData;let u=p.$xeGrid;e=e.tools,o=o.connectTable;let d=o;o=t.toolPrefix||t["tool-prefix"],t=t.toolSuffix||t["tool-suffix"];let m=[];return o&&m.push(...(0,_vn.getSlotVNs)(o.call(p,{tools:e||[],$grid:u,$table:d}))),e&&e.forEach((t,e)=>{var o,r,n,i,{dropdowns:l,toolRender:s}=t;!1!==t.visible&&(o=s?s.name:null,r=s?renderer.get(o):null,s&&r&&r.renderToolbarTool?(n=r.toolbarToolClassName,i={$grid:u,$table:d,tool:t},m.push(a("span",{key:o,class:["vxe-tool--item",n?_xeUtils.default.isFunction(n)?n(i):n:""]},(0,_vn.getSlotVNs)(r.renderToolbarTool(a,s,i))))):c&&m.push(a(c,{key:e,props:{disabled:t.disabled,loading:t.loading,type:t.type,mode:t.mode,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,title:t.title,routerLink:t.routerLink,permissionCode:t.permissionCode,prefixTooltip:t.prefixTooltip,suffixTooltip:t.suffixTooltip,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer},on:{click:({$event:e})=>p.tolEvent(e,t)},scopedSlots:l&&l.length?{dropdowns:()=>p.renderDropdowns(a,t,!1)}:{}})))}),t&&m.push(...(0,_vn.getSlotVNs)(t.call(p,{tools:e||[],$grid:u,$table:d}))),m},renderToolImport(e){var t=_ui.VxeUI.getComponent("VxeButton"),o=this.computeImportOpts;return t?e(t,{key:"import",props:{circle:!0,icon:o.icon||getIcon().TOOLBAR_TOOLS_IMPORT,title:getI18n("vxe.toolbar.import")},on:{click:this.importEvent}}):renderEmptyElement(this)},renderToolExport(e){var t=_ui.VxeUI.getComponent("VxeButton"),o=this.computeExportOpts;return t?e(t,{key:"export",props:{circle:!0,icon:o.icon||getIcon().TOOLBAR_TOOLS_EXPORT,title:getI18n("vxe.toolbar.export")},on:{click:this.exportEvent}}):renderEmptyElement(this)},renderToolPrint(e){var t=_ui.VxeUI.getComponent("VxeButton"),o=this.computePrintOpts;return t?e(t,{key:"print",props:{circle:!0,icon:o.icon||getIcon().TOOLBAR_TOOLS_PRINT,title:getI18n("vxe.toolbar.print")},on:{click:this.printEvent}}):renderEmptyElement(this)},renderToolRefresh(e){var t=_ui.VxeUI.getComponent("VxeButton"),o=this.reactData,r=this.computeRefreshOpts;return t?e(t,{key:"refresh",props:{circle:!0,icon:o.isRefresh?r.iconLoading||getIcon().TOOLBAR_TOOLS_REFRESH_LOADING:r.icon||getIcon().TOOLBAR_TOOLS_REFRESH,title:getI18n("vxe.toolbar.refresh")},on:{click:this.refreshEvent}}):renderEmptyElement(this)},renderToolZoom(e){var t=_ui.VxeUI.getComponent("VxeButton"),o=this.$xeGrid,r=this.computeZoomOpts;return o&&t?e(t,{key:"zoom",props:{circle:!0,icon:o.isMaximized()?r.iconOut||getIcon().TOOLBAR_TOOLS_MINIMIZE:r.iconIn||getIcon().TOOLBAR_TOOLS_FULLSCREEN,title:getI18n("vxe.toolbar.zoom"+(o.isMaximized()?"Out":"In"))},on:{click:this.zoomEvent}}):renderEmptyElement(this)},renderToolCustom(e){var t=_ui.VxeUI.getComponent("VxeButton"),o=this,r=o.computeCustomOpts,n=o.computeTrigger,i={};return"manual"!==n&&("hover"===n?(i.mouseenter=o.handleMouseenterSettingEvent,i.mouseleave=o.handleMouseleaveSettingEvent):i.click=o.handleClickSettingEvent),t?e(t,{key:"custom",props:{circle:!0,icon:r.icon||getIcon().TOOLBAR_TOOLS_CUSTOM,title:getI18n("vxe.toolbar.custom"),className:"vxe-toolbar-custom-target"},on:i}):renderEmptyElement(o)},renderVN(e){var t=this,o=t,r=t.$scopedSlots,n=t.$xeGrid,{perfect:i,loading:l,refresh:s,zoom:a,custom:c,className:p}=o,u=t.internalData.connectTable,d=r.tools,r=r.buttons,m=t.computeSize;return e("div",{ref:"refElem",class:["vxe-toolbar",p?_xeUtils.default.isFunction(p)?p({$toolbar:t}):p:"",{["size--"+m]:m,"is--perfect":i,"is--loading":l}]},[e("div",{class:"vxe-buttons--wrapper"},r?r({$grid:n,$table:u}):t.renderLeftBtns(e)),e("div",{class:"vxe-tools--wrapper"},d?d({$grid:n,$table:u}):t.renderRightTools(e)),e("div",{class:"vxe-tools--operate"},[o.import?t.renderToolImport(e):renderEmptyElement(t),o.export?t.renderToolExport(e):renderEmptyElement(t),o.print?t.renderToolPrint(e):renderEmptyElement(t),s?t.renderToolRefresh(e):renderEmptyElement(t),a&&n?t.renderToolZoom(e):renderEmptyElement(t),c?t.renderToolCustom(e):renderEmptyElement(t)])])}},created(){let r=this,n=r,i=r.$xeGrid;r.$nextTick(()=>{var e=n.refresh,t=r.computeRefreshOpts,o=this.fintTable(),t=t.queryMethod||t.query,e=(!e||i||t||(0,_log.warnLog)("vxe.error.notFunc",["queryMethod"]),o&&o.connect(this),r.computeCustomOpts);e.isFooter&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.isFooter","table.custom-config.showFooter"]),e.showFooter&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.showFooter","table.custom-config.showFooter"]),e.immediate&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.immediate","table.custom-config.immediate"]),e.trigger&&(0,_log.warnLog)("vxe.error.delProp",["toolbar.custom.trigger","table.custom-config.trigger"])});var e=_ui.VxeUI.getComponent("VxeButton");(n.refresh||n.import||n.export||n.print||n.zoom)&&!e&&(0,_log.errLog)("vxe.error.reqComp",["vxe-button"])},render(e){return this.renderVN(e)}});