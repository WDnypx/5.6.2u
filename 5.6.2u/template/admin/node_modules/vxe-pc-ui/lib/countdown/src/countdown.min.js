Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_vn=require("../../ui/src/vn"),_text=_interopRequireDefault(require("../../text/src/text"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxeCountdown",mixins:[_ui.globalMixins.sizeMixin],props:{value:[Number,String],format:String,prefixConfig:Object,suffixConfig:Object,size:{type:String,default:function(){return(0,_ui.getConfig)().countdown.size||(0,_ui.getConfig)().size}}},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{currNum:0,secondNum:0},internalData:{dnTimeout:void 0}}},computed:Object.assign(Object.assign({},{}),{computeTimeFormats:function(){var t=this.reactData.secondNum;return 316224e5<=t?["yyyy","MM","dd","HH","mm","ss"]:26784e5<=t?["MM","dd","HH","mm","ss"]:864e5<=t?["dd","HH","mm","ss"]:36e5<=t?["HH","mm","ss"]:6e4<=t?["mm","ss"]:["ss"]},computeDiffConf:function(){var t=this.reactData.currNum;return _xeUtils.default.getDateDiff(Date.now(),Date.now()+t)},computeFormatLabel:function(){var t=this.format,e=this.computeDiffConf,n="";return t&&(n="".concat(t),_xeUtils.default.each(e,function(t,e){n=n.replace(new RegExp(e,"g"),_xeUtils.default.padStart(t,e.length,"0"))})),n},computePrefixOpts:function(){return Object.assign({},this.prefixConfig,(0,_ui.getConfig)().countdown.prefixConfig)},computeSuffixOpts:function(){return Object.assign({},this.suffixConfig,(0,_ui.getConfig)().countdown.suffixConfig)}}),methods:{dispatchEvent:function(t,e,n){this.$emit(t,(0,_ui.createEvent)(n,{$carousel:this},e))},updateCount:function(){var t=this.reactData,e=_xeUtils.default.toNumber(this.value||0);t.secondNum=e,t.currNum=e},handleTime:function(){var t=this,e=t.reactData,n=t.internalData;1e3<e.currNum?(e.currNum-=1e3,n.dnTimeout=setTimeout(function(){t.handleTime()},1e3)):(e.currNum=0,t.handleStop())},handleStart:function(){this.dispatchEvent("start",{},null),this.handleTime()},handleStop:function(){var t=this.internalData,e=t.dnTimeout;e&&(clearTimeout(e),t.dnTimeout=void 0,this.dispatchEvent("end",{},null))},renderDefaultContentVNs:function(n){var t=this.format,e=this.computeTimeFormats,i=this.computeDiffConf,o=this.computeFormatLabel;return t?[n("div",{key:"format",class:"vxe-countdown--content-format"},o)]:e.map(function(t,e){return n("div",{key:e,class:"vxe-countdown--content-item"},[n("div",{class:"vxe-countdown--content-num"},"".concat(i[t]||0)),n("div",{class:"vxe-countdown--content-unit"},(0,_ui.getI18n)("vxe.countdown.formats.".concat(t)))])})},renderVN:function(t){var e=this,n=e.$scopedSlots,i=e.prefixConfig,o=e.suffixConfig,r=e.reactData.currNum,u=e.computeSize,a=e.computeDiffConf,s=e.computePrefixOpts,f=e.computeSuffixOpts,c=n.prefix,d=n.suffix,n=n.default;return t("div",{ref:"refElem",class:["vxe-countdown",a.done?"is--progress":"is-end",_defineProperty({},"size--".concat(u),u)]},[c||i?t("div",{class:"vxe-countdown--prefix"},c?(0,_vn.getSlotVNs)(c({currentValue:r,diffConf:a})):[t(_text.default,{props:{content:s.content,icon:s.icon,status:s.status}})]):(0,_ui.renderEmptyElement)(e),t("div",{class:"vxe-countdown--content"},n?(0,_vn.getSlotVNs)(n({currentValue:r,diffConf:a})):e.renderDefaultContentVNs(t)),d||o?t("div",{class:"vxe-countdown--suffix"},d?(0,_vn.getSlotVNs)(d({currentValue:r,diffConf:a})):[t(_text.default,{props:{content:f.content,icon:f.icon,status:f.status}})]):(0,_ui.renderEmptyElement)(e)])}},watch:{value:function(){this.updateCount(),this.handleStop(),this.handleStart()}},created:function(){this.updateCount()},mounted:function(){this.handleStart()},beforeDestroy:function(){this.handleStop()},render:function(t){return this.renderVN(t)}});