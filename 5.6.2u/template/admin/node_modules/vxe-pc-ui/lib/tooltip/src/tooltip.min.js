Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_utils=require("../../ui/src/utils"),_dom=require("../../ui/src/dom"),_vn=require("../../ui/src/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxeTooltip",mixins:[_ui.globalMixins.sizeMixin],props:{value:Boolean,size:{type:String,default:function(){return(0,_ui.getConfig)().tooltip.size||(0,_ui.getConfig)().size}},selector:String,trigger:{type:String,default:function(){return(0,_ui.getConfig)().tooltip.trigger||"hover"}},theme:{type:String,default:function(){return(0,_ui.getConfig)().tooltip.theme||"dark"}},content:{type:[String,Number],default:null},useHTML:Boolean,zIndex:[String,Number],popupClassName:[String,Function],isArrow:{type:Boolean,default:function(){return(0,_ui.getConfig)().tooltip.isArrow}},enterable:{type:Boolean,default:function(){return(0,_ui.getConfig)().tooltip.enterable}},enterDelay:{type:Number,default:function(){return(0,_ui.getConfig)().tooltip.enterDelay}},leaveDelay:{type:Number,default:function(){return(0,_ui.getConfig)().tooltip.leaveDelay}}},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{target:null,isUpdate:!1,visible:!1,tipContent:"",tipActive:!1,tipTarget:null,tipZindex:0,tipStore:{style:{},placement:"",arrowStyle:{}}},internalData:{}}},computed:Object.assign({},{}),methods:{dispatchEvent:function(e,t,r){this.$emit(e,(0,_ui.createEvent)(r,{$tooltip:this},t))},emitModel:function(e){var t=this,r=t._events;t.$emit("input",e),r&&r.modelValue?t.$emit("modelValue",e):t.$emit("model-value",e)},getSelectorEl:function(){var e=this.selector;if(e){if(_xeUtils.default.isElement(e))return e;if(_xeUtils.default.isString(e))return document.querySelector(e)}return null},open:function(e,t){var r=this,i=r.reactData;return r.handleVisible(e||i.target||r.getSelectorEl(),t)},close:function(){var e=this,t=e.reactData;return t.tipTarget=null,t.tipActive=!1,Object.assign(t.tipStore,{style:{},placement:"",arrowStyle:null}),e.updateValue(!1),e.$nextTick()},toVisible:function(e,t){return this.handleVisible(e,t)},updatePlacement:function(){var r=this,i=r.reactData;return r.$nextTick().then(function(){var e=i.tipTarget,t=r.$refs.refElem;if(e&&t)return r.updateTipStyle(),r.$nextTick().then(function(){r.updateTipStyle()})})},isActived:function(){return this.reactData.tipActive},setActived:function(e){this.reactData.tipActive=!!e},updateTipStyle:function(){var e,t,r,i,n,o,a,l,u,c=this.reactData,s=c.tipTarget,c=c.tipStore;s&&(e=(r=(0,_dom.getDomNode)()).scrollTop,t=r.scrollLeft,r=r.visibleWidth,i=(n=(0,_dom.getAbsolutePos)(s)).top,o=(a=this.$refs.refElem).offsetHeight,a=a.offsetWidth,u=n=n.left,l=i-o-6,t+r<(u=Math.max(6,n+Math.floor((s.offsetWidth-a)/2)))+a+6&&(u=t+r-a-6),i-o<e+6&&(c.placement="bottom",l=i+s.offsetHeight+6),c.style.top="".concat(l,"px"),c.style.left="".concat(u,"px"),c.arrowStyle.left="".concat(n-u+s.offsetWidth/2,"px"))},updateValue:function(e){var t=this.reactData;e!==t.visible&&(t.visible=e,t.isUpdate=!0,this.emitModel(e))},updateZindex:function(){var e=this.reactData;e.tipZindex<(0,_utils.getLastZIndex)()&&(e.tipZindex=(0,_utils.nextZIndex)())},clickEvent:function(){var e=this,t=e,r=e.reactData;r.visible?e.close():e.handleVisible(r.target||e.getSelectorEl(),t.content)},targetMouseenterEvent:function(){var e=this.reactData;this.handleVisible(e.target||this.getSelectorEl(),this.content)},targetMouseleaveEvent:function(){var e=this,t=e.reactData,r=e.trigger,i=e.enterable,n=e.leaveDelay;t.tipActive=!1,i&&"hover"===r?setTimeout(function(){t.tipActive||e.close()},n):e.close()},wrapperMouseenterEvent:function(){this.reactData.tipActive=!0},wrapperMouseleaveEvent:function(){var e=this,t=e.reactData,r=e.trigger,i=e.enterable,n=e.leaveDelay;t.tipActive=!1,i&&"hover"===r&&setTimeout(function(){t.tipActive||e.close()},n)},showTip:function(){var e=this,t=e,r=e.reactData,i=r.tipStore,n=e.$refs.refElem;return n&&!n.parentNode&&document.body.appendChild(n),e.updateValue(!0),e.updateZindex(),i.placement="top",i.style={width:"auto",left:0,top:0,zIndex:t.zIndex||r.tipZindex},i.arrowStyle={left:"50%"},e.updatePlacement()},handleDelayFn:function(){var e=this,t=e.reactData;e.internalData.showDelayTip=_xeUtils.default.debounce(function(){t.tipActive&&e.showTip()},e.enterDelay,{leading:!1,trailing:!0})},handleVisible:function(e,t){var r=this,i=r,n=r.$scopedSlots,o=r.reactData,a=r.internalData,n=n.content;if((n||""!==t&&!_xeUtils.default.eqNull(t))&&e){n=a.showDelayTip,a=i.trigger,i=i.enterDelay;if(o.tipActive=!0,o.tipTarget=e,o.tipContent=t,!i||"hover"!==a)return r.showTip();n&&n()}return r.$nextTick()},renderContent:function(e){var t=this.$scopedSlots,r=this.reactData,i=this.useHTML,r=r.tipContent,t=t.content;return t?e("div",{key:1,class:"vxe-tooltip--content"},(0,_vn.getSlotVNs)(t({}))):i?e("div",{key:2,class:"vxe-tooltip--content",domProps:{innerHTML:r}}):e("div",{key:3,class:"vxe-tooltip--content"},"".concat(r))},renderVN:function(e){var t,r=this,i=r.$scopedSlots,n=r.reactData,o=r.popupClassName,a=r.isArrow,l=r.enterable,u=n.tipActive,c=n.visible,n=n.tipStore,i=i.default,s=r.computeSize;return l&&(t={mouseenter:r.wrapperMouseenterEvent,mouseleave:r.wrapperMouseleaveEvent}),e("div",{ref:"refElem",class:["vxe-tooltip--wrapper","theme--".concat(r.theme),o?_xeUtils.default.isFunction(o)?o({$tooltip:r}):o:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(s),s),"placement--".concat(n.placement),n.placement),"is--enterable",l),"is--visible",c),"is--arrow",a),"is--active",u)],style:n.style,on:t},[r.renderContent(e),e("div",{class:"vxe-tooltip--arrow",style:n.arrowStyle})].concat(_toConsumableArray(i?(0,_vn.getSlotVNs)(i({})):[])))}},watch:{content:function(e){this.reactData.tipContent=e},value:function(e){var t=this,r=t,i=t.reactData;i.isUpdate||(e?t.handleVisible(i.target||t.getSelectorEl(),r.content):t.close()),i.isUpdate=!1},enterDelay:function(){this.handleDelayFn()}},created:function(){this.handleDelayFn()},mounted:function(){var o=this,a=o,l=o.reactData;o.$nextTick(function(){var r,e,t=a.trigger,i=a.content,n=o.$refs.refElem;n&&(r=n.parentNode)&&(l.tipContent=i,l.tipZindex=(0,_utils.nextZIndex)(),_xeUtils.default.arrayEach(n.children,function(e,t){1<t&&(r.insertBefore(e,n),l.target||(l.target=e))}),r.removeChild(n),(e=l.target)&&("hover"===t?(e.onmouseenter=o.targetMouseenterEvent,e.onmouseleave=o.targetMouseleaveEvent):"click"===t&&(e.onclick=o.clickEvent)),a.value)&&o.handleVisible(e||o.getSelectorEl(),i)})},beforeDestroy:function(){var e=this.reactData.target,t=this.$refs.refElem;e&&(e.onmouseenter=null,e.onmouseleave=null,e.onclick=null),t&&(e=t.parentNode)&&e.removeChild(t)},render:function(e){return this.renderVN(e)}});