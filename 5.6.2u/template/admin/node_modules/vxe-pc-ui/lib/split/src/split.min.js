Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_vn=require("../../ui/src/vn"),_dom=require("../../ui/src/dom"),_utils=require("../../ui/src/utils"),_log=require("../../ui/src/log");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxeSplit",mixins:[_ui.globalMixins.sizeMixin],props:{width:[Number,String],height:[Number,String],vertical:{type:Boolean,default:function(){return(0,_ui.getConfig)().split.vertical}},border:{type:Boolean,default:function(){return(0,_ui.getConfig)().split.border}},padding:{type:Boolean,default:function(){return(0,_ui.getConfig)().split.padding}},resize:{type:Boolean,default:function(){return(0,_ui.getConfig)().split.resize}},items:Array,itemConfig:Object,barConfig:Object,actionConfig:Object},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{staticItems:[],itemList:[]},internalData:{},reFlag:0}},provide:function(){return{$xeSplit:this}},computed:Object.assign(Object.assign({},{}),{computeItemOpts:function(){return Object.assign({},(0,_ui.getConfig)().split.itemConfig,this.itemConfig)},computeBarOpts:function(){return Object.assign({},(0,_ui.getConfig)().split.barConfig,this.barConfig)},computeActionOpts:function(){return Object.assign({},(0,_ui.getConfig)().split.actionConfig,this.actionConfig)},computeIsFoldNext:function(){return"next"===this.computeActionOpts.direction},computeVisibleItems:function(){return this.reactData.itemList.filter(function(e){return e.isVisible})},computeAutoItems:function(){var e=this.reactData,t=this.vertical;return e.itemList.filter(function(e){return t?!e.height:!e.width})},computeBarStyle:function(){var e=this.computeBarOpts,t=e.width,e=e.height,i={};return e&&(i.height=(0,_dom.toCssUnit)(e)),t&&(i.width=(0,_dom.toCssUnit)(t)),i},computeSItemSize:function(){return this.reactData.staticItems.length}}),watch:{items:function(e){this.loadItem(e||[])},computeSItemSize:function(){var e=this,t=e.reactData;e.items&&e.items.length&&(0,_log.errLog)("vxe.error.errConflicts",["<vxe-split-pane ...>","items"]),t.itemList=t.staticItems,e.recalculate()}},methods:{dispatchEvent:function(e,t,i){this.$emit(e,(0,_ui.createEvent)(i,{$split:this},t))},callSlot:function(e,t){var i=this.$scopedSlots;return e&&(_xeUtils.default.isString(e)&&(e=i[e]||null),_xeUtils.default.isFunction(e))?(0,_vn.getSlotVNs)(e(t)):[]},reset:function(){return this.reactData.itemList.forEach(function(e){e.isExpand=!0,e.isVisible=!0,e.foldHeight=0,e.foldWidth=0,e.resizeHeight=0,e.resizeWidth=0}),this.$nextTick()},handleLoadItem:function(e,t){var i=this.$scopedSlots,n=this.reactData,r=n.staticItems,s={isVisible:!0,isExpand:!0,renderWidth:0,resizeWidth:0,foldWidth:0,renderHeight:0,resizeHeight:0,foldHeight:0};return n.itemList=e.map(function(e){return e.slots&&_xeUtils.default.each(e.slots,function(e){_xeUtils.default.isFunction(e)||i[e]||(0,_log.errLog)("vxe.error.notSlot",[e])}),Object.assign({},t?null:s,e,t?s:null,{id:_xeUtils.default.uniqueId()})}),r.length&&(0,_log.errLog)("vxe.error.errConflicts",["<vxe-split-pane ...>","items"]),this.recalculate()},loadItem:function(e){return this.handleLoadItem(e||[],!1)},reloadItem:function(e){return this.handleLoadItem(e||[],!0)},recalculate:function(){var h=this,m=h,f=h.reactData;return h.$nextTick().then(function(){var n,r,t,i,s,a,l,o,d,e=m.vertical,u=f.itemList,c=h.$refs.refElem;c&&(n=c.clientWidth,r=c.clientHeight,n)&&r&&(c=h.computeItemOpts,t=_xeUtils.default.toNumber(c.minWidth),i=_xeUtils.default.toNumber(c.minHeight),s=[],e?(a=0,u.forEach(function(e){var t=e.height,i=0;t?(i=(0,_dom.isScale)(t)?r*_xeUtils.default.toNumber(t):_xeUtils.default.toNumber(t),e.renderHeight=i):s.push(e),a+=i}),s.length&&(l=(r-a)/s.length,s.forEach(function(e){e.renderHeight=Math.max(_xeUtils.default.toNumber((0,_utils.getGlobalDefaultConfig)(e.minHeight,i)),l)}))):(o=0,u.forEach(function(e){var t=e.width,i=0;t?(i=(0,_dom.isScale)(t)?n*_xeUtils.default.toNumber(t):_xeUtils.default.toNumber(t),e.renderWidth=i):s.push(e),o+=i}),s.length&&(d=(n-o)/s.length,s.forEach(function(e){e.renderWidth=Math.max(_xeUtils.default.toNumber((0,_utils.getGlobalDefaultConfig)(e.minWidth,t)),d)}))))})},dragEvent:function(e){var t,i,n,r,s,a,l,o,d,u,c,h,m,f,g,p,v,x=this,_=x.reactData,b=x.resize,E=x.vertical,_=_.itemList;b&&(e.preventDefault(),b=e.currentTarget.parentElement,t=x.$refs.refElem)&&(i=b.getAttribute("itemid"),b=_xeUtils.default.findIndexOf(_,function(e){return e.id===i}),n=_[b])&&n.isExpand&&(r=x.computeIsFoldNext,a=x.computeItemOpts,s=_xeUtils.default.toNumber(a.minWidth),a=_xeUtils.default.toNumber(a.minHeight),_=(l=_[b+(r?1:-1)])?t.querySelector('.vxe-split-pane[itemid="'.concat(l.id,'"]')):null,b=n?t.querySelector('.vxe-split-pane[itemid="'.concat(n.id,'"]')):null,o=_?_.clientWidth:0,d=b?b.clientWidth:0,u=_?_.clientHeight:0,c=b?b.clientHeight:0,h=_xeUtils.default.toNumber(l?(0,_utils.getGlobalDefaultConfig)(l.minWidth,s):s),m=_xeUtils.default.toNumber((0,_utils.getGlobalDefaultConfig)(n.minWidth,s)),f=_xeUtils.default.toNumber(l?(0,_utils.getGlobalDefaultConfig)(l.minHeight,a):a),g=_xeUtils.default.toNumber((0,_utils.getGlobalDefaultConfig)(n.minHeight,a)),p=e.clientX,v=e.clientY,(0,_dom.addClass)(t,"is--drag"),document.onmousemove=function(e){var t,i;e.preventDefault(),E?0<(t=r?v-e.clientY:e.clientY-v)?l&&g<=c-t&&(i=c-t,l.resizeHeight=u+t,n.resizeHeight=i,x.dispatchEvent("resize-drag",{item:n,name:n.name,offsetHeight:t,resizeHeight:i,offsetWidth:0,resizeWidth:0},e)):l&&f<=u+t&&(i=c-t,l.resizeHeight=u+t,n.resizeHeight=i,x.dispatchEvent("resize-drag",{item:n,name:n.name,offsetHeight:t,resizeHeight:i,offsetWidth:0,resizeWidth:0},e)):0<(t=r?p-e.clientX:e.clientX-p)?l&&m<=d-t&&(i=d-t,l.resizeWidth=o+t,n.resizeWidth=i,x.dispatchEvent("resize-drag",{item:n,name:n.name,offsetHeight:0,resizeHeight:0,offsetWidth:t,resizeWidth:i},e)):l&&h<=o+t&&(i=d-t,l.resizeWidth=o+t,n.resizeWidth=i,x.dispatchEvent("resize-drag",{item:n,name:n.name,offsetHeight:0,resizeHeight:0,offsetWidth:t,resizeWidth:i},e))},document.onmouseup=function(e){document.onmousemove=null,(document.onmouseup=null,_dom.removeClass)(t,"is--drag"),x.dispatchEvent("resize-end",{item:n,name:n.name,resizeHeight:n.resizeHeight,resizeWidth:n.resizeWidth},e),x.recalculate()},x.dispatchEvent("resize-start",{item:n,name:n.name},e))},handleItemActionEvent:function(e){var t,i,n,r,s,a=this,l=a.reactData;a.$refs.refElem&&(t=a.vertical,l=l.itemList,s=a.computeIsFoldNext,i=e.currentTarget.parentElement.getAttribute("itemid"),n=l[r=_xeUtils.default.findIndexOf(l,function(e){return e.id===i})],l=l[r+(s?1:-1)],n)&&(r=n.showAction,s=n.isExpand,r)&&(t?l&&(l.isVisible=!s,l.foldHeight=0,n.isExpand=!s,n.isVisible=!0,n.foldHeight=s?(l.resizeHeight||l.renderHeight)+(n.resizeHeight||n.renderHeight):0):l&&(l.isVisible=!s,l.foldWidth=0,n.isExpand=!s,n.isVisible=!0,n.foldWidth=s?(l.resizeWidth||l.renderWidth)+(n.resizeWidth||n.renderWidth):0),a.dispatchEvent("toggle-expand",{item:n,name:n.name,targetItem:l,targetName:l?l.name:"",expanded:n.isExpand},e),a.recalculate())},handleActionDblclickEvent:function(e){var t=this.reactData.itemList,i=this.computeActionOpts,n=e.currentTarget.parentElement.getAttribute("itemid"),t=t[_xeUtils.default.findIndexOf(t,function(e){return e.id===n})];"dblclick"===i.trigger&&this.handleItemActionEvent(e),this.dispatchEvent("action-dblclick",{item:t,name:t?t.name:""},e)},handleActionClickEvent:function(e){var t=this.reactData.itemList,i=this.computeActionOpts,n=e.currentTarget.parentElement.getAttribute("itemid"),t=t[_xeUtils.default.findIndexOf(t,function(e){return e.id===n})];"dblclick"!==i.trigger&&this.handleItemActionEvent(e),this.dispatchEvent("action-click",{item:t,name:t?t.name:""},e)},handleGlobalResizeEvent:function(){this.recalculate()},getDefaultActionIcon:function(e){var t=this.vertical,i=e.showAction,e=e.isExpand,n=this.computeIsFoldNext,r="SPLIT_TOP_ACTION",s="SPLIT_BOTTOM_ACTION",a="SPLIT_LEFT_ACTION",l="SPLIT_RIGHT_ACTION";if(i){i="";if(i=n?t?e?s:r:e?l:a:t?e?r:s:e?a:l)return(0,_ui.getIcon)()[i]}return""},renderHandleBar:function(e,t){var i=this,n=i.computeBarStyle,r=i.computeActionOpts,s=i.computeIsFoldNext,a=t.id,l=t.isExpand,o=t.showAction,d={};return"dblclick"===r.trigger?d.dblclick=i.handleItemActionEvent:d.click=i.handleItemActionEvent,e("div",{attrs:{itemid:a},class:["vxe-split-pane-handle",s?"to--next":"to--prev"]},[e("div",{class:"vxe-split-pane-handle-bar",style:n,on:{mousedown:i.dragEvent}}),o?e("span",{class:"vxe-split-pane-action-btn",on:d},[e("i",{class:(l?r.openIcon:r.closeIcon)||i.getDefaultActionIcon(t)})]):(0,_ui.renderEmptyElement)(i)])},renderItems:function(u){var c=this,e=c.reactData,h=c.border,m=c.padding,f=c.resize,g=c.vertical,p=e.itemList,v=c.computeVisibleItems,x=c.computeAutoItems,_=c.computeIsFoldNext,b=[];return p.forEach(function(e,t){var i=e.id,n=e.name,r=e.slots,s=e.isVisible,a=e.isExpand,r=r?r.default:null,l={},o=s?e.foldWidth||e.resizeWidth||e.renderWidth:0,d=s?e.foldHeight||e.resizeHeight||e.renderHeight:0;1===x.length&&(g?e.height||(d=0):e.width||(o=0)),g?d&&(l.height=1===v.length?"100%":(0,_dom.toCssUnit)(d)):o&&(l.width=1===v.length?"100%":(0,_dom.toCssUnit)(o)),b.push(u("div",{attrs:{itemid:i},class:["vxe-split-pane",g?"is--vertical":"is--horizontal",{"is--resize":f,"is--padding":m,"is--border":h,"is--height":d,"is--width":o,"is--fill":s&&!d&&!o,"is--handle":0<t,"is--expand":a,"is--hidden":!s}],style:l},[t&&!_?c.renderHandleBar(u,e):(0,_ui.renderEmptyElement)(c),u("div",{attrs:{itemid:i},class:"vxe-split-pane--wrapper"},[u("div",{class:"vxe-split-pane--inner"},r?c.callSlot(r,{name:n,isVisible:s,isExpand:a}):[])]),_&&t<p.length-1?c.renderHandleBar(u,e):(0,_ui.renderEmptyElement)(c)]))}),u("div",{class:"vxe-split-wrapper"},b)},renderVN:function(e){var t=this.$scopedSlots,i=this.vertical,n=this.width,r=this.height,t=t.default,s={};return r&&(s.height=(0,_dom.toCssUnit)(r)),n&&(s.width=(0,_dom.toCssUnit)(n)),e("div",{ref:"refElem",class:["vxe-split",i?"is--vertical":"is--horizontal"],style:s},[e("div",{class:"vxe-split-slots"},t?t({}):[]),this.renderItems(e)])}},created:function(){_ui.globalEvents.on(this,"resize",this.handleGlobalResizeEvent)},mounted:function(){var e,t=this,i=t,n=t.$refs.refElem;n&&((e=_ui.globalResize.create(function(){t.recalculate()})).observe(n),this.$resize=e),i.items&&t.loadItem(i.items),t.$nextTick(function(){t.recalculate()})},beforeDestroy:function(){this.$resize&&this.$resize.disconnect(),_ui.globalEvents.off(this,"resize")},render:function(e){return this.renderVN(e)}});