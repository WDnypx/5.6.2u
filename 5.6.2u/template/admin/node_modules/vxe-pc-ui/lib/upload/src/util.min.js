Object.defineProperty(exports,"__esModule",{value:!0}),exports.getExportBlobByContent=getExportBlobByContent,exports.parseFile=parseFile,exports.saveLocalFile=exports.readLocalFile=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_core=require("@vxe-ui/core");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var fileForm=null,fileInput=null;function parseFile(e){var e=e.name,t=_xeUtils.default.lastIndexOf(e,"."),r=e.substring(t+1,e.length).toLowerCase();return{filename:e.substring(0,t),type:r}}var readLocalFile=exports.readLocalFile=function(e){var c=Object.assign({},e);return new Promise(function(l,i){fileInput||((fileInput=document.createElement("input")).name="file",fileInput.type="file"),fileForm||((fileForm=document.createElement("form")).style.display="none",fileForm.appendChild(fileInput),document.body.appendChild(fileForm));var a=c.types||[],s=!a.length||a.some(function(e){return"*"===e});fileInput.multiple=!!c.multiple,fileInput.accept=s?"":".".concat(a.join(", .")),fileInput.onchange=function(e){var e=e.target,t=Array.from(e.files||[]),e=t[0],r="";if(!s)for(var n=0;n<t.length;n++){var o=parseFile(t[n]).type;if(!_xeUtils.default.includes(a,o)){r=o;break}}r?(!1!==c.message&&_core.VxeUI.modal&&_core.VxeUI.modal.message({content:(0,_core.getI18n)("vxe.error.notType",[r]),status:"error"}),i({status:!1,files:t,file:e})):l({status:!0,files:t,file:e})},fileForm.reset(),fileInput.click()})};function getExportBlobByContent(e,t){return new Blob([e],{type:"text/".concat(t.type,";charset=utf-8;")})}var saveLocalFile=exports.saveLocalFile=function(e){var t,r,e=Object.assign({type:""},e),n=e.filename,o=e.type,l=e.content,o=o?"".concat(n,".").concat(o):"".concat(n);return window.Blob?(n=l instanceof Blob?l:getExportBlobByContent(_xeUtils.default.toValueString(l),e),(l=window.navigator).msSaveBlob?l.msSaveBlob(n,o):(t=URL.createObjectURL(n),(r=document.createElement("a")).target="_blank",r.download=o,r.href=t,document.body.appendChild(r),r.click(),requestAnimationFrame(function(){r.parentNode&&r.parentNode.removeChild(r),URL.revokeObjectURL(t)})),Promise.resolve()):Promise.reject(new Error((0,_core.getI18n)("vxe.error.notExp")))};