Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_dom=require("../../ui/src/dom"),_utils=require("../../ui/src/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxePulldown",model:{prop:"value",event:"modelValue"},mixins:[_ui.globalMixins.sizeMixin,_ui.globalMixins.permissionMixin],props:{value:Boolean,disabled:Boolean,placement:String,trigger:{type:String,default:(0,_ui.getConfig)().pulldown.trigger},size:{type:String,default:function(){return(0,_ui.getConfig)().size}},options:Array,className:{type:[String,Function],default:(0,_ui.getConfig)().pulldown.className},popupClassName:[String,Function],showPopupShadow:Boolean,destroyOnClose:{type:Boolean,default:(0,_ui.getConfig)().pulldown.destroyOnClose},transfer:{type:Boolean,default:null}},inject:{$xeModal:{default:null},$xeDrawer:{default:null},$xeTable:{default:null},$xeForm:{default:null}},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{initialized:!1,panelIndex:0,panelStyle:{},panelPlacement:null,visiblePanel:!1,isAniVisible:!1,isActivated:!1},internalData:{hpTimeout:void 0}}},computed:Object.assign(Object.assign({},{}),{computeBtnTransfer:function(){var e=this,t=e.$xeModal,n=e.$xeDrawer,i=e.$xeTable,l=e.$xeForm,e=e.transfer;if(null===e){var a=(0,_ui.getConfig)().pulldown.transfer;if(_xeUtils.default.isBoolean(a))return a;if(i||t||n||l)return!0}return e}}),methods:{dispatchEvent:function(e,t,n){this.$emit(e,(0,_ui.createEvent)(n,{$pulldown:this},t))},emitModel:function(e){var t=this,n=t._events;n&&n.modelValue?t.$emit("modelValue",e):t.$emit("model-value",e)},updateZindex:function(){var e=this.reactData;e.panelIndex<(0,_utils.getLastZIndex)()&&(e.panelIndex=(0,_utils.nextZIndex)())},isPanelVisible:function(){return this.reactData.visiblePanel},updatePlacement:function(){function e(){var e=(0,_dom.updatePanelPlacement)(a,o,{placement:i,teleportTo:r}),t=Object.assign(e.style,{zIndex:l});n.panelStyle=t,n.panelPlacement=e.placement}var t=this,n=t.reactData,i=t.placement,l=n.panelIndex,a=t.$refs.refPulldownContent,o=t.$refs.refPulldownPanel,r=t.computeBtnTransfer;return e(),t.$nextTick().then(e)},showPanel:function(){var t=this,n=t,i=t.reactData,l=t.internalData,e=t.computeBtnTransfer,a=t.$refs.refPulldownPanel;return i.initialized||(i.initialized=!0,e&&a&&document.body.appendChild(a)),new Promise(function(e){n.disabled?t.$nextTick(function(){e()}):(l.hpTimeout&&clearTimeout(l.hpTimeout),i.isActivated=!0,i.isAniVisible=!0,setTimeout(function(){i.visiblePanel=!0,t.emitModel(!0),t.updatePlacement(),setTimeout(function(){e(t.updatePlacement())},40)},10),t.updateZindex(),t.dispatchEvent("visible-change",{visible:!0},null))})},hidePanel:function(){var t=this,n=t.reactData,i=t.internalData;return n.visiblePanel=!1,t.dispatchEvent("visible-change",{visible:!1},null),t.emitModel(!1),new Promise(function(e){n.isAniVisible?i.hpTimeout=setTimeout(function(){n.isAniVisible=!1,t.$nextTick(function(){e()})},350):t.$nextTick(function(){e()})})},togglePanel:function(){return this.reactData.visiblePanel?this.hidePanel():this.showPanel()},handleOptionEvent:function(e,t){var n=this.reactData;t.disabled||(n.visiblePanel&&(this.hidePanel(),this.dispatchEvent("hide-panel",{},e)),this.dispatchEvent("option-click",{option:t},e))},clickTargetEvent:function(e){var t=this,n=t.reactData;"click"===t.trigger&&(n.visiblePanel?(t.hidePanel(),t.dispatchEvent("hide-panel",{},e)):(t.showPanel(),t.dispatchEvent("show-panel",{},e))),t.dispatchEvent("click",{$pulldown:t},e)},handleGlobalMousewheelEvent:function(e){var t=this,n=t.reactData,i=t.disabled,n=n.visiblePanel,l=t.$refs.refPulldownPanel;i||n&&((0,_dom.getEventTargetNode)(e,l).flag?t.updatePlacement():(t.hidePanel(),t.dispatchEvent("hide-panel",{},e)))},handleGlobalMousedownEvent:function(e){var t=this,n=t.reactData,i=t.disabled,l=n.visiblePanel,a=t.$refs.refElem,o=t.$refs.refPulldownPanel;i||(n.isActivated=(0,_dom.getEventTargetNode)(e,a).flag||(0,_dom.getEventTargetNode)(e,o).flag,l&&!n.isActivated&&(t.hidePanel(),t.dispatchEvent("hide-panel",{},e)))},handleGlobalBlurEvent:function(e){var t=this.reactData;t.visiblePanel&&(t.isActivated=!1,this.hidePanel(),this.dispatchEvent("hide-panel",{},e))},renderDefaultPanel:function(e,t){var n=this,i=n.$scopedSlots.option;return e("div",{class:"vxe-pulldown--panel-list"},t?t.map(function(t){return e("div",{class:"vxe-pulldown--panel-item",on:{click:function(e){n.handleOptionEvent(e,t)}}},i?i({$pulldown:n,option:t}):"".concat(t.label||""))}):[])},renderVN:function(e){var t=this,n=t.$scopedSlots,i=t.reactData,l=t.className,a=t.options,o=t.popupClassName,r=t.showPopupShadow,s=t.destroyOnClose,u=t.disabled,d=i.initialized,c=i.isActivated,p=i.isAniVisible,f=i.visiblePanel,v=i.panelStyle,i=i.panelPlacement,h=t.computeBtnTransfer,m=t.computeSize,P=n.default,b=n.header,w=n.footer,n=n.dropdown;return e("div",{ref:"refElem",class:["vxe-pulldown",l?_xeUtils.default.isFunction(l)?l({$pulldown:t}):l:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(m),m),"is--visible",f),"is--disabled",u),"is--active",c)]},[e("div",{ref:"refPulldownContent",class:"vxe-pulldown--content",on:{click:t.clickTargetEvent}},P?P({$pulldown:t}):[]),e("div",{ref:"refPulldownPanel",class:["vxe-table--ignore-clear vxe-pulldown--panel",o?_xeUtils.default.isFunction(o)?o({$pulldown:t}):o:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(m),m),"is--shadow",r),"is--transfer",h),"ani--leave",p),"ani--enter",f)],attrs:{placement:i},style:v},d?[e("div",{class:"vxe-pulldown--panel-wrapper"},d&&(!s||f||p)?[b?e("div",{class:"vxe-pulldown--panel-header"},b({$pulldown:t})):(0,_ui.renderEmptyElement)(t),e("div",{class:"vxe-pulldown--panel-body"},n?n({$pulldown:t}):[t.renderDefaultPanel(e,a)]),w?e("div",{class:"vxe-pulldown--panel-footer"},w({$pulldown:t})):(0,_ui.renderEmptyElement)(t)]:[])]:[])])}},watch:{value:function(e){this.reactData.isActivated=!!e,e?this.showPanel():this.hidePanel()}},created:function(){var e=this;e.value&&e.showPanel(),_ui.globalEvents.on(e,"mousewheel",e.handleGlobalMousewheelEvent),_ui.globalEvents.on(e,"mousedown",e.handleGlobalMousedownEvent),_ui.globalEvents.on(e,"blur",e.handleGlobalBlurEvent)},beforeDestroy:function(){var e=this.$refs.refPulldownPanel;e&&e.parentNode&&e.parentNode.removeChild(e),_ui.globalEvents.off(this,"mousewheel"),_ui.globalEvents.off(this,"mousedown"),_ui.globalEvents.off(this,"blur")},render:function(e){return this.renderVN(e)}});