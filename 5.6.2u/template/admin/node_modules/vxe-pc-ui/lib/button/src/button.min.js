Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_vn=require("../../ui/src/vn"),_comp=require("../../ui/src/comp"),_dom=require("../../ui/src/dom"),_utils=require("../../ui/src/utils"),_log=require("../../ui/src/log"),_tooltip=_interopRequireDefault(require("../../tooltip/src/tooltip"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxeButton",mixins:[_ui.globalMixins.sizeMixin,_ui.globalMixins.permissionMixin],props:{type:String,mode:String,className:[String,Function],popupClassName:[String,Function],size:{type:String,default:function(){return(0,_ui.getConfig)().button.size||(0,_ui.getConfig)().size}},name:[String,Number],routerLink:Object,permissionCode:[String,Number],content:String,placement:String,status:String,title:String,icon:String,round:Boolean,circle:Boolean,disabled:Boolean,loading:Boolean,trigger:{type:String,default:function(){return(0,_ui.getConfig)().button.trigger}},align:String,prefixTooltip:Object,suffixTooltip:Object,options:Array,destroyOnClose:{type:Boolean,default:function(){return(0,_ui.getConfig)().button.destroyOnClose}},transfer:{type:Boolean,default:null}},inject:{$xeModal:{default:null},$xeDrawer:{default:null},$xeTable:{default:null},$xeForm:{default:null},$xeButtonGroup:{default:null}},data:function(){var e={showTime:void 0};return{xID:_xeUtils.default.uniqueId(),reactData:{initialized:!1,visiblePanel:!1,isAniVisible:!1,isActivated:!1,panelIndex:0,panelStyle:{},panelPlacement:""},internalData:e}},computed:Object.assign(Object.assign({},{}),{computeBtnTransfer:function(){var e=this,t=e.transfer,n=e.$xeTable,i=e.$xeModal,o=e.$xeDrawer,e=e.$xeForm;if(null===t){var r=(0,_ui.getConfig)().button.transfer;if(_xeUtils.default.isBoolean(r))return r;if(n||i||o||e)return!0}return t},computeBtnDisabled:function(){var e=this.disabled,t=this.computePermissionInfo;return e||t.disabled},computeIsFormBtn:function(){var e=this.type;return!!e&&-1<["submit","reset","button"].indexOf(e)},computeBtnMode:function(){var e=this.type,t=this.mode,n=this.$xeButtonGroup;return"text"===t||"text"===e||n&&"text"===n.mode?"text":"button"},computeBtnStatus:function(){var e=this.status,t=this.$xeButtonGroup;return e||(t?t.status:"")},computeBtnRound:function(){var e=this.round,t=this.$xeButtonGroup;return e||!!t&&t.round},computeBtnAlign:function(){var e=this.align,t=this.$xeButtonGroup;return e||!!t&&t.align},computeBtnCircle:function(){var e=this.circle,t=this.$xeButtonGroup;return e||!!t&&t.circle},computeDownBtnList:function(){var e=this.options;return e?e.filter(function(e){e=e.permissionCode;return!e||_ui.permission.checkVisible(e)}):[]},computePrefixTipOpts:function(){return Object.assign({},this.prefixTooltip)},computeSuffixTipOpts:function(){return Object.assign({},this.suffixTooltip)}}),methods:{dispatchEvent:function(e,t,n){this.$emit((0,_vn.getEventCaseName)(this,e),(0,_ui.createEvent)(n,{$button:this},t))},openPanel:function(){var e=this,t=this,n=t.reactData,i=t.internalData,o=t.trigger,r=t.computeBtnTransfer,a=t.$refs.refBtnPanel;return a&&(a.dataset.active="Y",n.initialized||(n.initialized=!0,r&&document.body.appendChild(a)),i.showTime=setTimeout(function(){"Y"===a.dataset.active?e.mouseenterDropdownEvent():n.isAniVisible=!1},"click"===o?50:250)),t.$nextTick()},closePanel:function(){return this.hidePanel()},hidePanel:function(){var e=this.reactData,t=this.internalData,n=this.$refs.refBtnPanel;return clearTimeout(t.showTime),n?(n.dataset.active="N",setTimeout(function(){"Y"!==n.dataset.active&&(e.visiblePanel=!1,setTimeout(function(){"Y"!==n.dataset.active&&(e.isAniVisible=!1)},350))},100)):(e.isAniVisible=!1,e.visiblePanel=!1),this.$nextTick()},focus:function(){var e=this.$refs.refButton;return e&&e.focus(),this.$nextTick()},blur:function(){var e=this.$refs.refButton;return e&&e.blur(),this.$nextTick()},updateZindex:function(){var e=this.reactData;e.panelIndex<(0,_utils.getLastZIndex)()&&(e.panelIndex=(0,_utils.nextZIndex)())},updatePlacement:function(){function e(){var e=(0,_dom.updatePanelPlacement)(r,a,{placement:i,teleportTo:s}),t=Object.assign(e.style,{zIndex:o});n.panelStyle=t,n.panelPlacement=e.placement}var t=this,n=t.reactData,i=t.placement,o=n.panelIndex,r=t.$refs.refButton,a=t.$refs.refBtnPanel,s=t.computeBtnTransfer;return e(),t.$nextTick().then(e)},clickEvent:function(e){var t=this.$xeButtonGroup;t&&t.handleClick({name:this.name},e),this.dispatchEvent("click",{$event:e},e)},downBtnClickEvent:function(e,t){e=e.$event;this.hidePanel(),this.dispatchEvent("dropdown-click",{name:t.name,option:t},e)},mousedownDropdownEvent:function(e){0===e.button&&e.stopPropagation()},clickDropdownEvent:function(e){var t=this.reactData,n=e.currentTarget,i=this.$refs.refBtnPanel,n=(0,_dom.getEventTargetNode)(e,n,"vxe-button"),o=n.flag,n=n.targetElem;o&&(i&&(i.dataset.active="N"),t.visiblePanel=!1,setTimeout(function(){i&&"Y"===i.dataset.active||(t.isAniVisible=!1)},350),this.dispatchEvent("dropdown-click",{name:n.getAttribute("name"),option:null,$event:e},e))},mouseenterDropdownEvent:function(){var e=this,t=this.reactData,n=this.$refs.refBtnPanel;n&&(n.dataset.active="Y",t.isAniVisible=!0,setTimeout(function(){"Y"===n.dataset.active&&(t.visiblePanel=!0,e.updateZindex(),e.updatePlacement(),setTimeout(function(){t.visiblePanel&&e.updatePlacement()},50))},20))},mouseenterTargetEvent:function(e){var t=this.loading;this.computeBtnDisabled||t||(this.openPanel(),this.mouseenterEvent(e))},mouseleaveTargetEvent:function(e){this.hidePanel(),this.mouseleaveEvent(e)},mouseenterEvent:function(e){this.dispatchEvent("mouseenter",{},e)},mouseleaveEvent:function(e){this.dispatchEvent("mouseleave",{},e)},clickTargetEvent:function(e){var t=this.reactData,n=this.loading;this.computeBtnDisabled||n||("click"===this.trigger&&(t.visiblePanel?this.hidePanel():this.openPanel()),this.clickEvent(e))},mouseleaveDropdownEvent:function(){this.hidePanel()},handleGlobalMousewheelEvent:function(e){var t=this.reactData,n=this.$refs.refBtnPanel;t.visiblePanel&&!(0,_dom.getEventTargetNode)(e,n).flag&&this.hidePanel()},handleGlobalMousedownEvent:function(e){var t,n=this.reactData,i=this.computeBtnDisabled,o=n.visiblePanel;i||(i=this.$refs.refElem,t=this.$refs.refBtnPanel,n.isActivated=(0,_dom.getEventTargetNode)(e,i).flag||(0,_dom.getEventTargetNode)(e,t).flag,o&&!n.isActivated&&this.hidePanel())},renderTooltipIcon:function(e,t,n){return e(_tooltip.default,{props:{useHTML:t.useHTML,content:t.content,enterable:t.enterable,theme:t.theme},scopedSlots:{default:function(){return e("i",{class:["vxe-button--tooltip-".concat(n,"-icon"),t.icon||(0,_ui.getIcon)().BUTTON_TOOLTIP_ICON]})}}})},renderContent:function(e){var t=this,n=t.$scopedSlots,i=t.content,o=t.icon,r=t.loading,a=t.suffixTooltip,s=t.computeSuffixTipOpts,u=n.icon,n=n.default,l=[];return t.prefixTooltip&&l.push(t.renderTooltipIcon(e,t.computePrefixTipOpts,"prefix")),r?l.push(e("i",{class:["vxe-button--loading-icon",(0,_ui.getIcon)().BUTTON_LOADING]})):u?l.push(e("span",{class:"vxe-button--custom-icon"},u.call(this,{}))):o&&l.push(e("i",{class:["vxe-button--icon",o]})),n?l.push(e("span",{class:"vxe-button--content"},n.call(this,{}))):i&&l.push(e("span",{class:"vxe-button--content"},(0,_utils.getFuncText)(i))),a&&l.push(t.renderTooltipIcon(e,s,"suffix")),l},renderVN:function(n){var e,t,i=this,o=i.$scopedSlots,r=i.reactData,a=i.className,s=i.popupClassName,u=i.trigger,l=i.title,c=i.routerLink,d=i.type,p=i.destroyOnClose,f=i.name,m=i.loading,v=r.initialized,b=r.isAniVisible,h=r.visiblePanel,g=i.computeIsFormBtn,_=i.computeBtnMode,x=i.computeBtnStatus,y=i.computeBtnRound,P=i.computeBtnCircle,B=i.computeBtnTransfer,T=i.computeBtnAlign,E=i.computeBtnDisabled,w=i.computeDownBtnList,$=i.computeSize,o=o.dropdowns;return i.computePermissionInfo.visible?o||w.length?(e={},t={},"hover"===u&&(e.mouseenter=i.mouseenterTargetEvent,e.mouseleave=i.mouseleaveTargetEvent,t.mouseenter=i.mouseenterDropdownEvent,t.mouseleave=i.mouseleaveDropdownEvent),n("div",{ref:"refElem",class:["vxe-button--dropdown",a?_xeUtils.default.isFunction(a)?a({$button:i}):a:"",_defineProperty(_defineProperty({},"size--".concat($),$),"is--active",h)]},[c?n("router-link",{ref:"refButton",class:["vxe-button","vxe-button--link","type--".concat(_),T?"align--".concat(T):"",a?_xeUtils.default.isFunction(a)?a({$button:i}):a:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat($),$),"theme--".concat(x),x),"is--round",y),"is--circle",P),"is--disabled",E||m),"is--loading",m)],attrs:{title:l,name:f,type:g?d:"button",disabled:E||m,custom:!0,to:c},on:Object.assign({click:i.clickTargetEvent},e)},i.renderContent(n).concat([n("i",{class:"vxe-button--dropdown-arrow ".concat((0,_ui.getIcon)().BUTTON_DROPDOWN)})])):n("button",{ref:"refButton",class:["vxe-button","type--".concat(_),T?"align--".concat(T):"",a?_xeUtils.default.isFunction(a)?a({$button:i}):a:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat($),$),"theme--".concat(x),x),"is--round",y),"is--circle",P),"is--disabled",E||m),"is--loading",m)],attrs:{title:l,name:f,type:g?d:"button",disabled:E||m},on:Object.assign({click:i.clickTargetEvent},e)},i.renderContent(n).concat([n("i",{class:"vxe-button--dropdown-arrow ".concat((0,_ui.getIcon)().BUTTON_DROPDOWN)})])),n("div",{ref:"refBtnPanel",class:["vxe-button--dropdown-panel",s?_xeUtils.default.isFunction(s)?s({$button:i}):s:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat($),$),"is--transfer",B),"ani--leave",b),"ani--enter",h)],attrs:{placement:r.panelPlacement},style:r.panelStyle,on:t},v&&(h||b)?[o?n("div",{class:"vxe-button--dropdown-wrapper",on:{mousedown:i.mousedownDropdownEvent,click:i.clickDropdownEvent}},v&&(!p||h||b)?o.call(i,{}):[]):n("div",{class:"vxe-button--dropdown-wrapper"},v&&(!p||h||b)?w.map(function(t,e){return n("vxe-button",{key:e,props:{type:t.type,mode:t.mode||_,className:t.className,name:t.name,routerLink:t.routerLink,permissionCode:t.permissionCode,title:t.title,content:t.content,status:t.status,icon:t.icon,round:_xeUtils.default.isBoolean(t.round)?t.round:"text"!==_&&y,circle:_xeUtils.default.isBoolean(t.circle)?t.circle:"text"!==_&&P,disabled:t.disabled,loading:t.loading,align:t.align},on:{click:function(e){i.downBtnClickEvent(e,t)}}})}):[])]:[])])):c?n("router-link",{ref:"refButton",class:["vxe-button","vxe-button--link","type--".concat(_),T?"align--".concat(T):"",a?_xeUtils.default.isFunction(a)?a({$button:i}):a:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat($),$),"theme--".concat(x),x),"is--round",y),"is--circle",P),"is--disabled",E||m),"is--loading",m)],props:{title:l,name:f,type:g?d:"button",disabled:E||m,custom:!0,to:c},on:{click:i.clickEvent,mouseenter:i.mouseenterEvent,mouseleave:i.mouseleaveEvent}},i.renderContent(n)):n("button",{ref:"refButton",class:["vxe-button","type--".concat(_),T?"align--".concat(T):"",a?_xeUtils.default.isFunction(a)?a({$button:i}):a:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat($),$),"theme--".concat(x),x),"is--round",y),"is--circle",P),"is--disabled",E||m),"is--loading",m)],attrs:{title:l,name:f,type:g?d:"button",disabled:E||m},on:{click:i.clickEvent,mouseenter:i.mouseenterEvent,mouseleave:i.mouseleaveEvent}},i.renderContent(n)):(0,_ui.renderEmptyElement)(i)}},mounted:function(){var e=this;"text"===e.type&&(0,_log.warnLog)("vxe.error.delProp",["type=text","mode=text"]),_ui.globalEvents.on(e,"mousewheel",e.handleGlobalMousewheelEvent),_ui.globalEvents.on(e,"mousedown",e.handleGlobalMousedownEvent)},beforeDestroy:function(){var e=this.$refs.refBtnPanel;e&&e.parentNode&&e.parentNode.removeChild(e)},destroyed:function(){_ui.globalEvents.off(this,"mousewheel"),_ui.globalEvents.off(this,"mousedown")},render:function(e){return this.renderVN(e)}});