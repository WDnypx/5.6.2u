Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_dom=require("../../ui/src/dom"),_utils=require("../../ui/src/utils"),_vn=require("../../ui/src/vn"),_index=_interopRequireDefault(require("../../loading/index"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxeMenu",mixins:[_ui.globalMixins.sizeMixin,_ui.globalMixins.permissionMixin],props:{value:[String,Number],expandAll:Boolean,collapsed:{type:Boolean,default:null},collapseFixed:Boolean,loading:Boolean,options:{type:Array,default:function(){return[]}},size:{type:String,default:function(){return(0,_ui.getConfig)().image.size||(0,_ui.getConfig)().size}}},inject:{$xeLayoutAside:{default:null}},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{initialized:!1,isEnterCollapse:!1,collapseStyle:{},collapseZindex:0,activeName:null,menuList:[],itemHeight:1}}},computed:Object.assign(Object.assign({},{}),{computeIsCollapsed:function(){var e=this.$xeLayoutAside,t=this.collapsed;return _xeUtils.default.isBoolean(t)?t:!!e&&!!e.collapsed},computeCollapseWidth:function(){var e=this.$xeLayoutAside,t="";return t=e?e.collapseWidth||"":t},computeCollapseEnterWidth:function(){var e=this.$xeLayoutAside,t="";return t=e?e.width||"":t}}),methods:{dispatchEvent:function(e,t,i){this.$emit(e,(0,_ui.createEvent)(i,{$menu:this},t))},emitModel:function(e){var t=this,i=t.reactData,n=t._events;i.activeName=e,t.$emit("input",e),n&&n.modelValue?t.$emit("modelValue",e):t.$emit("model-value",e)},callSlot:function(e,t,i){var n=this.$scopedSlots;return e&&(_xeUtils.default.isString(e)&&(e=n[e]||null),_xeUtils.default.isFunction(e))?(0,_vn.getSlotVNs)(e.call(this,t,i)):[]},getMenuTitle:function(e){return"".concat(e.title||e.name)},updateZindex:function(){var e=this.reactData;e.collapseZindex<(0,_utils.getLastZIndex)()&&(e.collapseZindex=(0,_utils.nextZIndex)())},updateActiveMenu:function(a){var e=this.reactData,s=e.activeName;_xeUtils.default.eachTree(e.menuList,function(e,t,i,n,l,o){e.itemKey===s?(o.forEach(function(e){e.isActive=!0,a&&(e.isExpand=!0)}),e.isExactActive=!0):(e.isExactActive=!1,e.isActive=!1)},{children:"childList"})},updateMenuConfig:function(){var e=this.reactData,t=this.options,o=this.expandAll;e.menuList=_xeUtils.default.mapTree(t,function(e,t,i,n,l){return Object.assign(Object.assign({},e),{parentKey:l?l.name||n.slice(0,n.length-1).join(","):"",level:n.length,itemKey:e.name||n.join(","),isExactActive:!1,isActive:!1,isExpand:_xeUtils.default.isBoolean(e.expanded)?e.expanded:!!o,hasChild:e.children&&0<e.children.length})},{children:"children",mapChildren:"childList"})},updateCollapseStyle:function(){var a=this,s=a.reactData;a.collapseFixed&&a.$nextTick(function(){var e,t=s.isEnterCollapse,i=a.computeIsCollapsed,n=a.computeCollapseEnterWidth,l=a.computeCollapseWidth,o=a.$refs.refElem;o&&(e=o.getBoundingClientRect(),o=o.parentNode,s.collapseStyle=i?{top:(0,_dom.toCssUnit)(e.top),left:(0,_dom.toCssUnit)(e.left),height:(0,_dom.toCssUnit)(o.clientHeight),width:t?n?(0,_dom.toCssUnit)(n):"":l?(0,_dom.toCssUnit)(l):"",zIndex:s.collapseZindex}:{})})},handleCollapseMenu:function(){var e,t=this,i=t.reactData;t.collapseFixed&&(e=i.initialized,t.computeIsCollapsed&&!e&&(i.initialized=!0,t.$nextTick(function(){var e=t.$refs.refCollapseElem;e&&document.body.appendChild(e)})),i.isEnterCollapse=!1,t.updateZindex(),t.updateCollapseStyle())},handleClickIconCollapse:function(e,t){var i=t.hasChild,n=t.isExpand;i&&(e.stopPropagation(),e.preventDefault(),t.isExpand=!n)},handleClickMenu:function(e,t){var i=t.itemKey;!t.routerLink&&t.hasChild?this.handleClickIconCollapse(e,t):this.emitModel(i),this.dispatchEvent("click",{menu:t},e)},handleMenuMouseenter:function(){var e=this.reactData,t=e.collapseStyle,i=this.computeCollapseEnterWidth;e.collapseStyle=Object.assign({},t,{width:i?(0,_dom.toCssUnit)(i):""}),e.isEnterCollapse=!0},handleMenuMouseleave:function(){var e=this.reactData,t=e.collapseStyle,i=this.$refs.refElem;e.collapseStyle=Object.assign({},t,{width:i?(0,_dom.toCssUnit)(i.offsetWidth):""}),e.isEnterCollapse=!1},renderMenuTitle:function(e,t){var i=this,n=i.$scopedSlots,l=t.icon,o=t.isExpand,a=t.hasChild,s=t.slots,s=s?s.default:n.option,n=i.getMenuTitle(t),r=i.computeIsCollapsed;return[e("div",{class:"vxe-menu--item-link-icon"},l?[e("i",{class:l})]:[]),s?e("div",{class:"vxe-menu--item-custom-title"},i.callSlot(s,{option:t,collapsed:r},e)):e("div",{class:"vxe-menu--item-link-title",attrs:{title:n}},n),a?e("div",{class:"vxe-menu--item-link-collapse",on:{click:function(e){i.handleClickIconCollapse(e,t)}}},[e("i",{class:o?(0,_ui.getIcon)().MENU_ITEM_EXPAND_OPEN:(0,_ui.getIcon)().MENU_ITEM_EXPAND_CLOSE})]):(0,_ui.renderEmptyElement)(i)]},renderDefaultChildren:function(t,i){var n=this,e=n.reactData,l=i.itemKey,o=i.level,a=i.hasChild,s=i.isActive,r=i.isExactActive,u=i.isExpand,c=i.routerLink,d=i.childList,e=e.isEnterCollapse,p=n.computeIsCollapsed;return i.permissionCode&&!_ui.permission.checkVisible(i.permissionCode)?(0,_ui.renderEmptyElement)(n):t("div",{key:l,class:["vxe-menu--item-wrapper","vxe-menu--item-level".concat(o),{"is--exact-active":r,"is--active":s,"is--expand":(!p||e)&&u}]},[c?t("router-link",{class:"vxe-menu--item-link",props:{custom:!0,to:c},on:{click:function(e){n.handleClickMenu(e,i)}}},n.renderMenuTitle(t,i)):t("div",{class:"vxe-menu--item-link",on:{click:function(e){n.handleClickMenu(e,i)}}},n.renderMenuTitle(t,i)),a?t("div",{class:"vxe-menu--item-group"},d.map(function(e){return n.renderDefaultChildren(t,e)})):(0,_ui.renderEmptyElement)(n)])},renderCollapseChildren:function(t,i){var n=this,e=i.itemKey,l=i.level,o=i.hasChild,a=i.isActive,s=i.isExactActive,r=i.routerLink,u=i.childList;return i.permissionCode&&!_ui.permission.checkVisible(i.permissionCode)?(0,_ui.renderEmptyElement)(n):t("div",{key:e,class:["vxe-menu--item-wrapper","vxe-menu--item-level".concat(l),{"is--exact-active":s,"is--active":a}]},[r?t("router-link",{class:"vxe-menu--item-link",props:{custom:!0,to:r},on:{click:function(e){n.handleClickMenu(e,i)}}},n.renderMenuTitle(t,i)):t("div",{class:"vxe-menu--item-link",on:{click:function(e){n.handleClickMenu(e,i)}}},n.renderMenuTitle(t,i)),o?t("div",{class:"vxe-menu--item-group"},u.map(function(e){return n.renderDefaultChildren(t,e)})):(0,_ui.renderEmptyElement)(n)])},renderVN:function(t){var i=this,e=i.reactData,n=i.loading,l=e.initialized,o=e.menuList,a=e.collapseStyle,e=e.isEnterCollapse,s=i.computeSize,r=i.computeIsCollapsed;return t("div",{ref:"refElem",class:["vxe-menu",_defineProperty(_defineProperty(_defineProperty({},"size--".concat(s),s),"is--collapsed",r),"is--loading",n)]},[t("div",{class:"vxe-menu--item-list"},o.map(function(e){return r?i.renderCollapseChildren(t,e):i.renderDefaultChildren(t,e)})),l?t("div",{ref:"refCollapseElem",class:["vxe-menu--collapse-wrapper",_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(s),s),"is--collapsed",r),"is--enter",e),"is--loading",n)],style:a,on:{mouseenter:i.handleMenuMouseenter,mouseleave:i.handleMenuMouseleave}},[r?t("div",{class:"vxe-menu--item-list"},o.map(function(e){return i.renderDefaultChildren(t,e)})):(0,_ui.renderEmptyElement)(i)]):(0,_ui.renderEmptyElement)(i),t(_index.default,{class:"vxe-list-view--loading",props:{value:n}})])}},watch:{value:function(e){this.reactData.activeName=e},options:function(){this.updateMenuConfig(),this.updateActiveMenu(!0)},"reactData.activeName":function(){this.updateActiveMenu(!0)},computeIsCollapsed:function(){this.handleCollapseMenu()}},mounted:function(){_ui.globalEvents.on(this,"resize",this.updateCollapseStyle),this.updateCollapseStyle()},beforeDestroy:function(){_ui.globalEvents.off(this,"resize");var e,t=this.$refs.refCollapseElem;t&&(e=t.parentNode)&&e.removeChild(t)},created:function(){var e=this.reactData;e.initialized=!!this.collapsed,e.activeName=this.value,this.updateMenuConfig(),this.updateActiveMenu(!0)},render:function(e){return this.renderVN(e)}});