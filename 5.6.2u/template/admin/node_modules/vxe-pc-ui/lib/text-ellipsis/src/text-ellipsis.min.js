Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxeTextEllipsis",mixins:[_ui.globalMixins.sizeMixin,_ui.globalMixins.permissionMixin],props:{href:String,target:String,content:[String,Number],lineClamp:[String,Number],status:String,title:[String,Number],loading:Boolean,offsetLength:[String,Number],routerLink:Object,underline:{type:Boolean,default:function(){return(0,_ui.getConfig)().textEllipsis.underline}},permissionCode:[String,Number],size:{type:String,default:function(){return(0,_ui.getConfig)().textEllipsis.size||(0,_ui.getConfig)().size}}},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{resizeObserver:null,visibleLen:0}}},computed:Object.assign(Object.assign({},{}),{computeTextLineClamp:function(){return _xeUtils.default.toNumber(this.lineClamp)},computeTextContent:function(){return _xeUtils.default.toValueString(this.content)},computeTextOffsetLength:function(){return this.offsetLength?_xeUtils.default.toNumber(this.offsetLength):0},computeVisibleContent:function(){var e=this,t=e.reactData.visibleLen,i=e.computeTextContent;return 1<e.computeTextLineClamp&&i.length>t?"".concat(i.slice(0,Math.max(1,t-3+e.computeTextOffsetLength)),"..."):i}}),methods:{dispatchEvent:function(e,t,i){this.$emit(e,(0,_ui.createEvent)(i,{$text:this},t))},calculateFont:function(e){var t=this,i=t.reactData,n=t.$refs.refElem,r=t.$refs.realityElem;if(n&&r){var o=12;try{o=Math.max(10,_xeUtils.default.toNumber(getComputedStyle(r).fontSize))}catch(e){}for(var l=t.computeTextContent,s=Math.floor(e/o),u=l.slice(0,s),a=(r.textContent=u,i.visibleLen=u.length,0);e>r.clientWidth&&a<30;){a++;var f=Math.floor((e-r.clientWidth)/o);if(!f)break;s+=f,u=l.slice(0,s),r.textContent=u,i.visibleLen=u.length}r.textContent="",r.style.display="",r.style.position="",r.style.top="",r.style.left=""}},updateStyle:function(){var e=this,t=e.reactData,i=e.$refs.refElem,n=e.$refs.realityElem,r=e.computeTextContent,o=e.computeTextLineClamp;!i||!n||(i=i.clientWidth,n.style.display="block",n.style.position="absolute",n.style.top="-3000px",n.style.left="-3000px",n.textContent=r,n.offsetWidth<(n=Math.floor(i*o)))?t.visibleLen=r.length:e.calculateFont(n)},clickEvent:function(){this.$emit("click",{})},initObserver:function(){var e,t,i=this,n=i.reactData;n.resizeObserver||(e=i.$refs.refElem)&&1<i.computeTextLineClamp&&window.ResizeObserver&&((t=new window.ResizeObserver(_xeUtils.default.throttle(function(){i.updateStyle()},300,{leading:!0,trailing:!0}))).observe(e),n.resizeObserver=t)},renderContent:function(e){var t=this.routerLink,i=this.href,n=this.target,r=this.title,o=this.computeVisibleContent;return t?e("router-link",{class:"vxe-text-ellipsis--link",props:{title:r,target:n,custom:!0}},o):i?e("a",{class:"vxe-text-ellipsis--link",attrs:{href:i,target:n,title:r}},o):e("span",{class:"vxe-text-ellipsis--content"},o)},renderVN:function(e){var t=this,i=t.loading,n=t.status,r=t.title,o=t.underline,l=t.computePermissionInfo,s=t.computeSize;return l.visible?e("div",{ref:"refElem",class:["vxe-text-ellipsis",1<t.computeTextLineClamp?"is--multi":"is--single",_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(s),s),"theme--".concat(n),n),"is--underline",o),"is--loading",i)],attrs:{title:r},on:{click:t.clickEvent}},[e("span",{ref:"realityElem",class:"vxe-text-ellipsis--reality"}),t.renderContent(e)]):(0,_ui.renderEmptyElement)(t)}},watch:{content:function(){this.updateStyle()},lineClamp:function(){this.initObserver(),this.updateStyle()}},mounted:function(){this.initObserver(),this.updateStyle()},beforeDestroy:function(){var e=this.reactData,t=e.resizeObserver,i=this.$refs.refElem,n=this.$refs.realityElem;n&&(n.textContent=""),t&&(i&&t.unobserve(i),t.disconnect(),e.resizeObserver=null)},render:function(e){return this.renderVN(e)}});