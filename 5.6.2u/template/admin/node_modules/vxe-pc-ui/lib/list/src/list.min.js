Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_dom=require("../../ui/src/dom"),_vn=require("../../ui/src/vn"),_loading=_interopRequireDefault(require("../../loading/src/loading"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}var browseObj=_xeUtils.default.browse(),_default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxeList",mixins:[_ui.globalMixins.sizeMixin],props:{data:Array,height:[Number,String],maxHeight:[Number,String],loading:Boolean,className:[String,Function],size:{type:String,default:function(){return(0,_ui.getConfig)().list.size||(0,_ui.getConfig)().size}},autoResize:{type:Boolean,default:function(){return(0,_ui.getConfig)().list.autoResize}},syncResize:[Boolean,String,Number],virtualYConfig:Object,scrollY:Object},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{scrollYLoad:!1,bodyHeight:0,customHeight:0,customMaxHeight:0,parentHeight:0,topSpaceHeight:0,items:[]},internalData:{resizeObserver:void 0,fullData:[],lastScrollLeft:0,lastScrollTop:0,scrollYStore:{startIndex:0,endIndex:0,visibleSize:0,offsetSize:0,rowHeight:0}}}},computed:Object.assign(Object.assign({},{}),{computeSYOpts:function(){return Object.assign({},(0,_ui.getConfig)().list.virtualYConfig||(0,_ui.getConfig)().list.scrollY,this.virtualYConfig||this.scrollY)},computeStyles:function(){var t=this.reactData,e=this.height,i=this.maxHeight,r=t.customHeight,t=t.customMaxHeight,a={};return e?a.height="".concat(r,"px"):i&&(a.height="auto",a.maxHeight="".concat(t,"px")),a}}),methods:{dispatchEvent:function(t,e,i){this.$emit(t,(0,_ui.createEvent)(i,{$list:this},e))},callSlot:function(t,e,i){var r=this.$scopedSlots;return t&&(_xeUtils.default.isString(t)&&(t=r[t]||null),_xeUtils.default.isFunction(t))?(0,_vn.getSlotVNs)(t.call(this,e,i)):[]},loadData:function(t){var e=this,i=e.reactData,r=e.internalData,a=r.scrollYStore,l=e.computeSYOpts,t=t||[];return Object.assign(a,{startIndex:0,endIndex:1,visibleSize:0}),r.fullData=t,i.scrollYLoad=!!l.enabled&&-1<l.gt&&(0===l.gt||l.gt<=t.length),e.handleData(),e.computeScrollLoad().then(function(){e.refreshScroll()})},reloadData:function(t){return this.clearScroll(),this.loadData(t)},calcTableHeight:function(t){var e=this.reactData.parentHeight,t=this[t],i=0;return i=t?"100%"===t||"auto"===t?e:(i=(0,_dom.isScale)(t)?Math.floor((_xeUtils.default.toInteger(t)||1)/100*e):_xeUtils.default.toNumber(t),Math.max(40,i)):i},updateHeight:function(){var t=this.reactData;t.customHeight=this.calcTableHeight("height"),t.customMaxHeight=this.calcTableHeight("maxHeight")},updateYSpace:function(){var t=this.reactData,e=this.internalData,i=t.scrollYLoad,r=e.scrollYStore;t.bodyHeight=i?e.fullData.length*r.rowHeight:0,t.topSpaceHeight=i?Math.max(r.startIndex*r.rowHeight,0):0},handleData:function(){var t=this.reactData,e=this.internalData,i=t.scrollYLoad,r=e.fullData,e=e.scrollYStore;return t.items=i?r.slice(e.startIndex,e.endIndex):r.slice(0),this.$nextTick()},updateYData:function(){this.handleData(),this.updateYSpace()},computeScrollLoad:function(){var o=this,n=o.reactData,s=o.internalData;return o.$nextTick().then(function(){var t,e=n.scrollYLoad,i=s.scrollYStore,r=o.$refs.refVirtualBody,a=o.computeSYOpts,l=0;(t=r?(t=a.sItem?r.querySelector(a.sItem):t)||r.children[0]:t)&&(l=t.offsetHeight),l=Math.max(12,l),i.rowHeight=l,e?(r=o.$refs.refVirtualWrapper,t=Math.max(8,Math.ceil(r.clientHeight/l)),e=a.oSize?_xeUtils.default.toNumber(a.oSize):browseObj.edge?10:0,i.offsetSize=e,i.visibleSize=t,i.endIndex=Math.max(i.startIndex+t+e,i.endIndex),o.updateYData()):o.updateYSpace()})},clearScroll:function(){var t=this.$refs.refVirtualWrapper;return t&&(t.scrollTop=0),this.$nextTick()},scrollTo:function(t,e){var i=this,r=i.reactData,a=i.$refs.refVirtualWrapper;return _xeUtils.default.isNumber(t)&&(a.scrollLeft=t),_xeUtils.default.isNumber(e)&&(a.scrollTop=e),r.scrollYLoad?new Promise(function(t){setTimeout(function(){i.$nextTick(function(){t()})},50)}):i.$nextTick()},refreshScroll:function(){var t=this.internalData,e=t.lastScrollLeft,i=t.lastScrollTop;return this.clearScroll().then(function(){if(e||i)return t.lastScrollLeft=0,t.lastScrollTop=0,scrollTo(e,i)})},recalculate:function(){var t=this,e=t.reactData,i=t.$refs.refElem;if(i){var r=i.parentElement;if(e.parentHeight=r?r.clientHeight:0,t.updateHeight(),i.clientWidth&&i.clientHeight)return t.computeScrollLoad()}return t.$nextTick()},loadYData:function(t){var e=this.internalData.scrollYStore,i=e.startIndex,r=e.endIndex,a=e.visibleSize,l=e.offsetSize,t=t.target.scrollTop,t=Math.floor(t/e.rowHeight),o=Math.max(0,t-1-l),l=t+a+l;!(t<=i||r-a-1<=t)||i===o&&r===l||(e.startIndex=o,e.endIndex=l,this.updateYData())},scrollEvent:function(t){var e=this.reactData,i=this.internalData,r=t.target,a=r.scrollTop,r=r.scrollLeft,l=r!==i.lastScrollLeft,o=a!==i.lastScrollTop;i.lastScrollTop=a,i.lastScrollLeft=r,e.scrollYLoad&&this.loadYData(t),this.dispatchEvent("scroll",{scrollLeft:r,scrollTop:a,isX:l,isY:o},t)},renderVN:function(t){var e=this,i=e.reactData,r=e.className,a=e.loading,l=i.bodyHeight,o=i.topSpaceHeight,i=i.items,n=e.$scopedSlots.default,s=e.computeSize,c=e.computeStyles;return t("div",{ref:"refElem",class:["vxe-list",r?_xeUtils.default.isFunction(r)?r({$list:e}):r:"",_defineProperty(_defineProperty({},"size--".concat(s),s),"is--loading",a)]},[t("div",{ref:"refVirtualWrapper",class:"vxe-list--virtual-wrapper",style:c,on:{scroll:e.scrollEvent}},[t("div",{class:"vxe-list--y-space",style:{height:l?"".concat(l,"px"):""}}),t("div",{ref:"refVirtualBody",class:"vxe-list--body",style:{marginTop:o?"".concat(o,"px"):""}},n?e.callSlot(n,{items:i},t):[])]),t(_loading.default,{class:"vxe-list--loading",props:{value:a}})])}},watch:{data:function(){this.loadData(this.data||[])},height:function(){this.recalculate()},maxHeight:function(){this.recalculate()},syncResize:function(t){var e=this;t&&(e.recalculate(),e.$nextTick(function(){return setTimeout(function(){return e.recalculate()})}))}},created:function(){this.loadData(this.data||[])},mounted:function(){var t,e=this,i=e,r=e.internalData;e.recalculate(),i.autoResize&&(i=e.$refs.refElem,(t=_ui.globalResize.create(function(){return e.recalculate()})).observe(i),i&&t.observe(i.parentElement),r.resizeObserver=t),_ui.globalEvents.on(e,"resize",e.recalculate)},activated:function(){var t=this;t.recalculate().then(function(){return t.refreshScroll()})},beforeDestroy:function(){var t=this.internalData.resizeObserver;t&&t.disconnect(),_ui.globalEvents.off(this,"resize")},render:function(t){return this.renderVN(t)}});