Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_dom=require("../../ui/src/dom"),_utils=require("../../ui/src/utils"),_input=_interopRequireDefault(require("../../input/src/input")),_vn=require("../../ui/src/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}function isOptionVisible(e){return!1!==e.visible}function getOptUniqueId(){return _xeUtils.default.uniqueId("opt_")}var _default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxeSelect",mixins:[_ui.globalMixins.sizeMixin],model:{prop:"value",event:"modelValue"},props:{value:[String,Number,Boolean,Array],defaultConfig:Object,clearable:Boolean,placeholder:String,readonly:{type:Boolean,default:null},loading:Boolean,disabled:{type:Boolean,default:null},multiple:Boolean,multiCharOverflow:{type:[Number,String],default:function(){return(0,_ui.getConfig)().select.multiCharOverflow}},prefixIcon:String,allowCreate:{type:Boolean,default:function(){return(0,_ui.getConfig)().select.allowCreate}},placement:String,options:Array,optionProps:Object,optionGroups:Array,optionGroupProps:Object,optionConfig:Object,className:[String,Function],popupClassName:[String,Function],max:{type:[String,Number],default:null},size:{type:String,default:function(){return(0,_ui.getConfig)().select.size||(0,_ui.getConfig)().size}},filterable:Boolean,filterMethod:Function,remote:Boolean,remoteMethod:Function,remoteConfig:Object,emptyText:String,transfer:{type:Boolean,default:null},virtualYConfig:Object,scrollY:Object,optionId:{type:String,default:function(){return(0,_ui.getConfig)().select.optionId}},optionKey:Boolean},inject:{$xeModal:{default:null},$xeDrawer:{default:null},$xeTable:{default:null},$xeForm:{default:null},formItemInfo:{from:"xeFormItemInfo",default:null}},provide:function(){return{$xeSelect:this}},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{initialized:!1,scrollYLoad:!1,bodyHeight:0,topSpaceHeight:0,optList:[],afterVisibleList:[],staticOptions:[],reactFlag:1,currentOption:null,searchValue:"",searchLoading:!1,panelIndex:0,panelStyle:{},panelPlacement:null,triggerFocusPanel:!1,visiblePanel:!1,isAniVisible:!1,isActivated:!1},internalData:{synchData:[],fullData:[],optAddMaps:{},optGroupKeyMaps:{},optFullValMaps:{},remoteValMaps:{},lastScrollLeft:0,lastScrollTop:0,scrollYStore:{startIndex:0,endIndex:0,visibleSize:0,offsetSize:0,rowHeight:0},lastScrollTime:0,hpTimeout:void 0}}},computed:Object.assign(Object.assign({},{}),{computeFormReadonly:function(){var e=this.$xeForm,t=this.readonly;return null===t?!!e&&e.readonly:t},computeIsDisabled:function(){var e=this.$xeForm,t=this.disabled;return null===t?!!e&&e.disabled:t},computeBtnTransfer:function(){var e=this,t=e.$xeTable,i=e.$xeModal,n=e.$xeDrawer,l=e.$xeForm,e=e.transfer;if(null===e){var a=(0,_ui.getConfig)().select.transfer;if(_xeUtils.default.isBoolean(a))return a;if(t||i||n||l)return!0}return e},computeInpPlaceholder:function(){var e=this.placeholder;return(e=e||(0,_ui.getConfig)().select.placeholder)?(0,_utils.getFuncText)(e):(0,_ui.getI18n)("vxe.base.pleaseSelect")},computeDefaultOpts:function(){return Object.assign({},this.defaultConfig)},computePropsOpts:function(){return Object.assign({},this.optionProps)},computeGroupPropsOpts:function(){return Object.assign({},this.optionGroupProps)},computeLabelField:function(){return this.computePropsOpts.label||"label"},computeValueField:function(){return this.computePropsOpts.value||"value"},computeGroupLabelField:function(){return this.computeGroupPropsOpts.label||"label"},computeGroupOptionsField:function(){return this.computeGroupPropsOpts.options||"options"},computeIsMaximize:function(){var e=this.value,t=this.multiple,i=this.max;return!(!t||!i)&&(_xeUtils.default.isArray(e)?e.length:_xeUtils.default.eqNull(e)?0:1)>=_xeUtils.default.toNumber(i)},computeSYOpts:function(){return Object.assign({},(0,_ui.getConfig)().select.virtualYConfig||(0,_ui.getConfig)().select.scrollY,this.virtualYConfig||this.scrollY)},computeRemoteOpts:function(){return Object.assign({},(0,_ui.getConfig)().select.remoteConfig,this.remoteConfig)},computeOptionOpts:function(){return Object.assign({},(0,_ui.getConfig)().select.optionConfig,this.optionConfig)},computeIsGroup:function(){return this.reactData.fullGroupList.some(function(e){return e.options&&e.options.length})},computeMultiMaxCharNum:function(){return _xeUtils.default.toNumber(this.multiCharOverflow)},computeSelectLabel:function(){var t=this,e=t.reactData,i=t.value,n=t.remote,l=t.multiple,e=e.reactFlag,a=t.computeMultiMaxCharNum;return _xeUtils.default.eqNull(i)?"":(i=_xeUtils.default.isArray(i)?i:[i],(n&&e?i.map(function(e){return t.getRemoteSelectLabel(e)}):i.map(function(e){e=t.getSelectLabel(e);return l&&0<a&&e.length>a?"".concat(e.substring(0,a),"..."):e})).join(", "))}}),methods:{dispatchEvent:function(e,t,i){this.$emit(e,(0,_ui.createEvent)(i,{$select:this},t))},emitModel:function(e){var t=this._events;t&&t.modelValue?this.$emit("modelValue",e):this.$emit("model-value",e)},isPanelVisible:function(){return this.reactData.visiblePanel},togglePanel:function(){return this.reactData.visiblePanel?this.hideOptionPanel():this.showOptionPanel(),this.$nextTick()},hidePanel:function(){return this.reactData.visiblePanel&&this.hideOptionPanel(),this.$nextTick()},showPanel:function(){return this.reactData.visiblePanel||this.showOptionPanel(),this.$nextTick()},focus:function(){var e=this.reactData,t=this.$refs.refInput;return e.isActivated=!0,t.blur(),this.$nextTick()},blur:function(){var e=this.reactData;return this.$refs.refInput.blur(),e.isActivated=!1,this.$nextTick()},callSlot:function(e,t,i){var n=this.$scopedSlots;return e&&(_xeUtils.default.isString(e)&&(e=n[e]||null),_xeUtils.default.isFunction(e))?(0,_vn.getSlotVNs)(e.call(this,t,i)):[]},getOptKey:function(){return this.computeOptionOpts.keyField||this.optionId||"_X_OPTION_KEY"},getOptId:function(e){e=e[this.getOptKey()];return e?encodeURIComponent(e):""},getRemoteSelectLabel:function(e){var t=this.internalData,i=t.remoteValMaps,n=this.computeLabelField,i=i[e]||t.optFullValMaps[e],t=i?i.item:null;return _xeUtils.default.toValueString(t?t[n]:e)},getSelectLabel:function(e){var t=this.reactData,i=this.internalData.optFullValMaps,n=this.computeLabelField,t=t.reactFlag?i[e]:null;return t?t.item[n]:_xeUtils.default.toValueString(e)},getOptkey:function(){return this.computeOptionOpts.keyField||this.optionId||"_X_OPTION_KEY"},getOptid:function(e){e=e[this.getOptkey()];return e?encodeURIComponent(e):""},handleOption:function(){var t=this,e=t.reactData,i=t.internalData,n=t.value,l=t.filterable,a=t.filterMethod,o=e.searchValue,r=i.fullData,s=i.optFullValMaps,c=t.computeLabelField,u=t.computeValueField,p="".concat(o||"").toLowerCase(),i=[];return(i=l&&a?r.filter(function(e){return isOptionVisible(e)&&a({$select:t,group:null,option:e,searchValue:o,value:n})}):l?r.filter(function(e){return isOptionVisible(e)&&(!p||-1<"".concat(e[c]).toLowerCase().indexOf(p))}):r.filter(isOptionVisible)).forEach(function(e,t){e=s[e[u]];e&&(e._index=t)}),e.afterVisibleList=i,t.$nextTick()},refreshOption:function(){return this.handleOption(),this.updateYData(),this.$nextTick()},cacheItemMap:function(e){function t(e){u.push(e);var t=i.getOptId(e);t||(t=getOptUniqueId(),e[r]=t),c[e[o]]={key:t,item:e,_index:-1}}var i=this,n=i.reactData,l=i.internalData,a=i.computeGroupOptionsField,o=i.computeValueField,r=i.getOptKey(),s={},c={},u=[];e.forEach(function(e){t(e),e[a]&&(s[e[r]]=e)[a].forEach(t)}),l.fullData=u,l.optGroupKeyMaps=s,l.optFullValMaps=c,n.reactFlag++,i.handleOption()},setCurrentOption:function(e){var t=this.reactData;e&&(t.currentOption=e)},scrollToOption:function(n,l){var a=this;return a.$nextTick().then(function(){var e,t,i;n&&(e=a.$refs.refOptionWrapper,t=a.$refs.refOptionPanel.querySelector("[optid='".concat(a.getOptid(n),"']")),e)&&t&&(i=e.offsetHeight,l?t.offsetTop+t.offsetHeight-e.scrollTop>i&&(e.scrollTop=t.offsetTop+t.offsetHeight-i):(t.offsetTop+5<e.scrollTop||t.offsetTop+5>e.scrollTop+e.clientHeight)&&(e.scrollTop=t.offsetTop-5))})},updateZindex:function(){var e=this.reactData;e.panelIndex<(0,_utils.getLastZIndex)()&&(e.panelIndex=(0,_utils.nextZIndex)())},updateZIndex:function(){var e=this.reactData;e.panelIndex<(0,_utils.getLastZIndex)()&&(e.panelIndex=(0,_utils.nextZIndex)())},updatePlacement:function(){function e(){var e=(0,_dom.updatePanelPlacement)(a,o,{placement:n,teleportTo:r}),t=Object.assign(e.style,{zIndex:l});i.panelStyle=t,i.panelPlacement=e.placement}var t=this,i=t.reactData,n=t.placement,l=i.panelIndex,a=t.$refs.refElem,o=t.$refs.refOptionPanel,r=t.computeBtnTransfer;return e(),t.$nextTick().then(e)},showOptionPanel:function(){var e=this,t=e.reactData,i=e.internalData,n=e.loading,l=e.filterable,a=e.remote,o=i.fullData,r=i.hpTimeout,s=e.computeRemoteOpts;n||e.computeIsDisabled||(r&&(clearTimeout(r),i.hpTimeout=void 0),t.initialized||(t.initialized=!0,n=e.computeBtnTransfer,r=e.$refs.refOptionPanel,n&&r&&document.body.appendChild(r)),t.isActivated=!0,t.isAniVisible=!0,l&&(a&&s.enabled&&s.autoLoad&&!o.length?e.triggerSearchEvent():(e.handleOption(),e.updateYData())),setTimeout(function(){t.visiblePanel=!0,e.handleFocusSearch(),e.recalculate().then(function(){return e.refreshScroll()})},10),setTimeout(function(){e.recalculate().then(function(){return e.refreshScroll()})},100),e.updateZIndex(),e.updatePlacement(),e.dispatchEvent("visible-change",{visible:!0},null))},hideOptionPanel:function(){var e=this.reactData,t=this.internalData;e.searchValue="",e.searchLoading=!1,e.visiblePanel=!1,t.hpTimeout=setTimeout(function(){e.isAniVisible=!1},350),this.dispatchEvent("visible-change",{visible:!1},null)},changeEvent:function(e,t){var i=this,n=i,l=i.$xeForm,a=i.formItemInfo;i.emitModel(t),t!==n.value&&(i.dispatchEvent("change",{value:t},e),l)&&a&&l.triggerItemEvent(e,a.itemConfig.field,t)},clearValueEvent:function(e,t){this.internalData.remoteValMaps={},this.changeEvent(e,t),this.dispatchEvent("clear",{value:t},e)},clearEvent:function(e){e=e.$event;this.clearValueEvent(e,null),this.hideOptionPanel()},changeOptionEvent:function(e,t){var i=this,n=i.reactData,l=i.value,a=i.multiple,o=i.internalData.remoteValMaps,r=t[i.computeValueField],s=o[r];n.visiblePanel&&(s?s.item=t:o[r]={key:i.getOptId(t),item:t,_index:-1},a?(s=[],o=_xeUtils.default.eqNull(l)?[]:_xeUtils.default.isArray(l)?l:[l],s=-1===_xeUtils.default.findIndexOf(o,function(e){return e===r})?o.concat([r]):o.filter(function(e){return e!==r}),i.changeEvent(e,s)):(i.changeEvent(e,r),i.hideOptionPanel()),n.reactFlag++)},handleGlobalMousewheelEvent:function(e){var t=this,i=t.reactData.visiblePanel;t.computeIsDisabled||i&&(i=t.$refs.refOptionPanel,(0,_dom.getEventTargetNode)(e,i).flag?t.updatePlacement():t.hideOptionPanel())},handleGlobalMousedownEvent:function(e){var t,i,n=this,l=n.reactData,a=l.visiblePanel;n.computeIsDisabled||(t=n.$refs.refElem,i=n.$refs.refOptionPanel,l.isActivated=(0,_dom.getEventTargetNode)(e,t).flag||(0,_dom.getEventTargetNode)(e,i).flag,a&&!l.isActivated&&n.hideOptionPanel())},validOffsetOption:function(e){var t=e.disabled,e=this.getOptId(e);return!t&&!this.hasOptGroupById(e)},findOffsetOption:function(e,t){var i=this,n=i.reactData,l=i.internalData,a=i.allowCreate,o=n.afterVisibleList,n=n.optList,r=l.optFullValMaps,l=l.optAddMaps,s=i.computeValueField,c=o,o=0;if(a&&n.length&&(a=n[0],l[n=i.getOptId(a)])&&(o=1,c=[l[n]].concat(c)),!e)if(t)for(var u=0;u<c.length;u++){var p=c[u];if(i.validOffsetOption(p))return p}else for(var f=c.length-1;0<=f;f--){var d=c[f];if(i.validOffsetOption(d))return d}a=0,l=e?r[e[s]]:null;if(-1<(a=l?l._index+o:a))if(t)for(var h=a+1;h<=c.length-1;h++){var v=c[h];if(i.validOffsetOption(v))return v}else if(0<a)for(var m=a-1;0<=m;m--){var g=c[m];if(i.validOffsetOption(g))return g}return null},handleGlobalKeydownEvent:function(e){var t,i,n,l,a,o,r,s=this,c=s.reactData,u=s.clearable,p=c.visiblePanel,f=c.currentOption;s.computeIsDisabled||(t=_ui.globalEvents.hasKey(e,_ui.GLOBAL_EVENT_KEYS.TAB),i=_ui.globalEvents.hasKey(e,_ui.GLOBAL_EVENT_KEYS.ENTER),n=_ui.globalEvents.hasKey(e,_ui.GLOBAL_EVENT_KEYS.ESCAPE),l=_ui.globalEvents.hasKey(e,_ui.GLOBAL_EVENT_KEYS.ARROW_UP),a=_ui.globalEvents.hasKey(e,_ui.GLOBAL_EVENT_KEYS.ARROW_DOWN),o=_ui.globalEvents.hasKey(e,_ui.GLOBAL_EVENT_KEYS.DELETE),r=_ui.globalEvents.hasKey(e,_ui.GLOBAL_EVENT_KEYS.SPACEBAR),t&&(c.isActivated=!1),p?n||t?s.hideOptionPanel():i?f&&(e.preventDefault(),e.stopPropagation(),s.changeOptionEvent(e,f)):l||a?(e.preventDefault(),(p=(p=s.findOffsetOption(f,a))||s.findOffsetOption(null,a))&&(s.setCurrentOption(p),s.handleScrollToOption(p,a))):r&&e.preventDefault():(l||a||i||r)&&c.isActivated&&(e.preventDefault(),s.showOptionPanel()),c.isActivated&&o&&u&&s.clearValueEvent(e,null))},handleGlobalBlurEvent:function(){this.hideOptionPanel()},handleFocusSearch:function(){var t=this;t.filterable&&t.$nextTick(function(){var e=t.$refs.refInpSearch;e&&e.focus()})},focusEvent:function(e){var t=this.reactData;this.computeIsDisabled||t.visiblePanel||(t.triggerFocusPanel=!0,this.showOptionPanel(),setTimeout(function(){t.triggerFocusPanel=!1},500)),this.dispatchEvent("focus",{},e)},clickEvent:function(e){var t=this.reactData;this.togglePanelEvent(e),this.dispatchEvent("click",{triggerButton:!1,visible:t.visiblePanel},e)},blurEvent:function(e){this.reactData.isActivated=!1,this.dispatchEvent("blur",{},e)},suffixClickEvent:function(e){var t=this.reactData;this.togglePanelEvent(e),this.dispatchEvent("click",{triggerButton:!0,visible:t.visiblePanel},e)},modelSearchEvent:function(e){this.reactData.searchValue=e},focusSearchEvent:function(){this.reactData.isActivated=!0},handleSearchEvent:function(){var e=this,t=e.reactData,i=e.value,n=t.searchValue,l=e.computeRemoteOpts,a=l.queryMethod||e.remoteMethod;e.remote&&a&&l.enabled?(t.searchLoading=!0,Promise.resolve(a({$select:e,searchValue:n,value:i})).then(function(){return e.$nextTick()}).catch(function(){return e.$nextTick()}).finally(function(){t.searchLoading=!1,e.handleOption(),e.updateYData()})):(e.handleOption(),e.updateYData())},triggerSearchEvent:_xeUtils.default.debounce(function(){this.handleSearchEvent()},350,{trailing:!0}),togglePanelEvent:function(e){var t=this.reactData;e.$event.preventDefault(),t.triggerFocusPanel?t.triggerFocusPanel=!1:t.visiblePanel?this.hideOptionPanel():this.showOptionPanel()},checkOptionDisabled:function(e,t,i){return!!t.disabled||!(!i||!i.disabled)||!(!this.computeIsMaximize||e)},updateYSpace:function(){var e=this.reactData,t=this.internalData,i=e.scrollYLoad,t=t.scrollYStore;e.bodyHeight=i?e.afterVisibleList.length*t.rowHeight:0,e.topSpaceHeight=i?Math.max(t.startIndex*t.rowHeight,0):0},handleData:function(){var e=this,t=e.reactData,i=e.internalData,n=e.filterable,l=e.allowCreate,a=t.scrollYLoad,o=t.afterVisibleList,r=t.searchValue,s=i.optAddMaps,i=i.scrollYStore,c=e.computeLabelField,u=e.computeValueField,a=a?o.slice(i.startIndex,i.endIndex):o.slice(0);return n&&l&&r&&(a.some(function(e){return e[c]===r})||(i=s[r]||_defineProperty(_defineProperty(_defineProperty({},e.getOptKey(),r),c,r),u,r),s[r]=i,a.unshift(i))),t.optList=a,e.$nextTick()},updateYData:function(){this.handleData(),this.updateYSpace()},computeScrollLoad:function(){var o=this,r=o.reactData,s=o.internalData;return o.$nextTick().then(function(){var e,t=r.scrollYLoad,i=s.scrollYStore,n=o.$refs.refVirtualBody,l=o.computeSYOpts,a=0;(e=n?(e=l.sItem?n.querySelector(l.sItem):e)||n.children[0]:e)&&(a=e.offsetHeight),a=Math.max(20,a),i.rowHeight=a,t?(n=o.$refs.refVirtualWrapper,e=Math.max(8,n?Math.ceil(n.clientHeight/a):0),t=Math.max(0,Math.min(2,_xeUtils.default.toNumber(l.oSize))),i.offsetSize=t,i.visibleSize=e,i.endIndex=Math.max(i.startIndex,e+t,i.endIndex),o.updateYData()):o.updateYSpace()})},handleScrollToOption:function(e,t){var i,n=this,l=n.reactData,a=n.internalData,l=l.scrollYLoad,o=a.optFullValMaps,a=a.scrollYStore,o=o[e[n.computeValueField]];o&&(e=o.key,-1<(o=o._index))&&(i=n.$refs.refVirtualWrapper,n=n.$refs.refOptionPanel.querySelector("[optid='".concat(e,"']")),i)&&(n?(e=i.offsetHeight,t?n.offsetTop+n.offsetHeight-i.scrollTop>e?i.scrollTop=n.offsetTop+n.offsetHeight-e:(n.offsetTop+1<i.scrollTop||n.offsetTop+1>i.scrollTop+i.clientHeight)&&(i.scrollTop=n.offsetTop-1):n.offsetTop+1<i.scrollTop||n.offsetTop+1>i.scrollTop+i.clientHeight?i.scrollTop=n.offsetTop-1:n.offsetTop+n.offsetHeight-i.scrollTop>e&&(i.scrollTop=n.offsetTop+n.offsetHeight-e)):l&&(i.scrollTop=t?o*a.rowHeight-i.clientHeight+a.rowHeight:o*a.rowHeight))},scrollTo:function(e,t){var i=this,n=i.reactData,l=i.$refs.refVirtualWrapper;return l&&(_xeUtils.default.isNumber(e)&&(l.scrollLeft=e),_xeUtils.default.isNumber(t))&&(l.scrollTop=t),n.scrollYLoad?new Promise(function(e){setTimeout(function(){i.$nextTick(function(){e()})},50)}):i.$nextTick()},refreshScroll:function(){var e=this,t=e.internalData,i=t.lastScrollLeft,n=t.lastScrollTop;return e.clearScroll().then(function(){if(i||n)return t.lastScrollLeft=0,t.lastScrollTop=0,e.scrollTo(i,n)})},recalculate:function(){var e=this.$refs.refElem;return e&&e.clientWidth&&e.clientHeight?this.computeScrollLoad():Promise.resolve()},loadYData:function(e){var t=this.internalData.scrollYStore,i=t.startIndex,n=t.endIndex,l=t.visibleSize,a=t.offsetSize,e=e.target.scrollTop,e=Math.floor(e/t.rowHeight),o=Math.max(0,e-1-a),a=e+l+a;!(e<=i||n-l-1<=e)||i===o&&n===a||(t.startIndex=o,t.endIndex=a,this.updateYData())},isVMScrollProcess:function(){var e=this.internalData.lastScrollTime;return!!(e&&Date.now()<e+250)},scrollEvent:function(e){var t=this.reactData,i=this.internalData,n=e.target,l=n.scrollTop,n=n.scrollLeft,a=n!==i.lastScrollLeft,o=l!==i.lastScrollTop;i.lastScrollTop=l,i.lastScrollLeft=n,t.scrollYLoad&&this.loadYData(e),i.lastScrollTime=Date.now(),this.dispatchEvent("scroll",{scrollLeft:n,scrollTop:l,isX:a,isY:o},e)},loadData:function(e){var t,i=this,n=i,l=i.reactData,a=i.internalData,o=(i.cacheItemMap(e||[]),a.isLoaded),r=a.fullData,s=a.scrollYStore,c=i.computeDefaultOpts,u=i.computeSYOpts,p=i.computeValueField;return Object.assign(s,{startIndex:0,endIndex:1,visibleSize:0}),a.synchData=e||[],l.scrollYLoad=!!u.enabled&&-1<u.gt&&(0===u.gt||u.gt<=r.length),i.handleData(),o||(s=c.selectMode,0<e.length&&_xeUtils.default.eqNull(n.value)&&("first"!==s&&"last"!==s||(t=_xeUtils.default[s](e))&&i.$nextTick(function(){_xeUtils.default.eqNull(n.value)&&i.emitModel(t[p])}),a.isLoaded=!0)),i.computeScrollLoad().then(function(){i.refreshScroll()})},reloadData:function(e){return this.internalData.isLoaded=!1,this.clearScroll(),this.loadData(e)},clearScroll:function(){var e=this.internalData,t=this.$refs.refVirtualWrapper;return t&&(t.scrollTop=0,t.scrollLeft=0),e.lastScrollTop=0,e.lastScrollLeft=0,this.$nextTick()},hasOptGroupById:function(e){return!!this.internalData.optGroupKeyMaps[e]},renderOption:function(p,e,f){var d=this,t=d.$scopedSlots,h=d.allowCreate,v=d.optionKey,m=d.value,g=d.reactData.currentOption,b=d.internalData.optAddMaps,x=d.computeLabelField,O=d.computeValueField,_=d.computeGroupLabelField,E=d.computeOptionOpts.useKey,y=t.option;return e.map(function(t,e){var i=t.slots,n=t.className,l=d.getOptId(t),a=t[O],o=d.hasOptGroupById(l),r=!(!h||!b[l]),a=!r&&(_xeUtils.default.isArray(m)?-1<m.indexOf(a):m===a),s=r||!o||isOptionVisible(t),c=!r&&d.checkOptionDisabled(a,t,f),i=i?i.default:null,u={option:t,group:null,$select:d},i=y?d.callSlot(y,u,p):i?d.callSlot(i,u,p):(0,_utils.getFuncText)(t[o?_:x]);return s?p("div",{key:E||v?l:e,class:["vxe-select-option",n?_xeUtils.default.isFunction(n)?n(u):n:"",{"vxe-select-optgroup":o,"is--disabled":c,"is--selected":a,"is--add":r,"is--hover":g&&d.getOptId(g)===l}],attrs:{optid:l},on:{mousedown:function(e){0===e.button&&e.stopPropagation()},click:function(e){c||o||d.changeOptionEvent(e,t)},mouseenter:function(){c||o||d.isVMScrollProcess()||d.setCurrentOption(t)}}},h?[p("span",{key:1,class:"vxe-select-option--label"},i),r?p("span",{key:2,class:"vxe-select-option--add-icon"},[p("i",{class:(0,_ui.getIcon)().ADD_OPTION})]):(0,_ui.renderEmptyElement)(d)]:i):(0,_ui.renderEmptyElement)(d)})},renderOpts:function(e){var t=this.reactData,i=t.optList;return t.searchLoading?[e("div",{class:"vxe-select--search-loading"},[e("i",{class:["vxe-select--search-icon",(0,_ui.getIcon)().SELECT_LOADED]}),e("span",{class:"vxe-select--search-text"},(0,_ui.getI18n)("vxe.select.loadingText"))])]:i.length?this.renderOption(e,i):[e("div",{class:"vxe-select--empty-placeholder"},this.emptyText||(0,_ui.getI18n)("vxe.select.emptyText"))]},renderVN:function(e){var t=this,i=t,n=t.$scopedSlots,l=t.reactData,a=i.className,o=i.popupClassName,r=i.loading,s=i.filterable,c=l.initialized,u=l.isActivated,p=l.isAniVisible,f=l.visiblePanel,d=l.bodyHeight,h=l.topSpaceHeight,v=t.computeSize,m=t.computeIsDisabled,g=t.computeSelectLabel,b=t.computeBtnTransfer,x=t.computeInpPlaceholder,O=n.default,_=n.header,E=n.footer,y=n.prefix;return t.computeFormReadonly?e("div",{ref:"refElem",class:["vxe-select--readonly",a]},[e("div",{class:"vxe-select-slots",ref:"hideOption"},O?t.callSlot(O,{},e):[]),e("span",{class:"vxe-select-label"},g)]):e("div",{ref:"refElem",class:["vxe-select",a?_xeUtils.default.isFunction(a)?a({$select:t}):a:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(v),v),"is--visible",f),"is--disabled",m),"is--filter",s),"is--loading",r),"is--active",u)]},[e("div",{class:"vxe-select-slots",ref:"hideOption"},O?O.call(t,{}):[]),e(_input.default,{ref:"refInput",props:{clearable:i.clearable,placeholder:x,readonly:!0,disabled:m,type:"text",prefixIcon:i.prefixIcon,suffixIcon:r?(0,_ui.getIcon)().SELECT_LOADED:f?(0,_ui.getIcon)().SELECT_OPEN:(0,_ui.getIcon)().SELECT_CLOSE,autoFocus:!1,value:g},on:{clear:t.clearEvent,click:t.clickEvent,focus:t.focusEvent,blur:t.blurEvent,"suffix-click":t.suffixClickEvent},scopedSlots:y?{prefix:function(){return y({})}}:{}}),e("div",{ref:"refOptionPanel",class:["vxe-table--ignore-clear vxe-select--panel",o?_xeUtils.default.isFunction(o)?o({$select:t}):o:"",_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(v),v),"is--transfer",b),"ani--leave",!r&&p),"ani--enter",!r&&f)],attrs:{placement:l.panelPlacement},style:l.panelStyle},c&&(f||p)?[e("div",{class:"vxe-select--panel-wrapper"},[s?e("div",{class:"vxe-select--panel-search"},[e(_input.default,{ref:"refInpSearch",class:"vxe-select-search--input",props:{value:l.searchValue,clearable:!0,disabled:!1,readonly:!1,placeholder:(0,_ui.getI18n)("vxe.select.search"),prefixIcon:(0,_ui.getIcon)().INPUT_SEARCH},on:{"model-value":t.modelSearchEvent,focus:t.focusSearchEvent,change:t.triggerSearchEvent,search:t.triggerSearchEvent}})]):(0,_ui.renderEmptyElement)(t),_?e("div",{class:"vxe-select--panel-header"},t.callSlot(_,{},e)):(0,_ui.renderEmptyElement)(t),e("div",{class:"vxe-select--panel-body"},[e("div",{ref:"refVirtualWrapper",class:"vxe-select-option--wrapper",on:{scroll:t.scrollEvent}},[e("div",{class:"vxe-select--y-space",style:{height:d?"".concat(d,"px"):""}}),e("div",{ref:"refVirtualBody",class:"vxe-select--body",style:{marginTop:h?"".concat(h,"px"):""}},t.renderOpts(e))])]),E?e("div",{class:"vxe-select--panel-footer"},t.callSlot(E,{},e)):(0,_ui.renderEmptyElement)(t)])]:[])])}},watch:{"reactData.staticOptions":function(e){this.loadData(e)},options:function(e){this.loadData(e)},optionGroups:function(e){this.loadData(e)}},mounted:function(){var i=this,n=i;i.$nextTick(function(){var e=n.options,t=n.optionGroups;t?i.loadData(t):e&&i.loadData(e)}),_ui.globalEvents.on(i,"mousewheel",i.handleGlobalMousewheelEvent),_ui.globalEvents.on(i,"mousedown",i.handleGlobalMousedownEvent),_ui.globalEvents.on(i,"keydown",i.handleGlobalKeydownEvent),_ui.globalEvents.on(i,"blur",i.handleGlobalBlurEvent)},beforeDestroy:function(){var e=this,t=e.$refs.refOptionPanel;t&&t.parentNode&&t.parentNode.removeChild(t),_ui.globalEvents.off(e,"mousewheel"),_ui.globalEvents.off(e,"mousedown"),_ui.globalEvents.off(e,"keydown"),_ui.globalEvents.off(e,"blur")},render:function(e){return this.renderVN(e)}});