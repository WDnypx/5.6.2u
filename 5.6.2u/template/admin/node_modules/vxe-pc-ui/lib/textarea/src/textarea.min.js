Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var autoTxtElem,_comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_utils=require("../../ui/src/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var _default2=exports.default=(0,_comp.defineVxeComponent)({name:"VxeTextarea",model:{prop:"value",event:"modelValue"},mixins:[_ui.globalMixins.sizeMixin],props:{value:[String,Number],className:String,immediate:{type:Boolean,default:!0},name:String,readonly:{type:Boolean,default:null},editable:{type:Boolean,default:!0},disabled:{type:Boolean,default:null},placeholder:String,maxLength:[String,Number],rows:{type:[String,Number],default:null},cols:{type:[String,Number],default:null},showWordCount:Boolean,countMethod:Function,autosize:[Boolean,Object],form:String,resize:{type:String,default:function(){return(0,_ui.getConfig)().textarea.resize}},size:{type:String,default:function(){return(0,_ui.getConfig)().textarea.size||(0,_ui.getConfig)().size}},maxlength:[String,Number]},inject:{$xeForm:{default:null},formItemInfo:{from:"xeFormItemInfo",default:null}},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{inputValue:""}}},computed:Object.assign(Object.assign({},{}),{computeFormReadonly:function(){var e=this.$xeForm,t=this.readonly;return null===t?!!e&&e.readonly:t},computeIsDisabled:function(){var e=this.$xeForm,t=this.disabled;return null===t?!!e&&e.disabled:t},computeInputReadonly:function(){var e=this.editable;return this.computeFormReadonly||!e},computeInpPlaceholder:function(){var e=this.placeholder;return(e=e||(0,_ui.getConfig)().textarea.placeholder)?(0,_utils.getFuncText)(e):(0,_ui.getI18n)("vxe.base.pleaseInput")},computeInpMaxLength:function(){var e=this.maxLength,t=this.maxlength;return e||t},computeInputCount:function(){var e=this.reactData;return _xeUtils.default.getSize(e.inputValue)},computeIsCountError:function(){var e=this.computeInputCount,t=this.computeInpMaxLength;return t&&e>_xeUtils.default.toNumber(t)},computeSizeOpts:function(){return Object.assign({minRows:1,maxRows:10},(0,_ui.getConfig)().textarea.autosize,this.autosize)}}),methods:{dispatchEvent:function(e,t,n){this.$emit(e,(0,_ui.createEvent)(n,{$textarea:this},t))},emitModel:function(e){var t=this._events;t&&t.modelValue?this.$emit("modelValue",e):this.$emit("model-value",e)},focus:function(){return this.$refs.refTextarea.focus(),this.$nextTick()},blur:function(){return this.$refs.refTextarea.blur(),this.$nextTick()},updateAutoTxt:function(){var e,t=this.reactData,n=this.size,i=this.autosize,t=t.inputValue;i&&((autoTxtElem=autoTxtElem||document.createElement("div")).parentNode||document.body.appendChild(autoTxtElem),i=this.$refs.refTextarea)&&(e=getComputedStyle(i),autoTxtElem.className=["vxe-textarea--autosize",n?"size--".concat(n):""].join(" "),autoTxtElem.style.width="".concat(i.clientWidth,"px"),autoTxtElem.style.padding=e.padding,autoTxtElem.innerText=(""+(t||"　")).replace(/\n$/,"\n　"))},handleResize:function(){var u=this;u.autosize&&u.$nextTick(function(){var e,t,n,i,a=u.computeSizeOpts,r=a.minRows,a=a.maxRows,o=u.$refs.refTextarea;o&&(t=autoTxtElem.clientHeight,n=getComputedStyle(o),e=_xeUtils.default.toNumber(n.lineHeight),(i=n=(n=(t-(t=_xeUtils.default.toNumber(n.paddingTop)+_xeUtils.default.toNumber(n.paddingBottom)+_xeUtils.default.toNumber(n.borderTopWidth)+_xeUtils.default.toNumber(n.borderBottomWidth)))/e)&&/[0-9]/.test(""+n)?n:Math.floor(n)+1)<r?i=r:a<n&&(i=a),o.style.height="".concat(i*e+t,"px"))})},triggerEvent:function(e){var t=this.reactData.inputValue;this.dispatchEvent(e.type,{value:t},e)},handleChange:function(e,t){var n=this,i=n,a=n.reactData,r=n.$xeForm,o=n.formItemInfo;a.inputValue=e,n.emitModel(e),_xeUtils.default.toValueString(i.value)!==e&&(n.dispatchEvent("change",{value:e},t),r)&&o&&r.triggerItemEvent(t,o.itemConfig.field,e)},inputEvent:function(e){var t=this,n=t.reactData,i=t.immediate,a=e.target.value;n.inputValue=a,i&&t.handleChange(a,e),t.dispatchEvent("input",{value:a},e),t.handleResize()},changeEvent:function(e){var t=this.reactData;this.immediate?this.triggerEvent(e):this.handleChange(t.inputValue,e)},blurEvent:function(e){var t=this.reactData,n=this.immediate,t=t.inputValue;n||this.handleChange(t,e),this.dispatchEvent("blur",{value:t},e)},renderVN:function(e){var t=this,n=t,i=t.reactData,a=n.className,r=n.resize,o=n.autosize,u=n.showWordCount,l=n.countMethod,s=n.rows,c=n.cols,i=i.inputValue,d=t.computeSize,p=t.computeIsDisabled,m=t.computeIsCountError,f=t.computeInputCount,h=t.computeInputReadonly,x=t.computeInpPlaceholder,g=t.computeInpMaxLength;return t.computeFormReadonly?e("div",{ref:"refElem",class:["vxe-textarea--readonly",a]},i):e("div",{ref:"refElem",class:["vxe-textarea",a,_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},"size--".concat(d),d),"is--autosize",o),"is--count",u),"is--disabled",p),"is--rows",!_xeUtils.default.eqNull(s)),"is--cols",!_xeUtils.default.eqNull(c))],attrs:{spellcheck:!1}},[e("textarea",{ref:"refTextarea",class:"vxe-textarea--inner",domProps:{value:i},attrs:{name:n.name,placeholder:x,maxlength:g,readonly:h,disabled:p,rows:s,cols:c},style:r?{resize:r}:{},on:{input:t.inputEvent,change:t.changeEvent,keydown:t.triggerEvent,keyup:t.triggerEvent,click:t.triggerEvent,focus:t.triggerEvent,blur:t.blurEvent}}),u?e("span",{class:["vxe-textarea--count",{"is--error":m}]},l?"".concat(l({value:i})):"".concat(f).concat(g?"/".concat(g):"")):null])}},watch:{value:function(e){this.reactData.inputValue=e,this.updateAutoTxt()},computeSizeOpts:function(){this.updateAutoTxt(),this.handleResize()}},created:function(){var e=this,t=e;e.reactData.inputValue=t.value,e.$nextTick(function(){t.autosize&&(e.updateAutoTxt(),e.handleResize())})},render:function(e){return this.renderVN(e)}});