Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _comp=require("../../ui/src/comp"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_dom=require("../../ui/src/dom"),_anchorLink=_interopRequireDefault(require("./anchor-link"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=exports.default=(0,_comp.defineVxeComponent)({name:"VxeAnchor",props:{value:String,options:Array,container:[String,Object,Function],showMarker:{type:Boolean,default:!0}},provide:function(){return{$xeAnchor:this}},data:function(){return{xID:_xeUtils.default.uniqueId(),reactData:{activeHref:null,staticLinks:[],containerElem:null}}},computed:{computeAllHrefList:function(){var e=this.reactData,t=[];return _xeUtils.default.eachTree(e.staticLinks,function(e){t.push(e.href||"")},{children:"children"}),t}},watch:{value:function(e){this.reactData.activeHref=e},"reactData.activeHref":function(){this.updateMarkerPos()},container:function(){this.removeContainerElemScroll(),this.updateContainerElem()}},methods:{dispatchEvent:function(e,t,r){this.$emit(e,(0,_ui.createEvent)(r,{$anchor:this},t))},getContainerElem:function(){var e=this.container;if(e){if(_xeUtils.default.isElement(e))return e;if(_xeUtils.default.isString(e))return document.querySelector(e);if(_xeUtils.default.isFunction(e))return e({$anchor:this})}return null},emitEvent:function(e){var t=this,r=t.reactData,n=t._events;r.activeHref=e,t.$emit("input",e),n&&n.modelValue?t.$emit("modelValue",e):t.$emit("model-value",e)},handleContainerScrollEvent:function(){var e=this.reactData,t=this.computeAllHrefList,r=e.containerElem;if(r)for(var n=r.querySelectorAll(t.map(function(e){return"".concat(e)}).join(",")),i=0;i<n.length;i++){var a=n[i];if(0<a.getBoundingClientRect().top){a=a.id;e.activeHref="#".concat(a);break}}},removeContainerElemScroll:function(){var e=this.reactData.containerElem;e&&e.removeEventListener("scroll",this.handleContainerScrollEvent)},updateContainerElem:function(){var e=this,t=e.reactData,r=e.getContainerElem();(t.containerElem=r)&&r.addEventListener("scroll",e.handleContainerScrollEvent,{passive:!1})},updateMarkerPos:function(){var n=this,i=n.reactData;n.$nextTick(function(){var e=i.activeHref,t=n.$refs.refElem,r=n.$refs.refMarkerElem;t&&r&&e&&(e=t.querySelector('[href="'.concat(e,'"]')))&&(e=(0,_dom.getOffsetPos)(e,t).top,r.style.top="".concat(e,"px"))})},handleClickLink:function(e,t){e.preventDefault();var r=document.getElementById("".concat(t).replace("#",""));r&&r.scrollIntoView({behavior:"smooth"}),this.emitEvent(t),this.dispatchEvent("click",{href:t},e)},renderSubItems:function(r,e){var n=this,i=[];return e&&e.forEach(function(e){var t=e.children;t&&t.length?i.push(r(_anchorLink.default,{props:{content:e.content,title:e.title,href:e.href},scopedSlots:{sub:function(){return n.renderSubItems(r,t)}}})):i.push(r(_anchorLink.default,{props:{content:e.content,title:e.title,href:e.href}}))}),i},renderVN:function(e){var t=this.$scopedSlots,r=this.options,n=this.showMarker,t=t.default;return e("div",{ref:"refElem",class:["vxe-anchor",{"is--marker":n}]},[e("div",{class:"vxe-anchor--list"},t?t({}):this.renderSubItems(e,r)),n?e("div",{ref:"refMarkerElem",class:"vxe-anchor--marker"}):(0,_ui.renderEmptyElement)(this)])}},mounted:function(){var e=this;e.$nextTick(function(){e.updateContainerElem()})},beforeDestroy:function(){this.removeContainerElemScroll()},render:function(e){return this.renderVN(e)}});