Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDateByCode=getDateByCode,exports.getDateQuarter=getDateQuarter,exports.getRangeDateByCode=getRangeDateByCode,exports.parseDateObj=parseDateObj,exports.parseDateValue=exports.parseDateString=void 0,exports.toStringTimeDate=toStringTimeDate;var _xeUtils=_interopRequireDefault(require("xe-utils"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function toStringTimeDate(e){var t,a,r,s;return e?(t=new Date,s=r=a=0,_xeUtils.default.isDate(e)?(a=e.getHours(),r=e.getMinutes(),s=e.getSeconds()):(e=(e=_xeUtils.default.toValueString(e)).match(/^(\d{1,2})(:(\d{1,2}))?(:(\d{1,2}))?/))&&(a=_xeUtils.default.toNumber(e[1]),r=_xeUtils.default.toNumber(e[3]),s=_xeUtils.default.toNumber(e[5])),t.setHours(a),t.setMinutes(r),t.setSeconds(s),t):new Date("")}function getDateQuarter(e){e=e.getMonth();return e<3?1:e<6?2:e<9?3:4}var parseDateValue=exports.parseDateValue=function(e,t,a){a=a.valueFormat;return e?"time"===t?toStringTimeDate(e):_xeUtils.default.isNumber(e)||/^[0-9]{11,15}$/.test("".concat(e))?new Date(Number(e)):_xeUtils.default.isString(e)?_xeUtils.default.toStringDate(_xeUtils.default.last(e.split(",")),a):_xeUtils.default.toStringDate(e,a):null},parseDateString=exports.parseDateString=function(e,t,a){e=parseDateValue(e,t,a);return e?_xeUtils.default.toDateString(e,a.valueFormat):""};function parseDateObj(e,t,a){var r=a.labelFormat,s=a.firstDay,l=null,u="";return e&&(l=parseDateValue(e,t,a)),_xeUtils.default.isValidDate(l)?(u=_xeUtils.default.toDateString(l,r,{firstDay:s}),r&&"week"===t&&(e=_xeUtils.default.getYearWeek(l,s),(a=_xeUtils.default.getWhatWeek(l,0,1===e?(6+s)%7:s,s).getFullYear())!==l.getFullYear())&&-1<(t=r.indexOf("yyyy"))&&(e=Number(u.substring(t,t+4)))&&!isNaN(e)&&(u=u.replace("".concat(e),"".concat(a)))):l=null,{label:u,value:l}}function getDateByCode(e,t,a,r){var s=r.valueFormat,l=r.firstDay,u=null,i=("prev"===e||"next"===e?new Date:t?parseDateValue(t,a,r):null)||new Date;switch(e){case"prev":case"next":case"minus":case"plus":var n="plus"===e||"next"===e?1:-1;switch(a){case"date":case"datetime":u=_xeUtils.default.getWhatDay(i,n);break;case"week":u=_xeUtils.default.getWhatWeek(i,n,l,l);break;case"month":u=_xeUtils.default.getWhatMonth(i,n);break;case"quarter":u=_xeUtils.default.getWhatQuarter(i,n);break;case"year":u=_xeUtils.default.getWhatYear(i,n)}break;default:u=new Date}return{value:u?_xeUtils.default.toDateString(u,s):""}}var rangeDateOffsetNumMaps={last180:-180,last90:-90,last60:-60,last30:-30,last7:-7,last3:-3,last1:-1};function getRangeDateOffsetNum(e){return rangeDateOffsetNumMaps[e]||0}function getRangeDateByCode(e,t,a,r){var s=r.valueFormat,l=r.firstDay,u=((t=_xeUtils.default.isArray(t)?t.join(""):t)?parseDateValue(t,a,r):null)||new Date,i=null,t=u;switch(e){case"last1":case"last3":case"last7":case"last30":case"last60":case"last90":case"last180":var n=getRangeDateOffsetNum(e);switch(a){case"date":case"datetime":i=_xeUtils.default.getWhatDay(u,n);break;case"week":i=_xeUtils.default.getWhatWeek(u,n,l,l);break;case"month":i=_xeUtils.default.getWhatMonth(u,n);break;case"quarter":i=_xeUtils.default.getWhatQuarter(u,n);break;case"year":i=_xeUtils.default.getWhatYear(u,n)}break;default:i=new Date}return{startValue:i?_xeUtils.default.toDateString(i,s):"",endValue:t?_xeUtils.default.toDateString(t,s):""}}