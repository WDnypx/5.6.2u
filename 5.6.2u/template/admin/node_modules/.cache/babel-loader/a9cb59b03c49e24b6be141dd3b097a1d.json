{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\thread-loader\\dist\\cjs.js!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\babel-loader\\lib\\index.js!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\product\\productAdd\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\product\\productAdd\\index.vue","mtime":1751246651273},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\babel.config.js","mtime":1679965410000},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\.babelrc","mtime":1679965410000},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1753254256661},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1753254258567},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0FycmF5IGZyb20gIkQ6L3BjL3ptL1x1NjYwNlx1NjYwRVx1OTYxNFx1N0ZENFx1NzlEMVx1NjI4MFx1NjcwOVx1OTY1MFx1NTE2Q1x1NTNGOC9cdTZFOTBcdTc4MDEvQ1JNRUItQlogdjUuNi4yKDIwMjUwNjMwKS90ZW1wbGF0ZS9hZG1pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9BcnJheS5qcyI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiRDovcGMvem0vXHU2NjA2XHU2NjBFXHU5NjE0XHU3RkQ0XHU3OUQxXHU2MjgwXHU2NzA5XHU5NjUwXHU1MTZDXHU1M0Y4L1x1NkU5MFx1NzgwMS9DUk1FQi1CWiB2NS42LjIoMjAyNTA2MzApL3RlbXBsYXRlL2FkbWluL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eS5qcyI7CmltcG9ydCBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciBmcm9tICJEOi9wYy96bS9cdTY2MDZcdTY2MEVcdTk2MTRcdTdGRDRcdTc5RDFcdTYyODBcdTY3MDlcdTk2NTBcdTUxNkNcdTUzRjgvXHU2RTkwXHU3ODAxL0NSTUVCLUJaIHY1LjYuMigyMDI1MDYzMCkvdGVtcGxhdGUvYWRtaW4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIuanMiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkQ6L3BjL3ptL1x1NjYwNlx1NjYwRVx1OTYxNFx1N0ZENFx1NzlEMVx1NjI4MFx1NjcwOVx1OTY1MFx1NTE2Q1x1NTNGOC9cdTZFOTBcdTc4MDEvQ1JNRUItQlogdjUuNi4yKDIwMjUwNjMwKS90ZW1wbGF0ZS9hZG1pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkuanMiOwppbXBvcnQgX3JlZ2VuZXJhdG9yIGZyb20gIkQ6L3BjL3ptL1x1NjYwNlx1NjYwRVx1OTYxNFx1N0ZENFx1NzlEMVx1NjI4MFx1NjcwOVx1OTY1MFx1NTE2Q1x1NTNGOC9cdTZFOTBcdTc4MDEvQ1JNRUItQlogdjUuNi4yKDIwMjUwNjMwKS90ZW1wbGF0ZS9hZG1pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vcmVnZW5lcmF0b3IuanMiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRDovcGMvem0vXHU2NjA2XHU2NjBFXHU5NjE0XHU3RkQ0XHU3OUQxXHU2MjgwXHU2NzA5XHU5NjUwXHU1MTZDXHU1M0Y4L1x1NkU5MFx1NzgwMS9DUk1FQi1CWiB2NS42LjIoMjAyNTA2MzApL3RlbXBsYXRlL2FkbWluL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRDovcGMvem0vXHU2NjA2XHU2NjBFXHU5NjE0XHU3RkQ0XHU3OUQxXHU2MjgwXHU2NzA5XHU5NjUwXHU1MTZDXHU1M0Y4L1x1NkU5MFx1NzgwMS9DUk1FQi1CWiB2NS42LjIoMjAyNTA2MzApL3RlbXBsYXRlL2FkbWluL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mbGF0LW1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZyb20uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnVuc2NvcGFibGVzLmZsYXQtbWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmZsYXQtbWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5zb21lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi5zdHJpbmdpZnkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIudG8tZml4ZWQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmRpZmZlcmVuY2UudjIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zZXQuaW50ZXJzZWN0aW9uLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmlzLWRpc2pvaW50LWZyb20udjIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zZXQuaXMtc3Vic2V0LW9mLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmlzLXN1cGVyc2V0LW9mLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LnN5bW1ldHJpYy1kaWZmZXJlbmNlLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LnVuaW9uLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCB1c2VyTGFiZWwgZnJvbSAnQC9jb21wb25lbnRzL2xhYmVsTGlzdCc7CmltcG9ydCB1c2VMYWJlbCBmcm9tICdAL2NvbXBvbmVudHMvZ29vZHNMYWJlbC91c2VMYWJlbCc7CmltcG9ydCBnb29kc0xhYmVsIGZyb20gJ0AvY29tcG9uZW50cy9nb29kc0xhYmVsJzsKaW1wb3J0IHsgbWFwU3RhdGUgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHVwbG9hZFBpY3R1cmVzIGZyb20gJ0AvY29tcG9uZW50cy91cGxvYWRQaWN0dXJlcyc7CmltcG9ydCBmcmVpZ2h0VGVtcGxhdGUgZnJvbSAnQC9jb21wb25lbnRzL2ZyZWlnaHRUZW1wbGF0ZSc7CmltcG9ydCBjb3Vwb25MaXN0IGZyb20gJ0AvY29tcG9uZW50cy9jb3Vwb25MaXN0JzsKaW1wb3J0IGFkZEF0dHIgZnJvbSAnLi4vcHJvZHVjdEF0dHIvYWRkQXR0cic7CmltcG9ydCBnb29kc0xpc3QgZnJvbSAnQC9jb21wb25lbnRzL2dvb2RzTGlzdC9pbmRleCc7CmltcG9ydCB0YW9CYW8gZnJvbSAnLi90YW9CYW8nOwppbXBvcnQgeyB1c2VyTGFiZWxBZGRBcGkgfSBmcm9tICdAL2FwaS91c2VyJzsKaW1wb3J0IHsgcHJvZHVjdEluZm9BcGksIGNhc2NhZGVyTGlzdEFwaSwgcHJvZHVjdEFkZEFwaSwgZ2VuZXJhdGVBdHRyQXBpLCBwcm9kdWN0R2V0UnVsZUFwaSwgcHJvZHVjdEdldFRlbXBsYXRlQXBpLCBwcm9kdWN0R2V0VGVtcEtleXNBcGksIGNoZWNrQWN0aXZpdHlBcGksIHByb2R1Y3RDYWNoZSwgY2FjaGVEZWxldGUsIHVwbG9hZFR5cGUgYXMgX3VwbG9hZFR5cGUsIGltcG9ydENhcmQsIHByb2R1Y3RDcmVhdGVBcGksIGdldFByb2R1Y3RUeXBlQ29uZmlnLCBydWxlQWRkQXBpLCBwYXJhbUxpc3RBcGksIHBhcmFtSW5mb0FwaSwgcHJvZHVjdFByb3RlY3Rpb25MaXN0QXBpLCBwcm9kdWN0TGFiZWxVc2VMaXN0QXBpIH0gZnJvbSAnQC9hcGkvcHJvZHVjdCc7CmltcG9ydCBTZXR0aW5nIGZyb20gJ0Avc2V0dGluZyc7CmltcG9ydCB7IGdldENvb2tpZXMgfSBmcm9tICdAL2xpYnMvdXRpbCc7CmltcG9ydCB7IHVwbG9hZEJ5UGllY2VzIH0gZnJvbSAnQC91dGlscy91cGxvYWQnOyAvL+W8leWFpXVwbG9hZEJ5UGllY2Vz5pa55rOVCmltcG9ydCB7IGlzRmlsZVVwbG9hZCwgaXNWaWRlb1VwbG9hZCwgYXJyYXlzRXF1YWwgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IGNoZWNrQXJyYXkgZnJvbSAnQC9saWJzL3Blcm1pc3Npb24nOwppbXBvcnQgeyBHb29kc1RhYmxlSGVhZCwgVmlydHVhbFRhYmxlSGVhZCwgVmlydHVhbFRhYmxlSGVhZDIsIGNvbHVtbnMyLCBjb2x1bW5zMywgQ3VzdG9tTGlzdCwgUnVsZVZhbGlkYXRlIH0gZnJvbSAnLi9kZWZhdWx0RGF0YS5qcyc7CmltcG9ydCBCYXNpY0luZm8gZnJvbSAnLi9jb21wb25lbnRzL0Jhc2ljSW5mby52dWUnOwppbXBvcnQgU3BlY1N0b2NrIGZyb20gJy4vY29tcG9uZW50cy9TcGVjU3RvY2sudnVlJzsKaW1wb3J0IFByb2R1Y3REZXRhaWwgZnJvbSAnLi9jb21wb25lbnRzL1Byb2R1Y3REZXRhaWwudnVlJzsKaW1wb3J0IExvZ2lzdGljc1NldHRpbmcgZnJvbSAnLi9jb21wb25lbnRzL0xvZ2lzdGljc1NldHRpbmcudnVlJzsKaW1wb3J0IFByaWNlQ29tbWlzc2lvbiBmcm9tICcuL2NvbXBvbmVudHMvUHJpY2VDb21taXNzaW9uLnZ1ZSc7CmltcG9ydCBNYXJrZXRpbmdTZXR0aW5nIGZyb20gJy4vY29tcG9uZW50cy9NYXJrZXRpbmdTZXR0aW5nLnZ1ZSc7CmltcG9ydCBPdGhlclNldHRpbmcgZnJvbSAnLi9jb21wb25lbnRzL090aGVyU2V0dGluZy52dWUnOwppbXBvcnQgeyBmb3JtYXRSaWNoVGV4dCB9IGZyb20gJ0AvdXRpbHMvZWRpdG9ySW1nJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdQcm9kdWN0QWRkJywKICBjb21wb25lbnRzOiB7CiAgICB1cGxvYWRQaWN0dXJlczogdXBsb2FkUGljdHVyZXMsCiAgICBmcmVpZ2h0VGVtcGxhdGU6IGZyZWlnaHRUZW1wbGF0ZSwKICAgIGFkZEF0dHI6IGFkZEF0dHIsCiAgICBjb3Vwb25MaXN0OiBjb3Vwb25MaXN0LAogICAgdGFvQmFvOiB0YW9CYW8sCiAgICBnb29kc0xpc3Q6IGdvb2RzTGlzdCwKICAgIHVzZXJMYWJlbDogdXNlckxhYmVsLAogICAgZ29vZHNMYWJlbDogZ29vZHNMYWJlbCwKICAgIHVzZUxhYmVsOiB1c2VMYWJlbCwKICAgIEJhc2ljSW5mbzogQmFzaWNJbmZvLAogICAgU3BlY1N0b2NrOiBTcGVjU3RvY2ssCiAgICBQcm9kdWN0RGV0YWlsOiBQcm9kdWN0RGV0YWlsLAogICAgTG9naXN0aWNzU2V0dGluZzogTG9naXN0aWNzU2V0dGluZywKICAgIFByaWNlQ29tbWlzc2lvbjogUHJpY2VDb21taXNzaW9uLAogICAgTWFya2V0aW5nU2V0dGluZzogTWFya2V0aW5nU2V0dGluZywKICAgIE90aGVyU2V0dGluZzogT3RoZXJTZXR0aW5nCiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbGFiZWxTaG93OiBmYWxzZSwKICAgICAgdGFnU2hvdzogZmFsc2UsCiAgICAgIGRhdGFMYWJlbDogW10sCiAgICAgIGhlYWRUYWI6IFt7CiAgICAgICAgdGl0OiAn5Z+656GA5L+h5oGvJywKICAgICAgICBuYW1lOiAnMScKICAgICAgfSwgewogICAgICAgIHRpdDogJ+inhOagvOW6k+WtmCcsCiAgICAgICAgbmFtZTogJzInCiAgICAgIH0sIHsKICAgICAgICB0aXQ6ICfllYblk4Hor6bmg4UnLAogICAgICAgIG5hbWU6ICczJwogICAgICB9LCB7CiAgICAgICAgdGl0OiAn54mp5rWB6K6+572uJywKICAgICAgICBuYW1lOiAnNCcKICAgICAgfSwgewogICAgICAgIHRpdDogJ+S8muWRmOS7ty/kvaPph5EnLAogICAgICAgIG5hbWU6ICc1JwogICAgICB9LCB7CiAgICAgICAgdGl0OiAn6JCl6ZSA6K6+572uJywKICAgICAgICBuYW1lOiAnNicKICAgICAgfSwgewogICAgICAgIHRpdDogJ+WFtuS7luiuvue9ricsCiAgICAgICAgbmFtZTogJzcnCiAgICAgIH1dLAogICAgICB2aXJ0dWFsOiBbewogICAgICAgIHRpdDogJ+aZrumAmuWVhuWTgScsCiAgICAgICAgaWQ6IDAsCiAgICAgICAgdGl0MjogJ+eJqea1geWPkei0pycKICAgICAgfSwgewogICAgICAgIHRpdDogJ+WNoeWvhi/nvZHnm5gnLAogICAgICAgIGlkOiAxLAogICAgICAgIHRpdDI6ICfoh6rliqjlj5HotKcnCiAgICAgIH0sIHsKICAgICAgICB0aXQ6ICfkvJjmg6DliLgnLAogICAgICAgIGlkOiAyLAogICAgICAgIHRpdDI6ICfoh6rliqjlj5HotKcnCiAgICAgIH0sIHsKICAgICAgICB0aXQ6ICfomZrmi5/llYblk4EnLAogICAgICAgIGlkOiAzLAogICAgICAgIHRpdDI6ICfomZrmi5/lj5HotKcnCiAgICAgIH1dLAogICAgICBzZWxldFZpZGVvOiAwLAogICAgICAvL+mAieaLqeinhumikeexu+WeiwogICAgICBjdXN0b21CdG46IDAsCiAgICAgIC8v6Ieq5a6a5LmJ55WZ6KiA5byA5YWzCiAgICAgIGNvbnRlbnQ6ICcnLAogICAgICBjb250ZW50czogJycsCiAgICAgIGZpbGVVcmw6IFNldHRpbmcuYXBpQmFzZVVSTCArICcvZmlsZS91cGxvYWQnLAogICAgICBmaWxlVXJsMjogU2V0dGluZy5hcGlCYXNlVVJMICsgJy9maWxlL3ZpZGVvX3VwbG9hZCcsCiAgICAgIGNhcmRVcmw6IFNldHRpbmcuYXBpQmFzZVVSTCArICcvZmlsZS91cGxvYWQvMScsCiAgICAgIHVwbG9hZF90eXBlOiAnJywKICAgICAgLy/op4bpopHkuIrkvKDnsbvlnosgMSDmnKzlnLDkuIrkvKAgMiAzIDQgT1NT5LiK5LygCiAgICAgIHVwbG9hZERhdGE6IHt9LAogICAgICAvLyDkuIrkvKDlj4LmlbAKICAgICAgaGVhZGVyOiB7fSwKICAgICAgdHlwZTogMCwKICAgICAgbW9kYWxzOiBmYWxzZSwKICAgICAgZ29vZHNfbW9kYWxzOiBmYWxzZSwKICAgICAgc3BpblNob3c6IGZhbHNlLAogICAgICBvcGVuU3ViaW1pdDogZmFsc2UsCiAgICAgIHZpcnR1YWxMaXN0OiBbewogICAgICAgIGtleTogJycsCiAgICAgICAgdmFsdWU6ICcnCiAgICAgIH1dLAogICAgICAvLyDmibnph4/orr7nva7ooajmoLxkYXRhCiAgICAgIG9uZUZvcm1CYXRjaDogW3sKICAgICAgICBwaWM6ICcnLAogICAgICAgIHByaWNlOiB2b2lkIDAsCiAgICAgICAgY29zdDogdm9pZCAwLAogICAgICAgIG90X3ByaWNlOiB2b2lkIDAsCiAgICAgICAgc3RvY2s6IHZvaWQgMCwKICAgICAgICBiYXJfY29kZTogJycsCiAgICAgICAgYmFyX2NvZGVfbnVtYmVyOiAnJywKICAgICAgICB3ZWlnaHQ6IHZvaWQgMCwKICAgICAgICB2b2x1bWU6IHZvaWQgMCwKICAgICAgICB2aXJ0dWFsX2xpc3Q6IFtdCiAgICAgIH1dLAogICAgICAvLyDop4TmoLzmlbDmja4KICAgICAgZm9ybUR5bmFtaWM6IHsKICAgICAgICBhdHRyc05hbWU6ICcnLAogICAgICAgIGF0dHJzVmFsOiAnJwogICAgICB9LAogICAgICBkaXNrX3R5cGU6IDEsCiAgICAgIC8v5Y2h5a+G57G75Z6LCiAgICAgIHRhYkluZGV4OiAwLAogICAgICB0YWJOYW1lOiAnJywKICAgICAgZm9ybUR5bmFtaWNOYW1lRGF0YTogW10sCiAgICAgIGlzQnRuOiBmYWxzZSwKICAgICAgY29sdW1uczI6IGNvbHVtbnMyLAogICAgICBjb2x1bW5zMzogY29sdW1uczMsCiAgICAgIGNvbHVtbnM6IFtdLAogICAgICBjb2x1bW5zSW5zdGFsbDogW10sCiAgICAgIGNvbHVtbnNJbnN0YWwyOiBbXSwKICAgICAgZ3JpZFBpYzogewogICAgICAgIHhsOiA2LAogICAgICAgIGxnOiA4LAogICAgICAgIG1kOiAxMiwKICAgICAgICBzbTogMTIsCiAgICAgICAgeHM6IDEyCiAgICAgIH0sCiAgICAgIGdyaWRCdG46IHsKICAgICAgICB4bDogNCwKICAgICAgICBsZzogOCwKICAgICAgICBtZDogOCwKICAgICAgICBzbTogOCwKICAgICAgICB4czogOAogICAgICB9LAogICAgICAvL+iHquWumuS5ieeVmeiogOS4i+aLiemAieaLqQogICAgICBDdXN0b21MaXN0OiBDdXN0b21MaXN0LAogICAgICAvL+iHquWumuS5ieeVmeiogOWGheWuuQogICAgICBjdXJyZW50SW5kZXg6IDAsCiAgICAgIGZvcm1WYWxpZGF0ZTogewogICAgICAgIGRpc2tfaW5mbzogJycsCiAgICAgICAgLy/ljaHlr4bnsbvlnosKICAgICAgICBsb2dpc3RpY3M6IFsnMSddLAogICAgICAgIC8v6YCJ5oup54mp5rWB5pa55byPCiAgICAgICAgZnJlaWdodDogMiwKICAgICAgICAvL+i/kOi0ueiuvue9rgogICAgICAgIHBvc3RhZ2U6IDAsCiAgICAgICAgLy/orr7nva7ov5DotLnph5Hpop0KICAgICAgICByZWNvbW1lbmQ6IFtdLAogICAgICAgIC8v5ZWG5ZOB5o6o6I2QCiAgICAgICAgcHJlc2FsZV9kYXk6IDEsCiAgICAgICAgLy/pooTllK7lj5HotKfml7bpl7Qt57uT5p2fCiAgICAgICAgcHJlc2FsZTogZmFsc2UsCiAgICAgICAgLy/pooTllK7llYblk4HlvIDlhbMKICAgICAgICBpc19saW1pdDogZmFsc2UsCiAgICAgICAgbGltaXRfdHlwZTogMCwKICAgICAgICBsaW1pdF9udW06IDAsCiAgICAgICAgdmlwX3Byb2R1Y3Q6IGZhbHNlLAogICAgICAgIC8v5LuY6LS55Lya5ZGY5LiT5bGe5byA5YWzCiAgICAgICAgY3VzdG9tX2Zvcm06IFtdLAogICAgICAgIC8v6Ieq5a6a5LmJ55WZ6KiACiAgICAgICAgc3RvcmVfbmFtZTogJycsCiAgICAgICAgY2F0ZV9pZDogW10sCiAgICAgICAgbGFiZWxfaWQ6IFtdLAogICAgICAgIGtleXdvcmQ6ICcnLAogICAgICAgIHVuaXRfbmFtZTogJycsCiAgICAgICAgc3RvcmVfaW5mbzogJycsCiAgICAgICAgaW1hZ2U6ICcnLAogICAgICAgIHJlY29tbWVuZF9pbWFnZTogJycsCiAgICAgICAgc2xpZGVyX2ltYWdlOiBbXSwKICAgICAgICBkZXNjcmlwdGlvbjogJycsCiAgICAgICAgZmljdGk6IDAsCiAgICAgICAgZ2l2ZV9pbnRlZ3JhbDogMCwKICAgICAgICBzb3J0OiAwLAogICAgICAgIGlzX3Nob3c6IDEsCiAgICAgICAgaXNfZ2lmdDogMCwKICAgICAgICAvLyDlvIDlkK/pgIHnpLzlk4EKICAgICAgICBnaWZ0X3ByaWNlOiAwLAogICAgICAgIGlzX2hvdDogMCwKICAgICAgICBpc19iZW5lZml0OiAwLAogICAgICAgIGlzX2Jlc3Q6IDAsCiAgICAgICAgaXNfbmV3OiAwLAogICAgICAgIGlzX2dvb2Q6IDAsCiAgICAgICAgaXNfcG9zdGFnZTogMCwKICAgICAgICBpc19zdWI6IFtdLAogICAgICAgIHJlY29tbWVuZF9saXN0OiBbXSwKICAgICAgICBwYXJhbXNfbGlzdDogW10sCiAgICAgICAgLy/llYblk4Hlj4LmlbAKICAgICAgICB2aXJ0dWFsX3R5cGU6IDAsCiAgICAgICAgLy8gaXNfc3ViOiAwLAogICAgICAgIGlkOiAwLAogICAgICAgIHNwZWNfdHlwZTogMCwKICAgICAgICBpc192aXJ0dWFsOiAwLAogICAgICAgIHZpZGVvX2xpbms6ICcnLAogICAgICAgIC8vIHBvc3RhZ2U6IDAsCiAgICAgICAgdGVtcF9pZDogJycsCiAgICAgICAgYXR0cnM6IFtdLAogICAgICAgIGl0ZW1zOiBbewogICAgICAgICAgcGljOiAnJywKICAgICAgICAgIHByaWNlOiAwLAogICAgICAgICAgY29zdDogMCwKICAgICAgICAgIG90X3ByaWNlOiAwLAogICAgICAgICAgc3RvY2s6IDAsCiAgICAgICAgICBiYXJfY29kZTogJycsCiAgICAgICAgICBiYXJfY29kZV9udW1iZXI6ICcnCiAgICAgICAgfV0sCiAgICAgICAgYWN0aXZpdHk6IFsn6buY6K6kJywgJ+enkuadgCcsICfnoI3ku7cnLCAn5ou85ZuiJ10sCiAgICAgICAgY291cG9uTmFtZTogW10sCiAgICAgICAgaGVhZGVyOiBbXSwKICAgICAgICBzZWxlY3RSdWxlOiAnJywKICAgICAgICBjb3Vwb25faWRzOiBbXSwKICAgICAgICBjb21tYW5kX3dvcmQ6ICcnLAogICAgICAgIG1pbl9xdHk6IDEsCiAgICAgICAgbGFiZWxfbGlzdDogW10sCiAgICAgICAgcHJvdGVjdGlvbl9saXN0OiBbXQogICAgICB9LAogICAgICBydWxlTGlzdDogW10sCiAgICAgIHRlbXBsYXRlTGlzdDogW10sCiAgICAgIGNyZWF0ZUJudDogdHJ1ZSwKICAgICAgc2hvd0lwdXQ6IGZhbHNlLAogICAgICBtYW55Rm9ybVZhbGlkYXRlOiBbXSwKICAgICAgLy8g5Y2V6KeE5qC86KGo5qC8ZGF0YQogICAgICBvbmVGb3JtVmFsaWRhdGU6IFt7CiAgICAgICAgcGljOiAnJywKICAgICAgICBwcmljZTogMCwKICAgICAgICBjb3N0OiAwLAogICAgICAgIG90X3ByaWNlOiAwLAogICAgICAgIHN0b2NrOiAwLAogICAgICAgIGJhcl9jb2RlOiAnJywKICAgICAgICBiYXJfY29kZV9udW1iZXI6ICcnLAogICAgICAgIHdlaWdodDogMCwKICAgICAgICB2b2x1bWU6IDAsCiAgICAgICAgYnJva2VyYWdlOiAwLAogICAgICAgIGJyb2tlcmFnZV90d286IDAsCiAgICAgICAgdmlwX3ByaWNlOiAwLAogICAgICAgIHZpcnR1YWxfbGlzdDogW10sCiAgICAgICAgY291cG9uX2lkOiAwCiAgICAgIH1dLAogICAgICBpbWFnZXM6IFtdLAogICAgICBpbWFnZXNUYWJsZTogJycsCiAgICAgIGN1cnJlbnRUYWI6ICcxJywKICAgICAgaXNDaG9pY2U6ICcnLAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgbW9kYWxQaWM6IGZhbHNlLAogICAgICBhZGRWaXJ0dWFsTW9kZWw6IGZhbHNlLAogICAgICB0ZW1wbGF0ZTogZmFsc2UsCiAgICAgIHVwbG9hZExpc3Q6IFtdLAogICAgICB0cmVlU2VsZWN0OiBbXSwKICAgICAgcGljVGl0OiAnJywKICAgICAgdGFibGVJbmRleDogMCwKICAgICAgcnVsZVZhbGlkYXRlOiBSdWxlVmFsaWRhdGUsCiAgICAgIG1hbnlCcm9rZXJhZ2U6IHVuZGVmaW5lZCwKICAgICAgbWFueUJyb2tlcmFnZVR3bzogdW5kZWZpbmVkLAogICAgICBtYW55VmlwUHJpY2U6IHVuZGVmaW5lZCwKICAgICAgbWFueVZpcERpc2NvdW50OiB1bmRlZmluZWQsCiAgICAgIHVwbG9hZDogewogICAgICAgIHZpZGVvSW5nOiBmYWxzZSAvLyDmmK/lkKbmmL7npLrov5vluqbmnaHvvJsKICAgICAgfSwKICAgICAgdmlkZW9Jbmc6IGZhbHNlLAogICAgICAvLyDmmK/lkKbmmL7npLrov5vluqbmnaHvvJsKICAgICAgcHJvZ3Jlc3M6IDAsCiAgICAgIC8vIOi/m+W6puadoem7mOiupDAKICAgICAgc3RvY2s6IDAsCiAgICAgIGRpc2tfaW5mbzogJycsCiAgICAgIHZpZGVvTGluazogJycsCiAgICAgIGF0dHJzOiBbXSwKICAgICAgYWN0aXZpdHk6IHsKICAgICAgICDpu5jorqQ6ICdyZWQnLAogICAgICAgIOenkuadgDogJ2JsdWUnLAogICAgICAgIOegjeS7tzogJ2dyZWVuJywKICAgICAgICDmi7zlm6I6ICd5ZWxsb3cnCiAgICAgIH0sCiAgICAgIGNvdXBvbk5hbWU6IFtdLAogICAgICB1cGRhdGVJZHM6IFtdLAogICAgICB1cGRhdGVOYW1lOiBbXSwKICAgICAgY291cG9uSWRzOiAnJywKICAgICAgY291cG9uTmFtZXM6IFtdLAogICAgICByYWtlQmFjazogW3sKICAgICAgICB0aXRsZTogJ+S4gOe6p+i/lOS9oyjlhYMpJywKICAgICAgICBzbG90OiAnYnJva2VyYWdlJywKICAgICAgICBhbGlnbjogJ2NlbnRlcicsCiAgICAgICAgd2lkdGg6IDk1CiAgICAgIH0sIHsKICAgICAgICB0aXRsZTogJ+S6jOe6p+i/lOS9oyjlhYMpJywKICAgICAgICBzbG90OiAnYnJva2VyYWdlX3R3bycsCiAgICAgICAgYWxpZ246ICdjZW50ZXInLAogICAgICAgIHdpZHRoOiA5NQogICAgICB9XSwKICAgICAgbWVtYmVyOiBbewogICAgICAgIHRpdGxlOiAn5Lya5ZGY5Lu3JywKICAgICAgICBzbG90OiAndmlwX3ByaWNlJywKICAgICAgICBhbGlnbjogJ2NlbnRlcicsCiAgICAgICAgd2lkdGg6IDk1CiAgICAgIH0sIHsKICAgICAgICB0aXRsZTogJ+S8muWRmOaKmOaJoycsCiAgICAgICAgc2xvdDogJ3ZpcF9wcm9wb3J0aW9uJywKICAgICAgICBhbGlnbjogJ2NlbnRlcicsCiAgICAgICAgd2lkdGg6IDk1CiAgICAgIH1dLAogICAgICBjb2x1bW5zSW5zdGFsTTogW10sCiAgICAgIG1vdmVJbmRleDogJycsCiAgICAgIGFkZFZhbHVlOiAnJywKICAgICAgdmlzaWJsZTogZmFsc2UsCiAgICAgIHR5cGVDb25maWc6IFtdLAogICAgICBnb29kc1R5cGU6IFtdLAogICAgICBwYXJhbXNUeXBlTGlzdDogW10sCiAgICAgIHBhcmFtc1R5cGU6IG51bGwsCiAgICAgIGNhblNlbDogdHJ1ZSwKICAgICAgLy8g6KeE5qC85Zu+54mH5re75Yqg5Yik5patCiAgICAgIGNoYW5nZUF0dHJWYWx1ZTogJycsCiAgICAgIC8v5L+u5pS555qE6KeE5qC85YC8CiAgICAgIHRhYmxlS2V5OiAwLAogICAgICBwcm90ZWN0aW9uTGlzdDogW10sCiAgICAgIC8vIOacjeWKoeS/nemanAogICAgICBsYWJlbExpc3Q6IFtdLAogICAgICB0aWxlTGFiZWxMaXN0OiBbXQogICAgfTsKICB9LAogIGNvbXB1dGVkOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1hcFN0YXRlKCdtZWRpYScsIFsnaXNNb2JpbGUnXSkpLCB7fSwgewogICAgbGFiZWxXaWR0aDogZnVuY3Rpb24gbGFiZWxXaWR0aCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNNb2JpbGUgPyB1bmRlZmluZWQgOiAnMTIwcHgnOwogICAgfSwKICAgIGxhYmVsUG9zaXRpb246IGZ1bmN0aW9uIGxhYmVsUG9zaXRpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmlzTW9iaWxlID8gJ3RvcCcgOiAncmlnaHQnOwogICAgfSwKICAgIGxhYmVsQm90dG9tOiBmdW5jdGlvbiBsYWJlbEJvdHRvbSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNNb2JpbGUgPyB1bmRlZmluZWQgOiAnMTVweCc7CiAgICB9CiAgfSksCiAgd2F0Y2g6IHsKICAgIHR5cGVDb25maWc6IGZ1bmN0aW9uIHR5cGVDb25maWcodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgLy8g5a+5dmlydHVhbOS4reeahGlk562J5LqOdmFs5Lit55qEaWTnmoQKICAgICAgICB0aGlzLmdvb2RzVHlwZSA9IHRoaXMudmlydHVhbC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiB2YWwuaW5jbHVkZXMoaXRlbS5pZCArICcnKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmdvb2RzVHlwZSA9IHRoaXMudmlydHVhbDsKICAgICAgfQogICAgfQogIH0sCiAgYmVmb3JlUm91dGVVcGRhdGU6IGZ1bmN0aW9uIGJlZm9yZVJvdXRlVXBkYXRlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICB0aGlzLmJ1cy4kZW1pdCgnb25UYWdzVmlld1JlZnJlc2hSb3V0ZXJWaWV3JywgdGhpcy4kcm91dGUucGF0aCk7CiAgICBuZXh0KCk7CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdGhpcy5jb2x1bW5zID0gdGhpcy5jb2x1bW5zMi5zbGljZSgwLCA4KTsKICAgIHRoaXMuZ2V0VG9rZW4oKTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3IoKS5tKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IoKS53KGZ1bmN0aW9uIChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Lm4pIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgaWYgKCEoX3RoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gJzAnICYmIF90aGlzLiRyb3V0ZS5wYXJhbXMuaWQpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubiA9IDI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnRleHQubiA9IDE7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy5nZXRJbmZvKCk7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIF9jb250ZXh0Lm4gPSAzOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgaWYgKF90aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09ICcwJykgewogICAgICAgICAgICAgIF90aGlzLmdldFByb2R1Y3RDYWNoZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzLmdldHByb2R1Y3RMYWJlbFVzZUxpc3RBcGkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBpZiAoX3RoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUpIHsKICAgICAgICAgICAgICBfdGhpcy5tb2RhbHMgPSB0cnVlOwogICAgICAgICAgICAgIF90aGlzLnR5cGUgPSBfdGhpcy4kcm91dGUucXVlcnkudHlwZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpcy50eXBlID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBfdGhpcy5nb29kc0NhdGVnb3J5KCk7CiAgICAgICAgICAgIF90aGlzLnByb2R1Y3RHZXRSdWxlKCk7CiAgICAgICAgICAgIF90aGlzLnByb2R1Y3RHZXRUZW1wbGF0ZSgpOwogICAgICAgICAgICBfdGhpcy5wYXJhbXNHZXRUZW1wbGF0ZSgpOwogICAgICAgICAgICBfdGhpcy51cGxvYWRUeXBlKCk7CiAgICAgICAgICAgIF90aGlzLnByb2R1Y3RDb25maWcoKTsKICAgICAgICAgICAgX3RoaXMud2F0Y2hBY3Rpdml0eSgpOwogICAgICAgICAgICBfdGhpcy5nZXRQcm90ZWN0aW9uTGlzdCgpOwogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYSgyKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUpOwogICAgfSkpKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRQcm9kdWN0Q2FjaGU6IGZ1bmN0aW9uIGdldFByb2R1Y3RDYWNoZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIHByb2R1Y3RDYWNoZSgpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIHZhciBkYXRhID0gcmVzLmRhdGEuaW5mbzsKICAgICAgICBfdGhpczIuZ2V0cHJvZHVjdExhYmVsVXNlTGlzdEFwaSgpOwogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAgICAgdmFyIGNhdGVfaWQgPSBkYXRhLmNhdGVfaWQubWFwKE51bWJlcik7CiAgICAgICAgICB2YXIgbGFiZWxfaWQgPSBkYXRhLmxhYmVsX2lkLm1hcChOdW1iZXIpOwogICAgICAgICAgX3RoaXMyLmF0dHJzID0gZGF0YS5pdGVtcyB8fCBbXTsKICAgICAgICAgIHZhciBpZHMgPSBbXTsKICAgICAgICAgIGlmIChkYXRhLmNvdXBvbnMpIHsKICAgICAgICAgICAgZGF0YS5jb3Vwb25zLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIGlkcy5wdXNoKGl0ZW0uaWQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3RoaXMyLmNvdXBvbk5hbWUgPSBkYXRhLmNvdXBvbnM7CiAgICAgICAgICB9CiAgICAgICAgICBfdGhpczIuZm9ybVZhbGlkYXRlID0gZGF0YTsKICAgICAgICAgIF90aGlzMi5kYXRhTGFiZWwgPSBkYXRhLmxhYmVsX2lkOwogICAgICAgICAgX3RoaXMyLmZvcm1WYWxpZGF0ZS5jb3Vwb25faWRzID0gaWRzOwogICAgICAgICAgX3RoaXMyLnVwZGF0ZUlkcyA9IGlkczsKICAgICAgICAgIF90aGlzMi51cGRhdGVOYW1lID0gZGF0YS5jb3Vwb25zOwogICAgICAgICAgX3RoaXMyLmZvcm1WYWxpZGF0ZS5jYXRlX2lkID0gY2F0ZV9pZDsKICAgICAgICAgIF90aGlzMi5vbmVGb3JtVmFsaWRhdGUgPSBkYXRhLmF0dHJzOwogICAgICAgICAgX3RoaXMyLmdlbmVyYXRlSGVhZGVyKF90aGlzMi5hdHRycyk7CiAgICAgICAgICBfdGhpczIuZm9ybVZhbGlkYXRlLmxvZ2lzdGljcyA9IGRhdGEubG9naXN0aWNzIHx8IFsnMSddOwogICAgICAgICAgX3RoaXMyLmZvcm1WYWxpZGF0ZS5oZWFkZXIgPSBbXTsKICAgICAgICAgIF90aGlzMi5tYW55Rm9ybVZhbGlkYXRlID0gZGF0YS5hdHRyczsKICAgICAgICAgIF90aGlzMi5zcGVjX3R5cGUgPSBkYXRhLnNwZWNfdHlwZTsKICAgICAgICAgIF90aGlzMi5mb3JtVmFsaWRhdGUuaXNfdmlydHVhbCA9IGRhdGEuaXNfdmlydHVhbDsKICAgICAgICAgIF90aGlzMi5mb3JtVmFsaWRhdGUuY3VzdG9tX2Zvcm0gPSBkYXRhLmN1c3RvbV9mb3JtIHx8IFtdOwogICAgICAgICAgaWYgKF90aGlzMi5mb3JtVmFsaWRhdGUuY3VzdG9tX2Zvcm0ubGVuZ3RoICE9IDApIHsKICAgICAgICAgICAgX3RoaXMyLmN1c3RvbUJ0biA9IDE7CiAgICAgICAgICB9CiAgICAgICAgICBfdGhpczIuYXR0cnMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmIChpdGVtLmFkZF9waWMpIF90aGlzMi5jYW5TZWwgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXMyLnZpcnR1YWxidG4oZGF0YS52aXJ0dWFsX3R5cGUsIDEpOwogICAgICAgICAgaWYgKGRhdGEuc3BlY190eXBlID09PSAwKSB7CiAgICAgICAgICAgIF90aGlzMi5tYW55Rm9ybVZhbGlkYXRlID0gW107CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczIuY3JlYXRlQm50ID0gdHJ1ZTsKICAgICAgICAgICAgX3RoaXMyLm9uZUZvcm1WYWxpZGF0ZSA9IFt7CiAgICAgICAgICAgICAgcGljOiBkYXRhLmltYWdlLAogICAgICAgICAgICAgIHByaWNlOiAwLAogICAgICAgICAgICAgIGNvc3Q6IDAsCiAgICAgICAgICAgICAgb3RfcHJpY2U6IDAsCiAgICAgICAgICAgICAgc3RvY2s6IDAsCiAgICAgICAgICAgICAgYmFyX2NvZGU6ICcnLAogICAgICAgICAgICAgIGJhcl9jb2RlX251bWJlcjogJycsCiAgICAgICAgICAgICAgd2VpZ2h0OiAwLAogICAgICAgICAgICAgIHZvbHVtZTogMCwKICAgICAgICAgICAgICBicm9rZXJhZ2U6IDAsCiAgICAgICAgICAgICAgYnJva2VyYWdlX3R3bzogMCwKICAgICAgICAgICAgICB2aXBfcHJpY2U6IDAsCiAgICAgICAgICAgICAgdmlydHVhbF9saXN0OiBbXSwKICAgICAgICAgICAgICBjb3Vwb25faWQ6IDAKICAgICAgICAgICAgfV07CiAgICAgICAgICB9CiAgICAgICAgICBfdGhpczIud2F0Y2hBY3Rpdml0eSgpOwogICAgICAgICAgX3RoaXMyLnNwaW5TaG93ID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgX3RoaXMyLiRtZXNzYWdlLmVycm9yKGVyci5tc2cpOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRQcm90ZWN0aW9uTGlzdDogZnVuY3Rpb24gZ2V0UHJvdGVjdGlvbkxpc3QoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgICBwcm9kdWN0UHJvdGVjdGlvbkxpc3RBcGkoewogICAgICAgIHBhZ2U6IDAsCiAgICAgICAgbGltaXQ6IDAsCiAgICAgICAgc3RhdHVzOiAxCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMy5wcm90ZWN0aW9uTGlzdCA9IHJlcy5kYXRhLmxpc3Q7CiAgICAgIH0pOwogICAgfSwKICAgIGdldHByb2R1Y3RMYWJlbFVzZUxpc3RBcGk6IGZ1bmN0aW9uIGdldHByb2R1Y3RMYWJlbFVzZUxpc3RBcGkoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwogICAgICBwcm9kdWN0TGFiZWxVc2VMaXN0QXBpKCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgLy8g5ZCI5bm25pWw57uE5Lit5omA5pyJ55qEbGlzdAogICAgICAgIF90aGlzNC50aWxlTGFiZWxMaXN0ID0gcmVzLmRhdGEuZmxhdE1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW0ubGlzdDsKICAgICAgICB9KTsKICAgICAgICB2YXIgbGFiZWxMaXN0ID0gcmVzLmRhdGE7CiAgICAgICAgaWYgKF90aGlzNC5mb3JtVmFsaWRhdGUubGFiZWxfbGlzdC5sZW5ndGgpIHsKICAgICAgICAgIF90aGlzNC5mb3JtVmFsaWRhdGUubGFiZWxfbGlzdC5tYXAoZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgIGxhYmVsTGlzdC5tYXAoZnVuY3Rpb24gKHJlKSB7CiAgICAgICAgICAgICAgcmUubGlzdC5tYXAoZnVuY3Rpb24gKGxhYmVsKSB7CiAgICAgICAgICAgICAgICBpZiAobGFiZWwuaWQgPT09IGVsKSB7CiAgICAgICAgICAgICAgICAgIGxhYmVsLmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBsYWJlbC5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGFiZWxMaXN0Lm1hcChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgZWwubGlzdC5tYXAoZnVuY3Rpb24gKGxhYmVsKSB7CiAgICAgICAgICAgICAgbGFiZWwuYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIF90aGlzNC5sYWJlbExpc3QgPSBsYWJlbExpc3Q7CiAgICAgIH0pOwogICAgfSwKICAgIGFkZFByb3RlY3Rpb246IGZ1bmN0aW9uIGFkZFByb3RlY3Rpb24oKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBwYXRoOiB0aGlzLiRyb3V0ZVByb1N0ciArICcvcHJvZHVjdC9wcm90ZWN0aW9uL2xpc3QnCiAgICAgIH0pOwogICAgfSwKICAgIHByb2R1Y3RDb25maWc6IGZ1bmN0aW9uIHByb2R1Y3RDb25maWcoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwogICAgICBnZXRQcm9kdWN0VHlwZUNvbmZpZygpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzNS50eXBlQ29uZmlnID0gcmVzLmRhdGE7CiAgICAgIH0pOwogICAgfSwKICAgIGJlZm9yZVVwbG9hZDogZnVuY3Rpb24gYmVmb3JlVXBsb2FkKGZpbGUpIHsKICAgICAgcmV0dXJuIGlzRmlsZVVwbG9hZChmaWxlKTsKICAgIH0sCiAgICAvLyDliIbniYfkuIrkvKAKICAgIHZpZGVvU2F2ZVRvVXJsOiBmdW5jdGlvbiB2aWRlb1NhdmVUb1VybChmaWxlKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwogICAgICBpZiAoaXNWaWRlb1VwbG9hZChmaWxlKSkgewogICAgICAgIHVwbG9hZEJ5UGllY2VzKHsKICAgICAgICAgIGZpbGU6IGZpbGUsCiAgICAgICAgICAvLyDop4bpopHlrp7kvZMKICAgICAgICAgIHBpZWNlU2l6ZTogMywKICAgICAgICAgIC8vIOWIhueJh+Wkp+WwjwogICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gc3VjY2VzcyhkYXRhKSB7CiAgICAgICAgICAgIF90aGlzNi5mb3JtVmFsaWRhdGUudmlkZW9fbGluayA9IGRhdGEuZmlsZV9wYXRoOwogICAgICAgICAgICBfdGhpczYucHJvZ3Jlc3MgPSAxMDA7CiAgICAgICAgICB9LAogICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKGUpIHsKICAgICAgICAgICAgX3RoaXM2LiRtZXNzYWdlLmVycm9yKGUubXNnKTsKICAgICAgICAgIH0sCiAgICAgICAgICB1cGxvYWRpbmc6IGZ1bmN0aW9uIHVwbG9hZGluZyhjaHVuaywgYWxsQ2h1bmspIHsKICAgICAgICAgICAgX3RoaXM2LnZpZGVvSW5nID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIHN0ID0gTWF0aC5mbG9vcihjaHVuayAvIGFsbENodW5rICogMTAwKTsKICAgICAgICAgICAgX3RoaXM2LnByb2dyZXNzID0gc3Q7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIC8vIOexu+Wei+mAieaLqS/loavlhaXlhoXlrrnliKTmlq0KICAgIHZpcnR1YWxidG46IGZ1bmN0aW9uIHZpcnR1YWxidG4oaW5kZXgsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CiAgICAgIGlmICh0eXBlICE9IDEpIHsKICAgICAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkKSByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign57yW6L6R5ZWG5ZOB5LiN5pSv5oyB5YiH5o2i5ZWG5ZOB57G75Z6LJyk7CiAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuaXNfc3ViID0gW107CiAgICAgICAgdmFyIGlkID0gdGhpcy4kcm91dGUucGFyYW1zLmlkOwogICAgICAgIGlmIChpZCkgewogICAgICAgICAgY2hlY2tBY3Rpdml0eUFwaShpZCkudGhlbihmdW5jdGlvbiAocmVzKSB7fSkuY2F0Y2goZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczcuZm9ybVZhbGlkYXRlLnNwZWNfdHlwZSA9IF90aGlzNy5zcGVjX3R5cGU7CiAgICAgICAgICAgIF90aGlzNy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5mb3JtVmFsaWRhdGUuc3BlY190eXBlID09IDEpIHsKICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZSgxKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgLy8g5a6a5LmJ5Z+656GA5ZWG5ZOB5ZKM6Jma5ouf5ZWG5ZOB55qE5qCH562+6aG16YWN572uCiAgICAgIHZhciBiYXNlSGVhZFRhYnMgPSBbewogICAgICAgIHRpdDogJ+WfuuehgOS/oeaBrycsCiAgICAgICAgbmFtZTogJzEnCiAgICAgIH0sIHsKICAgICAgICB0aXQ6ICfop4TmoLzlupPlrZgnLAogICAgICAgIG5hbWU6ICcyJwogICAgICB9LCB7CiAgICAgICAgdGl0OiAn5ZWG5ZOB6K+m5oOFJywKICAgICAgICBuYW1lOiAnMycKICAgICAgfSwgewogICAgICAgIHRpdDogJ+eJqea1geiuvue9ricsCiAgICAgICAgbmFtZTogJzQnCiAgICAgIH0sIHsKICAgICAgICB0aXQ6ICfkvJrlkZjku7cv5L2j6YeRJywKICAgICAgICBuYW1lOiAnNScKICAgICAgfSwgewogICAgICAgIHRpdDogJ+iQpemUgOiuvue9ricsCiAgICAgICAgbmFtZTogJzYnCiAgICAgIH0sIHsKICAgICAgICB0aXQ6ICflhbbku5borr7nva4nLAogICAgICAgIG5hbWU6ICc3JwogICAgICB9XTsKICAgICAgdmFyIHZpcnR1YWxIZWFkVGFicyA9IFt7CiAgICAgICAgdGl0OiAn5Z+656GA5L+h5oGvJywKICAgICAgICBuYW1lOiAnMScKICAgICAgfSwgewogICAgICAgIHRpdDogJ+inhOagvOW6k+WtmCcsCiAgICAgICAgbmFtZTogJzInCiAgICAgIH0sIHsKICAgICAgICB0aXQ6ICfllYblk4Hor6bmg4UnLAogICAgICAgIG5hbWU6ICczJwogICAgICB9LCB7CiAgICAgICAgdGl0OiAn5Lya5ZGY5Lu3L+S9o+mHkScsCiAgICAgICAgbmFtZTogJzQnCiAgICAgIH0sIHsKICAgICAgICB0aXQ6ICfokKXplIDorr7nva4nLAogICAgICAgIG5hbWU6ICc1JwogICAgICB9LCB7CiAgICAgICAgdGl0OiAn5YW25LuW6K6+572uJywKICAgICAgICBuYW1lOiAnNicKICAgICAgfV07CiAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICAvLyDmma7pgJrllYblk4EKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSA9IDA7CiAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5pc192aXJ0dWFsID0gMDsKICAgICAgICAgIHRoaXMuaGVhZFRhYiA9IGJhc2VIZWFkVGFiczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIC8vIOWNoeWvhi/nvZHnm5jllYblk4EKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSA9IDE7CiAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5wb3N0YWdlID0gMDsKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmlzX3ZpcnR1YWwgPSAxOwogICAgICAgICAgdGhpcy5oZWFkVGFiID0gdmlydHVhbEhlYWRUYWJzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgLy8g5LyY5oOg5Yi45ZWG5ZOBCiAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS52aXJ0dWFsX3R5cGUgPSAyOwogICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuaXNfdmlydHVhbCA9IDE7CiAgICAgICAgICB0aGlzLmhlYWRUYWIgPSB2aXJ0dWFsSGVhZFRhYnM7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICAvLyDomZrmi5/llYblk4EKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSA9IDM7CiAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5pc192aXJ0dWFsID0gMTsKICAgICAgICAgIHRoaXMuaGVhZFRhYiA9IHZpcnR1YWxIZWFkVGFiczsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgLy8g5paw5aKe5YiG57G7CiAgICBhZGRDYXRlOiBmdW5jdGlvbiBhZGRDYXRlKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKICAgICAgdGhpcy4kbW9kYWxGb3JtKHByb2R1Y3RDcmVhdGVBcGkoKSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzOC5nb29kc0NhdGVnb3J5KCk7CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOeJqea1geaWueW8j+mAieaLqQogICAgbG9naXN0aWNzQnRuOiBmdW5jdGlvbiBsb2dpc3RpY3NCdG4oZSkgewogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5sb2dpc3RpY3MgPSBlOwogICAgfSwKICAgIC8vIOaWsOWinuagh+etvgogICAgYWRkTGFiZWw6IGZ1bmN0aW9uIGFkZExhYmVsKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKICAgICAgdGhpcy4kbW9kYWxGb3JtKHVzZXJMYWJlbEFkZEFwaSgwKSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzOS51c2VyTGFiZWwoKTsKICAgICAgfSk7CiAgICB9LAogICAgLy8g6YCJ5oup5qCH562+CiAgICBhZGRHb29kc1RhZzogZnVuY3Rpb24gYWRkR29vZHNUYWcoKSB7CiAgICAgIHRoaXMudGFnU2hvdyA9IHRydWU7CiAgICB9LAogICAgLy8g6Ieq5a6a5LmJ55WZ6KiAIOW8gOWQr+WFs+mXrQogICAgY3VzdG9tTWVzc0J0bjogZnVuY3Rpb24gY3VzdG9tTWVzc0J0bihlKSB7CiAgICAgIGlmICghZSkgewogICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtID0gW107CiAgICAgIH0KICAgICAgdGhpcy5jdXN0b21CdG4gPSBlOwogICAgfSwKICAgIC8vIOiHquWumuS5ieeVmeiogCDmlrDlop7ooajljZUKICAgIGFkZGN1c3RvbTogZnVuY3Rpb24gYWRkY3VzdG9tKCkgewogICAgICBpZiAodGhpcy5mb3JtVmFsaWRhdGUuY3VzdG9tX2Zvcm0ubGVuZ3RoID4gOSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn5pyA5aSa5re75YqgMTDmnaEnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5jdXN0b21fZm9ybS5wdXNoKHsKICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgIGxhYmVsOiAndGV4dCcsCiAgICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgICBzdGF0dXM6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDliKDpmaQKICAgIGRlbGN1c3RvbTogZnVuY3Rpb24gZGVsY3VzdG9tKGluZGV4KSB7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtLnNwbGljZShpbmRleCwgMSk7CiAgICB9LAogICAgLy8g6aKE5ZSu5YW35L2T5pel5pyfCiAgICBvbmNoYW5nZVRpbWU6IGZ1bmN0aW9uIG9uY2hhbmdlVGltZShlKSB7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnByZXNhbGVfdGltZSA9IGU7CiAgICB9LAogICAgLy8g5ZWG5ZOB6K+m5oOFCiAgICBnZXRFZGl0b3JDb250ZW50OiBmdW5jdGlvbiBnZXRFZGl0b3JDb250ZW50KGRhdGEpIHsKICAgICAgdGhpcy5jb250ZW50ID0gZGF0YTsKICAgIH0sCiAgICBjYW5jZWw6IGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgdGhpcy5tb2RhbHMgPSBmYWxzZTsKICAgIH0sCiAgICAvLyDkuIrkvKDlpLTpg6h0b2tlbgogICAgZ2V0VG9rZW46IGZ1bmN0aW9uIGdldFRva2VuKCkgewogICAgICB0aGlzLmhlYWRlclsnQXV0aG9yaS16YXRpb24nXSA9ICdCZWFyZXIgJyArIGdldENvb2tpZXMoJ3Rva2VuJyk7CiAgICB9LAogICAgLy8g5a+85YWl5Y2h5a+GCiAgICB1cEZpbGU6IGZ1bmN0aW9uIHVwRmlsZShyZXMpIHsKICAgICAgdmFyIF90aGlzMCA9IHRoaXM7CiAgICAgIGltcG9ydENhcmQoewogICAgICAgIGZpbGU6IHJlcy5kYXRhLnNyYwogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczAudmlydHVhbExpc3QgPSBfdGhpczAudmlydHVhbExpc3QuY29uY2F0KHJlcy5kYXRhKTsKICAgICAgfSk7CiAgICB9LAogICAgLy/ojrflj5bop4bpopHkuIrkvKDnsbvlnosKICAgIHVwbG9hZFR5cGU6IGZ1bmN0aW9uIHVwbG9hZFR5cGUoKSB7CiAgICAgIHZhciBfdGhpczEgPSB0aGlzOwogICAgICBfdXBsb2FkVHlwZSgpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMS51cGxvYWRfdHlwZSA9IHJlcy5kYXRhLnVwbG9hZF90eXBlOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDliJ3lp4vljJbmlbDmja7lsZXnpLoKICAgIGluZm9EYXRhOiBmdW5jdGlvbiBpbmZvRGF0YShkYXRhLCBpc0NvcHkpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwogICAgICB2YXIgY2F0ZV9pZCA9IGRhdGEuY2F0ZV9pZC5tYXAoTnVtYmVyKTsKICAgICAgdmFyIGxhYmVsX2lkID0gZGF0YS5sYWJlbF9pZC5tYXAoTnVtYmVyKTsKICAgICAgdGhpcy5hdHRycyA9IGRhdGEuaXRlbXMgfHwgW107CiAgICAgIHZhciBpZHMgPSBbXTsKICAgICAgZGF0YS5jb3Vwb25zLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlkcy5wdXNoKGl0ZW0uaWQpOwogICAgICB9KTsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUgPSBkYXRhOwogICAgICB0aGlzLnNlbGV0VmlkZW8gPSBkYXRhLnNlbGV0VmlkZW87CiAgICAgIHRoaXMuY29udGVudHMgPSBkYXRhLmRlc2NyaXB0aW9uOwogICAgICB0aGlzLmNvdXBvbk5hbWUgPSBkYXRhLmNvdXBvbnM7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmNvdXBvbl9pZHMgPSBpZHM7CiAgICAgIHRoaXMudXBkYXRlSWRzID0gaWRzOwogICAgICB0aGlzLmRhdGFMYWJlbCA9IGRhdGEubGFiZWxfaWQ7CiAgICAgIHRoaXMudXBkYXRlTmFtZSA9IGRhdGEuY291cG9uczsKICAgICAgdGhpcy52aXJ0dWFsYnRuKGRhdGEudmlydHVhbF90eXBlLCAxKTsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUubG9naXN0aWNzID0gZGF0YS5sb2dpc3RpY3MgfHwgWycxJ107CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtID0gZGF0YS5jdXN0b21fZm9ybSB8fCBbXTsKICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgdGhpcy5jdXN0b21CdG4gPSAxOwogICAgICB9CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmNhdGVfaWQgPSBjYXRlX2lkOwogICAgICBpZiAoZGF0YS5hdHRyKSB7CiAgICAgICAgdGhpcy5vbmVGb3JtVmFsaWRhdGUgPSBbZGF0YS5hdHRyXTsKICAgICAgICB0aGlzLm9uZUZvcm1WYWxpZGF0ZVswXS52aXBfcHJvcG9ydGlvbiA9ICh0aGlzLm9uZUZvcm1WYWxpZGF0ZVswXS52aXBfcHJpY2UgLyB0aGlzLm9uZUZvcm1WYWxpZGF0ZVswXS5wcmljZSAqIDEwMCkudG9GaXhlZCgyKTsKICAgICAgfQogICAgICB0aGlzLmdldHByb2R1Y3RMYWJlbFVzZUxpc3RBcGkoKTsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuaGVhZGVyID0gW107CiAgICAgIHRoaXMuc3BlY190eXBlID0gZGF0YS5zcGVjX3R5cGU7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnNwZWNfdHlwZSA9IHRoaXMuc3BlY190eXBlOwogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5pc192aXJ0dWFsID0gZGF0YS5pc192aXJ0dWFsOwogICAgICB0aGlzLmF0dHJzLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlmIChpdGVtLmFkZF9waWMpIF90aGlzMTAuY2FuU2VsID0gZmFsc2U7CiAgICAgIH0pOwogICAgICBpZiAoZGF0YS5zcGVjX3R5cGUgPT09IDApIHsKICAgICAgICB0aGlzLm1hbnlGb3JtVmFsaWRhdGUgPSBbXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNyZWF0ZUJudCA9IHRydWU7CiAgICAgICAgdGhpcy5vbmVGb3JtVmFsaWRhdGUgPSBbewogICAgICAgICAgcGljOiAnJywKICAgICAgICAgIHByaWNlOiAwLAogICAgICAgICAgY29zdDogMCwKICAgICAgICAgIG90X3ByaWNlOiAwLAogICAgICAgICAgc3RvY2s6IDAsCiAgICAgICAgICBiYXJfY29kZTogJycsCiAgICAgICAgICBiYXJfY29kZV9udW1iZXI6ICcnLAogICAgICAgICAgd2VpZ2h0OiAwLAogICAgICAgICAgdm9sdW1lOiAwLAogICAgICAgICAgYnJva2VyYWdlOiAwLAogICAgICAgICAgYnJva2VyYWdlX3R3bzogMCwKICAgICAgICAgIHZpcF9wcmljZTogMCwKICAgICAgICAgIHZpcnR1YWxfbGlzdDogW10sCiAgICAgICAgICBjb3Vwb25faWQ6IDAKICAgICAgICB9XTsKICAgICAgICB0aGlzLmdlbmVyYXRlSGVhZGVyKHRoaXMuYXR0cnMpOwogICAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZSA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5vbmVGb3JtQmF0Y2gpLCBfdG9Db25zdW1hYmxlQXJyYXkoZGF0YS5hdHRycykpOwogICAgICB9CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczEwLmNoZWNrQWxsR3JvdXAoZGF0YS5pc19zdWIpOwogICAgICB9LCAxMDAwKTsKICAgICAgdGhpcy53YXRjaEFjdGl2aXR5KCk7CiAgICB9LAogICAgLy/lhbPpl63mt5jlrp3lvLnnqpflubbnlJ/miJDmlbDmja7vvJsKICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoZGF0YSkgewogICAgICB0aGlzLm1vZGFscyA9IGZhbHNlOwogICAgICB0aGlzLmluZm9EYXRhKGRhdGEsIDEpOwogICAgfSwKICAgIGNoZWNrTW92ZTogZnVuY3Rpb24gY2hlY2tNb3ZlKGV2dCkgewogICAgICB0aGlzLm1vdmVJbmRleCA9IGV2dC5kcmFnZ2VkQ29udGV4dC5pbmRleDsKICAgIH0sCiAgICBlbmQ6IGZ1bmN0aW9uIGVuZCgpIHsKICAgICAgdGhpcy5tb3ZlSW5kZXggPSAnJzsKICAgICAgdGhpcy5nZW5lcmF0ZSgxKTsKICAgIH0sCiAgICAvLyDljZXni6zorr7nva7kvJrlkZjorr7nva4KICAgIGNoZWNrQWxsR3JvdXBDaGFuZ2U6IGZ1bmN0aW9uIGNoZWNrQWxsR3JvdXBDaGFuZ2UoZGF0YSkgewogICAgICB0aGlzLmNoZWNrQWxsR3JvdXAoZGF0YSk7CiAgICB9LAogICAgY2hlY2tBbGxHcm91cDogZnVuY3Rpb24gY2hlY2tBbGxHcm91cChkYXRhKSB7CiAgICAgIHZhciBlbmRMZW5ndGggPSB0aGlzLmF0dHJzLmxlbmd0aCArIDM7CiAgICAgIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS5zcGVjX3R5cGUgPT09IDApIHsKICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDIpIHsKICAgICAgICAgIHRoaXMuY29sdW1uc0luc3RhbGwgPSB0aGlzLmNvbHVtbnMyLnNsaWNlKDAsIGVuZExlbmd0aCkuY29uY2F0KHRoaXMucmFrZUJhY2spLmNvbmNhdCh0aGlzLm1lbWJlcik7CiAgICAgICAgfSBlbHNlIGlmIChkYXRhLmluZGV4T2YoMCkgPiAtMSkgewogICAgICAgICAgdGhpcy5jb2x1bW5zSW5zdGFsbCA9IHRoaXMuY29sdW1uczIuc2xpY2UoMCwgZW5kTGVuZ3RoKS5jb25jYXQodGhpcy5tZW1iZXIpOwogICAgICAgIH0gZWxzZSBpZiAoZGF0YS5pbmRleE9mKDEpID4gLTEpIHsKICAgICAgICAgIHRoaXMuY29sdW1uc0luc3RhbGwgPSB0aGlzLmNvbHVtbnMyLnNsaWNlKDAsIGVuZExlbmd0aCkuY29uY2F0KHRoaXMucmFrZUJhY2spOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmNvbHVtbnNJbnN0YWxsID0gdGhpcy5jb2x1bW5zMi5zbGljZSgwLCBlbmRMZW5ndGgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDIpIHsKICAgICAgICAgIHRoaXMuY29sdW1uc0luc3RhbDIgPSB0aGlzLmNvbHVtbnNJbnN0YWxNLnNsaWNlKDAsIGVuZExlbmd0aCArIDEpLmNvbmNhdCh0aGlzLnJha2VCYWNrKS5jb25jYXQodGhpcy5tZW1iZXIpOwogICAgICAgIH0gZWxzZSBpZiAoZGF0YS5pbmRleE9mKDApID4gLTEpIHsKICAgICAgICAgIHRoaXMuY29sdW1uc0luc3RhbDIgPSB0aGlzLmNvbHVtbnNJbnN0YWxNLnNsaWNlKDAsIGVuZExlbmd0aCkuY29uY2F0KHRoaXMubWVtYmVyKTsKICAgICAgICB9IGVsc2UgaWYgKGRhdGEuaW5kZXhPZigxKSA+IC0xKSB7CiAgICAgICAgICB0aGlzLmNvbHVtbnNJbnN0YWwyID0gdGhpcy5jb2x1bW5zSW5zdGFsTS5zbGljZSgwLCBlbmRMZW5ndGgpLmNvbmNhdCh0aGlzLnJha2VCYWNrKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jb2x1bW5zSW5zdGFsMiA9IHRoaXMuY29sdW1uc0luc3RhbE0uc2xpY2UoMCwgZW5kTGVuZ3RoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDmt7vliqDkvJjmg6DliLgKICAgIGFkZENvdXBvbjogZnVuY3Rpb24gYWRkQ291cG9uKCkgewogICAgICB0aGlzLiRyZWZzLmNvdXBvblRlbXBsYXRlcy5pc1RlbXBsYXRlID0gdHJ1ZTsKICAgICAgdGhpcy4kcmVmcy5jb3Vwb25UZW1wbGF0ZXMudGFibGVMaXN0KCk7CiAgICB9LAogICAgLy8g6KeE5qC85Lit5LyY5oOg5Yi45p+l55yLCiAgICBzZWU6IGZ1bmN0aW9uIHNlZShkYXRhLCBuYW1lLCBpbmRleCkgewogICAgICB0aGlzLnRhYk5hbWUgPSBuYW1lOwogICAgICB0aGlzLnRhYkluZGV4ID0gaW5kZXg7CiAgICAgIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS52aXJ0dWFsX3R5cGUgPT09IDEpIHsKICAgICAgICBpZiAoZGF0YS5kaXNrX2luZm8gIT0gJycpIHsKICAgICAgICAgIHRoaXMuZGlza190eXBlID0gMTsKICAgICAgICAgIHRoaXMuZGlza19pbmZvID0gZGF0YS5kaXNrX2luZm87CiAgICAgICAgICB0aGlzLnN0b2NrID0gZGF0YS5zdG9jazsKICAgICAgICB9IGVsc2UgaWYgKGRhdGEudmlydHVhbF9saXN0Lmxlbmd0aCkgewogICAgICAgICAgdGhpcy5kaXNrX3R5cGUgPSAyOwogICAgICAgICAgdGhpcy52aXJ0dWFsTGlzdCA9IGRhdGEudmlydHVhbF9saXN0OwogICAgICAgIH0KICAgICAgICB0aGlzLmFkZFZpcnR1YWxNb2RlbCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kcmVmcy5nb29kc0NvdXBvbi5pc1RlbXBsYXRlID0gdHJ1ZTsKICAgICAgICB0aGlzLiRyZWZzLmdvb2RzQ291cG9uLnRhYmxlTGlzdCgzKTsKICAgICAgfQogICAgfSwKICAgIC8vIOS/ruaUueWIhuS9o+avlOS+iwogICAgY2hhbmdlRGlzY291bnQ6IGZ1bmN0aW9uIGNoYW5nZURpc2NvdW50KGluZGV4KSB7CiAgICAgIHZhciB0eXBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAnbWFueUZvcm1WYWxpZGF0ZSc7CiAgICAgIC8vIOagueaNruWIhuS9o+avlOS+iyB2aXBfcHJvcG9ydGlvbiDkv67mlLnkvJrlkZjku7cg5L+d55WZMuS9jeWwj+aVsAogICAgICB0aGlzW3R5cGVdW2luZGV4XS52aXBfcHJpY2UgPSAodGhpc1t0eXBlXVtpbmRleF0ucHJpY2UgKiAodGhpc1t0eXBlXVtpbmRleF0udmlwX3Byb3BvcnRpb24gLyAxMDApKS50b0ZpeGVkKDIpOwogICAgfSwKICAgIC8vIOS/ruaUueS8muWRmOS7twogICAgY2hhbmdlVmlwUHJpY2U6IGZ1bmN0aW9uIGNoYW5nZVZpcFByaWNlKGluZGV4KSB7CiAgICAgIHZhciB0eXBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAnbWFueUZvcm1WYWxpZGF0ZSc7CiAgICAgIC8vIOagueaNruS8muWRmOS7t+iuoeeul+WHuuWIhuS9o+avlOS+iwogICAgICB0aGlzW3R5cGVdW2luZGV4XS52aXBfcHJvcG9ydGlvbiA9ICh0aGlzW3R5cGVdW2luZGV4XS52aXBfcHJpY2UgLyB0aGlzW3R5cGVdW2luZGV4XS5wcmljZSAqIDEwMCkudG9GaXhlZCgyKTsKICAgIH0sCiAgICAvLyDmt7vliqDkvJjmg6DliLgKICAgIGFkZEdvb2RzQ291cG9uOiBmdW5jdGlvbiBhZGRHb29kc0NvdXBvbihpbmRleCwgbmFtZSkgewogICAgICB0aGlzLnRhYkluZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMudGFiTmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuJHJlZnMuZ29vZHNDb3Vwb24uaXNUZW1wbGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuJHJlZnMuZ29vZHNDb3Vwb24udGFibGVMaXN0KDMpOwogICAgfSwKICAgIGFkZFZpcnR1YWw6IGZ1bmN0aW9uIGFkZFZpcnR1YWwoaW5kZXgsIG5hbWUpIHsKICAgICAgdGhpcy50YWJJbmRleCA9IGluZGV4OwogICAgICB0aGlzLnRhYk5hbWUgPSBuYW1lOwogICAgICB0aGlzLmFkZFZpcnR1YWxNb2RlbCA9IHRydWU7CiAgICB9LAogICAgLy8g5o+Q5Lqk5Y2h5a+G5L+h5oGvCiAgICB1cFZpcnR1YWw6IGZ1bmN0aW9uIHVwVmlydHVhbCgpIHsKICAgICAgaWYgKHRoaXMuZGlza190eXBlID09IDIpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudmlydHVhbExpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy52aXJ0dWFsTGlzdFtpXTsKICAgICAgICAgIGlmICghZWxlbWVudC52YWx1ZSkgewogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfor7fovpPlhaXmiYDmnInljaHlr4YnKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLiRzZXQodGhpc1t0aGlzLnRhYk5hbWVdW3RoaXMudGFiSW5kZXhdLCAndmlydHVhbF9saXN0JywgdGhpcy52aXJ0dWFsTGlzdCk7CiAgICAgICAgdGhpcy4kc2V0KHRoaXNbdGhpcy50YWJOYW1lXVt0aGlzLnRhYkluZGV4XSwgJ3N0b2NrJywgdGhpcy52aXJ0dWFsTGlzdC5sZW5ndGgpOwogICAgICAgIHRoaXMudmlydHVhbExpc3QgPSBbewogICAgICAgICAga2V5OiAnJywKICAgICAgICAgIHZhbHVlOiAnJwogICAgICAgIH1dOwogICAgICAgIHRoaXMuJHNldCh0aGlzW3RoaXMudGFiTmFtZV1bdGhpcy50YWJJbmRleF0sICdkaXNrX2luZm8nLCAnJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF0aGlzLmRpc2tfaW5mby5sZW5ndGgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfor7floavlhpnljaHlr4bkv6Hmga8nKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLnN0b2NrKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign6K+35aGr5YaZ5bqT5a2Y5pWw6YePJyk7CiAgICAgICAgfQogICAgICAgIHRoaXMuJHNldCh0aGlzW3RoaXMudGFiTmFtZV1bdGhpcy50YWJJbmRleF0sICdzdG9jaycsIE51bWJlcih0aGlzLnN0b2NrKSk7CiAgICAgICAgdGhpcy4kc2V0KHRoaXNbdGhpcy50YWJOYW1lXVt0aGlzLnRhYkluZGV4XSwgJ3N0b2NrJywgTnVtYmVyKHRoaXMuc3RvY2spKTsKICAgICAgICB0aGlzLiRzZXQodGhpc1t0aGlzLnRhYk5hbWVdW3RoaXMudGFiSW5kZXhdLCAnZGlza19pbmZvJywgdGhpcy5kaXNrX2luZm8pOwogICAgICAgIHRoaXMuJHNldCh0aGlzW3RoaXMudGFiTmFtZV1bdGhpcy50YWJJbmRleF0sICd2aXJ0dWFsX2xpc3QnLCBbXSk7CiAgICAgIH0KICAgICAgdGhpcy5hZGRWaXJ0dWFsTW9kZWwgPSBmYWxzZTsKICAgICAgdGhpcy5jbG9zZVZpcnR1YWwoKTsKICAgIH0sCiAgICAvLyAg5Yid5aeL5YyW5Y2h5a+G5pWw5o2u5L+h5oGvCiAgICBjbG9zZVZpcnR1YWw6IGZ1bmN0aW9uIGNsb3NlVmlydHVhbCgpIHsKICAgICAgdGhpcy5hZGRWaXJ0dWFsTW9kZWwgPSBmYWxzZTsKICAgICAgdGhpcy52aXJ0dWFsTGlzdCA9IFt7CiAgICAgICAga2V5OiAnJywKICAgICAgICB2YWx1ZTogJycKICAgICAgfV07CiAgICAgIHRoaXMuZGlza19pbmZvID0gJyc7CiAgICAgIHRoaXMuc3RvY2sgPSAwOwogICAgfSwKICAgIC8v5a+56LGh5pWw57uE5Y676YeN77ybCiAgICB1bmlxdWVBcnJheTogZnVuY3Rpb24gdW5pcXVlQXJyYXkoYXJyKSB7CiAgICAgIHZhciBzZWVuID0ge307CiAgICAgIHJldHVybiBhcnIuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdmFyIGtleSA9IEpTT04uc3RyaW5naWZ5KGl0ZW0pOyAvLyDkvb/nlKggSlNPTi5zdHJpbmdpZnkg55Sf5oiQ5ZSv5LiA6ZSuCiAgICAgICAgaWYgKHNlZW5ba2V5XSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWVuW2tleV0gPSB0cnVlOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAvLyDojrflj5bkvJjmg6DliLhpZOaVsOaNrgogICAgbmFtZUlkOiBmdW5jdGlvbiBuYW1lSWQoaWQsIG5hbWVzKSB7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmNvdXBvbl9pZHMgPSBpZDsKICAgICAgdGhpcy5jb3Vwb25OYW1lID0gdGhpcy51bmlxdWVBcnJheShuYW1lcyk7CiAgICB9LAogICAgLy8g6I635Y+W5LyY5oOg5Yi45L+h5oGvCiAgICBnb29kc0NvdXBvbklkOiBmdW5jdGlvbiBnb29kc0NvdXBvbklkKGRhdGEpIHsKICAgICAgdGhpcy4kc2V0KHRoaXNbdGhpcy50YWJOYW1lXVt0aGlzLnRhYkluZGV4XSwgJ2NvdXBvbl9pZCcsIGRhdGEuaWQpOwogICAgICB0aGlzLiRzZXQodGhpc1t0aGlzLnRhYk5hbWVdW3RoaXMudGFiSW5kZXhdLCAnY291cG9uX25hbWUnLCBkYXRhLnRpdGxlKTsKICAgICAgdGhpcy4kcmVmcy5nb29kc0NvdXBvbi5pc1RlbXBsYXRlID0gZmFsc2U7CiAgICB9LAogICAgaGFuZGxlQ2xvc2U6IGZ1bmN0aW9uIGhhbmRsZUNsb3NlKG5hbWUpIHsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5jb3Vwb25OYW1lLmluZGV4T2YobmFtZSk7CiAgICAgIHRoaXMuY291cG9uTmFtZS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB2YXIgY291cG9uSWRzID0gdGhpcy5mb3JtVmFsaWRhdGUuY291cG9uX2lkczsKICAgICAgY291cG9uSWRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMudXBkYXRlSWRzID0gY291cG9uSWRzOwogICAgICB0aGlzLnVwZGF0ZU5hbWUgPSB0aGlzLmNvdXBvbk5hbWU7CiAgICB9LAogICAgLy8g5re75Yqg6L+Q6LS55qih5p2/CiAgICBhZGRUZW1wOiBmdW5jdGlvbiBhZGRUZW1wKCkgewogICAgICB0aGlzLiRyZWZzLnRlbXBsYXRlcy5pc1RlbXBsYXRlID0gdHJ1ZTsKICAgIH0sCiAgICBhZGRWaWRlbzogZnVuY3Rpb24gYWRkVmlkZW8oKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKICAgICAgdGhpcy4kdmlkZW9Nb2RhbChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTEuZm9ybVZhbGlkYXRlLnZpZGVvX2xpbmsgPSBlOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDliKDpmaTop4bpopHvvJsKICAgIGRlbFZpZGVvOiBmdW5jdGlvbiBkZWxWaWRlbygpIHsKICAgICAgdGhpcy4kc2V0KHRoaXMuZm9ybVZhbGlkYXRlLCAndmlkZW9fbGluaycsICcnKTsKICAgICAgdGhpcy4kc2V0KHRoaXMsICdwcm9ncmVzcycsIDApOwogICAgICB0aGlzLnZpZGVvSW5nID0gZmFsc2U7CiAgICAgIHRoaXMudXBsb2FkLnZpZGVvSW5nID0gZmFsc2U7CiAgICB9LAogICAgemhfdXBsb2FkRmlsZTogZnVuY3Rpb24gemhfdXBsb2FkRmlsZSgpIHsKICAgICAgaWYgKHRoaXMuc2VsZXRWaWRlbyA9PSAxKSB7CiAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUudmlkZW9fbGluayA9IHRoaXMudmlkZW9MaW5rOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJHJlZnMucmVmaWQuY2xpY2soKTsKICAgICAgfQogICAgfSwKICAgIC8vIOS4iuS8oOinhumikQogICAgemhfdXBsb2FkRmlsZV9jaGFuZ2U6IGZ1bmN0aW9uIHpoX3VwbG9hZEZpbGVfY2hhbmdlKGV2ZmlsZSkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CiAgICAgIHZhciBzdWZmaXggPSBldmZpbGUudGFyZ2V0LmZpbGVzWzBdLm5hbWUuc3Vic3RyKGV2ZmlsZS50YXJnZXQuZmlsZXNbMF0ubmFtZS5pbmRleE9mKCcuJykpOwogICAgICBpZiAoc3VmZml4LmluZGV4T2YoJy5tcDQnKSA9PT0gLTEpIHsKICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign5Y+q6IO95LiK5LygTVA05paH5Lu2Jyk7CiAgICAgIH0KICAgICAgdmFyIHR5cGVzID0gewogICAgICAgIGtleTogZXZmaWxlLnRhcmdldC5maWxlc1swXS5uYW1lLAogICAgICAgIGNvbnRlbnRUeXBlOiBldmZpbGUudGFyZ2V0LmZpbGVzWzBdLnR5cGUKICAgICAgfTsKICAgICAgcHJvZHVjdEdldFRlbXBLZXlzQXBpKHR5cGVzKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczEyLiR2aWRlb0Nsb3VkLnZpZGVvVXBsb2FkKHsKICAgICAgICAgIHR5cGU6IHJlcy5kYXRhLnR5cGUsCiAgICAgICAgICBldmZpbGU6IGV2ZmlsZSwKICAgICAgICAgIHJlczogcmVzLAogICAgICAgICAgdXBsb2FkaW5nOiBmdW5jdGlvbiB1cGxvYWRpbmcoc3RhdHVzLCBwcm9ncmVzcykgewogICAgICAgICAgICB0aGlzLnVwbG9hZC52aWRlb0luZyA9IHN0YXR1czsKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT0gMjAwKSB7CiAgICAgICAgICAgICAgdGhpcy5wcm9ncmVzcyA9IDEwMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXMxMi5mb3JtVmFsaWRhdGUudmlkZW9fbGluayA9IHJlcy51cmw7CiAgICAgICAgICBfdGhpczEyLiRtZXNzYWdlLnN1Y2Nlc3MoJ+inhumikeS4iuS8oOaIkOWKnycpOwogICAgICAgICAgX3RoaXMxMi51cGxvYWQudmlkZW9JbmcgPSBmYWxzZTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBfdGhpczEyLiRtZXNzYWdlLmVycm9yKHJlcyk7CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczEyLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDkuIrkuIDpobXvvJsKICAgIHVwVGFiOiBmdW5jdGlvbiB1cFRhYigpIHsKICAgICAgdGhpcy5jdXJyZW50VGFiID0gKE51bWJlcih0aGlzLmN1cnJlbnRUYWIpIC0gMSkudG9TdHJpbmcoKTsKICAgIH0sCiAgICAvLyDkuIvkuIDpobXvvJsKICAgIGRvd25UYWI6IGZ1bmN0aW9uIGRvd25UYWIoKSB7CiAgICAgIHRoaXMuY3VycmVudFRhYiA9IChOdW1iZXIodGhpcy5jdXJyZW50VGFiKSArIDEpLnRvU3RyaW5nKCk7CiAgICB9LAogICAgLy8g5bGe5oCn5by556qX5Zue6LCD5Ye95pWw77ybCiAgICB1c2VyU2VhcmNoczogZnVuY3Rpb24gdXNlclNlYXJjaHMoKSB7CiAgICAgIHRoaXMucHJvZHVjdEdldFJ1bGUoKTsKICAgIH0sCiAgICAvLyDmt7vliqDop4TliJnvvJsKICAgIGFkZFJ1bGU6IGZ1bmN0aW9uIGFkZFJ1bGUoKSB7CiAgICAgIHRoaXMuJHJlZnMuYWRkYXR0ci5tb2RhbCA9IHRydWU7CiAgICB9LAogICAgLy8g5om56YeP6K6+572u5YiG5L2j77ybCiAgICBicm9rZXJhZ2VTZXRVcDogZnVuY3Rpb24gYnJva2VyYWdlU2V0VXAoKSB7CiAgICAgIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS5pc19zdWIuaW5kZXhPZigxKSA+IC0xKSB7CiAgICAgICAgaWYgKHRoaXMubWFueUJyb2tlcmFnZSA8PSAwIHx8IHRoaXMubWFueUJyb2tlcmFnZVR3byA8PSAwKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign6K+35aGr5YaZ6L+U5L2j6YeR6aKd5ZCO6L+b6KGM5om56YeP5re75YqgJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLmlzX3N1Yi5pbmRleE9mKDApID4gLTEpIHsKICAgICAgICBpZiAodGhpcy5tYW55VmlwUHJpY2UgPD0gMCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+Whq+WGmeS8muWRmOS7t+WQjui/m+ihjOaJuemHj+a3u+WKoCcpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGhpcy5mb3JtVmFsaWRhdGUuaXNfc3ViLmxlbmd0aCA9PT0gMikgewogICAgICAgIGlmICh0aGlzLm1hbnlCcm9rZXJhZ2UgPD0gMCB8fCB0aGlzLm1hbnlCcm9rZXJhZ2VUd28gPD0gMCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+Whq+WGmeWujOmHkemineWQjui/m+ihjOaJuemHj+a3u+WKoCcpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5tYW55VmlwUHJpY2UgPiAwICYmIHRoaXMubWFueVZpcERpc2NvdW50ID4gMCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S8muWRmOS7t+WSjOS8muWRmOaKmOaJo+WPquiDveS6jOmAieS4gOa3u+WKoCcpOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5tYW55Rm9ybVZhbGlkYXRlKSwKICAgICAgICBfc3RlcDsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHZhbCA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgdGhpcy5tYW55QnJva2VyYWdlICE9IHVuZGVmaW5lZCAmJiB0aGlzLiRzZXQodmFsLCAnYnJva2VyYWdlJywgdGhpcy5tYW55QnJva2VyYWdlKTsKICAgICAgICAgIHRoaXMubWFueUJyb2tlcmFnZVR3byAhPSB1bmRlZmluZWQgJiYgdGhpcy4kc2V0KHZhbCwgJ2Jyb2tlcmFnZV90d28nLCB0aGlzLm1hbnlCcm9rZXJhZ2VUd28pOwogICAgICAgICAgaWYgKHRoaXMubWFueVZpcFByaWNlICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLiRzZXQodmFsLCAndmlwX3ByaWNlJywgdGhpcy5tYW55VmlwUHJpY2UpOwogICAgICAgICAgICB0aGlzLiRzZXQodmFsLCAndmlwX3Byb3BvcnRpb24nLCAodmFsLnZpcF9wcmljZSAvIHZhbC5wcmljZSAqIDEwMCkudG9GaXhlZCgyKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLiRzZXQodmFsLCAndmlwX3Byb3BvcnRpb24nLCB0aGlzLm1hbnlWaXBEaXNjb3VudCk7CiAgICAgICAgICAgIHRoaXMuJHNldCh2YWwsICd2aXBfcHJpY2UnLCAodmFsLnByaWNlICogKHRoaXMubWFueVZpcERpc2NvdW50IC8gMTAwKSkudG9GaXhlZCgyKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDmibnph4/orr7nva7kvJrlkZjku7cKICAgIHZpcFByaWNlU2V0VXA6IGZ1bmN0aW9uIHZpcFByaWNlU2V0VXAoKSB7CiAgICAgIGlmICh0aGlzLm1hbnlWaXBQcmljZSA8PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+Whq+WGmeS8muWRmOS7t+WcqOi/m+ihjOaJuemHj+a3u+WKoCcpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5tYW55Rm9ybVZhbGlkYXRlKSwKICAgICAgICAgIF9zdGVwMjsKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIHZhbCA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgICAgdGhpcy4kc2V0KHZhbCwgJ3ZpcF9wcmljZScsIHRoaXMubWFueVZpcFByaWNlKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3IyLmYoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDmlrDlop7ljaHlr4YKICAgIGhhbmRsZUFkZDogZnVuY3Rpb24gaGFuZGxlQWRkKCkgewogICAgICB0aGlzLnZpcnR1YWxMaXN0LnB1c2goewogICAgICAgIGtleTogJycsCiAgICAgICAgdmFsdWU6ICcnCiAgICAgIH0pOwogICAgfSwKICAgIC8vIOWIneWni+WMluWNoeWvhuS/oeaBrwogICAgaW5pdFZpcnR1YWxEYXRhOiBmdW5jdGlvbiBpbml0VmlydHVhbERhdGEoc3RhdHVzKSB7CiAgICAgIHRoaXMudmlydHVhbExpc3QgPSBbewogICAgICAgIGtleTogJycsCiAgICAgICAgdmFsdWU6ICcnCiAgICAgIH1dOwogICAgfSwKICAgIHJlbW92ZVZpcnR1YWw6IGZ1bmN0aW9uIHJlbW92ZVZpcnR1YWwoaW5kZXgpIHsKICAgICAgdGhpcy52aXJ0dWFsTGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgfSwKICAgIC8vIOa4heepuuaJuemHj+inhOagvOS/oeaBrwogICAgYmF0Y2hEZWw6IGZ1bmN0aW9uIGJhdGNoRGVsKCkgewogICAgICB0aGlzLm9uZUZvcm1CYXRjaCA9IFt7CiAgICAgICAgcGljOiAnJywKICAgICAgICBwcmljZTogdm9pZCAwLAogICAgICAgIGNvc3Q6IHZvaWQgMCwKICAgICAgICBvdF9wcmljZTogdm9pZCAwLAogICAgICAgIHN0b2NrOiB2b2lkIDAsCiAgICAgICAgYmFyX2NvZGU6ICcnLAogICAgICAgIGJhcl9jb2RlX251bWJlcjogJycsCiAgICAgICAgd2VpZ2h0OiB2b2lkIDAsCiAgICAgICAgdm9sdW1lOiB2b2lkIDAsCiAgICAgICAgdmlydHVhbF9saXN0OiBbXQogICAgICB9XTsKICAgIH0sCiAgICBjb25maXJtOiBmdW5jdGlvbiBjb25maXJtKG5hbWUpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwogICAgICB0aGlzLmNyZWF0ZUJudCA9IHRydWU7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnNlbGVjdFJ1bGUgPSBuYW1lOwogICAgICB0aGlzLmF0dHJzID0gW107CiAgICAgIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS5zZWxlY3RSdWxlLnRyaW0oKS5sZW5ndGggPD0gMCkgewogICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfor7fpgInmi6nlsZ7mgKcnKTsKICAgICAgfQogICAgICB0aGlzLnJ1bGVMaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgaWYgKGl0ZW0ucnVsZV9uYW1lID09PSBfdGhpczEzLmZvcm1WYWxpZGF0ZS5zZWxlY3RSdWxlKSB7CiAgICAgICAgICBfdGhpczEzLmF0dHJzID0gX3RvQ29uc3VtYWJsZUFycmF5KGl0ZW0ucnVsZV92YWx1ZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5jYW5TZWwgPSB0cnVlOwogICAgICB0aGlzLmdlbmVyYXRlQXR0cih0aGlzLmF0dHJzKTsKICAgIH0sCiAgICAvLyDpgInmi6nop4TmoLzmqKHmnb8KICAgIGhhbmRsZUNvbW1hbmQ6IGZ1bmN0aW9uIGhhbmRsZUNvbW1hbmQoZSkge30sCiAgICAvLyDojrflj5bllYblk4HlsZ7mgKfmqKHmnb/vvJsKICAgIHByb2R1Y3RHZXRSdWxlOiBmdW5jdGlvbiBwcm9kdWN0R2V0UnVsZSgpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwogICAgICBwcm9kdWN0R2V0UnVsZUFwaSgpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMTQucnVsZUxpc3QgPSByZXMuZGF0YTsKICAgICAgfSk7CiAgICB9LAogICAgLy8g6I635Y+W6L+Q6LS55qih5p2/77ybCiAgICBwcm9kdWN0R2V0VGVtcGxhdGU6IGZ1bmN0aW9uIHByb2R1Y3RHZXRUZW1wbGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwogICAgICBwcm9kdWN0R2V0VGVtcGxhdGVBcGkoKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczE1LnRlbXBsYXRlTGlzdCA9IHJlcy5kYXRhOwogICAgICB9KTsKICAgIH0sCiAgICBwYXJhbXNHZXRUZW1wbGF0ZTogZnVuY3Rpb24gcGFyYW1zR2V0VGVtcGxhdGUoKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKICAgICAgcGFyYW1MaXN0QXBpKCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMxNi5wYXJhbXNUeXBlTGlzdCA9IHJlcy5kYXRhLmxpc3Q7CiAgICAgIH0pOwogICAgfSwKICAgIGNoYW5nZVBhcmFtc1R5cGU6IGZ1bmN0aW9uIGNoYW5nZVBhcmFtc1R5cGUoZSkgewogICAgICBlID8gdGhpcy5nZXRQYXJhbXMoZSkgOiB0aGlzLmZvcm1WYWxpZGF0ZS5wYXJhbXNfbGlzdCA9IFtdOwogICAgfSwKICAgIGdldFBhcmFtczogZnVuY3Rpb24gZ2V0UGFyYW1zKGlkKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKICAgICAgcGFyYW1JbmZvQXBpKGlkKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczE3LmZvcm1WYWxpZGF0ZS5wYXJhbXNfbGlzdCA9IHJlcy5kYXRhLnZhbHVlOwogICAgICB9KTsKICAgIH0sCiAgICBpc1N1YnNldDogZnVuY3Rpb24gaXNTdWJzZXQoYXJyMSwgYXJyMikgewogICAgICAvLyDlsIbmlbDnu4TovazmjaLkuLogU2V077yM5Lul5L6/6L+b6KGM6auY5pWI55qE5YyF5ZCr5qOA5p+lCiAgICAgIHZhciBzZXQxID0gbmV3IFNldChhcnIxKTsKICAgICAgdmFyIHNldDIgPSBuZXcgU2V0KGFycjIpOwoKICAgICAgLy8g5qOA5p+lIHNldDIg5Lit55qE5q+P5Liq5YWD57Sg5piv5ZCm6YO95ZyoIHNldDEg5LitCiAgICAgIHZhciBfaXRlcmF0b3IzID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoc2V0MiksCiAgICAgICAgX3N0ZXAzOwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgZWxlbSA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgIGlmICghc2V0MS5oYXMoZWxlbSkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgLy8g5om56YeP5re75YqgCiAgICBiYXRjaEFkZDogZnVuY3Rpb24gYmF0Y2hBZGQoKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKICAgICAgdmFyIGFyciA9IFtdOwogICAgICB2YXIgX2l0ZXJhdG9yNCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMuYXR0cnMpLAogICAgICAgIF9zdGVwNDsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHZhbCA9IF9zdGVwNC52YWx1ZTsKICAgICAgICAgIGlmICh0aGlzLm9uZUZvcm1CYXRjaFswXVt2YWwudmFsdWVdKSB7CiAgICAgICAgICAgIGFyci5wdXNoKHRoaXMub25lRm9ybUJhdGNoWzBdW3ZhbC52YWx1ZV0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g5om56YeP6K6+572u5ZWG5ZOB6KeE5qC85bGe5oCnCiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjQuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjQuZigpOwogICAgICB9CiAgICAgIHZhciBiYXRjaEZpZWxkcyA9IFsncGljJywgJ3ByaWNlJywgJ2Nvc3QnLCAnb3RfcHJpY2UnLCAnc3RvY2snLCAnd2VpZ2h0JywgJ3ZvbHVtZScsICdiYXJfY29kZScsICdiYXJfY29kZV9udW1iZXInXTsKICAgICAgLy8gY29uc3QgZGVmYXVsdEZpZWxkcyA9IFsnYmFyX2NvZGUnLCAnYmFyX2NvZGVfbnVtYmVyJ107CiAgICAgIHZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5tYW55Rm9ybVZhbGlkYXRlKSwKICAgICAgICBfc3RlcDU7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoKSB7CiAgICAgICAgICB2YXIgdmFsID0gX3N0ZXA1LnZhbHVlOwogICAgICAgICAgdmFyIGJhdGNoID0gX3RoaXMxOC5vbmVGb3JtQmF0Y2hbMF07CiAgICAgICAgICAvLyDlpoLmnpzlrZjlnKjnrZvpgInmnaHku7bkuJTmu6HotrPmnaHku7Ys5oiW5peg562b6YCJ5p2h5Lu25pe2CiAgICAgICAgICBpZiAoIWFyci5sZW5ndGggfHwgX3RoaXMxOC5pc1N1YnNldCh2YWwuYXR0cl9hcnIsIGFycikpIHsKICAgICAgICAgICAgLy8g6K6+572u5pyJ5YC855qE5om56YeP5a2X5q61CiAgICAgICAgICAgIGJhdGNoRmllbGRzLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgICAgICAgaWYgKGJhdGNoW2ZpZWxkXSAmJiBiYXRjaFtmaWVsZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkID09PSAncGljJyAmJiBiYXRjaFtmaWVsZF0pIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxOC4kc2V0KHZhbCwgZmllbGQsIGJhdGNoW2ZpZWxkXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkICE9ICdwaWMnKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTguJHNldCh2YWwsIGZpZWxkLCBiYXRjaFtmaWVsZF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyDorr7nva7pu5jorqTlrZfmrrUKICAgICAgICAgICAgLy8gZGVmYXVsdEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4gewogICAgICAgICAgICAvLyAgIHRoaXMuJHNldCh2YWwsIGZpZWxkLCBiYXRjaFtmaWVsZF0pOwogICAgICAgICAgICAvLyB9KTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGZvciAoX2l0ZXJhdG9yNS5zKCk7ICEoX3N0ZXA1ID0gX2l0ZXJhdG9yNS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICBfbG9vcCgpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yNS5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yNS5mKCk7CiAgICAgIH0KICAgIH0sCiAgICBjaGFuZ2VTcGVjSW1nOiBmdW5jdGlvbiBjaGFuZ2VTcGVjSW1nKGFyciwgaW1nKSB7CiAgICAgIHZhciBfdGhpczE5ID0gdGhpczsKICAgICAgLy8g5Yik5pat5piv5ZCm5a2Y5Zyo6KeE5qC85Zu+CiAgICAgIHZhciBpc0hhcyA9IGZhbHNlOwogICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRoaXMubWFueUZvcm1WYWxpZGF0ZS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBpdGVtID0gdGhpcy5tYW55Rm9ybVZhbGlkYXRlW2ldOwogICAgICAgIGlmIChpdGVtLnBpYyAmJiB0aGlzLmlzU3Vic2V0KGl0ZW0uYXR0cl9hcnIsIGFycikpIHsKICAgICAgICAgIGlzSGFzID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaXNIYXMpIHsKICAgICAgICB0aGlzLiRjb25maXJtKCflj6/ku6XlkIzmraXkv67mlLnkuIvmlrnor6Xop4TmoLzlm77niYfvvIznoa7lrpropoHmm7/mjaLlkJfvvJ8nLCAn5o+Q56S6JywgewogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfmm7/mjaInLAogICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+aaguS4jScsCiAgICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBfaXRlcmF0b3I2ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoX3RoaXMxOS5tYW55Rm9ybVZhbGlkYXRlKSwKICAgICAgICAgICAgX3N0ZXA2OwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChfaXRlcmF0b3I2LnMoKTsgIShfc3RlcDYgPSBfaXRlcmF0b3I2Lm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICB2YXIgdmFsID0gX3N0ZXA2LnZhbHVlOwogICAgICAgICAgICAgIGlmIChfdGhpczE5LmlzU3Vic2V0KHZhbC5hdHRyX2FyciwgYXJyKSkgewogICAgICAgICAgICAgICAgX3RoaXMxOS4kc2V0KHZhbCwgJ3BpYycsIGltZyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yNi5lKGVycik7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaXRlcmF0b3I2LmYoKTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIF9pdGVyYXRvcjcgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLm1hbnlGb3JtVmFsaWRhdGUpLAogICAgICAgICAgX3N0ZXA3OwogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjcucygpOyAhKF9zdGVwNyA9IF9pdGVyYXRvcjcubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgdmFsID0gX3N0ZXA3LnZhbHVlOwogICAgICAgICAgICBpZiAodGhpcy5pc1N1YnNldCh2YWwuYXR0cl9hcnIsIGFycikpIHsKICAgICAgICAgICAgICB0aGlzLiRzZXQodmFsLCAncGljJywgaW1nKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yNy5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjcuZigpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIOeri+WNs+eUn+aIkAogICAgZ2VuZXJhdGU6IGZ1bmN0aW9uIGdlbmVyYXRlKHR5cGUsIGlzQ29weSwgYXJyKSB7CiAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZSA9IFtdOwogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5oZWFkZXIgPSBbXTsKICAgIH0sCiAgICBjbGVhckF0dHI6IGZ1bmN0aW9uIGNsZWFyQXR0cigpIHsKICAgICAgdGhpcy5mb3JtRHluYW1pYy5hdHRyc05hbWUgPSAnJzsKICAgICAgdGhpcy5mb3JtRHluYW1pYy5hdHRyc1ZhbCA9ICcnOwogICAgfSwKICAgIC8vIOWIoOmZpOinhOagvAogICAgaGFuZGxlUmVtb3ZlUm9sZTogZnVuY3Rpb24gaGFuZGxlUmVtb3ZlUm9sZShpbmRleCkgewogICAgICB0aGlzLmF0dHJzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICBpZiAoIXRoaXMuYXR0cnMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuaGVhZGVyID0gW107CiAgICAgICAgdGhpcy5tYW55Rm9ybVZhbGlkYXRlID0gW107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5nZW5lcmF0ZUF0dHIodGhpcy5hdHRycyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDliKDpmaTooajmoLzkuK0g5a+55bqU5bGe5oCnCiAgICBkZWxBdHRyVGFibGU6IGZ1bmN0aW9uIGRlbEF0dHJUYWJsZSh2YWwpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1hbnlGb3JtVmFsaWRhdGUubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgaXRlbSA9IHRoaXMubWFueUZvcm1WYWxpZGF0ZVtpXTsKICAgICAgICBpZiAoaXRlbS5hdHRyX2FyciAmJiBpdGVtLmF0dHJfYXJyLmluY2x1ZGVzKHZhbCkpIHsKICAgICAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBpLS07CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8g5Yig6Zmk5bGe5oCnCiAgICBoYW5kbGVSZW1vdmUyOiBmdW5jdGlvbiBoYW5kbGVSZW1vdmUyKGl0ZW0sIGluZGV4LCB2YWwpIHsKICAgICAgLy8g5Yig6ZmkIG1hbnlGb3JtVmFsaWRhdGXkuK0gdGl0bGUgPSBpdGVtLnZhbHVlIOeahOWxnuaAp+WAvAogICAgICBpdGVtLnNwbGljZShpbmRleCwgMSk7CiAgICAgIC8vIHRoaXMuZ2VuZXJhdGVBdHRyKHRoaXMuYXR0cnMpOwogICAgICB0aGlzLmRlbEF0dHJUYWJsZSh2YWwpOwogICAgfSwKICAgIC8vIOaWsOWinuinhOagvAogICAgaGFuZGxlQWRkUm9sZTogZnVuY3Rpb24gaGFuZGxlQWRkUm9sZSgpIHsKICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgdmFsdWU6IHRoaXMuZm9ybUR5bmFtaWMuYXR0cnNOYW1lLAogICAgICAgIGFkZF9waWM6IDAsCiAgICAgICAgZGV0YWlsOiBbXQogICAgICB9OwogICAgICB0aGlzLmF0dHJzLnB1c2goZGF0YSk7CiAgICB9LAogICAgaGFuZGxlQWRkUGFyYW1zOiBmdW5jdGlvbiBoYW5kbGVBZGRQYXJhbXMoKSB7CiAgICAgIHZhciBkYXRhID0gewogICAgICAgIG5hbWU6ICcnLAogICAgICAgIHZhbHVlOiAnJwogICAgICB9OwogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5wYXJhbXNfbGlzdC5wdXNoKGRhdGEpOwogICAgfSwKICAgIGhhbmRsZVNhdmVBc1RlbXBsYXRlOiBmdW5jdGlvbiBoYW5kbGVTYXZlQXNUZW1wbGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMjAgPSB0aGlzOwogICAgICB0aGlzLiRwcm9tcHQoJycsICfor7fovpPlhaXmqKHmnb/lkI3np7AnLCB7CiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICB2YXIgdmFsdWUgPSBfcmVmLnZhbHVlOwogICAgICAgIHZhciBzcGVjID0gX3RoaXMyMC5hdHRycy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLAogICAgICAgICAgICBkZXRhaWw6IGl0ZW0uZGV0YWlsLm1hcChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHJldHVybiBlLnZhbHVlOwogICAgICAgICAgICB9KQogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICB2YXIgZm9ybUR5bmFtaWMgPSB7CiAgICAgICAgICBydWxlX25hbWU6IHZhbHVlLAogICAgICAgICAgc3BlYzogc3BlYwogICAgICAgIH07CiAgICAgICAgcnVsZUFkZEFwaShmb3JtRHluYW1pYywgMCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBfdGhpczIwLiRtZXNzYWdlLnN1Y2Nlc3MocmVzLm1zZyk7CiAgICAgICAgICBfdGhpczIwLnByb2R1Y3RHZXRSdWxlKCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXMyMC4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge30pOwogICAgfSwKICAgIC8vIOaWsOWinuS4gOadoeWxnuaApwogICAgYWRkT25lQXR0cjogZnVuY3Rpb24gYWRkT25lQXR0cih2YWwsIHZhbDIpIHsKICAgICAgdGhpcy5nZW5lcmF0ZUF0dHIodGhpcy5hdHRycywgdmFsMik7CiAgICB9LAogICAgaGFuZGxlRm9jdXM6IGZ1bmN0aW9uIGhhbmRsZUZvY3VzKHZhbCkgewogICAgICB0aGlzLmNoYW5nZUF0dHJWYWx1ZSA9IHZhbDsKICAgIH0sCiAgICBoYW5kbGVCbHVyOiBmdW5jdGlvbiBoYW5kbGVCbHVyKCkgewogICAgICB0aGlzLmNoYW5nZUF0dHJWYWx1ZSA9ICcnOwogICAgfSwKICAgIGhhbmRsZVNlbEltZzogZnVuY3Rpb24gaGFuZGxlU2VsSW1nKGl0ZW0pIHsKICAgICAgdmFyIF90aGlzMjEgPSB0aGlzOwogICAgICB0aGlzLiRpbWdNb2RhbChmdW5jdGlvbiAoZSkgewogICAgICAgIGl0ZW0ucGljID0gZS5hdHRfZGlyOwogICAgICAgIF90aGlzMjEuY2hhbmdlU3BlY0ltZyhbaXRlbS52YWx1ZV0sIGUuYXR0X2Rpcik7CiAgICAgIH0pOwogICAgfSwKICAgIGhhbmRsZVJlbW92ZUltZzogZnVuY3Rpb24gaGFuZGxlUmVtb3ZlSW1nKGl0ZW0pIHsKICAgICAgaXRlbS5waWMgPSAnJzsKICAgIH0sCiAgICAvLyDop4TmoLzlkI3np7DmlLnlj5gKICAgIGF0dHJDaGFuZ2VWYWx1ZTogZnVuY3Rpb24gYXR0ckNoYW5nZVZhbHVlKGksIHZhbCkgewogICAgICB2YXIgX3RoaXMyMiA9IHRoaXM7CiAgICAgIGlmICh2YWwudHJpbSgpLmxlbmd0aCAmJiB0aGlzLmF0dHJzW2ldLmRldGFpbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmdlbmVyYXRlSGVhZGVyKHRoaXMuYXR0cnMpOwogICAgICAgIGlmICh0aGlzLm1hbnlGb3JtVmFsaWRhdGUubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLm1hbnlGb3JtVmFsaWRhdGUubWFwKGZ1bmN0aW9uIChpdGVtLCBpKSB7CiAgICAgICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhpdGVtLmRldGFpbCkuaW5jbHVkZXMoX3RoaXMyMi5jaGFuZ2VBdHRyVmFsdWUpKSB7CiAgICAgICAgICAgICAgICBpdGVtLmRldGFpbFt2YWxdID0gaXRlbS5kZXRhaWxbX3RoaXMyMi5jaGFuZ2VBdHRyVmFsdWVdOwogICAgICAgICAgICAgICAgaXRlbVt2YWxdID0gaXRlbVtfdGhpczIyLmNoYW5nZUF0dHJWYWx1ZV07CiAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5kZXRhaWxbX3RoaXMyMi5jaGFuZ2VBdHRyVmFsdWVdOwogICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW1bX3RoaXMyMi5jaGFuZ2VBdHRyVmFsdWVdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNoYW5nZUF0dHJWYWx1ZSA9IHZhbDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5nZW5lcmF0ZUF0dHIodGhpcy5hdHRycyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDop4TmoLzlgLzmlLnlj5gKICAgIGF0dHJEZXRhaWxDaGFuZ2VWYWx1ZTogZnVuY3Rpb24gYXR0ckRldGFpbENoYW5nZVZhbHVlKHZhbCwgaSkgewogICAgICB2YXIgX3RoaXMyMyA9IHRoaXM7CiAgICAgIGlmICh0aGlzLm1hbnlGb3JtVmFsaWRhdGUubGVuZ3RoKSB7CiAgICAgICAgdmFyIGtleSA9IHRoaXMuYXR0cnNbaV0udmFsdWU7CiAgICAgICAgdGhpcy5tYW55Rm9ybVZhbGlkYXRlLm1hcChmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhpdGVtLmRldGFpbCkuaW5jbHVkZXMoa2V5KSAmJiBpdGVtLmRldGFpbFtrZXldID09PSBfdGhpczIzLmNoYW5nZUF0dHJWYWx1ZSkgewogICAgICAgICAgICAgIGl0ZW0uZGV0YWlsW2tleV0gPSB2YWw7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gaXRlbS5hdHRyX2Fyci5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtID09PSBfdGhpczIzLmNoYW5nZUF0dHJWYWx1ZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpdGVtLmF0dHJfYXJyW2luZGV4XSA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY2hhbmdlQXR0clZhbHVlID0gdmFsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZ2VuZXJhdGVBdHRyKHRoaXMuYXR0cnMsIDEpOwogICAgICB9CiAgICB9LAogICAgLy8g6KeE5qC85Zu+54mH5re75Yqg5byA5YWzCiAgICBhZGRQaWM6IGZ1bmN0aW9uIGFkZFBpYyhlLCBpKSB7CiAgICAgIHZhciBfdGhpczI0ID0gdGhpczsKICAgICAgaWYgKGUpIHsKICAgICAgICB0aGlzLmF0dHJzLm1hcChmdW5jdGlvbiAoaXRlbSwgaWkpIHsKICAgICAgICAgIGlmIChpaSAhPT0gaSkgewogICAgICAgICAgICBfdGhpczI0LiRzZXQoaXRlbSwgJ2FkZF9waWMnLCAwKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmNhblNlbCA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY2FuU2VsID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIC8vIOinhOagvOaLluaLveaOkuW6j+WQjgogICAgb25Nb3ZlU3BlYzogZnVuY3Rpb24gb25Nb3ZlU3BlYygpIHsKICAgICAgdGhpcy5nZW5lcmF0ZUF0dHIodGhpcy5hdHRycyk7CiAgICB9LAogICAgY2hhbmdlQ3VycmVudEluZGV4OiBmdW5jdGlvbiBjaGFuZ2VDdXJyZW50SW5kZXgoaSkgewogICAgICB0aGlzLmN1cnJlbnRJbmRleCA9IGk7CiAgICB9LAogICAgLy8g55Sf5oiQ5ZWG5ZOB6KeE5qC86KGo5aS0CiAgICBnZW5lcmF0ZUhlYWRlcjogZnVuY3Rpb24gZ2VuZXJhdGVIZWFkZXIoZGF0YSkgewogICAgICB2YXIgX3RoaXMyNSA9IHRoaXM7CiAgICAgIHZhciBzcGVjaWZpY2F0aW9uc0NvbHVtbnMgPSBkYXRhLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0aXRsZTogaXRlbS52YWx1ZSwKICAgICAgICAgIGtleTogaXRlbS52YWx1ZSwKICAgICAgICAgIG1pbldpZHRoOiAxNDAsCiAgICAgICAgICBmaXhlZDogJ2xlZnQnCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHZhciBhcnI7CiAgICAgIGlmIChbMSwgMl0uaW5jbHVkZXMoTnVtYmVyKHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSkpKSB7CiAgICAgICAgYXJyID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzcGVjaWZpY2F0aW9uc0NvbHVtbnMpLCBfdG9Db25zdW1hYmxlQXJyYXkoVmlydHVhbFRhYmxlSGVhZCkpOwogICAgICAgIC8vIOaJvuWIsHNsb3Qg562J5LqOIGZpY3RpdGlvdXMg5bCGdGl0bGXmlLnkuLrop4TmoLzlkI3np7AKICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5oZWFkZXIubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpZiAoaXRlbS5zbG90ID09PSAnZmljdGl0aW91cycpIHsKICAgICAgICAgICAgaXRlbS50aXRsZSA9IF90aGlzMjUuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSA9PSAxID8gJ+a3u+WKoOWNoeWvhi/nvZHnm5gnIDogJ+mAieaLqeS8mOaDoOWIuCc7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5mb3JtVmFsaWRhdGUudmlydHVhbF90eXBlID09IDMpIHsKICAgICAgICBhcnIgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHNwZWNpZmljYXRpb25zQ29sdW1ucyksIF90b0NvbnN1bWFibGVBcnJheShWaXJ0dWFsVGFibGVIZWFkMikpOwogICAgICB9IGVsc2UgewogICAgICAgIGFyciA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3BlY2lmaWNhdGlvbnNDb2x1bW5zKSwgX3RvQ29uc3VtYWJsZUFycmF5KEdvb2RzVGFibGVIZWFkKSk7CiAgICAgIH0KICAgICAgdGhpcy4kc2V0KHRoaXMuZm9ybVZhbGlkYXRlLCAnaGVhZGVyJywgYXJyKTsKICAgICAgdGhpcy50YWJsZUtleSArPSAxOwogICAgICB0aGlzLmNvbHVtbnNJbnN0YWxNID0gYXJyOwogICAgfSwKICAgIC8qCiAgICAgKiDnlJ/miJDlsZ7mgKcKICAgICAqIEBwYXJhbSB7QXJyYXl9IGRhdGEg6KeE5qC85pWw5o2uCiAgICAgKiAqLwogICAgZ2VuZXJhdGVBdHRyOiBmdW5jdGlvbiBnZW5lcmF0ZUF0dHIoZGF0YSwgdmFsKSB7CiAgICAgIHZhciBfdGhpczI2ID0gdGhpczsKICAgICAgdGhpcy5nZW5lcmF0ZUhlYWRlcihkYXRhKTsKICAgICAgdmFyIGNvbWJpbmF0aW9ucyA9IHRoaXMuZ2VuZXJhdGVDb21iaW5hdGlvbnMoZGF0YSk7CiAgICAgIGNvbnNvbGUubG9nKCfop4TmoLznu4TlkIjmgLvmlbDvvJonICsgY29tYmluYXRpb25zLmxlbmd0aCk7CiAgICAgIHZhciB2aXJ0dWFsVHlwZSA9IHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZTsKICAgICAgLy8g5aaC5p6cY29tYmluYXRpb25z5pWw6YeP6LaF6L+HIDUwMO+8jOWImeWIhuaJueasoeeUn+aIkOWxnuaApwogICAgICB2YXIgcm93cyA9IFtdOwogICAgICBpZiAoY29tYmluYXRpb25zLmxlbmd0aCA+IDUwMCkgewogICAgICAgIHZhciBiYXRjaFNpemUgPSBNYXRoLmNlaWwoY29tYmluYXRpb25zLmxlbmd0aCAvIDUwMCk7CiAgICAgICAgdmFyIF9sb29wMiA9IGZ1bmN0aW9uIF9sb29wMihpKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBkID0gX3RoaXMyNi5nZW5lcmF0ZUF0dHJCYXRjaChkYXRhLCBjb21iaW5hdGlvbnMuc2xpY2UoaSwgaSArIGJhdGNoU2l6ZSksIHZhbCk7CiAgICAgICAgICAgIHJvd3MgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHJvd3MpLCBfdG9Db25zdW1hYmxlQXJyYXkoZCkpOwogICAgICAgICAgICBfdGhpczI2Lm1hbnlGb3JtVmFsaWRhdGUgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KF90aGlzMjYub25lRm9ybUJhdGNoKSwgX3RvQ29uc3VtYWJsZUFycmF5KHJvd3MpKTsKICAgICAgICAgIH0sIDApOwogICAgICAgIH07CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb21iaW5hdGlvbnMubGVuZ3RoOyBpICs9IGJhdGNoU2l6ZSkgewogICAgICAgICAgX2xvb3AyKGkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByb3dzID0gdGhpcy5nZW5lcmF0ZUF0dHJCYXRjaChkYXRhLCBjb21iaW5hdGlvbnMsIHZhbCk7CiAgICAgICAgdGhpcy5tYW55Rm9ybVZhbGlkYXRlID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aGlzLm9uZUZvcm1CYXRjaCksIF90b0NvbnN1bWFibGVBcnJheShyb3dzKSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDnlJ/miJDlsZ7mgKfmibnmrKEKICAgIGdlbmVyYXRlQXR0ckJhdGNoOiBmdW5jdGlvbiBnZW5lcmF0ZUF0dHJCYXRjaChkYXRhLCBjb21iaW5hdGlvbnMsIHZhbCkgewogICAgICB2YXIgX3RoaXMyNyA9IHRoaXM7CiAgICAgIHZhciBleGlzdGluZ0l0ZW1zID0gdGhpcy5tYW55Rm9ybVZhbGlkYXRlLnNsaWNlKDEpOyAvLyDmjpLpmaTnrKzkuIDpobnpu5jorqTmlbDmja4KCiAgICAgIHZhciByb3dzID0gY29tYmluYXRpb25zLm1hcChmdW5jdGlvbiAoY29tYmluYXRpb24pIHsKICAgICAgICB2YXIgcm93ID0gewogICAgICAgICAgYXR0cl9hcnI6IGNvbWJpbmF0aW9uLAogICAgICAgICAgZGV0YWlsOiB7fSwKICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgIGtleTogJycsCiAgICAgICAgICBwcmljZTogMCwKICAgICAgICAgIHBpYzogJycsCiAgICAgICAgICBvdF9wcmljZTogMCwKICAgICAgICAgIGNvc3Q6IDAsCiAgICAgICAgICBzdG9jazogMCwKICAgICAgICAgIGlzX3Nob3c6IDEsCiAgICAgICAgICBpc19kZWZhdWx0X3NlbGVjdDogMCwKICAgICAgICAgIHVuaXF1ZTogJycsCiAgICAgICAgICB3ZWlnaHQ6ICcnLAogICAgICAgICAgdm9sdW1lOiAnJywKICAgICAgICAgIGJyb2tlcmFnZTogMCwKICAgICAgICAgIGJyb2tlcmFnZV90d286IDAsCiAgICAgICAgICB2aXBfcHJpY2U6IDAsCiAgICAgICAgICB2aXBfcHJvcG9ydGlvbjogMAogICAgICAgIH07CgogICAgICAgIC8vIOiuvue9ruiZmuaLn+exu+Wei+ebuOWFs+WxnuaApwogICAgICAgIGlmIChfdGhpczI3LmZvcm1WYWxpZGF0ZS52aXJ0dWFsX3R5cGUgPT09IDEpIHsKICAgICAgICAgIHJvdy52aXJ0dWFsX2xpc3QgPSBbXTsKICAgICAgICAgIHJvdy5kaXNrX2luZm8gPSAnJzsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMjcuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSA9PT0gMikgewogICAgICAgICAgcm93LmNvdXBvbl9pZCA9IDA7CiAgICAgICAgICByb3cuY291cG9uX25hbWUgPSAnJzsKICAgICAgICB9CgogICAgICAgIC8vIOWkhOeQhuinhOagvOWxnuaApwogICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgICAgICAgdmFyIHZhbHVlID0gY29tYmluYXRpb25baV07CiAgICAgICAgICByb3dbaXRlbS52YWx1ZV0gPSB2YWx1ZTsKICAgICAgICAgIHJvdy50aXRsZSA9IGl0ZW0udmFsdWU7CiAgICAgICAgICByb3cua2V5ID0gaXRlbS52YWx1ZTsKICAgICAgICAgIHJvdy5kZXRhaWxbaXRlbS52YWx1ZV0gPSB2YWx1ZTsKCiAgICAgICAgICAvLyDmn6Xmib7ljLnphY3nmoTnjrDmnInop4TmoLzpobkKICAgICAgICAgIHZhciBtYXRjaGVkSXRlbSA9IGV4aXN0aW5nSXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gaXRlbS5hdHRyX2FyciAmJiBhcnJheXNFcXVhbChpdGVtLmF0dHJfYXJyLCBjb21iaW5hdGlvbik7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChtYXRjaGVkSXRlbSkgewogICAgICAgICAgICBPYmplY3QuYXNzaWduKHJvdywgX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KHsKICAgICAgICAgICAgICBwcmljZTogbWF0Y2hlZEl0ZW0ucHJpY2UsCiAgICAgICAgICAgICAgY29zdDogbWF0Y2hlZEl0ZW0uY29zdCwKICAgICAgICAgICAgICBvdF9wcmljZTogbWF0Y2hlZEl0ZW0ub3RfcHJpY2UsCiAgICAgICAgICAgICAgc3RvY2s6IG1hdGNoZWRJdGVtLnN0b2NrLAogICAgICAgICAgICAgIHBpYzogbWF0Y2hlZEl0ZW0ucGljLAogICAgICAgICAgICAgIHVuaXF1ZTogbWF0Y2hlZEl0ZW0udW5pcXVlIHx8ICcnLAogICAgICAgICAgICAgIHdlaWdodDogbWF0Y2hlZEl0ZW0ud2VpZ2h0IHx8ICcnLAogICAgICAgICAgICAgIHZvbHVtZTogbWF0Y2hlZEl0ZW0udm9sdW1lIHx8ICcnLAogICAgICAgICAgICAgIGlzX3Nob3c6IG1hdGNoZWRJdGVtLmlzX3Nob3cgfHwgMSwKICAgICAgICAgICAgICBpc19kZWZhdWx0X3NlbGVjdDogbWF0Y2hlZEl0ZW0uaXNfZGVmYXVsdF9zZWxlY3QgfHwgMAogICAgICAgICAgICB9LCAidm9sdW1lIiwgbWF0Y2hlZEl0ZW0udm9sdW1lIHx8IDApLCAiYmFyX2NvZGVfbnVtYmVyIiwgbWF0Y2hlZEl0ZW0uYmFyX2NvZGVfbnVtYmVyIHx8IDApLCAiaXNfdmlydHVhbCIsIG1hdGNoZWRJdGVtLmlzX3ZpcnR1YWwpLCAiYnJva2VyYWdlIiwgbWF0Y2hlZEl0ZW0uYnJva2VyYWdlKSwgImJyb2tlcmFnZV90d28iLCBtYXRjaGVkSXRlbS5icm9rZXJhZ2VfdHdvKSwgInZpcF9wcmljZSIsIG1hdGNoZWRJdGVtLnZpcF9wcmljZSksICJ2aXBfcHJvcG9ydGlvbiIsIG1hdGNoZWRJdGVtLnZpcF9wcm9wb3J0aW9uKSk7CiAgICAgICAgICAgIGlmIChfdGhpczI3LmZvcm1WYWxpZGF0ZS52aXJ0dWFsX3R5cGUgPT09IDEpIHsKICAgICAgICAgICAgICByb3cudmlydHVhbF9saXN0ID0gbWF0Y2hlZEl0ZW0udmlydHVhbF9saXN0OwogICAgICAgICAgICAgIHJvdy5kaXNrX2luZm8gPSBtYXRjaGVkSXRlbS5kaXNrX2luZm87CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyNy5mb3JtVmFsaWRhdGUudmlydHVhbF90eXBlID09PSAyICYmIG1hdGNoZWRJdGVtLmNvdXBvbl9pZCkgewogICAgICAgICAgICAgIHJvdy5jb3Vwb25faWQgPSBtYXRjaGVkSXRlbS5jb3Vwb25faWQ7CiAgICAgICAgICAgICAgcm93LmNvdXBvbl9uYW1lID0gbWF0Y2hlZEl0ZW0uY291cG9uX25hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5hZGRfcGljICYmIGNvbWJpbmF0aW9uLmluY2x1ZGVzKHZhbCkpIHsKICAgICAgICAgICAgdmFyIHBpY0l0ZW0gPSBpdGVtLmRldGFpbC5maW5kKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNvbWJpbmF0aW9uLmluY2x1ZGVzKGUudmFsdWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKHBpY0l0ZW0pIHJvdy5waWMgPSBwaWNJdGVtLnBpYzsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcm93OwogICAgICB9KTsKICAgICAgcmV0dXJuIHJvd3M7CiAgICB9LAogICAgLy8g5YiH5o2i6buY6K6k6YCJ5Lit6KeE5qC8CiAgICBjaGFuZ2VEZWZhdWx0U2VsZWN0OiBmdW5jdGlvbiBjaGFuZ2VEZWZhdWx0U2VsZWN0KGUsIGluZGV4KSB7CiAgICAgIC8vIOS4gOS4quW8gOWQryDlhbbku5blhbPpl60KICAgICAgdGhpcy5tYW55Rm9ybVZhbGlkYXRlLm1hcChmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgICAgIGlmIChpICE9PSBpbmRleCkgewogICAgICAgICAgaXRlbS5pc19kZWZhdWx0X3NlbGVjdCA9IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgaWYgKGUpIHRoaXMubWFueUZvcm1WYWxpZGF0ZVtpbmRleF0uaXNfc2hvdyA9IDE7CiAgICB9LAogICAgLy8g5pS55Y+Y5piv5ZCm5pi+56S6CiAgICBjaGFuZ2VEZWZhdWx0U2hvdzogZnVuY3Rpb24gY2hhbmdlRGVmYXVsdFNob3coaW5kZXgpIHsKICAgICAgLy8g5aaC5p6c6buY6K6k6YCJ5Lit5byA5ZCvIOWImeS4jeWPr+makOiXjwogICAgICBpZiAodGhpcy5tYW55Rm9ybVZhbGlkYXRlW2luZGV4XS5pc19kZWZhdWx0X3NlbGVjdCA9PT0gMSkgewogICAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZVtpbmRleF0uaXNfc2hvdyA9IDE7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign6buY6K6k6KeE5qC85LiN5Y+v6ZqQ6JePJyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDnlJ/miJDop4TmoLznu4TlkIgKICAgIGdlbmVyYXRlQ29tYmluYXRpb25zOiBmdW5jdGlvbiBnZW5lcmF0ZUNvbWJpbmF0aW9ucyhhcnIpIHsKICAgICAgdmFyIF90aGlzMjggPSB0aGlzOwogICAgICB2YXIgcHJlZml4ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBbXTsKICAgICAgaWYgKGFyci5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gW3ByZWZpeF07CiAgICAgIH0KICAgICAgdmFyIF9hcnIgPSBfdG9BcnJheShhcnIpLAogICAgICAgIGZpcnN0ID0gX2FyclswXSwKICAgICAgICByZXN0ID0gX2Fyci5zbGljZSgxKTsKICAgICAgcmV0dXJuIGZpcnN0LmRldGFpbC5mbGF0TWFwKGZ1bmN0aW9uIChkZXRhaWwpIHsKICAgICAgICByZXR1cm4gX3RoaXMyOC5nZW5lcmF0ZUNvbWJpbmF0aW9ucyhyZXN0LCBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHByZWZpeCksIFtkZXRhaWwudmFsdWVdKSk7CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOa3u+WKoOWxnuaApwogICAgY3JlYXRlQXR0cjogZnVuY3Rpb24gY3JlYXRlQXR0cihudW0sIGlkeCkgewogICAgICB2YXIgX3RoaXMyOSA9IHRoaXM7CiAgICAgIGlmIChudW0pIHsKICAgICAgICAvLyDliKTmlq3mmK/lkKblrZjlnKjlkIzmoLfnhp/mgokKICAgICAgICB2YXIgaXNFeGlzdCA9IHRoaXMuYXR0cnNbaWR4XS5kZXRhaWwuc29tZShmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgPT09IG51bTsKICAgICAgICB9KTsKICAgICAgICBpZiAoaXNFeGlzdCkgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign6KeE5qC85YC85bey5a2Y5ZyoJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuYXR0cnNbaWR4XS5kZXRhaWwucHVzaCh7CiAgICAgICAgICB2YWx1ZTogbnVtLAogICAgICAgICAgcGljOiAnJwogICAgICAgIH0pOwogICAgICAgIGlmICh0aGlzLm1hbnlGb3JtVmFsaWRhdGUubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmFkZE9uZUF0dHIodGhpcy5hdHRyc1tpZHhdLnZhbHVlLCBudW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmdlbmVyYXRlQXR0cih0aGlzLmF0dHJzKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4kcmVmcy5zcGVjU3RvY2suJHJlZnNbJ3BvcG92ZXJSZWZfJyArIGlkeF1bMF0uZG9DbG9zZSgpOyAvL+WFs+mXreeahAogICAgICAgIHRoaXMuY2xlYXJBdHRyKCk7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoX3RoaXMyOS4kcmVmcy5zcGVjU3RvY2suJHJlZnNbJ3BvcG92ZXJSZWZfJyArIGlkeF0pIHsKICAgICAgICAgICAgLy/ph43ngrnmmK/ku6XkuIvkuKTlj6UKICAgICAgICAgICAgX3RoaXMyOS4kcmVmcy5zcGVjU3RvY2suJHJlZnNbJ3BvcG92ZXJSZWZfJyArIGlkeF1bMF0uZG9TaG93KCk7IC8v5omT5byA55qECiAgICAgICAgICAgIC8v6YeN54K55piv5Lul5LiK5Lik5Y+lCiAgICAgICAgICB9CiAgICAgICAgfSwgMjApOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJHJlZnMuc3BlY1N0b2NrLiRyZWZzWydwb3BvdmVyUmVmXycgKyBpZHhdWzBdLmRvQ2xvc2UoKTsgLy/lhbPpl63nmoQKICAgICAgfQogICAgfSwKICAgIGhhbmRsZVNob3dQb3A6IGZ1bmN0aW9uIGhhbmRsZVNob3dQb3AoaW5kZXgpIHsKICAgICAgdGhpcy4kcmVmcy5zcGVjU3RvY2suJHJlZnNbJ2lucHV0UmVmXycgKyBpbmRleF1bMF0uZm9jdXMoKTsKICAgIH0sCiAgICAvLyDllYblk4HliIbnsbvvvJsKICAgIGdvb2RzQ2F0ZWdvcnk6IGZ1bmN0aW9uIGdvb2RzQ2F0ZWdvcnkoKSB7CiAgICAgIHZhciBfdGhpczMwID0gdGhpczsKICAgICAgY2FzY2FkZXJMaXN0QXBpKDEpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzAudHJlZVNlbGVjdCA9IHJlcy5kYXRhOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzMC4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgfSk7CiAgICB9LAogICAgLy8g5pS55Y+Y6KeE5qC8CiAgICBjaGFuZ2VTcGVjOiBmdW5jdGlvbiBjaGFuZ2VTcGVjKCkgewogICAgICB2YXIgX3RoaXMzMSA9IHRoaXM7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmlzX3N1YiA9IFtdOwogICAgICB2YXIgaWQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICAgIGlmIChpZCkgewogICAgICAgIGNoZWNrQWN0aXZpdHlBcGkoaWQpLnRoZW4oZnVuY3Rpb24gKHJlcykge30pLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIF90aGlzMzEuZm9ybVZhbGlkYXRlLnNwZWNfdHlwZSA9IF90aGlzMzEuc3BlY190eXBlOwogICAgICAgICAgX3RoaXMzMS4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIC8vIOivpuaDhQogICAgZ2V0SW5mbzogZnVuY3Rpb24gZ2V0SW5mbygpIHsKICAgICAgdmFyIF90aGlzMzIgPSB0aGlzOwogICAgICB0aGlzLnNwaW5TaG93ID0gdHJ1ZTsKICAgICAgcHJvZHVjdEluZm9BcGkodGhpcy4kcm91dGUucGFyYW1zLmlkKS50aGVuKC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoLyojX19QVVJFX18qL19yZWdlbmVyYXRvcigpLm0oZnVuY3Rpb24gX2NhbGxlZTIocmVzKSB7CiAgICAgICAgICB2YXIgZGF0YTsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IoKS53KGZ1bmN0aW9uIChfY29udGV4dDIpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLm4pIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBkYXRhID0gcmVzLmRhdGEucHJvZHVjdEluZm87CiAgICAgICAgICAgICAgICBfdGhpczMyLmluZm9EYXRhKGRhdGEpOwogICAgICAgICAgICAgICAgX3RoaXMzMi5zcGluU2hvdyA9IGZhbHNlOwogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYSgyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICAgIH0pKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICB9KCkpLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczMyLnNwaW5TaG93ID0gZmFsc2U7CiAgICAgICAgX3RoaXMzMi4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlUmVtb3ZlOiBmdW5jdGlvbiBoYW5kbGVSZW1vdmUoaSkgewogICAgICB0aGlzLmltYWdlcy5zcGxpY2UoaSwgMSk7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZS5zcGxpY2UoaSwgMSk7CiAgICAgIHRoaXMub25lRm9ybVZhbGlkYXRlWzBdLnBpYyA9IHRoaXMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZVswXTsKICAgIH0sCiAgICAvLyDlhbPpl63lm77niYfkuIrkvKDmqKHmgIHmoYYKICAgIGNoYW5nZUNhbmNlbDogZnVuY3Rpb24gY2hhbmdlQ2FuY2VsKG1zZykgewogICAgICB0aGlzLm1vZGFsUGljID0gZmFsc2U7CiAgICB9LAogICAgLy8g54K55Ye75ZWG5ZOB5Zu+CiAgICBtb2RhbFBpY1RhcDogZnVuY3Rpb24gbW9kYWxQaWNUYXAodGl0KSB7CiAgICAgIHZhciBwaWNUaXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICcnOwogICAgICB2YXIgaW5kZXggPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IDA7CiAgICAgIHRoaXMubW9kYWxQaWMgPSB0cnVlOwogICAgICB0aGlzLmlzQ2hvaWNlID0gdGl0ID09PSAnZGFuJyA/ICfljZXpgIknIDogJ+WkmumAiSc7CiAgICAgIHRoaXMucGljVGl0ID0gcGljVGl0OwogICAgICB0aGlzLnRhYmxlSW5kZXggPSBpbmRleDsKICAgIH0sCiAgICAvLyDojrflj5bljZXlvKDlm77niYfkv6Hmga8KICAgIGdldFBpYzogZnVuY3Rpb24gZ2V0UGljKHBjKSB7CiAgICAgIHN3aXRjaCAodGhpcy5waWNUaXQpIHsKICAgICAgICBjYXNlICdkYW5Gcm9tJzoKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmltYWdlID0gcGMuYXR0X2RpcjsKICAgICAgICAgIGlmICghdGhpcy4kcm91dGUucGFyYW1zLmlkKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS5zcGVjX3R5cGUgPT09IDApIHsKICAgICAgICAgICAgICB0aGlzLm9uZUZvcm1WYWxpZGF0ZVswXS5waWMgPSBwYy5hdHRfZGlyOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGl0ZW0ucGljID0gcGMuYXR0X2RpcjsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLm9uZUZvcm1CYXRjaFswXS5waWMgPSBwYy5hdHRfZGlyOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdkYW5UYWJsZSc6CiAgICAgICAgICB0aGlzLm9uZUZvcm1WYWxpZGF0ZVt0aGlzLnRhYmxlSW5kZXhdLnBpYyA9IHBjLmF0dF9kaXI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdkdW9waSc6CiAgICAgICAgICB0aGlzLm9uZUZvcm1CYXRjaFt0aGlzLnRhYmxlSW5kZXhdLnBpYyA9IHBjLmF0dF9kaXI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdyZWNvbW1lbmRfaW1hZ2UnOgogICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUucmVjb21tZW5kX2ltYWdlID0gcGMuYXR0X2RpcjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpZiAodGhpcy5tYW55Rm9ybVZhbGlkYXRlLmxlbmd0aCkgdGhpcy5tYW55Rm9ybVZhbGlkYXRlW3RoaXMudGFibGVJbmRleF0ucGljID0gcGMuYXR0X2RpcjsKICAgICAgfQogICAgICB0aGlzLm1vZGFsUGljID0gZmFsc2U7CiAgICB9LAogICAgZGVsZXRlUm93OiBmdW5jdGlvbiBkZWxldGVSb3coaW5kZXgpIHsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUucGFyYW1zX2xpc3Quc3BsaWNlKGluZGV4LCAxKTsKICAgIH0sCiAgICAvLyDojrflj5blpJrlvKDlm77kv6Hmga8KICAgIGdldFBpY0Q6IGZ1bmN0aW9uIGdldFBpY0QocGMpIHsKICAgICAgdmFyIF90aGlzMzMgPSB0aGlzOwogICAgICB0aGlzLmltYWdlcyA9IHBjOwogICAgICB0aGlzLmltYWdlcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBfdGhpczMzLmZvcm1WYWxpZGF0ZS5zbGlkZXJfaW1hZ2UucHVzaChpdGVtLmF0dF9kaXIpOwogICAgICAgIF90aGlzMzMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZSA9IF90aGlzMzMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZS5zcGxpY2UoMCwgMTApOwogICAgICB9KTsKICAgICAgdGhpcy5vbmVGb3JtVmFsaWRhdGVbMF0ucGljID0gdGhpcy5mb3JtVmFsaWRhdGUuc2xpZGVyX2ltYWdlWzBdOwogICAgICB0aGlzLm1vZGFsUGljID0gZmFsc2U7CiAgICB9LAogICAgLy8g5o+Q5LqkCiAgICBoYW5kbGVTdWJtaXQ6IGZ1bmN0aW9uIGhhbmRsZVN1Ym1pdChuYW1lKSB7CiAgICAgIHZhciBfdGhpczM0ID0gdGhpczsKICAgICAgdGhpcy4kcmVmc1tuYW1lXS52YWxpZGF0ZShmdW5jdGlvbiAodmFsaWQpIHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIF90aGlzMzQuZm9ybVZhbGlkYXRlLnR5cGUgPSBfdGhpczM0LnR5cGU7CiAgICAgICAgICB2YXIgYXJyID0gX3RoaXMzNC5mb3JtVmFsaWRhdGUuc3BlY190eXBlID09PSAwID8gX3RoaXMzNC5vbmVGb3JtVmFsaWRhdGUgOiBfdGhpczM0Lm1hbnlGb3JtVmFsaWRhdGU7CiAgICAgICAgICB2YXIgaXRlbSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYXJyKSk7CiAgICAgICAgICBpZiAoX3RoaXMzNC5mb3JtVmFsaWRhdGUuc3BlY190eXBlID09PSAxKSB7CiAgICAgICAgICAgIGlmIChpdGVtLmxlbmd0aCA8IDIpIHJldHVybiBfdGhpczM0LiRtZXNzYWdlLndhcm5pbmcoJ+WVhuWTgeinhOagvC3op4TmoLzmlbDph4/mnIDlsJEx5LiqJyk7CiAgICAgICAgICAgIC8vIOWIoOmZpOesrOS4gOmhuQogICAgICAgICAgICBpdGVtLnNoaWZ0KCk7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGl0ZW1baV0uc3RvY2sgPiAxMDAwMDAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMzQuJG1lc3NhZ2UuZXJyb3IoJ+inhOagvOW6k+WtmC3lupPlrZjotoXlh7rns7vnu5/ojIPlm7QoMTAwMDAwMCknKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKF90aGlzMzQuZm9ybVZhbGlkYXRlLmlzX3N1YlswXSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgaXRlbS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgICBpZiAoaXRlbVtfaV0uYnJva2VyYWdlID09PSBudWxsIHx8IGl0ZW1bX2ldLmJyb2tlcmFnZV90d28gPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczM0LiRtZXNzYWdlLmVycm9yKCfokKXplIDorr7nva4tIOS4gOS6jOe6p+i/lOS9o+S4jeiDveS4uuepuicpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgaXRlbS5sZW5ndGg7IF9pMisrKSB7CiAgICAgICAgICAgICAgaWYgKGl0ZW1bX2kyXS52aXBfcHJpY2UgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczM0LiRtZXNzYWdlLmVycm9yKCfokKXplIDorr7nva4t5Lya5ZGY5Lu35LiN6IO95Li656m6Jyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoX3RoaXMzNC5mb3JtVmFsaWRhdGUuaXNfc3ViLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBpdGVtLmxlbmd0aDsgX2kzKyspIHsKICAgICAgICAgICAgICBpZiAoaXRlbVtfaTNdLmJyb2tlcmFnZSA9PT0gbnVsbCB8fCBpdGVtW19pM10uYnJva2VyYWdlX3R3byA9PT0gbnVsbCB8fCBpdGVtW19pM10udmlwX3ByaWNlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMzNC4kbWVzc2FnZS5lcnJvcign6JCl6ZSA6K6+572uLSDkuIDkuoznuqfov5TkvaPlkozkvJrlkZjku7fkuI3og73kuLrnqbonKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChfdGhpczM0LmZvcm1WYWxpZGF0ZS5mcmVpZ2h0ID09IDMgJiYgIV90aGlzMzQuZm9ybVZhbGlkYXRlLnRlbXBfaWQpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMzQuJG1lc3NhZ2Uud2FybmluZygn5ZWG5ZOB5L+h5oGvLei/kOi0ueaooeadv+S4jeiDveS4uuepuicpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGFjdGl2ZUlkcyA9IFtdOwogICAgICAgICAgX3RoaXMzNC5kYXRhTGFiZWwuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICBhY3RpdmVJZHMucHVzaChpdGVtLmlkKTsKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXMzNC5mb3JtVmFsaWRhdGUubGFiZWxfaWQgPSBhY3RpdmVJZHM7CiAgICAgICAgICBpZiAoX3RoaXMzNC5vcGVuU3ViaW1pdCkgcmV0dXJuOwogICAgICAgICAgX3RoaXMzNC5vcGVuU3ViaW1pdCA9IHRydWU7CiAgICAgICAgICBfdGhpczM0LmZvcm1WYWxpZGF0ZS5kZXNjcmlwdGlvbiA9IGZvcm1hdFJpY2hUZXh0KF90aGlzMzQuY29udGVudCk7CiAgICAgICAgICBpZiAoX3RoaXMzNC5mb3JtVmFsaWRhdGUuc3BlY190eXBlID09PSAwKSB7CiAgICAgICAgICAgIF90aGlzMzQuZm9ybVZhbGlkYXRlLmF0dHJzID0gaXRlbTsKICAgICAgICAgICAgX3RoaXMzNC5mb3JtVmFsaWRhdGUuaGVhZGVyID0gW107CiAgICAgICAgICAgIF90aGlzMzQuZm9ybVZhbGlkYXRlLml0ZW1zID0gW107CiAgICAgICAgICAgIF90aGlzMzQuZm9ybVZhbGlkYXRlLmlzX2NvcHkgPSAwOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMzNC5mb3JtVmFsaWRhdGUuaXRlbXMgPSBfdGhpczM0LmF0dHJzOwogICAgICAgICAgICBfdGhpczM0LmZvcm1WYWxpZGF0ZS5hdHRycyA9IGl0ZW07CiAgICAgICAgICAgIF90aGlzMzQuZm9ybVZhbGlkYXRlLmlzX2NvcHkgPSAxOwogICAgICAgICAgfQogICAgICAgICAgcHJvZHVjdEFkZEFwaShfdGhpczM0LmZvcm1WYWxpZGF0ZSkudGhlbigvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX3JlZjMgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yKCkubShmdW5jdGlvbiBfY2FsbGVlMyhyZXMpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yKCkudyhmdW5jdGlvbiAoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDMubikgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgX3RoaXMzNC5vcGVuU3ViaW1pdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIF90aGlzMzQuJG1lc3NhZ2Uuc3VjY2VzcyhyZXMubXNnKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMzNC4kcm91dGUucGFyYW1zLmlkID09PSAnMCcpIHsKICAgICAgICAgICAgICAgICAgICAgIGNhY2hlRGVsZXRlKCkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczM0LiRtZXNzYWdlLmVycm9yKGVyci5tc2cpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgX3RoaXMzNC5vcGVuU3ViaW1pdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgX3RoaXMzNC4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBfdGhpczM0LiRyb3V0ZVByb1N0ciArICcvcHJvZHVjdC9wcm9kdWN0X2xpc3QnCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hKDIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94MikgewogICAgICAgICAgICAgIHJldHVybiBfcmVmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSgpKS5jYXRjaChmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBfdGhpczM0Lm9wZW5TdWJpbWl0ID0gZmFsc2U7CiAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICBfdGhpczM0LiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICghX3RoaXMzNC5mb3JtVmFsaWRhdGUuc3RvcmVfbmFtZSkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMzNC4kbWVzc2FnZS53YXJuaW5nKCfllYblk4Hkv6Hmga8t5ZWG5ZOB5ZCN56ew5LiN6IO95Li656m6Jyk7CiAgICAgICAgICB9IGVsc2UgaWYgKCFfdGhpczM0LmZvcm1WYWxpZGF0ZS5jYXRlX2lkLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMzNC4kbWVzc2FnZS53YXJuaW5nKCfllYblk4Hkv6Hmga8t5ZWG5ZOB5YiG57G75LiN6IO95Li656m6Jyk7CiAgICAgICAgICB9IGVsc2UgaWYgKCFfdGhpczM0LmZvcm1WYWxpZGF0ZS51bml0X25hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMzQuJG1lc3NhZ2Uud2FybmluZygn5ZWG5ZOB5L+h5oGvLeWVhuWTgeWNleS9jeS4jeiDveS4uuepuicpOwogICAgICAgICAgfSBlbHNlIGlmICghX3RoaXMzNC5mb3JtVmFsaWRhdGUuc2xpZGVyX2ltYWdlLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMzNC4kbWVzc2FnZS53YXJuaW5nKCfllYblk4Hkv6Hmga8t5ZWG5ZOB6L2u5pKt5Zu+5LiN6IO95Li656m6Jyk7CiAgICAgICAgICB9IGVsc2UgaWYgKCFfdGhpczM0LmZvcm1WYWxpZGF0ZS5sb2dpc3RpY3MubGVuZ3RoICYmICFfdGhpczM0LmZvcm1WYWxpZGF0ZS52aXJ0dWFsX3R5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMzQuJG1lc3NhZ2Uud2FybmluZygn54mp5rWB6K6+572uLeiHs+WwkemAieaLqeS4gOenjeeJqea1geaWueW8jycpOwogICAgICAgICAgfSBlbHNlIGlmICghX3RoaXMzNC5mb3JtVmFsaWRhdGUudGVtcF9pZCAmJiBfdGhpczM0LmZvcm1WYWxpZGF0ZS5mcmVpZ2h0ID09IDMpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMzQuJG1lc3NhZ2Uud2FybmluZygn5ZWG5ZOB5L+h5oGvLei/kOi0ueaooeadv+S4jeiDveS4uuepuicpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY2hhbmdlVGVtcGxhdGU6IGZ1bmN0aW9uIGNoYW5nZVRlbXBsYXRlKG1zZykgewogICAgICB0aGlzLnRlbXBsYXRlID0gbXNnOwogICAgfSwKICAgIC8vIOihqOWNlemqjOivgQogICAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKHByb3AsIHN0YXR1cywgZXJyb3IpIHsKICAgICAgaWYgKHN0YXR1cyA9PT0gZmFsc2UpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoZXJyb3IpOwogICAgICB9CiAgICB9LAogICAgLy8g56e75YqoCiAgICBoYW5kbGVEcmFnU3RhcnQ6IGZ1bmN0aW9uIGhhbmRsZURyYWdTdGFydChlLCBpdGVtKSB7CiAgICAgIHRoaXMuZHJhZ2dpbmcgPSBpdGVtOwogICAgfSwKICAgIGhhbmRsZURyYWdFbmQ6IGZ1bmN0aW9uIGhhbmRsZURyYWdFbmQoZSwgaXRlbSkgewogICAgICB0aGlzLmRyYWdnaW5nID0gbnVsbDsKICAgIH0sCiAgICBoYW5kbGVEcmFnT3ZlcjogZnVuY3Rpb24gaGFuZGxlRHJhZ092ZXIoZSkgewogICAgICBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gJ21vdmUnOwogICAgfSwKICAgIGhhbmRsZURyYWdFbnRlcjogZnVuY3Rpb24gaGFuZGxlRHJhZ0VudGVyKGUsIGl0ZW0pIHsKICAgICAgZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICdtb3ZlJzsKICAgICAgaWYgKGl0ZW0gPT09IHRoaXMuZHJhZ2dpbmcpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIG5ld0l0ZW1zID0gX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZSk7CiAgICAgIHZhciBzcmMgPSBuZXdJdGVtcy5pbmRleE9mKHRoaXMuZHJhZ2dpbmcpOwogICAgICB2YXIgZHN0ID0gbmV3SXRlbXMuaW5kZXhPZihpdGVtKTsKICAgICAgbmV3SXRlbXMuc3BsaWNlLmFwcGx5KG5ld0l0ZW1zLCBbZHN0LCAwXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KG5ld0l0ZW1zLnNwbGljZShzcmMsIDEpKSkpOwogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5zbGlkZXJfaW1hZ2UgPSBuZXdJdGVtczsKICAgIH0sCiAgICAvL+WvueixoeaVsOe7hOWOu+mHje+8mwogICAgdW5pcXVlOiBmdW5jdGlvbiB1bmlxdWUoYXJyKSB7CiAgICAgIHZhciByZXMgPSBuZXcgTWFwKCk7CiAgICAgIHJldHVybiBhcnIuZmlsdGVyKGZ1bmN0aW9uIChhcnIpIHsKICAgICAgICByZXR1cm4gIXJlcy5oYXMoYXJyLnByb2R1Y3RfaWQpICYmIHJlcy5zZXQoYXJyLnByb2R1Y3RfaWQsIDEpOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDllYblk4FpZAogICAgZ2V0UHJvZHVjdElkOiBmdW5jdGlvbiBnZXRQcm9kdWN0SWQoZGF0YSkgewogICAgICB0aGlzLmdvb2RzX21vZGFscyA9IGZhbHNlOwogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5yZWNvbW1lbmRfbGlzdCA9IHRoaXMudW5pcXVlKHRoaXMuZm9ybVZhbGlkYXRlLnJlY29tbWVuZF9saXN0LmNvbmNhdChkYXRhKSk7CiAgICB9LAogICAgLy8g6YCJ5oup5o6o6I2Q5ZWG5ZOBCiAgICBjaGFuZ2VHb29kczogZnVuY3Rpb24gY2hhbmdlR29vZHMoKSB7CiAgICAgIHRoaXMuZ29vZHNfbW9kYWxzID0gdHJ1ZTsKICAgICAgdGhpcy4kcmVmcy5nb29kc2xpc3QuZ2V0TGlzdCgpOwogICAgICB0aGlzLiRyZWZzLmdvb2RzbGlzdC5nb29kc0NhdGVnb3J5KCk7CiAgICB9LAogICAgLy8g6YCJ5oup55So5oi35qCH562+CiAgICBhY3RpdmVEYXRhOiBmdW5jdGlvbiBhY3RpdmVEYXRhKGRhdGFMYWJlbCkgewogICAgICB0aGlzLmxhYmVsU2hvdyA9IGZhbHNlOwogICAgICB0aGlzLmRhdGFMYWJlbCA9IGRhdGFMYWJlbDsKICAgIH0sCiAgICAvLyDpgInmi6nllYblk4HmoIfnrb4KICAgIGFjdGl2ZUxhYmVsOiBmdW5jdGlvbiBhY3RpdmVMYWJlbChkYXRhKSB7CiAgICAgIHRoaXMudGFnU2hvdyA9IGZhbHNlOwogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5sYWJlbF9saXN0ID0gQXJyYXkuZnJvbShuZXcgU2V0KGRhdGEpKTsKICAgIH0sCiAgICAvLyDmoIfnrb7lvLnnqpflhbPpl60KICAgIGxhYmVsQ2xvc2U6IGZ1bmN0aW9uIGxhYmVsQ2xvc2UoKSB7CiAgICAgIHRoaXMubGFiZWxTaG93ID0gZmFsc2U7CiAgICAgIHRoaXMudGFnU2hvdyA9IGZhbHNlOwogICAgfSwKICAgIC8vIOWIoOmZpOeUqOaIt+agh+etvgogICAgY2xvc2VMYWJlbDogZnVuY3Rpb24gY2xvc2VMYWJlbChsYWJlbCkgewogICAgICB2YXIgaW5kZXggPSB0aGlzLmRhdGFMYWJlbC5pbmRleE9mKHRoaXMuZGF0YUxhYmVsLmZpbHRlcihmdW5jdGlvbiAoZCkgewogICAgICAgIHJldHVybiBkLmlkID09IGxhYmVsLmlkOwogICAgICB9KVswXSk7CiAgICAgIHRoaXMuZGF0YUxhYmVsLnNwbGljZShpbmRleCwgMSk7CiAgICB9LAogICAgLy8g5omT5byA6YCJ5oup55So5oi35qCH562+CiAgICBvcGVuTGFiZWw6IGZ1bmN0aW9uIG9wZW5MYWJlbChyb3cpIHsKICAgICAgdGhpcy5sYWJlbFNob3cgPSB0cnVlOwogICAgfSwKICAgIGhhbmRsZVJlbW92ZVJlY29tbWVuZDogZnVuY3Rpb24gaGFuZGxlUmVtb3ZlUmVjb21tZW5kKGkpIHsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUucmVjb21tZW5kX2xpc3Quc3BsaWNlKGksIDEpOwogICAgfSwKICAgIC8vIOaJk+W8gOeahOiQpemUgOa0u+WKqOagh+etvgogICAgd2F0Y2hBY3Rpdml0eTogZnVuY3Rpb24gd2F0Y2hBY3Rpdml0eSgpIHsKICAgICAgdmFyIG1hcmtldGluZyA9IFtdOwogICAgICAvLyDkvb/nlKjlr7nosaHmmKDlsITkvJjljJbmnYPpmZDliKTmlq3pgLvovpEKICAgICAgdmFyIHBlcm1pc3Npb25NYXAgPSB7CiAgICAgICAg6buY6K6kOiB0cnVlLAogICAgICAgIOenkuadgDogJ3NlY2tpbGwnLAogICAgICAgIOegjeS7tzogJ2JhcmdhaW4nLAogICAgICAgIOaLvOWbojogJ2NvbWJpbmF0aW9uJwogICAgICB9OwogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5hY3Rpdml0eS5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewogICAgICAgIGlmIChwZXJtaXNzaW9uTWFwW2VsXSA9PT0gdHJ1ZSB8fCBwZXJtaXNzaW9uTWFwW2VsXSAmJiBjaGVja0FycmF5KHBlcm1pc3Npb25NYXBbZWxdKSkgewogICAgICAgICAgbWFya2V0aW5nLnB1c2goZWwpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmFjdGl2aXR5ID0gbWFya2V0aW5nOwogICAgfQogIH0KfTs="},null]}