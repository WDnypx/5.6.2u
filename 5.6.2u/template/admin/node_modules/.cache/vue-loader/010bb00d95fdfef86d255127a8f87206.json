{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\components\\couponList\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\components\\couponList\\index.vue","mtime":1745474910930},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1753254258567},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IHJlbGVhc2VkTGlzdEFwaSB9IGZyb20gJ0AvYXBpL21hcmtldGluZyc7CmltcG9ydCB7IGZvcm1hdERhdGUgfSBmcm9tICdAL3V0aWxzL3ZhbGlkYXRlJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnaW5kZXgnLAogIGZpbHRlcnM6IHsKICAgIGZvcm1hdERhdGUodGltZSkgewogICAgICBpZiAodGltZSAhPT0gMCkgewogICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUodGltZSAqIDEwMDApOwogICAgICAgIHJldHVybiBmb3JtYXREYXRlKGRhdGUsICd5eXl5LU1NLWRkIGhoOm1tJyk7CiAgICAgIH0KICAgIH0sCiAgfSwKICBwcm9wczogewogICAgY291cG9uaWRzOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgfSwKICAgIHVwZGF0ZUlkczogewogICAgICB0eXBlOiBBcnJheSwKICAgIH0sCiAgICB1cGRhdGVOYW1lOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgfSwKICAgIGx1Y2tEcmF3OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB0ZW1wbGF0ZVJhZGlvOiAwLAoKICAgICAgY3VycmVudGlkOiAwLAogICAgICBwcm9kdWN0Um93OiB7fSwKICAgICAgaXNUZW1wbGF0ZTogZmFsc2UsCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICB0YWJsZUZyb206IHsKICAgICAgICByZWNlaXZlX3R5cGU6IDMsCiAgICAgICAgcGFnZTogMSwKICAgICAgICBsaW1pdDogMTUsCiAgICAgIH0sCiAgICAgIHRvdGFsOiAwLAogICAgICBpZHM6IFtdLAogICAgICB0ZXh0czogW10sCiAgICAgIGNvdXBvbkxpc3Q6IFtdLAogICAgICBzZWxlY3RlZElkczogW10sCiAgICAgIHNlbGVjdGVkTmFtZXM6IFtdLAogICAgICBtdWx0aXBsZVNlbGVjdGlvbjogW10sCiAgICB9OwogIH0sCiAgbW91bnRlZCgpIHt9LAogIHdhdGNoOiB7CiAgICB1cGRhdGVJZHM6IGZ1bmN0aW9uIChuZXdWYWwpIHsKICAgICAgdGhpcy5zZWxlY3RlZElkcyA9IG5ld1ZhbDsKICAgIH0sCiAgICB1cGRhdGVOYW1lOiBmdW5jdGlvbiAobmV3VmFsKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWROYW1lcyA9IG5ld1ZhbDsKICAgICAgdGhpcy5tdWx0aXBsZVNlbGVjdGlvbiA9IG5ld1ZhbDsKICAgIH0sCiAgfSwKICBjcmVhdGVkKCkge30sCiAgbWV0aG9kczogewogICAgZ2V0Um93S2V5KHJvdykgewogICAgICByZXR1cm4gcm93LmlkOwogICAgfSwKICAgIGdldFRlbXBsYXRlUm93KHJvdykgewogICAgICB0aGlzLmN1cnJlbnRpZCA9IHJvdy5pZDsKICAgICAgdGhpcy5wcm9kdWN0Um93ID0gcm93OwogICAgfSwKICAgIC8v5a+56LGh5pWw57uE5Y676YeN77ybCiAgICB1bmlxdWUoYXJyKSB7CiAgICAgIGNvbnN0IHJlcyA9IG5ldyBNYXAoKTsKICAgICAgcmV0dXJuIGFyci5maWx0ZXIoKGFycikgPT4gIXJlcy5oYXMoYXJyLmlkKSAmJiByZXMuc2V0KGFyci5pZCwgMSkpOwogICAgfSwKICAgIGNoYW5nZUNoZWNrYm94KHNlbGVjdGlvbikgewogICAgICBsZXQgdW5pcXVlQXJyID0gW107CiAgICAgIGxldCBjdXBzID0gW107CiAgICAgIGxldCBpZHMgPSBbXTsKICAgICAgbGV0IGFyciA9IHRoaXMudW5pcXVlKHNlbGVjdGlvbik7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgaXRlbSA9IGFycltpXTsKICAgICAgICBpZiAoIWlkcy5pbmNsdWRlcyhpdGVtLmlkKSkgewogICAgICAgICAgbGV0IG9iaiA9IHsKICAgICAgICAgICAgaWQ6IGl0ZW0uaWQsCiAgICAgICAgICAgIHRpdGxlOiBpdGVtLnRpdGxlLAogICAgICAgICAgICBmdWxsX3JlZHVjdGlvbjogaXRlbS5mdWxsX3JlZHVjdGlvbiwgLy8g5ruhCiAgICAgICAgICAgIHVzZV9taW5fcHJpY2U6IGl0ZW0udXNlX21pbl9wcmljZSwgLy8g5ruhCiAgICAgICAgICAgIGNvdXBvbl9wcmljZTogaXRlbS5jb3Vwb25fcHJpY2UsIC8vIOWHjwogICAgICAgICAgfTsKICAgICAgICAgIGN1cHMucHVzaChvYmopOwogICAgICAgICAgaWRzLnB1c2goaXRlbS5pZCk7CiAgICAgICAgICB1bmlxdWVBcnIucHVzaChpdGVtKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5zZWxlY3RlZElkcyA9IGlkczsKICAgICAgdGhpcy5zZWxlY3RlZE5hbWVzID0gY3VwczsKICAgICAgdGhpcy5tdWx0aXBsZVNlbGVjdGlvbiA9IHVuaXF1ZUFycjsKICAgIH0sCiAgICBjYW5jZWwoKSB7CiAgICAgIHRoaXMuaXNUZW1wbGF0ZSA9IGZhbHNlOwogICAgICBpZiAodGhpcy5sdWNrRHJhdykgewogICAgICAgIHRoaXMuY3VycmVudGlkID0gMDsKICAgICAgfQogICAgfSwKICAgIHRhYmxlTGlzdCgpIHsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgcmVsZWFzZWRMaXN0QXBpKHRoaXMudGFibGVGcm9tKS50aGVuKChyZXMpID0+IHsKICAgICAgICBsZXQgZGF0YSA9IHJlcy5kYXRhOwogICAgICAgIHRoaXMuY291cG9uTGlzdCA9IGRhdGEubGlzdDsKICAgICAgICB0aGlzLnRvdGFsID0gZGF0YS5jb3VudDsKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAvL+ehruS/nWRvbeWKoOi9veWujOavlQogICAgICAgICAgdGhpcy5zZWxlY3RlZElkcy5sZW5ndGggJiYgdGhpcy5zZXRDaGVja2VkKCk7CiAgICAgICAgICB0aGlzLnNob3dTZWxlY3REYXRhKCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHNldENoZWNrZWQoKSB7CiAgICAgIC8v5bCGbmV3IFNldCgp6L2s5YyW5Li65pWw57uECiAgICAgIGxldCBpZHMgPSBbLi4udGhpcy5zZWxlY3RlZElkc107CiAgICAgIHRoaXMuY291cG9uTGlzdC5mb3JFYWNoKChyb3cpID0+IHsKICAgICAgICBpZiAoaWRzLmluY2x1ZGVzKHJvdy5pZCkpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuY291cG9uVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKHJvdywgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBvaygpIHsKICAgICAgaWYgKHRoaXMubHVja0RyYXcpIHsKICAgICAgICB0aGlzLiRlbWl0KCdnZXRDb3Vwb25JZCcsIHRoaXMucHJvZHVjdFJvdyk7CiAgICAgICAgdGhpcy5jdXJyZW50aWQgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJGVtaXQoJ25hbWVJZCcsIHRoaXMuc2VsZWN0ZWRJZHMsIHRoaXMuc2VsZWN0ZWROYW1lcyk7CiAgICAgIH0KICAgICAgdGhpcy5pc1RlbXBsYXRlID0gZmFsc2U7CiAgICB9LAogICAgcGFnZUNoYW5nZShpbmRleCkgewogICAgICB0aGlzLnRhYmxlRnJvbS5wYWdlID0gaW5kZXg7CiAgICAgIHRoaXMudGFibGVMaXN0KCk7CiAgICB9LAogICAgbGltaXRDaGFuZ2UobGltaXQpIHsKICAgICAgdGhpcy50YWJsZUZyb20ubGltaXQgPSBsaW1pdDsKICAgICAgdGhpcy50YWJsZUxpc3QoKTsKICAgIH0sCiAgICBzaG93U2VsZWN0RGF0YSgpIHsKICAgICAgaWYgKHRoaXMubXVsdGlwbGVTZWxlY3Rpb24ubGVuZ3RoID4gMCkgewogICAgICAgIC8vIOWIpOaWreaYr+WQpuWtmOWcqOWLvumAiei/h+eahOaVsOaNrgogICAgICAgIHRoaXMuY291cG9uTGlzdC5mb3JFYWNoKChyb3cpID0+IHsKICAgICAgICAgIC8vIOiOt+WPluaVsOaNruWIl+ihqOaOpeWPo+ivt+axguWIsOeahOaVsOaNrgogICAgICAgICAgdGhpcy5tdWx0aXBsZVNlbGVjdGlvbi5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgICAgIC8vIOWLvumAieWIsOeahOaVsOaNrgogICAgICAgICAgICBpZiAocm93LmlkID09PSBpdGVtLmlkKSB7CiAgICAgICAgICAgICAgLy8gdGhpcy4kcmVmcy50YWJsZS50b2dnbGVSb3dTZWxlY3Rpb24oaXRlbSwgdHJ1ZSk7IC8vIOiLpeaciemHjeWQiO+8jOWImeWbnuaYvuivpeadoeaVsOaNrgogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA6FA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/couponList","sourcesContent":["<template>\n  <div>\n    <el-dialog :visible.sync=\"isTemplate\" title=\"优惠券列表\" append-to-body width=\"1000px\">\n      <el-table\n        :data=\"couponList\"\n        ref=\"couponTable\"\n        class=\"mt20\"\n        v-loading=\"loading\"\n        highlight-current-row\n        :row-key=\"getRowKey\"\n        no-userFrom-text=\"暂无数据\"\n        no-filtered-userFrom-text=\"暂无筛选结果\"\n        @selection-change=\"changeCheckbox\"\n      >\n        <el-table-column v-if=\"!luckDraw\" type=\"selection\" width=\"55\" :reserve-selection=\"true\"> </el-table-column>\n        <el-table-column v-else width=\"50\">\n          <template slot-scope=\"scope\">\n            <el-radio v-model=\"templateRadio\" :label=\"scope.row.id\" @change.native=\"getTemplateRow(scope.row)\"\n              >&nbsp;</el-radio\n            >\n          </template>\n        </el-table-column>\n        <el-table-column label=\"ID\" width=\"70\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.id }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"优惠券名称\" min-width=\"120\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.title }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"优惠券类型\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.type === 1\">品类券</span>\n            <span v-else-if=\"scope.row.type === 2\">商品券</span>\n            <span v-else-if=\"scope.row.type === 3\">会员券</span>\n            <span v-else>通用券</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"面值\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.coupon_price }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"最低消费额\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.use_min_price }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"发布数量\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span v-if=\"scope.row.is_permanent\">不限量</span>\n            <div v-else>\n              <span class=\"fa\">发布：{{ scope.row.total_count }}</span>\n              <span class=\"sheng ml10\">剩余：{{ scope.row.remain_count }}</span>\n            </div>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"有效期限\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <div v-if=\"scope.row.start_time\">\n              {{ scope.row.start_time | formatDate }} - {{ scope.row.end_time | formatDate }}\n            </div>\n            <span v-else>不限时</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"状态\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <el-tag size=\"medium\" v-show=\"scope.row.status === 1\">正常</el-tag>\n            <el-tag size=\"medium\" type=\"danger\" v-show=\"scope.row.status === 0\">未开启</el-tag>\n            <el-tag size=\"medium\" type=\"info\" v-show=\"scope.row.status === -1\">已失效</el-tag>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div class=\"acea-row row-right page\">\n        <pagination\n          v-if=\"total\"\n          :total=\"total\"\n          :page.sync=\"tableFrom.page\"\n          :limit.sync=\"tableFrom.limit\"\n          @pagination=\"tableList\"\n        />\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button v-db-click @click=\"cancel\">取 消</el-button>\n        <el-button type=\"primary\" v-db-click @click=\"ok\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { releasedListApi } from '@/api/marketing';\nimport { formatDate } from '@/utils/validate';\n\nexport default {\n  name: 'index',\n  filters: {\n    formatDate(time) {\n      if (time !== 0) {\n        let date = new Date(time * 1000);\n        return formatDate(date, 'yyyy-MM-dd hh:mm');\n      }\n    },\n  },\n  props: {\n    couponids: {\n      type: Array,\n    },\n    updateIds: {\n      type: Array,\n    },\n    updateName: {\n      type: Array,\n    },\n    luckDraw: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      templateRadio: 0,\n\n      currentid: 0,\n      productRow: {},\n      isTemplate: false,\n      loading: false,\n      tableFrom: {\n        receive_type: 3,\n        page: 1,\n        limit: 15,\n      },\n      total: 0,\n      ids: [],\n      texts: [],\n      couponList: [],\n      selectedIds: [],\n      selectedNames: [],\n      multipleSelection: [],\n    };\n  },\n  mounted() {},\n  watch: {\n    updateIds: function (newVal) {\n      this.selectedIds = newVal;\n    },\n    updateName: function (newVal) {\n      this.selectedNames = newVal;\n      this.multipleSelection = newVal;\n    },\n  },\n  created() {},\n  methods: {\n    getRowKey(row) {\n      return row.id;\n    },\n    getTemplateRow(row) {\n      this.currentid = row.id;\n      this.productRow = row;\n    },\n    //对象数组去重；\n    unique(arr) {\n      const res = new Map();\n      return arr.filter((arr) => !res.has(arr.id) && res.set(arr.id, 1));\n    },\n    changeCheckbox(selection) {\n      let uniqueArr = [];\n      let cups = [];\n      let ids = [];\n      let arr = this.unique(selection);\n      for (let i = 0; i < arr.length; i++) {\n        const item = arr[i];\n        if (!ids.includes(item.id)) {\n          let obj = {\n            id: item.id,\n            title: item.title,\n            full_reduction: item.full_reduction, // 满\n            use_min_price: item.use_min_price, // 满\n            coupon_price: item.coupon_price, // 减\n          };\n          cups.push(obj);\n          ids.push(item.id);\n          uniqueArr.push(item);\n        }\n      }\n      this.selectedIds = ids;\n      this.selectedNames = cups;\n      this.multipleSelection = uniqueArr;\n    },\n    cancel() {\n      this.isTemplate = false;\n      if (this.luckDraw) {\n        this.currentid = 0;\n      }\n    },\n    tableList() {\n      this.loading = true;\n      releasedListApi(this.tableFrom).then((res) => {\n        let data = res.data;\n        this.couponList = data.list;\n        this.total = data.count;\n        this.$nextTick(() => {\n          //确保dom加载完毕\n          this.selectedIds.length && this.setChecked();\n          this.showSelectData();\n        });\n        this.loading = false;\n      });\n    },\n    setChecked() {\n      //将new Set()转化为数组\n      let ids = [...this.selectedIds];\n      this.couponList.forEach((row) => {\n        if (ids.includes(row.id)) {\n          this.$refs.couponTable.toggleRowSelection(row, true);\n        }\n      });\n    },\n    ok() {\n      if (this.luckDraw) {\n        this.$emit('getCouponId', this.productRow);\n        this.currentid = 0;\n      } else {\n        this.$emit('nameId', this.selectedIds, this.selectedNames);\n      }\n      this.isTemplate = false;\n    },\n    pageChange(index) {\n      this.tableFrom.page = index;\n      this.tableList();\n    },\n    limitChange(limit) {\n      this.tableFrom.limit = limit;\n      this.tableList();\n    },\n    showSelectData() {\n      if (this.multipleSelection.length > 0) {\n        // 判断是否存在勾选过的数据\n        this.couponList.forEach((row) => {\n          // 获取数据列表接口请求到的数据\n          this.multipleSelection.forEach((item) => {\n            // 勾选到的数据\n            if (row.id === item.id) {\n              // this.$refs.table.toggleRowSelection(item, true); // 若有重合，则回显该条数据\n            }\n          });\n        });\n      }\n    },\n  },\n};\n</script>\n\n<style scoped></style>\n"]}]}