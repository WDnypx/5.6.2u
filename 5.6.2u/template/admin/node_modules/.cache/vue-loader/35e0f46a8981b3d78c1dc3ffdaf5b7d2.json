{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\marketing\\storeIntegralOrder\\handle\\orderSend.vue?vue&type=style&index=0&id=5851d640&scoped=true&lang=css","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\marketing\\storeIntegralOrder\\handle\\orderSend.vue","mtime":1711590189049},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\css-loader\\index.js","mtime":1753254259822},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1753254262918},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1753254258547},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5leHByZXNzX3RlbXBfaWQgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKfQoKLmV4cHJlc3NfdGVtcF9pZCBidXR0b24gewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDUwJTsKICByaWdodDogMTEwcHg7CiAgcGFkZGluZzogMDsKICBib3JkZXI6IG5vbmU7CiAgYmFja2dyb3VuZDogbm9uZTsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSk7CiAgY29sb3I6ICM1N2EzZjM7Cn0KCi5pdnUtYnRuLXRleHQ6Zm9jdXMgewogIGJveC1zaGFkb3c6IG5vbmU7Cn0KLnRyaXBzIHsKICBjb2xvcjogI2NjYzsKfQo="},{"version":3,"sources":["orderSend.vue"],"names":[],"mappings":";AAwYA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"orderSend.vue","sourceRoot":"src/pages/marketing/storeIntegralOrder/handle","sourcesContent":["<template>\n  <el-dialog :visible.sync=\"modals\" title=\"订单发送货\" width=\"720px\" class=\"order_box\" :show-close=\"true\">\n    <el-form ref=\"formItem\" :model=\"formItem\" label-width=\"100px\" @submit.native.prevent>\n      <el-form-item label=\"选择类型：\">\n        <el-radio-group v-model=\"formItem.type\" @input=\"changeRadio\">\n          <el-radio label=\"1\">发货</el-radio>\n          <el-radio label=\"2\">送货</el-radio>\n          <el-radio label=\"3\">虚拟</el-radio>\n        </el-radio-group>\n      </el-form-item>\n      <el-form-item v-show=\"formItem.type == '1' && export_open\" label=\"发货类型：\">\n        <el-radio-group v-model=\"formItem.express_record_type\" @input=\"changeExpress\">\n          <el-radio label=\"1\">手动填写</el-radio>\n          <el-radio label=\"2\">电子面单打印</el-radio>\n        </el-radio-group>\n      </el-form-item>\n      <div v-show=\"formItem.type === '1'\">\n        <el-form-item label=\"快递公司：\">\n          <el-select\n            v-model=\"formItem.delivery_name\"\n            filterable\n            placeholder=\"请选择快递公司\"\n            style=\"width: 80%\"\n            @change=\"expressChange\"\n          >\n            <el-option\n              v-for=\"(item, i) in express\"\n              :value=\"item.value\"\n              :key=\"item.value\"\n              :label=\"item.value\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item v-if=\"formItem.express_record_type === '1'\" label=\"快递单号：\">\n          <el-input v-model=\"formItem.delivery_id\" placeholder=\"请输入快递单号\" style=\"width: 80%\"></el-input>\n          <div class=\"trips\" v-if=\"formItem.delivery_name == '顺丰速运'\">\n            <p>顺丰请输入单号 :收件人或寄件人手机号后四位</p>\n            <p>例如：SF000000000000:3941</p>\n          </div>\n        </el-form-item>\n        <template v-if=\"formItem.express_record_type === '2'\">\n          <el-form-item label=\"电子面单：\" class=\"express_temp_id\">\n            <el-select\n              v-model=\"formItem.express_temp_id\"\n              placeholder=\"请选择电子面单\"\n              style=\"width: 80%\"\n              @change=\"expressTempChange\"\n            >\n              <el-option\n                v-for=\"(item, i) in expressTemp\"\n                :value=\"item.temp_id\"\n                :key=\"i\"\n                :label=\"item.title\"\n              ></el-option>\n            </el-select>\n            <el-button v-if=\"formItem.express_temp_id\" type=\"text\" v-db-click @click=\"preview\">预览</el-button>\n          </el-form-item>\n          <el-form-item label=\"寄件人姓名：\">\n            <el-input v-model=\"formItem.to_name\" placeholder=\"请输入寄件人姓名\" style=\"width: 80%\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"寄件人电话：\">\n            <el-input v-model=\"formItem.to_tel\" placeholder=\"请输入寄件人电话\" style=\"width: 80%\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"寄件人地址：\">\n            <el-input v-model=\"formItem.to_addr\" placeholder=\"请输入寄件人地址\" style=\"width: 80%\"></el-input>\n          </el-form-item>\n        </template>\n      </div>\n      <div v-show=\"formItem.type === '2'\">\n        <el-form-item label=\"送货人：\">\n          <el-select\n            v-model=\"formItem.sh_delivery\"\n            placeholder=\"请选择送货人\"\n            style=\"width: 80%\"\n            @change=\"shDeliveryChange\"\n          >\n            <el-option\n              v-for=\"(item, i) in deliveryList\"\n              :value=\"item.id\"\n              :key=\"i\"\n              :label=\"`${item.wx_name} (${item.phone})`\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n      </div>\n      <div v-show=\"formItem.type === '3'\">\n        <el-form-item label=\"备注：\">\n          <el-input\n            v-model=\"formItem.fictitious_content\"\n            type=\"textarea\"\n            :autosize=\"{ minRows: 2, maxRows: 5 }\"\n            placeholder=\"备注\"\n            style=\"width: 80%\"\n          ></el-input>\n        </el-form-item>\n      </div>\n    </el-form>\n    <span slot=\"footer\" class=\"dialog-footer\">\n      <el-button v-db-click @click=\"cancel\">取消</el-button>\n      <el-button type=\"primary\" v-db-click @click=\"putSend\">提交</el-button>\n    </span>\n    <div ref=\"viewer\" v-viewer v-show=\"temp\">\n      <img :src=\"temp.pic\" style=\"display: none\" />\n    </div>\n  </el-dialog>\n</template>\n\n<script>\nimport {\n  getExpressData,\n  orderExpressTemp,\n  orderDeliveryList,\n  orderSheetInfo,\n  integralOrderPutDelivery,\n} from '@/api/marketing';\n// import {integralOrderPutDelivery} from \"@/api/marketing\";\nexport default {\n  name: 'orderSend',\n  props: {\n    orderId: Number,\n  },\n  data() {\n    return {\n      formItem: {\n        type: '1',\n        express_record_type: '1',\n        delivery_name: '',\n        delivery_id: '',\n        express_temp_id: '',\n        to_name: '',\n        to_tel: '',\n        to_addr: '',\n        sh_delivery: '',\n        fictitious_content: '',\n      },\n      modals: false,\n      express: [],\n      expressTemp: [],\n      deliveryList: [],\n      // ruleValidate: {\n      //     delivery_name: [\n      //         { required: true, message: '请选择快递公司', trigger: 'change' }\n      //     ],\n      //     delivery_id: [\n      //         { required: true, message: '请输入快递单号', trigger: 'blur' }\n      //     ],\n      //     express_temp_id: [\n      //         { required: true, message: '请选择电子面单', trigger: 'change' }\n      //     ],\n      //     sh_delivery: [\n      //         { required: true, message: '请选择送货人', trigger: 'change', type: 'number' }\n      //     ]\n      // },\n      temp: {},\n      export_open: false,\n    };\n  },\n  methods: {\n    changeRadio(o) {\n      this.$refs.formItem.resetFields();\n      switch (o) {\n        case '1':\n          this.formItem.delivery_name = '';\n          this.formItem.delivery_id = '';\n          this.formItem.express_temp_id = '';\n          this.formItem.express_record_type = '1';\n          this.expressTemp = [];\n          this.getList(1);\n          break;\n        case '2':\n          this.formItem.sh_delivery = '';\n          break;\n        case '3':\n          this.formItem.fictitious_content = '';\n          break;\n        default:\n          // this.formItem = {\n          //     type: '3',\n          //     express_record_type: '1',\n          //     delivery_name: '',\n          //     delivery_id: '',\n          //     express_temp_id: '',\n          //     to_name: '',\n          //     to_tel: '',\n          //     to_addr: '',\n          //     sh_delivery: ''\n          // };\n          break;\n      }\n    },\n    changeExpress(j) {\n      switch (j) {\n        case '2':\n          this.formItem.delivery_name = '';\n          this.formItem.express_temp_id = '';\n          this.expressTemp = [];\n          this.getList(2);\n          break;\n        case '1':\n          this.formItem.delivery_name = '';\n          this.formItem.delivery_id = '';\n          this.getList(1);\n          break;\n        default:\n          break;\n      }\n    },\n    reset() {\n      this.formItem = {\n        type: '1',\n        express_record_type: '1',\n        delivery_name: '',\n        delivery_id: '',\n        express_temp_id: '',\n        expressTemp: [],\n        to_name: '',\n        to_tel: '',\n        to_addr: '',\n        sh_delivery: '',\n        fictitious_content: '',\n      };\n    },\n    // 物流公司列表\n    getList(type) {\n      let status = type === 2 ? 1 : '';\n      getExpressData(status)\n        .then(async (res) => {\n          this.express = res.data;\n          this.getSheetInfo();\n        })\n        .catch((res) => {\n          this.loading = false;\n          this.$message.error(res.msg);\n        });\n    },\n    // 提交\n    putSend(name) {\n      let data = {\n        id: this.orderId,\n        datas: this.formItem,\n      };\n      if (this.formItem.type === '1' && this.formItem.express_record_type === '2') {\n        if (this.formItem.delivery_name === '') {\n          return this.$message.error('快递公司不能为空');\n        } else if (this.formItem.express_temp_id === '') {\n          return this.$message.error('电子面单不能为空');\n        } else if (this.formItem.to_name === '') {\n          return this.$message.error('寄件人姓名不能为空');\n        } else if (this.formItem.to_tel === '') {\n          return this.$message.error('寄件人电话不能为空');\n        } else if (!/^1(3|4|5|7|8|9|6)\\d{9}$/i.test(this.formItem.to_tel)) {\n          return this.$message.error('请输入正确的手机号码');\n        } else if (this.formItem.to_addr === '') {\n          return this.$message.error('寄件人地址不能为空');\n        }\n      }\n      if (this.formItem.type === '1' && this.formItem.express_record_type === '1') {\n        if (this.formItem.delivery_name === '') {\n          return this.$message.error('快递公司不能为空');\n        } else if (this.formItem.delivery_id === '') {\n          return this.$message.error('快递单号不能为空');\n        }\n      }\n      if (this.formItem.type === '2') {\n        if (this.formItem.sh_delivery === '') {\n          return this.$message.error('送货人不能为空');\n        }\n      }\n      integralOrderPutDelivery(data)\n        .then(async (res) => {\n          this.$emit('submitFail');\n          this.modals = false;\n          this.$message.success(res.msg);\n          this.reset();\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n      // if (this.formItem.type == 3) {\n      //     putDelivery(data).then(async res => {\n      //         this.modals = false;\n      //         this.$message.success(res.msg);\n      //         this.$refs[name].resetFields();\n      //         this.$emit('submitFail')\n      //     }).catch(res => {\n      //         this.$message.error(res.msg);\n      //     })\n      // } else {\n      //     this.$refs[name].validate((valid) => {\n      //         if (valid) {\n      //             putDelivery(data).then(async res => {\n      //                 this.modals = false;\n      //                 this.$message.success(res.msg);\n      //                 this.$refs[name].resetFields();\n      //                 this.$emit('submitFail')\n      //             }).catch(res => {\n      //                 this.$message.error(res.msg);\n      //             })\n      //         } else {\n      //             this.$message.error('请填写信息');\n      //         }\n      //     })\n      // }\n    },\n    cancel(name) {\n      this.modals = false;\n      this.reset();\n      // this.$refs[name].resetFields();\n      // this.formItem.type = '1';\n    },\n    // 电子面单列表\n    expressChange(value) {\n      let expressItem = this.express.find((item) => {\n        return item.value === value;\n      });\n      if (expressItem === undefined) {\n        return;\n      }\n      this.formItem.delivery_code = expressItem.code;\n      if (this.formItem.express_record_type === '2') {\n        this.expressTemp = [];\n        this.formItem.express_temp_id = '';\n        orderExpressTemp({\n          com: this.formItem.delivery_code,\n        })\n          .then((res) => {\n            this.expressTemp = res.data;\n            if (!res.data.length) {\n              this.$message.error('请配置你所选快递公司的电子面单');\n            }\n          })\n          .catch((err) => {\n            this.$message.error(err.msg);\n          });\n      }\n    },\n    getDeliveryList() {\n      orderDeliveryList()\n        .then((res) => {\n          this.deliveryList = res.data.list;\n        })\n        .catch((err) => {\n          this.$message.error(err.msg);\n        });\n    },\n    getSheetInfo() {\n      orderSheetInfo()\n        .then((res) => {\n          const data = res.data;\n          for (const key in data) {\n            if (data.hasOwnProperty(key)) {\n              this.formItem[key] = data[key];\n            }\n          }\n          this.export_open = data.export_open === undefined ? true : data.export_open;\n          if (!this.export_open) {\n            this.formItem.express_record_type = '1';\n          }\n          this.formItem.to_addr = data.to_add;\n        })\n        .catch((err) => {\n          this.$message.error(err.msg);\n        });\n    },\n    shDeliveryChange(value) {\n      let deliveryItem = this.deliveryList.find((item) => {\n        return item.id === value;\n      });\n      this.formItem.sh_delivery_name = deliveryItem.wx_name;\n      this.formItem.sh_delivery_id = deliveryItem.phone;\n      this.formItem.sh_delivery_uid = deliveryItem.uid;\n    },\n    expressTempChange(tempId) {\n      this.temp = this.expressTemp.find((item) => {\n        return tempId === item.temp_id;\n      });\n      if (this.temp === undefined) {\n        this.temp = {};\n      }\n    },\n    // inited (viewer) {\n    //     this.$viewer = viewer;\n    // },\n    preview() {\n      this.$refs.viewer.$viewer.show();\n      // this.$viewer.show();\n    },\n  },\n};\n</script>\n\n<style scoped>\n.express_temp_id {\n  position: relative;\n}\n\n.express_temp_id button {\n  position: absolute;\n  top: 50%;\n  right: 110px;\n  padding: 0;\n  border: none;\n  background: none;\n  transform: translateY(-50%);\n  color: #57a3f3;\n}\n\n.ivu-btn-text:focus {\n  box-shadow: none;\n}\n.trips {\n  color: #ccc;\n}\n</style>\n"]}]}