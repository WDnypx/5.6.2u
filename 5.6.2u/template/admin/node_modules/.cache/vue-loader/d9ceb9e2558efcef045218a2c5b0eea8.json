{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\system\\crontab\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\system\\crontab\\index.vue","mtime":1731313973103},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1753254258567},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IHRpbWVySW5kZXgsIHNob3dUaW1lciB9IGZyb20gJ0AvYXBpL3N5c3RlbSc7CmltcG9ydCBjcmVhdFRhc2sgZnJvbSAnLi9jcmVhdGVNb2RhbC52dWUnOwppbXBvcnQgc2V0dGluZyBmcm9tICdAL3NldHRpbmcnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ3N5c3RlbV9jcm9udGFiJywKICBjb21wb25lbnRzOiB7IGNyZWF0VGFzayB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgdGFibGVEYXRhOiBbXSwKICAgICAgcGFnZTogMSwKICAgICAgbGltaXQ6IDE1LAogICAgICB0b3RhbDogMSwKICAgICAgYXBpQmFzZVVSTDogJycsCiAgICAgIGhlYWRlckxpc3Q6IFsKICAgICAgICB7IGxhYmVsOiAn57O757uf5Lu75YqhJywgdmFsdWU6ICcwJyB9LAogICAgICAgIHsgbGFiZWw6ICfoh6rlrprkuYnku7vliqEnLCB2YWx1ZTogJzEnIH0sCiAgICAgIF0sCiAgICAgIGN1cnJlbnRUYWI6ICcwJywKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5hcGlCYXNlVVJMID0gc2V0dGluZy5hcGlCYXNlVVJMOwogICAgdGhpcy5nZXRMaXN0KCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICB0YXNrVHJpcChyb3cpIHsKICAgICAgc3dpdGNoIChyb3cudHlwZSkgewogICAgICAgIGNhc2UgMToKICAgICAgICAgIHJldHVybiBg5q+P6ZqUJHtyb3cuc2Vjb25kfeenkuaJp+ihjOS4gOasoWA7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgcmV0dXJuIGDmr4/pmpQke3Jvdy5taW51dGV95YiG6ZKf5omn6KGM5LiA5qyhYDsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICByZXR1cm4gYOavj+malCR7cm93LmhvdXJ95bCP5pe25omn6KGM5LiA5qyhYDsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICByZXR1cm4gYOavj+malCR7cm93LmRheX3lpKnmiafooYzkuIDmrKFgOwogICAgICAgIGNhc2UgNToKICAgICAgICAgIHJldHVybiBg5q+P5aSpJHtyb3cuaG91cn3ml7Yke3Jvdy5taW51dGV95YiGJHtyb3cuc2Vjb25kfeenkuaJp+ihjOS4gOasoWA7CiAgICAgICAgY2FzZSA2OgogICAgICAgICAgcmV0dXJuIGDmr4/kuKrmmJ/mnJ8ke3Jvdy53ZWVrfeeahCR7cm93LmhvdXJ95pe2JHtyb3cubWludXRlfeWIhiR7cm93LnNlY29uZH3np5LmiafooYzkuIDmrKFgOwogICAgICAgIGNhc2UgNzoKICAgICAgICAgIHJldHVybiBg5q+P5pyIJHtyb3cuZGF5feaXpeeahCR7cm93LmhvdXJ95pe2JHtyb3cubWludXRlfeWIhiR7cm93LnNlY29uZH3np5LmiafooYzkuIDmrKFgOwogICAgICAgIGNhc2UgODoKICAgICAgICAgIHJldHVybiBg5q+P5bm0JHtyb3cubW9udGh95pyIJHtyb3cuZGF5feaXpeeahCR7cm93LmhvdXJ95pe2JHtyb3cubWludXRlfeWIhiR7cm93LnNlY29uZH3np5LmiafooYzkuIDmrKFgOwogICAgICB9CiAgICB9LAogICAgLy8g5YiX6KGoCiAgICBnZXRMaXN0KCkgewogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICB0aW1lckluZGV4KHsKICAgICAgICBwYWdlOiB0aGlzLnBhZ2UsCiAgICAgICAgbGltaXQ6IHRoaXMubGltaXQsCiAgICAgICAgY3VzdG9tOiB0aGlzLmN1cnJlbnRUYWIgPT09ICcxJyA/IDEgOiAwLAogICAgICB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgbGV0IHsgY291bnQsIGxpc3QgfSA9IHJlcy5kYXRhOwogICAgICAgICAgdGhpcy50b3RhbCA9IGNvdW50OwogICAgICAgICAgdGhpcy50YWJsZURhdGEgPSBsaXN0OwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBhZGRUYXNrKCkgewogICAgICB0aGlzLiRyZWZzLmFkZFRhc2sudGltZXJJbmZvKDApOwogICAgfSwKICAgIGVkaXQoaWQpIHsKICAgICAgdGhpcy4kcmVmcy5hZGRUYXNrLnRpbWVySW5mbyhpZCk7CiAgICB9LAogICAgLy8g5Yig6ZmkCiAgICBoYW5kbGVEZWxldGUocm93LCB0aXQsIG51bSkgewogICAgICBsZXQgZGVsZnJvbURhdGEgPSB7CiAgICAgICAgdGl0bGU6IHRpdCwKICAgICAgICBudW06IG51bSwKICAgICAgICB1cmw6IGBzeXN0ZW0vY3JvbnRhYi9kZWwvJHtyb3cuaWR9YCwKICAgICAgICBtZXRob2Q6ICdkZWxldGUnLAogICAgICAgIGlkczogJycsCiAgICAgIH07CiAgICAgIHRoaXMuJG1vZGFsU3VyZShkZWxmcm9tRGF0YSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MocmVzLm1zZyk7CiAgICAgICAgICB0aGlzLmdldExpc3QoKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICAgIH0pOwogICAgfSwKICAgIC8vIOaYr+WQpuW8gOWQrwogICAgaGFuZGxlQ2hhbmdlKHsgaWQsIGlzX29wZW4gfSkgewogICAgICBzaG93VGltZXIoaWQsIGlzX29wZW4pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHJlcy5tc2cpOwogICAgICAgICAgdGhpcy5nZXRMaXN0KCk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKHJlcykgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICB9KTsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAgFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/system/crontab","sourcesContent":["<template>\n  <div>\n    <el-card :bordered=\"false\" shadow=\"never\" class=\"ivu-mt\" :body-style=\"{ padding: '0 20px' }\">\n      <div>\n        <el-tabs v-model=\"currentTab\" @tab-click=\"getList\">\n          <el-tab-pane\n            :label=\"item.label\"\n            :name=\"item.value.toString()\"\n            v-for=\"(item, index) in headerList\"\n            :key=\"index\"\n          />\n        </el-tabs>\n      </div>\n    </el-card>\n    <el-card :bordered=\"false\" shadow=\"never\">\n      <el-alert type=\"warning\" :closable=\"false\">\n        <template slot=\"title\">\n          启动定时任务两种方式：<br />\n          1、使用命令启动：php think timer start\n          --d；如果更改了执行周期、编辑是否开启、删除定时任务需要重新启动下定时任务确保生效；<br />\n          2、使用接口触发定时任务，建议每分钟调用一次，接口地址 {{ apiBaseURL }}/api/crontab/run <br />\n        </template>\n      </el-alert>\n      <el-button v-if=\"currentTab === '1'\" type=\"primary\" v-db-click @click=\"addTask\" class=\"mt14\"\n        >添加定时任务</el-button\n      >\n      <el-table :data=\"tableData\" v-loading=\"loading\" class=\"ivu-mt\">\n        <el-table-column label=\"标题\" min-width=\"150\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.name }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"任务说明\" min-width=\"130\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.content }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"执行周期\" min-width=\"130\">\n          <template slot-scope=\"scope\">\n            <span>{{ taskTrip(scope.row) }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"是否开启\" min-width=\"130\">\n          <template slot-scope=\"scope\">\n            <el-switch\n              class=\"defineSwitch\"\n              :active-value=\"1\"\n              :inactive-value=\"0\"\n              v-model=\"scope.row.is_open\"\n              size=\"large\"\n              @change=\"handleChange(scope.row)\"\n              active-text=\"开启\"\n              inactive-text=\"关闭\"\n            >\n            </el-switch>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" width=\"100\">\n          <template slot-scope=\"scope\">\n            <a v-db-click @click=\"edit(scope.row.id)\">编辑</a>\n            <el-divider direction=\"vertical\" v-if=\"currentTab === '1'\"></el-divider>\n            <a\n              v-if=\"currentTab === '1'\"\n              v-permission=\"'seckill'\"\n              v-db-click\n              @click=\"handleDelete(scope.row, '删除定时任务', scope.$index)\"\n              >删除</a\n            >\n          </template>\n        </el-table-column>\n      </el-table>\n      <div class=\"acea-row row-right page\">\n        <pagination v-if=\"total\" :total=\"total\" :page.sync=\"page\" :limit.sync=\"limit\" @pagination=\"getList\" />\n      </div>\n      <creatTask ref=\"addTask\" :currentTab=\"currentTab\" @submitAsk=\"getList\"></creatTask>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { timerIndex, showTimer } from '@/api/system';\nimport creatTask from './createModal.vue';\nimport setting from '@/setting';\nexport default {\n  name: 'system_crontab',\n  components: { creatTask },\n  data() {\n    return {\n      loading: false,\n      tableData: [],\n      page: 1,\n      limit: 15,\n      total: 1,\n      apiBaseURL: '',\n      headerList: [\n        { label: '系统任务', value: '0' },\n        { label: '自定义任务', value: '1' },\n      ],\n      currentTab: '0',\n    };\n  },\n  created() {\n    this.apiBaseURL = setting.apiBaseURL;\n    this.getList();\n  },\n  methods: {\n    taskTrip(row) {\n      switch (row.type) {\n        case 1:\n          return `每隔${row.second}秒执行一次`;\n        case 2:\n          return `每隔${row.minute}分钟执行一次`;\n        case 3:\n          return `每隔${row.hour}小时执行一次`;\n        case 4:\n          return `每隔${row.day}天执行一次`;\n        case 5:\n          return `每天${row.hour}时${row.minute}分${row.second}秒执行一次`;\n        case 6:\n          return `每个星期${row.week}的${row.hour}时${row.minute}分${row.second}秒执行一次`;\n        case 7:\n          return `每月${row.day}日的${row.hour}时${row.minute}分${row.second}秒执行一次`;\n        case 8:\n          return `每年${row.month}月${row.day}日的${row.hour}时${row.minute}分${row.second}秒执行一次`;\n      }\n    },\n    // 列表\n    getList() {\n      this.loading = true;\n      timerIndex({\n        page: this.page,\n        limit: this.limit,\n        custom: this.currentTab === '1' ? 1 : 0,\n      })\n        .then((res) => {\n          this.loading = false;\n          let { count, list } = res.data;\n          this.total = count;\n          this.tableData = list;\n        })\n        .catch((res) => {\n          this.loading = false;\n          this.$message.error(res.msg);\n        });\n    },\n    addTask() {\n      this.$refs.addTask.timerInfo(0);\n    },\n    edit(id) {\n      this.$refs.addTask.timerInfo(id);\n    },\n    // 删除\n    handleDelete(row, tit, num) {\n      let delfromData = {\n        title: tit,\n        num: num,\n        url: `system/crontab/del/${row.id}`,\n        method: 'delete',\n        ids: '',\n      };\n      this.$modalSure(delfromData)\n        .then((res) => {\n          this.$message.success(res.msg);\n          this.getList();\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    // 是否开启\n    handleChange({ id, is_open }) {\n      showTimer(id, is_open)\n        .then((res) => {\n          this.$message.success(res.msg);\n          this.getList();\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.ivu-mt {\n  padding-top: 10px;\n}\n</style>\n"]}]}