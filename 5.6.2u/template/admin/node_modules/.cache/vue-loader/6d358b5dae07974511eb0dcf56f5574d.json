{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\components\\freightTemplate\\index.vue?vue&type=style&index=0&id=6c602140&lang=scss&scoped=true","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\components\\freightTemplate\\index.vue","mtime":1731313973039},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\css-loader\\index.js","mtime":1753254259822},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1753254262918},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1753254258547},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1753254255270},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5pdnUtdGFibGUtd3JhcHBlciB7CiAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjZGNkZWUyOwogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZGNkZWUyOwp9Ci5pdnUtdGFibGUtYm9yZGVyIHRoLAouaXZ1LXRhYmxlLWJvcmRlciB0ZCB7CiAgcGFkZGluZzogMCAxMHB4ICFpbXBvcnRhbnQ7Cn0KLmFkZFRvcCB7CiAgbWFyZ2luLXRvcDogMTVweDsKfQoucmFkaW8gewogIHBhZGRpbmc6IDVweCAwOwp9Ci5pdnUtaW5wdXQtbnVtYmVyIHsKICB3aWR0aDogMTAwJTsKfQouZnJlZV90aXBzIHsKICBmb250LXNpemU6IDEycHg7CiAgY29sb3I6ICNjY2M7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAsdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/freightTemplate","sourcesContent":["<template>\n  <div>\n    <el-dialog\n      :visible.sync=\"isTemplate\"\n      title=\"运费模版\"\n      width=\"1000px\"\n      if=\"isTemplate\"\n      @on-cancel=\"cancel\"\n      @closed=\"close\"\n    >\n      <div class=\"Modals\">\n        <el-form class=\"form\" ref=\"formData\" label-width=\"120px\" label-position=\"right\">\n          <el-row :gutter=\"24\">\n            <el-col :xl=\"18\" :lg=\"18\" :md=\"18\" :sm=\"24\" :xs=\"24\">\n              <el-form-item label=\"模板名称：\" prop=\"name\">\n                <el-input type=\"text\" placeholder=\"请输入模板名称\" :maxlength=\"20\" v-model=\"formData.name\" />\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row :gutter=\"24\">\n            <el-col :xl=\"18\" :lg=\"18\" :md=\"18\" :sm=\"24\" :xs=\"24\">\n              <el-form-item label=\"计费方式：\" props=\"state\" label-for=\"state\">\n                <el-radio-group class=\"radio\" v-model=\"formData.type\" @input=\"changeRadio\" element-id=\"state\">\n                  <el-radio :label=\"1\">按件数</el-radio>\n                  <el-radio :label=\"2\">按重量</el-radio>\n                  <el-radio :label=\"3\">按体积</el-radio>\n                </el-radio-group>\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row :gutter=\"24\">\n            <el-col :xl=\"24\" :lg=\"24\" :md=\"24\" :sm=\"24\" :xs=\"24\">\n              <el-form-item class=\"label\" label=\"配送区域及运费：\" props=\"state\" label-for=\"state\">\n                <el-table ref=\"table\" :data=\"templateList\" class=\"ivu-mt\" empty-text=\"暂无数据\" border>\n                  <el-table-column label=\"可配送区域\" minWidth=\"100\">\n                    <template slot-scope=\"scope\">\n                      <el-input v-model=\"templateList[scope.$index].regionName\" />\n                    </template>\n                  </el-table-column>\n                  <el-table-column\n                    :label=\"formData.type === 2 ? '首件重量(KG)' : formData.type === 3 ? '首件体积(m³)' : '首件'\"\n                    minWidth=\"100\"\n                  >\n                    <template slot-scope=\"scope\">\n                      <el-input type=\"number\" v-model=\"templateList[scope.$index].first\" />\n                    </template>\n                  </el-table-column>\n                  <el-table-column label=\"运费（元）\" minWidth=\"100\">\n                    <template slot-scope=\"scope\">\n                      <el-input type=\"number\" v-model=\"templateList[scope.$index].price\" />\n                    </template>\n                  </el-table-column>\n                  <el-table-column\n                    :label=\"formData.type === 2 ? '续件重量(KG)' : formData.type === 3 ? '续件体积(m³)' : '续件'\"\n                    minWidth=\"100\"\n                  >\n                    <template slot-scope=\"scope\">\n                      <el-input type=\"number\" v-model=\"templateList[scope.$index].continue\" />\n                    </template>\n                  </el-table-column>\n                  <el-table-column label=\"续费（元）\" minWidth=\"100\">\n                    <template slot-scope=\"scope\">\n                      <el-input type=\"number\" v-model=\"templateList[scope.$index].continue_price\" />\n                    </template>\n                  </el-table-column>\n                  <el-table-column label=\"操作\" fixed=\"right\" width=\"100\">\n                    <template slot-scope=\"scope\">\n                      <a\n                        v-if=\"scope.row.regionName !== '默认全国'\"\n                        v-db-click\n                        @click=\"delCity(scope.row, '配送区域', scope.$index, 1)\"\n                        >删除</a\n                      >\n                    </template>\n                  </el-table-column>\n                </el-table>\n                <el-row class=\"addTop\">\n                  <el-col>\n                    <el-button type=\"primary\" icon=\"md-add\" v-db-click @click=\"addCity(1)\">添加配送区域</el-button>\n                  </el-col>\n                </el-row>\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row :gutter=\"24\">\n            <el-col :xl=\"24\" :lg=\"24\" :md=\"24\" :sm=\"24\" :xs=\"24\">\n              <el-form-item label=\"指定包邮：\" prop=\"store_name\" label-for=\"store_name\">\n                <el-radio-group class=\"radio\" v-model=\"formData.appoint_check\">\n                  <el-radio :label=\"1\">开启</el-radio>\n                  <el-radio :label=\"0\">关闭</el-radio>\n                </el-radio-group>\n                <el-table\n                  ref=\"table\"\n                  :data=\"appointList\"\n                  class=\"addTop mt10\"\n                  empty-text=\"暂无数据\"\n                  border\n                  v-if=\"formData.appoint_check === 1\"\n                >\n                  <el-table-column label=\"选择区域\" minWidth=\"100\">\n                    <template slot-scope=\"scope\">\n                      <el-input v-model=\"appointList[scope.$index].placeName\" />\n                    </template>\n                  </el-table-column>\n                  <el-table-column\n                    :label=\"formData.type === 2 ? '包邮重量' : formData.type === 3 ? '包邮体积(m³)' : '包邮件数'\"\n                    minWidth=\"100\"\n                  >\n                    <template slot-scope=\"scope\">\n                      <el-input type=\"number\" v-model=\"appointList[scope.$index].a_num\" />\n                    </template>\n                  </el-table-column>\n                  <el-table-column label=\"包邮金额（元）\" minWidth=\"100\">\n                    <template slot-scope=\"scope\">\n                      <el-input type=\"number\" v-model=\"appointList[scope.$index].a_price\" />\n                    </template>\n                  </el-table-column>\n                  <el-table-column label=\"操作\" fixed=\"right\" width=\"100\">\n                    <template slot-scope=\"scope\">\n                      <a\n                        v-if=\"scope.row.regionName !== '默认全国'\"\n                        v-db-click\n                        @click=\"delCity(scope.row, '配送区域', scope.$index, 2)\"\n                        >删除</a\n                      >\n                    </template>\n                  </el-table-column>\n                </el-table>\n                <div v-if=\"formData.appoint_check === 1\" class=\"free_tips\">\n                  指定地区需同时满足包邮（件数/重量/体积）和包邮金额的条件，才可实现包邮\n                </div>\n                <el-row class=\"addTop mt5\" v-if=\"formData.appoint_check === 1\">\n                  <el-col>\n                    <el-button type=\"primary\" icon=\"md-add\" v-db-click @click=\"addCity(2)\">添加包邮区域</el-button>\n                  </el-col>\n                </el-row>\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row :gutter=\"24\">\n            <el-col :xl=\"24\" :lg=\"24\" :md=\"24\" :sm=\"24\" :xs=\"24\">\n              <el-form-item label=\"指定不送达：\" prop=\"store_name\" label-for=\"store_name\">\n                <el-radio-group class=\"radio\" v-model=\"formData.no_delivery_check\">\n                  <el-radio :label=\"1\">开启</el-radio>\n                  <el-radio :label=\"0\">关闭</el-radio>\n                </el-radio-group>\n                <el-table\n                  ref=\"table\"\n                  :data=\"noDeliveryList\"\n                  class=\"addTop mt10\"\n                  empty-text=\"暂无数据\"\n                  border\n                  v-if=\"formData.no_delivery_check === 1\"\n                >\n                  <el-table-column label=\"选择区域\" minWidth=\"100\">\n                    <template slot-scope=\"scope\">\n                      <el-input v-model=\"noDeliveryList[scope.$index].placeName\" />\n                    </template>\n                  </el-table-column>\n                  <el-table-column label=\"操作\" fixed=\"right\" width=\"100\">\n                    <template slot-scope=\"scope\">\n                      <a\n                        v-if=\"scope.row.regionName !== '默认全国'\"\n                        v-db-click\n                        @click=\"delCity(scope.row, '配送区域', scope.$index, 3)\"\n                        >删除</a\n                      >\n                    </template>\n                  </el-table-column>\n                </el-table>\n                <el-row class=\"addTop\" v-if=\"formData.no_delivery_check === 1\">\n                  <el-col>\n                    <el-button type=\"primary\" icon=\"md-add\" v-db-click @click=\"addCity(3)\">添加不送达区域</el-button>\n                  </el-col>\n                </el-row>\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row :gutter=\"24\">\n            <el-col :xl=\"18\" :lg=\"18\" :md=\"18\" :sm=\"24\" :xs=\"24\">\n              <el-form-item label=\"排序：\" prop=\"store_name\" label-for=\"store_name\">\n                <el-input-number\n                  :controls=\"false\"\n                  :min=\"0\"\n                  placeholder=\"输入值越大越靠前\"\n                  v-model=\"formData.sort\"\n                ></el-input-number>\n              </el-form-item>\n            </el-col>\n          </el-row>\n          <el-row :gutter=\"24\">\n            <el-col>\n              <el-form-item prop=\"store_name\" label-for=\"store_name\">\n                <el-button type=\"primary\" v-db-click @click=\"handleSubmit\">{{\n                  id ? '立即修改' : '立即提交'\n                }}</el-button>\n              </el-form-item>\n            </el-col>\n          </el-row>\n        </el-form>\n      </div>\n      <div slot=\"footer\"></div>\n    </el-dialog>\n    <city ref=\"city\" @selectCity=\"selectCity\" :type=\"type\" :selectArr=\"selectArr\"></city>\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex';\nimport city from '@/components/freightTemplate/city';\nimport { templatesSaveApi, shipTemplatesApi } from '@/api/setting';\nexport default {\n  name: 'freightTemplate',\n  components: { city },\n  props: {},\n  data() {\n    let that = this;\n    return {\n      isTemplate: false,\n      templateList: [\n        {\n          region: [\n            {\n              name: '默认全国',\n              city_id: 0,\n            },\n          ],\n          regionName: '默认全国',\n          first: 1,\n          price: 0,\n          continue: 1,\n          continue_price: 0,\n        },\n      ],\n      appointList: [],\n      noDeliveryList: [],\n      type: 1,\n      formData: {\n        type: 1,\n        sort: 0,\n        name: '',\n        appoint_check: 0,\n        no_delivery_check: 0,\n      },\n      id: 0,\n\n      addressModal: false,\n      indeterminate: true,\n      checkAll: false,\n      checkAllGroup: [],\n      activeCity: -1,\n      provinceAllGroup: [],\n      index: -1,\n      displayData: '',\n      currentProvince: '',\n      selectArr: [], // 传递选中的城市\n      noShippingArr: [], // 不包邮选择的城市数据\n      yesShippingArr: [], // 包邮选择的城市数据\n      noDeliveryArr: [], // 不送达选择的城市数据\n    };\n  },\n  computed: {},\n  methods: {\n    close() {\n      this.$emit('close');\n    },\n    editFrom(id) {\n      this.id = id;\n      shipTemplatesApi(id).then((res) => {\n        let formData = res.data.formData;\n        this.templateList = res.data.templateList;\n        this.appointList = res.data.appointList;\n        this.noDeliveryList = res.data.noDeliveryList;\n        this.formData = {\n          type: formData.type,\n          sort: formData.sort,\n          name: formData.name,\n          appoint_check: formData.appoint_check,\n          no_delivery_check: formData.no_delivery_check,\n        };\n        // this.headerType();\n      });\n    },\n    selectCity: function (data, type) {\n      let cityName = data\n        .map(function (item) {\n          return item.name;\n        })\n        .join(';');\n      switch (type) {\n        case 1:\n          this.templateList.push({\n            region: data,\n            regionName: cityName,\n            first: 1,\n            price: 0,\n            continue: 1,\n            continue_price: 0,\n          });\n          this.noShippingArr = this.noShippingArr.concat(data);\n          break;\n        case 2:\n          this.appointList.push({\n            place: data,\n            placeName: cityName,\n            a_num: 0,\n            a_price: 0,\n          });\n          this.yesShippingArr = this.yesShippingArr.concat(data);\n          break;\n        case 3:\n          this.noDeliveryList.push({\n            place: data,\n            placeName: cityName,\n          });\n          this.noDeliveryArr = this.noDeliveryArr.concat(data);\n          break;\n      }\n    },\n    // 单独添加配送区域\n    addCity(type) {\n      this.selectArr = type == 1 ? this.noShippingArr : type == 2 ? this.yesShippingArr : this.noDeliveryArr;\n      this.type = type;\n      this.$refs.city.getCityList();\n      this.$refs.city.addressModal = true;\n    },\n    changeRadio() {},\n    // 提交\n    handleSubmit: function () {\n      let that = this;\n      if (!that.formData.name.trim().length) {\n        return that.$message.error('请填写模板名称');\n      }\n      for (let i = 0; i < that.templateList.length; i++) {\n        if (that.templateList[i].first <= 0) {\n          return that.$message.error('首件/重量/体积应大于0');\n        }\n        if (that.templateList[i].price < 0) {\n          return that.$message.error('运费应大于等于0');\n        }\n        if (that.templateList[i].continue <= 0) {\n          return that.$message.error('续件/重量/体积应大于0');\n        }\n        if (that.templateList[i].continue_price < 0) {\n          return that.$message.error('续费应大于等于0');\n        }\n      }\n      if (that.formData.appoint_check === 1) {\n        for (let i = 0; i < that.appointList.length; i++) {\n          if (that.appointList[i].a_num <= 0) {\n            return that.$message.error('包邮件数应大于0');\n          }\n          if (that.appointList[i].a_price < 0) {\n            return that.$message.error('包邮金额应大于等于0');\n          }\n        }\n      }\n      let data = {\n        appoint_info: that.appointList,\n        region_info: that.templateList,\n        no_delivery_info: that.noDeliveryList,\n        sort: that.formData.sort,\n        type: that.formData.type,\n        name: that.formData.name,\n        appoint: that.formData.appoint_check,\n        no_delivery: that.formData.no_delivery_check,\n      };\n      templatesSaveApi(that.id, data).then((res) => {\n        this.isTemplate = false;\n        // this.$parent.getList();\n        this.formData = {\n          type: 1,\n          sort: 0,\n          name: '',\n          appoint_check: 0,\n          no_delivery_check: 0,\n        };\n        this.appointList = [];\n        this.noDeliveryList = [];\n        this.addressModal = false;\n        this.templateList = [\n          {\n            region: [\n              {\n                name: '默认全国',\n                city_id: 0,\n              },\n            ],\n            regionName: '默认全国',\n            first: 1,\n            price: 0,\n            continue: 1,\n            continue_price: 0,\n          },\n        ];\n        this.$emit('addSuccess');\n        this.$message.success(res.msg);\n      });\n    },\n    // 删除\n    delCity(row, tit, num, type) {\n      if (type === 1) {\n        this.templateList.splice(num, 1);\n      } else if (type == 2) {\n        this.appointList.splice(num, 1);\n      } else {\n        this.noDeliveryList.splice(num, 1);\n      }\n      //   let delfromData = {\n      //     title: tit,\n      //     num: num,\n      //     url: `setting/shipping_templates/del/${row.id}`,\n      //     method: \"DELETE\",\n      //     ids: \"\",\n      //   };\n      //   this.$modalSure(delfromData)\n      //     .then((res) => {\n      //       this.$message.success(res.msg);\n      //     })\n      //     .catch((res) => {\n      //       this.$message.error(res.msg);\n      //     });\n    },\n    // 关闭\n    cancel() {\n      this.noShippingArr = [];\n      this.noDeliveryArr = [];\n      this.yesShippingArr = [];\n      this.selectArr = [];\n      this.formData = {\n        type: 1,\n        sort: 0,\n        name: '',\n        appoint_check: 0,\n        no_delivery_check: 0,\n      };\n      this.appointList = [];\n      this.noDeliveryList = [];\n      this.addressModal = false;\n      this.templateList = [\n        {\n          region: [\n            {\n              name: '默认全国',\n              city_id: 0,\n            },\n          ],\n          regionName: '默认全国',\n          first: 0,\n          price: 0,\n          continue: 0,\n          continue_price: 0,\n        },\n      ];\n    },\n\n    address() {\n      this.addressModal = true;\n    },\n    enter(index) {\n      this.activeCity = index;\n    },\n    leave() {\n      this.activeCity = null;\n    },\n  },\n  mounted() {},\n};\n</script>\n<style lang=\"scss\" scoped>\n.ivu-table-wrapper {\n  border-left: 1px solid #dcdee2;\n  border-top: 1px solid #dcdee2;\n}\n.ivu-table-border th,\n.ivu-table-border td {\n  padding: 0 10px !important;\n}\n.addTop {\n  margin-top: 15px;\n}\n.radio {\n  padding: 5px 0;\n}\n.ivu-input-number {\n  width: 100%;\n}\n.free_tips {\n  font-size: 12px;\n  color: #ccc;\n}\n</style>\n"]}]}