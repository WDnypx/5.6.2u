{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\app\\wechat\\menus\\index.vue?vue&type=style&index=0&id=54b330c0&scoped=true&lang=scss","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\app\\wechat\\menus\\index.vue","mtime":1731313973062},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\css-loader\\index.js","mtime":1753254259822},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1753254262918},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1753254258547},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1753254255270},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiogewogIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7IC8q54Gr54uQKi8KICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOyAvKndlYmtpdOa1j+iniOWZqCovCiAgLW1zLXVzZXItc2VsZWN0OiBub25lOyAvKklFMTAqLwogIC1raHRtbC11c2VyLXNlbGVjdDogbm9uZTsgLyrml6nmnJ/mtY/op4jlmagqLwogIHVzZXItc2VsZWN0OiBub25lOwp9CgoubGVmdCB7CiAgbWluLXdpZHRoOiAzOTBweDsKICBtaW4taGVpZ2h0OiA1NTBweDsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgcGFkZGluZy1sZWZ0OiA0MHB4Owp9CgoudG9wIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwcHg7Cn0KCi5ib3R0b20gewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBib3R0b206IDBweDsKfQoKLnRleHRib3QgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBib3R0b206IDBweDsKICBsZWZ0OiA1NXB4OwogIHdpZHRoOiAxMDAlOwp9Ci5hY3RpdmUgewogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXByZXYtY29sb3ItcHJpbWFyeSkgIWltcG9ydGFudDsKICBjb2xvcjogdmFyKC0tcHJldi1jb2xvci1wcmltYXJ5KSAhaW1wb3J0YW50Owp9Ci5saSB7CiAgZmxvYXQ6IGxlZnQ7CiAgd2lkdGg6IDkycHg7CiAgaGVpZ2h0OiA0OHB4OwogIGxpbmUtaGVpZ2h0OiA0OHB4OwogIGJvcmRlci1sZWZ0OiAxcHggc29saWQgI2U3ZTdlYjsKICBiYWNrZ3JvdW5kOiAjZmFmYWZhOwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBjdXJzb3I6IHBvaW50ZXI7CiAgY29sb3I6ICM5OTk7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9Ci50ZXh0IHsKICBoZWlnaHQ6IDUwcHg7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICB3aWR0aDogMTAwJTsKICBvdmVyZmxvdzogaGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwogIHBhZGRpbmc6IDAgNXB4Owp9Ci50ZXh0OmhvdmVyIHsKICBjb2xvcjogIzAwMDsKfQoKLmFkZCB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGJvdHRvbTogNjVweDsKICB3aWR0aDogMTAwJTsKICBsaW5lLWhlaWdodDogNDBweDsKICAvLyBib3JkZXI6IDFweCBzb2xpZCAjZTdlN2ViOwogIGJhY2tncm91bmQ6ICNmYWZhZmE7Cn0KLmFycm93IHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgYm90dG9tOiAtMTZweDsKICBsZWZ0OiAzNnB4OwogIC8qIOWchuinkueahOS9jee9rumcgOimgee7huW/g+iwg+ivleWTpiAqLwogIHdpZHRoOiAwOwogIGhlaWdodDogMDsKICBmb250LXNpemU6IDA7CiAgYm9yZGVyOiBzb2xpZCA4cHg7CiAgYm9yZGVyLWNvbG9yOiAjZmFmYWZhICNmNGY1ZjkgI2Y0ZjVmOSAjZjRmNWY5Owp9Ci50aWFuamlhIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgYm90dG9tOiAxMDdweDsKICB3aWR0aDogMTAwJTsKICBsaW5lLWhlaWdodDogNDhweDsKICBiYWNrZ3JvdW5kOiAjZmFmYWZhOwogIDpmaXJzdC1jaGlsZCB7CiAgICBib3JkZXI6IG5vbmU7CiAgfQp9Ci5hZGRhZGQgewogIHdpZHRoOiAxMDAlOwogIGxpbmUtaGVpZ2h0OiA0MHB4OwogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZjBmMGYwOwogIGJhY2tncm91bmQ6ICNmYWZhZmE7CiAgaGVpZ2h0OiA0MHB4Owp9Ci5yaWdodCB7CiAgYmFja2dyb3VuZDogI2ZmZjsKICBtaW4taGVpZ2h0OiA0MDBweDsKfQouc3B3aWR0aCB7CiAgd2lkdGg6IDEwMCU7Cn0KLnVzZXJBbGVydCB7CiAgbWFyZ2luLXRvcDogMTZweCAhaW1wb3J0YW50Owp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAuVA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/app/wechat/menus","sourcesContent":["<template>\n  <div class=\"article-manager\">\n    <!-- <div class=\"i-layout-page-header header-title\">\n      <span class=\"ivu-page-header-title\">{{ $route.meta.title }}</span>\n    </div> -->\n    <pages-header ref=\"pageHeader\" :title=\"$route.meta.title\"></pages-header>\n    <el-card :bordered=\"false\" shadow=\"never\" class=\"ivu-mt mt16\">\n      <!-- 公众号设置 -->\n      <el-row :gutter=\"24\">\n        <el-col :span=\"24\" class=\"ml40\">\n          <!-- 预览功能 -->\n          <el-col :span=\"24\">\n            <el-col :xl=\"7\" :lg=\"7\" :md=\"22\" :sm=\"22\" :xs=\"22\" class=\"left mb15\">\n              <img class=\"top\" src=\"../../../../assets/images/mobilehead.png\" />\n              <img class=\"bottom\" src=\"@/assets/images/mobilefoot.png\" />\n              <div style=\"background: #f4f5f9; min-height: 438px; position: absolute; top: 63px; width: 320px\"></div>\n              <div class=\"textbot\">\n                <div class=\"li\" v-for=\"(item, indx) in list\" :key=\"indx\" :class=\"{ active: item === formValidate }\">\n                  <div>\n                    <div class=\"add\" v-db-click @click=\"add(item, indx)\">\n                      <i class=\"el-icon-plus\"></i>\n                      <div class=\"arrow\"></div>\n                    </div>\n                    <div class=\"tianjia\">\n                      <div\n                        class=\"addadd\"\n                        v-for=\"(j, index) in item.sub_button\"\n                        :key=\"index\"\n                        :class=\"{ active: j === formValidate }\"\n                        v-db-click\n                        @click=\"gettem(j, index, indx)\"\n                      >\n                        {{ j.name || '二级菜单' }}\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"text\" v-db-click @click=\"gettem(item, indx, null)\">{{ item.name || '一级菜单' }}</div>\n                </div>\n                <div class=\"li\" v-show=\"list.length < 3\">\n                  <div class=\"text\" v-db-click @click=\"addtext\"><i class=\"el-icon-plus\"></i></div>\n                </div>\n              </div>\n            </el-col>\n            <el-col :xl=\"11\" :lg=\"12\" :md=\"22\" :sm=\"22\" :xs=\"22\">\n              <el-tabs value=\"name1\" v-if=\"checkedMenuId !== null\">\n                <el-tab-pane label=\"菜单信息\" name=\"name1\">\n                  <el-col :span=\"24\" class=\"userAlert\">\n                    <div class=\"box-card right\">\n                      <el-alert type=\"info\" show-icon closable title=\"已添加子菜单，仅可设置菜单名称\"></el-alert>\n                      <el-form\n                        ref=\"formValidate\"\n                        :model=\"formValidate\"\n                        :rules=\"ruleValidate\"\n                        label-width=\"100px\"\n                        class=\"mt20\"\n                      >\n                        <el-form-item label=\"菜单名称\" prop=\"name\">\n                          <el-input v-model=\"formValidate.name\" placeholder=\"请填写菜单名称\" class=\"spwidth\"></el-input>\n                        </el-form-item>\n                        <el-form-item label=\"规则状态\" prop=\"type\">\n                          <el-select v-model=\"formValidate.type\" placeholder=\"请选择规则状态\" class=\"spwidth\">\n                            <el-option value=\"click\" label=\"关键字\"></el-option>\n                            <el-option value=\"view\" label=\"跳转网页\"></el-option>\n                            <el-option value=\"miniprogram\" label=\"小程序\"></el-option>\n                          </el-select>\n                        </el-form-item>\n                        <div v-if=\"formValidate.type === 'click'\">\n                          <el-form-item label=\"关键字\" prop=\"key\">\n                            <el-input v-model=\"formValidate.key\" placeholder=\"请填写关键字\" class=\"spwidth\"></el-input>\n                          </el-form-item>\n                        </div>\n                        <div v-if=\"formValidate.type === 'miniprogram'\">\n                          <el-form-item label=\"appid\" prop=\"appid\">\n                            <el-input v-model=\"formValidate.appid\" placeholder=\"请填写appid\" class=\"spwidth\"></el-input>\n                          </el-form-item>\n                          <el-form-item label=\"小程序路径\" prop=\"pagepath\">\n                            <el-input\n                              v-model=\"formValidate.pagepath\"\n                              placeholder=\"请填写小程序路径\"\n                              class=\"spwidth\"\n                            ></el-input>\n                          </el-form-item>\n                          <el-form-item label=\"备用网页\" prop=\"url\">\n                            <el-input\n                              v-model=\"formValidate.url\"\n                              placeholder=\"请填写备用网页\"\n                              class=\"spwidth\"\n                            ></el-input>\n                          </el-form-item>\n                        </div>\n                        <div v-if=\"formValidate.type === 'view'\">\n                          <el-form-item label=\"跳转地址\" prop=\"url\">\n                            <el-input\n                              v-model=\"formValidate.url\"\n                              placeholder=\"请填写跳转地址\"\n                              class=\"spwidth\"\n                            ></el-input>\n                          </el-form-item>\n                        </div>\n                      </el-form>\n                    </div>\n                  </el-col>\n                </el-tab-pane>\n              </el-tabs>\n              <el-col :span=\"24\" v-if=\"isTrue\">\n                <el-button size=\"small\" type=\"danger\" v-db-click @click=\"deltMenus\">删除</el-button>\n                <el-button type=\"primary\" v-db-click @click=\"submenus('formValidate')\">保存并发布</el-button>\n              </el-col>\n            </el-col>\n          </el-col>\n        </el-col>\n      </el-row>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { wechatMenuApi, MenuApi } from '@/api/app';\nexport default {\n  name: 'wechatMenus',\n  data() {\n    return {\n      modal2: false,\n      formValidate: {\n        name: '',\n        type: 'click',\n        appid: '',\n        url: '',\n        key: '',\n        pagepath: '',\n        id: 0,\n      },\n      ruleValidate: {\n        name: [\n          { required: true, message: '请填写菜单名称', trigger: 'blur' },\n          { min: 1, max: 14, message: '长度在 1 到 14 个字符', trigger: 'blur' },\n        ],\n        key: [{ required: true, message: '请填写关键字', trigger: 'blur' }],\n        appid: [{ required: true, message: '请填写appid', trigger: 'blur' }],\n        pagepath: [{ required: true, message: '请填写备用网页', trigger: 'blur' }],\n        url: [{ required: true, message: '请填写跳转地址', trigger: 'blur' }],\n        type: [{ required: true, message: '请选择规则状态', trigger: 'change' }],\n      },\n      parentMenuId: null,\n      list: [],\n      checkedMenuId: null,\n      isTrue: false,\n    };\n  },\n  mounted() {\n    this.getMenus();\n    if (this.list.length) {\n      this.formValidate = this.list[this.activeClass];\n    } else {\n      return this.formValidate;\n    }\n  },\n  methods: {\n    // 添加一级字段函数\n    defaultMenusData() {\n      return {\n        type: 'click',\n        name: '',\n        sub_button: [],\n      };\n    },\n    // 添加二级字段函数\n    defaultChildData() {\n      return {\n        type: 'click',\n        name: '',\n      };\n    },\n    // 获取 菜单\n    getMenus() {\n      wechatMenuApi()\n        .then(async (res) => {\n          let data = res.data;\n          this.list = data.menus;\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    // 点击保存提交\n    submenus(name) {\n      if (this.isTrue && !this.checkedMenuId && this.checkedMenuId !== 0) {\n        this.putData();\n      } else {\n        this.$refs[name].validate((valid) => {\n          if (valid) {\n            this.putData();\n          } else {\n            if (!this.check()) return false;\n          }\n        });\n      }\n    },\n    // 新增data\n    putData() {\n      let data = {\n        button: this.list,\n      };\n      MenuApi(data)\n        .then(async (res) => {\n          this.$message.success(res.msg);\n          this.checkedMenuId = null;\n          this.formValidate = {};\n          this.isTrue = false;\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    // 点击元素\n    gettem(item, index, pid) {\n      this.checkedMenuId = index;\n      this.formValidate = item;\n      this.parentMenuId = pid;\n      this.isTrue = true;\n    },\n    // 增加二级\n    add(item, index) {\n      if (!this.check()) return false;\n      if (item.sub_button.length < 5) {\n        let data = this.defaultChildData();\n        let id = item.sub_button.length;\n        item.sub_button.push(data);\n        this.formValidate = data;\n        this.checkedMenuId = id;\n        this.parentMenuId = index;\n        this.isTrue = true;\n      } else {\n        this.$message.warning('二级菜单最多只能添加5个!');\n        return false;\n      }\n    },\n    // 增加一级\n    addtext() {\n      if (!this.check()) return false;\n      let data = this.defaultMenusData();\n      let id = this.list.length;\n      this.list.push(data);\n      this.formValidate = data;\n      this.checkedMenuId = id;\n      this.parentMenuId = null;\n      this.isTrue = true;\n    },\n    // 判断函数\n    check: function () {\n      let reg = /[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\\.?/;\n      if (this.checkedMenuId === null) return true;\n      if (!this.isTrue) return true;\n      if (!this.formValidate.name) {\n        this.$message.warning('请输入按钮名称!');\n        return false;\n      }\n      if (this.formValidate.type === 'click' && !this.formValidate.key) {\n        this.$message.warning('请输入关键字!');\n        return false;\n      }\n      if (this.formValidate.type === 'view' && !reg.test(this.formValidate.url)) {\n        this.$message.warning('请输入正确的跳转地址!');\n        return false;\n      }\n      if (\n        this.formValidate.type === 'miniprogram' &&\n        (!this.formValidate.appid || !this.formValidate.pagepath || !this.formValidate.url)\n      ) {\n        this.$message.warning('请填写完整小程序配置!');\n        return false;\n      }\n      return true;\n    },\n    // 删除\n    deltMenus() {\n      if (this.isTrue) {\n        this.$confirm('确认删除此菜单吗?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning',\n          beforeClose(action, instance, done) {\n            if (action == 'confirm') {\n              instance.$refs.confirm.$el.onclick = a();\n              function a(e) {\n                e = e || window.event;\n                if (e.detail != 0) {\n                  done();\n                }\n              }\n            } else {\n              done();\n            }\n          },\n        })\n          .then(() => {\n            this.parentMenuId === null\n              ? this.list.splice(this.checkedMenuId, 1)\n              : this.list[this.parentMenuId].sub_button.splice(this.checkedMenuId, 1);\n            this.parentMenuId = null;\n            this.formValidate = {\n              name: '',\n              type: 'click',\n              appid: '',\n              url: '',\n              key: '',\n              pagepath: '',\n              id: 0,\n            };\n            this.isTrue = true;\n            this.modal2 = false;\n            this.checkedMenuId = null;\n            this.$refs['formValidate'].resetFields();\n          })\n          .catch(() => {});\n      } else {\n        this.$message.warning('请选择菜单!');\n      }\n    },\n    // 确认删除\n    del() {\n      this.parentMenuId === null\n        ? this.list.splice(this.checkedMenuId, 1)\n        : this.list[this.parentMenuId].sub_button.splice(this.checkedMenuId, 1);\n      this.parentMenuId = null;\n      this.formValidate = {\n        name: '',\n        type: 'click',\n        appid: '',\n        url: '',\n        key: '',\n        pagepath: '',\n        id: 0,\n      };\n      this.isTrue = true;\n      this.modal2 = false;\n      this.checkedMenuId = null;\n      this.$refs['formValidate'].resetFields();\n    },\n  },\n};\n</script>\n<style scoped lang=\"scss\">\n* {\n  -moz-user-select: none; /*火狐*/\n  -webkit-user-select: none; /*webkit浏览器*/\n  -ms-user-select: none; /*IE10*/\n  -khtml-user-select: none; /*早期浏览器*/\n  user-select: none;\n}\n\n.left {\n  min-width: 390px;\n  min-height: 550px;\n  position: relative;\n  padding-left: 40px;\n}\n\n.top {\n  position: absolute;\n  top: 0px;\n}\n\n.bottom {\n  position: absolute;\n  bottom: 0px;\n}\n\n.textbot {\n  position: absolute;\n  bottom: 0px;\n  left: 55px;\n  width: 100%;\n}\n.active {\n  border: 1px solid var(--prev-color-primary) !important;\n  color: var(--prev-color-primary) !important;\n}\n.li {\n  float: left;\n  width: 92px;\n  height: 48px;\n  line-height: 48px;\n  border-left: 1px solid #e7e7eb;\n  background: #fafafa;\n  text-align: center;\n  cursor: pointer;\n  color: #999;\n  position: relative;\n}\n.text {\n  height: 50px;\n  white-space: nowrap;\n  width: 100%;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding: 0 5px;\n}\n.text:hover {\n  color: #000;\n}\n\n.add {\n  position: absolute;\n  bottom: 65px;\n  width: 100%;\n  line-height: 40px;\n  // border: 1px solid #e7e7eb;\n  background: #fafafa;\n}\n.arrow {\n  position: absolute;\n  bottom: -16px;\n  left: 36px;\n  /* 圆角的位置需要细心调试哦 */\n  width: 0;\n  height: 0;\n  font-size: 0;\n  border: solid 8px;\n  border-color: #fafafa #f4f5f9 #f4f5f9 #f4f5f9;\n}\n.tianjia {\n  position: absolute;\n  bottom: 107px;\n  width: 100%;\n  line-height: 48px;\n  background: #fafafa;\n  :first-child {\n    border: none;\n  }\n}\n.addadd {\n  width: 100%;\n  line-height: 40px;\n  border-top: 1px solid #f0f0f0;\n  background: #fafafa;\n  height: 40px;\n}\n.right {\n  background: #fff;\n  min-height: 400px;\n}\n.spwidth {\n  width: 100%;\n}\n.userAlert {\n  margin-top: 16px !important;\n}\n</style>\n"]}]}