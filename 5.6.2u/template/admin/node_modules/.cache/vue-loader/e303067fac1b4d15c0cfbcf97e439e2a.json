{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\marketing\\newuser\\gift.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\marketing\\newuser\\gift.vue","mtime":1745474910907},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1753254258567},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBjb3Vwb25MaXN0IGZyb20gJ0AvY29tcG9uZW50cy9jb3Vwb25MaXN0JzsKaW1wb3J0IHsgZWRpdE5ld2JpZSwgZ2V0TmV3YmllIH0gZnJvbSAnQC9hcGkvbWFya2V0aW5nJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdOZXdVc2VyR2lmdCcsCiAgY29tcG9uZW50czogeyBjb3Vwb25MaXN0IH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHNwaW5TaG93OiBmYWxzZSwKICAgICAgZm9ybURhdGE6IHsKICAgICAgICByZXdhcmRfbW9uZXk6IDAsCiAgICAgICAgcmV3YXJkX2ludGVncmFsOiAwLAogICAgICAgIHJld2FyZF9jb3Vwb246IFtdLAogICAgICAgIHVwZGF0ZUlkczogW10sCiAgICAgIH0sCiAgICB9OwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0SW5mbygpOwogIH0sCiAgbWV0aG9kczogewogICAgLy/lr7nosaHmlbDnu4Tljrvph43vvJsKICAgIHVuaXF1ZUFycmF5KGFycikgewogICAgICBjb25zdCBzZWVuID0ge307CiAgICAgIHJldHVybiBhcnIuZmlsdGVyKChpdGVtKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coaXRlbSkKICAgICAgICBpdGVtLnRpdGxlID0KICAgICAgICAgIGl0ZW0udXNlX21pbl9wcmljZSAhPT0gJzAuMDAnCiAgICAgICAgICAgID8gYCR7aXRlbS50aXRsZX0gfCDmu6Eke2l0ZW0udXNlX21pbl9wcmljZX3lhYMg5YePICR7aXRlbS5jb3Vwb25fcHJpY2V95YWDYAogICAgICAgICAgICA6IGAke2l0ZW0udGl0bGV9IHwgJHtpdGVtLmNvdXBvbl9wcmljZX3lhYMg5peg6Zeo5qeb5Yi4YDsKICAgICAgICBkZWxldGUgaXRlbS51c2VfbWluX3ByaWNlOwogICAgICAgIGRlbGV0ZSBpdGVtLmNvdXBvbl9wcmljZTsKICAgICAgICBjb25zdCBrZXkgPSBKU09OLnN0cmluZ2lmeShpdGVtKTsgLy8g5L2/55SoIEpTT04uc3RyaW5naWZ5IOeUn+aIkOWUr+S4gOmUrgogICAgICAgIGlmIChzZWVuW2tleV0pIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VlbltrZXldID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8g6I635Y+W5LyY5oOg5Yi4aWTmlbDmja4KICAgIG5hbWVJZChpZCwgbmFtZXMpIHsKICAgICAgdGhpcy5mb3JtRGF0YS5yZXdhcmRfY291cG9uID0gdGhpcy51bmlxdWVBcnJheShuYW1lcyk7CiAgICB9LAogICAgLy8g5re75Yqg5LyY5oOg5Yi4CiAgICBhZGRDb3Vwb24oKSB7CiAgICAgIHRoaXMuJHJlZnMuY291cG9uVGVtcGxhdGVzLmlzVGVtcGxhdGUgPSB0cnVlOwogICAgICB0aGlzLiRyZWZzLmNvdXBvblRlbXBsYXRlcy50YWJsZUxpc3QoKTsKICAgIH0sCiAgICBoYW5kbGVDbG9zZShpbmRleCkgewogICAgICB0aGlzLmZvcm1EYXRhLnJld2FyZF9jb3Vwb24uc3BsaWNlKGluZGV4LCAxKTsKICAgIH0sCiAgICBnZXRJbmZvKCkgewogICAgICB0aGlzLnNwaW5TaG93ID0gdHJ1ZTsKICAgICAgZ2V0TmV3YmllKCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5TaG93ID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmZvcm1EYXRhID0gcmVzLmRhdGE7CiAgICAgICAgICB0aGlzLnVwZGF0ZUlkcyA9IHJlcy5kYXRhLnJld2FyZF9jb3Vwb24ubWFwKChpdGVtKSA9PiBpdGVtLmlkKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5TaG93ID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfojrflj5blpLHotKUnKTsKICAgICAgICB9KTsKICAgIH0sCiAgICAvLyDmj5DkuqTooajljZUKICAgIHN1Ym1pdEZvcm0oKSB7CiAgICAgIHRoaXMuc3BpblNob3cgPSB0cnVlOwogICAgICBlZGl0TmV3YmllKHRoaXMuZm9ybURhdGEpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5zcGluU2hvdyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfmj5DkuqTmiJDlip8nKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5TaG93ID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfmj5DkuqTlpLHotKUnKTsKICAgICAgICB9KTsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["gift.vue"],"names":[],"mappings":";AA+CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"gift.vue","sourceRoot":"src/pages/marketing/newuser","sourcesContent":["<template>\n  <div v-loading=\"spinShow\">\n    <div class=\"article-manager\">\n      <el-card :bordered=\"false\" shadow=\"never\" class=\"ivu-mt fromBox\">\n        <el-form ref=\"formRef\" :model=\"formData\" label-width=\"100px\">\n          <el-form-item label=\"赠送余额(元)：\">\n            <el-input-number\n              class=\"form-width\"\n              v-model=\"formData.reward_money\"\n              placeholder=\"请输入赠送余额\"\n              :min=\"0\"\n            ></el-input-number>\n            <div class=\"tips-info\">新用户奖励金额，必须大于等于0，0为不赠送</div>\n          </el-form-item>\n          <el-form-item label=\"赠送积分：\">\n            <el-input-number\n              class=\"form-width\"\n              v-model=\"formData.reward_integral\"\n              placeholder=\"请输入赠送积分数量\"\n              :min=\"0\"\n            ></el-input-number>\n            <div class=\"tips-info\">新用户奖励积分，必须大于等于0，0为不赠送</div>\n          </el-form-item>\n          <el-form-item label=\"赠送优惠券：\">\n            <div v-if=\"formData.reward_coupon.length\" class=\"mb10\">\n              <el-tag\n                class=\"mr10\"\n                closable\n                v-for=\"(item, index) in formData.reward_coupon\"\n                :key=\"index\"\n                @close=\"handleClose(index)\"\n                >{{ item.title }}</el-tag\n              >\n            </div>\n            <el-button v-db-click @click=\"addCoupon\">选择优惠券</el-button>\n          </el-form-item>\n          <el-form-item label=\"\">\n            <el-button type=\"primary\" v-db-click @click=\"submitForm\">确认</el-button>\n          </el-form-item>\n        </el-form>\n      </el-card>\n    </div>\n    <coupon-list ref=\"couponTemplates\" :updateIds=\"updateIds\" @nameId=\"nameId\"></coupon-list>\n  </div>\n</template>\n\n<script>\nimport couponList from '@/components/couponList';\nimport { editNewbie, getNewbie } from '@/api/marketing';\nexport default {\n  name: 'NewUserGift',\n  components: { couponList },\n  data() {\n    return {\n      spinShow: false,\n      formData: {\n        reward_money: 0,\n        reward_integral: 0,\n        reward_coupon: [],\n        updateIds: [],\n      },\n    };\n  },\n  created() {\n    this.getInfo();\n  },\n  methods: {\n    //对象数组去重；\n    uniqueArray(arr) {\n      const seen = {};\n      return arr.filter((item) => {\n        console.log(item)\n        item.title =\n          item.use_min_price !== '0.00'\n            ? `${item.title} | 满${item.use_min_price}元 减 ${item.coupon_price}元`\n            : `${item.title} | ${item.coupon_price}元 无门槛券`;\n        delete item.use_min_price;\n        delete item.coupon_price;\n        const key = JSON.stringify(item); // 使用 JSON.stringify 生成唯一键\n        if (seen[key]) {\n          return false;\n        } else {\n          seen[key] = true;\n          return true;\n        }\n      });\n    },\n    // 获取优惠券id数据\n    nameId(id, names) {\n      this.formData.reward_coupon = this.uniqueArray(names);\n    },\n    // 添加优惠券\n    addCoupon() {\n      this.$refs.couponTemplates.isTemplate = true;\n      this.$refs.couponTemplates.tableList();\n    },\n    handleClose(index) {\n      this.formData.reward_coupon.splice(index, 1);\n    },\n    getInfo() {\n      this.spinShow = true;\n      getNewbie()\n        .then((res) => {\n          this.spinShow = false;\n          this.formData = res.data;\n          this.updateIds = res.data.reward_coupon.map((item) => item.id);\n        })\n        .catch((err) => {\n          this.spinShow = false;\n          this.$message.error('获取失败');\n        });\n    },\n    // 提交表单\n    submitForm() {\n      this.spinShow = true;\n      editNewbie(this.formData)\n        .then((res) => {\n          this.spinShow = false;\n          this.$message.success('提交成功');\n        })\n        .catch((err) => {\n          this.spinShow = false;\n          this.$message.error('提交失败');\n        });\n    },\n  },\n};\n</script>\n<style lang=\"scss\" scoped></style>\n"]}]}