{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\product\\productAdd\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\product\\productAdd\\index.vue","mtime":1751246651273},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1753254258567},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB1c2VyTGFiZWwgZnJvbSAnQC9jb21wb25lbnRzL2xhYmVsTGlzdCc7CmltcG9ydCB1c2VMYWJlbCBmcm9tICdAL2NvbXBvbmVudHMvZ29vZHNMYWJlbC91c2VMYWJlbCc7CmltcG9ydCBnb29kc0xhYmVsIGZyb20gJ0AvY29tcG9uZW50cy9nb29kc0xhYmVsJzsKaW1wb3J0IHsgbWFwU3RhdGUgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHVwbG9hZFBpY3R1cmVzIGZyb20gJ0AvY29tcG9uZW50cy91cGxvYWRQaWN0dXJlcyc7CmltcG9ydCBmcmVpZ2h0VGVtcGxhdGUgZnJvbSAnQC9jb21wb25lbnRzL2ZyZWlnaHRUZW1wbGF0ZSc7CmltcG9ydCBjb3Vwb25MaXN0IGZyb20gJ0AvY29tcG9uZW50cy9jb3Vwb25MaXN0JzsKaW1wb3J0IGFkZEF0dHIgZnJvbSAnLi4vcHJvZHVjdEF0dHIvYWRkQXR0cic7CmltcG9ydCBnb29kc0xpc3QgZnJvbSAnQC9jb21wb25lbnRzL2dvb2RzTGlzdC9pbmRleCc7CmltcG9ydCB0YW9CYW8gZnJvbSAnLi90YW9CYW8nOwppbXBvcnQgeyB1c2VyTGFiZWxBZGRBcGkgfSBmcm9tICdAL2FwaS91c2VyJzsKaW1wb3J0IHsKICBwcm9kdWN0SW5mb0FwaSwKICBjYXNjYWRlckxpc3RBcGksCiAgcHJvZHVjdEFkZEFwaSwKICBnZW5lcmF0ZUF0dHJBcGksCiAgcHJvZHVjdEdldFJ1bGVBcGksCiAgcHJvZHVjdEdldFRlbXBsYXRlQXBpLAogIHByb2R1Y3RHZXRUZW1wS2V5c0FwaSwKICBjaGVja0FjdGl2aXR5QXBpLAogIHByb2R1Y3RDYWNoZSwKICBjYWNoZURlbGV0ZSwKICB1cGxvYWRUeXBlLAogIGltcG9ydENhcmQsCiAgcHJvZHVjdENyZWF0ZUFwaSwKICBnZXRQcm9kdWN0VHlwZUNvbmZpZywKICBydWxlQWRkQXBpLAogIHBhcmFtTGlzdEFwaSwKICBwYXJhbUluZm9BcGksCiAgcHJvZHVjdFByb3RlY3Rpb25MaXN0QXBpLAogIHByb2R1Y3RMYWJlbFVzZUxpc3RBcGksCn0gZnJvbSAnQC9hcGkvcHJvZHVjdCc7CmltcG9ydCBTZXR0aW5nIGZyb20gJ0Avc2V0dGluZyc7CmltcG9ydCB7IGdldENvb2tpZXMgfSBmcm9tICdAL2xpYnMvdXRpbCc7CmltcG9ydCB7IHVwbG9hZEJ5UGllY2VzIH0gZnJvbSAnQC91dGlscy91cGxvYWQnOyAvL+W8leWFpXVwbG9hZEJ5UGllY2Vz5pa55rOVCmltcG9ydCB7IGlzRmlsZVVwbG9hZCwgaXNWaWRlb1VwbG9hZCwgYXJyYXlzRXF1YWwgfSBmcm9tICdAL3V0aWxzJzsKaW1wb3J0IGNoZWNrQXJyYXkgZnJvbSAnQC9saWJzL3Blcm1pc3Npb24nOwppbXBvcnQgewogIEdvb2RzVGFibGVIZWFkLAogIFZpcnR1YWxUYWJsZUhlYWQsCiAgVmlydHVhbFRhYmxlSGVhZDIsCiAgY29sdW1uczIsCiAgY29sdW1uczMsCiAgQ3VzdG9tTGlzdCwKICBSdWxlVmFsaWRhdGUsCn0gZnJvbSAnLi9kZWZhdWx0RGF0YS5qcyc7CmltcG9ydCBCYXNpY0luZm8gZnJvbSAnLi9jb21wb25lbnRzL0Jhc2ljSW5mby52dWUnOwppbXBvcnQgU3BlY1N0b2NrIGZyb20gJy4vY29tcG9uZW50cy9TcGVjU3RvY2sudnVlJzsKaW1wb3J0IFByb2R1Y3REZXRhaWwgZnJvbSAnLi9jb21wb25lbnRzL1Byb2R1Y3REZXRhaWwudnVlJzsKaW1wb3J0IExvZ2lzdGljc1NldHRpbmcgZnJvbSAnLi9jb21wb25lbnRzL0xvZ2lzdGljc1NldHRpbmcudnVlJzsKaW1wb3J0IFByaWNlQ29tbWlzc2lvbiBmcm9tICcuL2NvbXBvbmVudHMvUHJpY2VDb21taXNzaW9uLnZ1ZSc7CmltcG9ydCBNYXJrZXRpbmdTZXR0aW5nIGZyb20gJy4vY29tcG9uZW50cy9NYXJrZXRpbmdTZXR0aW5nLnZ1ZSc7CmltcG9ydCBPdGhlclNldHRpbmcgZnJvbSAnLi9jb21wb25lbnRzL090aGVyU2V0dGluZy52dWUnOwppbXBvcnQgeyBmb3JtYXRSaWNoVGV4dCB9IGZyb20gJ0AvdXRpbHMvZWRpdG9ySW1nJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnUHJvZHVjdEFkZCcsCiAgY29tcG9uZW50czogewogICAgdXBsb2FkUGljdHVyZXMsCiAgICBmcmVpZ2h0VGVtcGxhdGUsCiAgICBhZGRBdHRyLAogICAgY291cG9uTGlzdCwKICAgIHRhb0JhbywKICAgIGdvb2RzTGlzdCwKICAgIHVzZXJMYWJlbCwKICAgIGdvb2RzTGFiZWwsCiAgICB1c2VMYWJlbCwKICAgIEJhc2ljSW5mbywKICAgIFNwZWNTdG9jaywKICAgIFByb2R1Y3REZXRhaWwsCiAgICBMb2dpc3RpY3NTZXR0aW5nLAogICAgUHJpY2VDb21taXNzaW9uLAogICAgTWFya2V0aW5nU2V0dGluZywKICAgIE90aGVyU2V0dGluZywKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBsYWJlbFNob3c6IGZhbHNlLAogICAgICB0YWdTaG93OiBmYWxzZSwKICAgICAgZGF0YUxhYmVsOiBbXSwKICAgICAgaGVhZFRhYjogWwogICAgICAgIHsgdGl0OiAn5Z+656GA5L+h5oGvJywgbmFtZTogJzEnIH0sCiAgICAgICAgeyB0aXQ6ICfop4TmoLzlupPlrZgnLCBuYW1lOiAnMicgfSwKICAgICAgICB7IHRpdDogJ+WVhuWTgeivpuaDhScsIG5hbWU6ICczJyB9LAogICAgICAgIHsgdGl0OiAn54mp5rWB6K6+572uJywgbmFtZTogJzQnIH0sCiAgICAgICAgeyB0aXQ6ICfkvJrlkZjku7cv5L2j6YeRJywgbmFtZTogJzUnIH0sCiAgICAgICAgeyB0aXQ6ICfokKXplIDorr7nva4nLCBuYW1lOiAnNicgfSwKICAgICAgICB7IHRpdDogJ+WFtuS7luiuvue9ricsIG5hbWU6ICc3JyB9LAogICAgICBdLAogICAgICB2aXJ0dWFsOiBbCiAgICAgICAgeyB0aXQ6ICfmma7pgJrllYblk4EnLCBpZDogMCwgdGl0MjogJ+eJqea1geWPkei0pycgfSwKICAgICAgICB7IHRpdDogJ+WNoeWvhi/nvZHnm5gnLCBpZDogMSwgdGl0MjogJ+iHquWKqOWPkei0pycgfSwKICAgICAgICB7IHRpdDogJ+S8mOaDoOWIuCcsIGlkOiAyLCB0aXQyOiAn6Ieq5Yqo5Y+R6LSnJyB9LAogICAgICAgIHsgdGl0OiAn6Jma5ouf5ZWG5ZOBJywgaWQ6IDMsIHRpdDI6ICfomZrmi5/lj5HotKcnIH0sCiAgICAgIF0sCiAgICAgIHNlbGV0VmlkZW86IDAsIC8v6YCJ5oup6KeG6aKR57G75Z6LCiAgICAgIGN1c3RvbUJ0bjogMCwgLy/oh6rlrprkuYnnlZnoqIDlvIDlhbMKICAgICAgY29udGVudDogJycsCiAgICAgIGNvbnRlbnRzOiAnJywKICAgICAgZmlsZVVybDogU2V0dGluZy5hcGlCYXNlVVJMICsgJy9maWxlL3VwbG9hZCcsCiAgICAgIGZpbGVVcmwyOiBTZXR0aW5nLmFwaUJhc2VVUkwgKyAnL2ZpbGUvdmlkZW9fdXBsb2FkJywKICAgICAgY2FyZFVybDogU2V0dGluZy5hcGlCYXNlVVJMICsgJy9maWxlL3VwbG9hZC8xJywKICAgICAgdXBsb2FkX3R5cGU6ICcnLCAvL+inhumikeS4iuS8oOexu+WeiyAxIOacrOWcsOS4iuS8oCAyIDMgNCBPU1PkuIrkvKAKICAgICAgdXBsb2FkRGF0YToge30sIC8vIOS4iuS8oOWPguaVsAogICAgICBoZWFkZXI6IHt9LAogICAgICB0eXBlOiAwLAogICAgICBtb2RhbHM6IGZhbHNlLAogICAgICBnb29kc19tb2RhbHM6IGZhbHNlLAogICAgICBzcGluU2hvdzogZmFsc2UsCiAgICAgIG9wZW5TdWJpbWl0OiBmYWxzZSwKICAgICAgdmlydHVhbExpc3Q6IFsKICAgICAgICB7CiAgICAgICAgICBrZXk6ICcnLAogICAgICAgICAgdmFsdWU6ICcnLAogICAgICAgIH0sCiAgICAgIF0sCiAgICAgIC8vIOaJuemHj+iuvue9ruihqOagvGRhdGEKICAgICAgb25lRm9ybUJhdGNoOiBbCiAgICAgICAgewogICAgICAgICAgcGljOiAnJywKICAgICAgICAgIHByaWNlOiB2b2lkIDAsCiAgICAgICAgICBjb3N0OiB2b2lkIDAsCiAgICAgICAgICBvdF9wcmljZTogdm9pZCAwLAogICAgICAgICAgc3RvY2s6IHZvaWQgMCwKICAgICAgICAgIGJhcl9jb2RlOiAnJywKICAgICAgICAgIGJhcl9jb2RlX251bWJlcjogJycsCiAgICAgICAgICB3ZWlnaHQ6IHZvaWQgMCwKICAgICAgICAgIHZvbHVtZTogdm9pZCAwLAogICAgICAgICAgdmlydHVhbF9saXN0OiBbXSwKICAgICAgICB9LAogICAgICBdLAoKICAgICAgLy8g6KeE5qC85pWw5o2uCiAgICAgIGZvcm1EeW5hbWljOiB7CiAgICAgICAgYXR0cnNOYW1lOiAnJywKICAgICAgICBhdHRyc1ZhbDogJycsCiAgICAgIH0sCiAgICAgIGRpc2tfdHlwZTogMSwgLy/ljaHlr4bnsbvlnosKICAgICAgdGFiSW5kZXg6IDAsCiAgICAgIHRhYk5hbWU6ICcnLAogICAgICBmb3JtRHluYW1pY05hbWVEYXRhOiBbXSwKICAgICAgaXNCdG46IGZhbHNlLAogICAgICBjb2x1bW5zMjogY29sdW1uczIsCiAgICAgIGNvbHVtbnMzOiBjb2x1bW5zMywKICAgICAgY29sdW1uczogW10sCiAgICAgIGNvbHVtbnNJbnN0YWxsOiBbXSwKICAgICAgY29sdW1uc0luc3RhbDI6IFtdLAogICAgICBncmlkUGljOiB7CiAgICAgICAgeGw6IDYsCiAgICAgICAgbGc6IDgsCiAgICAgICAgbWQ6IDEyLAogICAgICAgIHNtOiAxMiwKICAgICAgICB4czogMTIsCiAgICAgIH0sCiAgICAgIGdyaWRCdG46IHsKICAgICAgICB4bDogNCwKICAgICAgICBsZzogOCwKICAgICAgICBtZDogOCwKICAgICAgICBzbTogOCwKICAgICAgICB4czogOCwKICAgICAgfSwKICAgICAgLy/oh6rlrprkuYnnlZnoqIDkuIvmi4npgInmi6kKICAgICAgQ3VzdG9tTGlzdDogQ3VzdG9tTGlzdCwKICAgICAgLy/oh6rlrprkuYnnlZnoqIDlhoXlrrkKICAgICAgY3VycmVudEluZGV4OiAwLAoKICAgICAgZm9ybVZhbGlkYXRlOiB7CiAgICAgICAgZGlza19pbmZvOiAnJywgLy/ljaHlr4bnsbvlnosKICAgICAgICBsb2dpc3RpY3M6IFsnMSddLCAvL+mAieaLqeeJqea1geaWueW8jwogICAgICAgIGZyZWlnaHQ6IDIsIC8v6L+Q6LS56K6+572uCiAgICAgICAgcG9zdGFnZTogMCwgLy/orr7nva7ov5DotLnph5Hpop0KICAgICAgICByZWNvbW1lbmQ6IFtdLCAvL+WVhuWTgeaOqOiNkAogICAgICAgIHByZXNhbGVfZGF5OiAxLCAvL+mihOWUruWPkei0p+aXtumXtC3nu5PmnZ8KICAgICAgICBwcmVzYWxlOiBmYWxzZSwgLy/pooTllK7llYblk4HlvIDlhbMKICAgICAgICBpc19saW1pdDogZmFsc2UsCiAgICAgICAgbGltaXRfdHlwZTogMCwKICAgICAgICBsaW1pdF9udW06IDAsCiAgICAgICAgdmlwX3Byb2R1Y3Q6IGZhbHNlLCAvL+S7mOi0ueS8muWRmOS4k+WxnuW8gOWFswogICAgICAgIGN1c3RvbV9mb3JtOiBbXSwgLy/oh6rlrprkuYnnlZnoqIAKICAgICAgICBzdG9yZV9uYW1lOiAnJywKICAgICAgICBjYXRlX2lkOiBbXSwKICAgICAgICBsYWJlbF9pZDogW10sCiAgICAgICAga2V5d29yZDogJycsCiAgICAgICAgdW5pdF9uYW1lOiAnJywKICAgICAgICBzdG9yZV9pbmZvOiAnJywKICAgICAgICBpbWFnZTogJycsCiAgICAgICAgcmVjb21tZW5kX2ltYWdlOiAnJywKICAgICAgICBzbGlkZXJfaW1hZ2U6IFtdLAogICAgICAgIGRlc2NyaXB0aW9uOiAnJywKICAgICAgICBmaWN0aTogMCwKICAgICAgICBnaXZlX2ludGVncmFsOiAwLAogICAgICAgIHNvcnQ6IDAsCiAgICAgICAgaXNfc2hvdzogMSwKICAgICAgICBpc19naWZ0OiAwLCAvLyDlvIDlkK/pgIHnpLzlk4EKICAgICAgICBnaWZ0X3ByaWNlOiAwLAogICAgICAgIGlzX2hvdDogMCwKICAgICAgICBpc19iZW5lZml0OiAwLAogICAgICAgIGlzX2Jlc3Q6IDAsCiAgICAgICAgaXNfbmV3OiAwLAogICAgICAgIGlzX2dvb2Q6IDAsCiAgICAgICAgaXNfcG9zdGFnZTogMCwKICAgICAgICBpc19zdWI6IFtdLAogICAgICAgIHJlY29tbWVuZF9saXN0OiBbXSwKICAgICAgICBwYXJhbXNfbGlzdDogW10sIC8v5ZWG5ZOB5Y+C5pWwCiAgICAgICAgdmlydHVhbF90eXBlOiAwLAogICAgICAgIC8vIGlzX3N1YjogMCwKICAgICAgICBpZDogMCwKICAgICAgICBzcGVjX3R5cGU6IDAsCiAgICAgICAgaXNfdmlydHVhbDogMCwKICAgICAgICB2aWRlb19saW5rOiAnJywKICAgICAgICAvLyBwb3N0YWdlOiAwLAogICAgICAgIHRlbXBfaWQ6ICcnLAogICAgICAgIGF0dHJzOiBbXSwKICAgICAgICBpdGVtczogWwogICAgICAgICAgewogICAgICAgICAgICBwaWM6ICcnLAogICAgICAgICAgICBwcmljZTogMCwKICAgICAgICAgICAgY29zdDogMCwKICAgICAgICAgICAgb3RfcHJpY2U6IDAsCiAgICAgICAgICAgIHN0b2NrOiAwLAogICAgICAgICAgICBiYXJfY29kZTogJycsCiAgICAgICAgICAgIGJhcl9jb2RlX251bWJlcjogJycsCiAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgYWN0aXZpdHk6IFsn6buY6K6kJywgJ+enkuadgCcsICfnoI3ku7cnLCAn5ou85ZuiJ10sCiAgICAgICAgY291cG9uTmFtZTogW10sCiAgICAgICAgaGVhZGVyOiBbXSwKICAgICAgICBzZWxlY3RSdWxlOiAnJywKICAgICAgICBjb3Vwb25faWRzOiBbXSwKICAgICAgICBjb21tYW5kX3dvcmQ6ICcnLAogICAgICAgIG1pbl9xdHk6IDEsCiAgICAgICAgbGFiZWxfbGlzdDogW10sCiAgICAgICAgcHJvdGVjdGlvbl9saXN0OiBbXSwKICAgICAgfSwKICAgICAgcnVsZUxpc3Q6IFtdLAogICAgICB0ZW1wbGF0ZUxpc3Q6IFtdLAogICAgICBjcmVhdGVCbnQ6IHRydWUsCiAgICAgIHNob3dJcHV0OiBmYWxzZSwKICAgICAgbWFueUZvcm1WYWxpZGF0ZTogW10sCiAgICAgIC8vIOWNleinhOagvOihqOagvGRhdGEKICAgICAgb25lRm9ybVZhbGlkYXRlOiBbCiAgICAgICAgewogICAgICAgICAgcGljOiAnJywKICAgICAgICAgIHByaWNlOiAwLAogICAgICAgICAgY29zdDogMCwKICAgICAgICAgIG90X3ByaWNlOiAwLAogICAgICAgICAgc3RvY2s6IDAsCiAgICAgICAgICBiYXJfY29kZTogJycsCiAgICAgICAgICBiYXJfY29kZV9udW1iZXI6ICcnLAogICAgICAgICAgd2VpZ2h0OiAwLAogICAgICAgICAgdm9sdW1lOiAwLAogICAgICAgICAgYnJva2VyYWdlOiAwLAogICAgICAgICAgYnJva2VyYWdlX3R3bzogMCwKICAgICAgICAgIHZpcF9wcmljZTogMCwKICAgICAgICAgIHZpcnR1YWxfbGlzdDogW10sCiAgICAgICAgICBjb3Vwb25faWQ6IDAsCiAgICAgICAgfSwKICAgICAgXSwKICAgICAgaW1hZ2VzOiBbXSwKICAgICAgaW1hZ2VzVGFibGU6ICcnLAogICAgICBjdXJyZW50VGFiOiAnMScsCiAgICAgIGlzQ2hvaWNlOiAnJywKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIG1vZGFsUGljOiBmYWxzZSwKICAgICAgYWRkVmlydHVhbE1vZGVsOiBmYWxzZSwKICAgICAgdGVtcGxhdGU6IGZhbHNlLAogICAgICB1cGxvYWRMaXN0OiBbXSwKICAgICAgdHJlZVNlbGVjdDogW10sCiAgICAgIHBpY1RpdDogJycsCiAgICAgIHRhYmxlSW5kZXg6IDAsCiAgICAgIHJ1bGVWYWxpZGF0ZTogUnVsZVZhbGlkYXRlLAogICAgICBtYW55QnJva2VyYWdlOiB1bmRlZmluZWQsCiAgICAgIG1hbnlCcm9rZXJhZ2VUd286IHVuZGVmaW5lZCwKICAgICAgbWFueVZpcFByaWNlOiB1bmRlZmluZWQsCiAgICAgIG1hbnlWaXBEaXNjb3VudDogdW5kZWZpbmVkLAogICAgICB1cGxvYWQ6IHsKICAgICAgICB2aWRlb0luZzogZmFsc2UsIC8vIOaYr+WQpuaYvuekuui/m+W6puadoe+8mwogICAgICB9LAogICAgICB2aWRlb0luZzogZmFsc2UsIC8vIOaYr+WQpuaYvuekuui/m+W6puadoe+8mwogICAgICBwcm9ncmVzczogMCwgLy8g6L+b5bqm5p2h6buY6K6kMAogICAgICBzdG9jazogMCwKICAgICAgZGlza19pbmZvOiAnJywKICAgICAgdmlkZW9MaW5rOiAnJywKICAgICAgYXR0cnM6IFtdLAogICAgICBhY3Rpdml0eTogeyDpu5jorqQ6ICdyZWQnLCDnp5LmnYA6ICdibHVlJywg56CN5Lu3OiAnZ3JlZW4nLCDmi7zlm6I6ICd5ZWxsb3cnIH0sCiAgICAgIGNvdXBvbk5hbWU6IFtdLAogICAgICB1cGRhdGVJZHM6IFtdLAogICAgICB1cGRhdGVOYW1lOiBbXSwKICAgICAgY291cG9uSWRzOiAnJywKICAgICAgY291cG9uTmFtZXM6IFtdLAogICAgICByYWtlQmFjazogWwogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAn5LiA57qn6L+U5L2jKOWFgyknLAogICAgICAgICAgc2xvdDogJ2Jyb2tlcmFnZScsCiAgICAgICAgICBhbGlnbjogJ2NlbnRlcicsCiAgICAgICAgICB3aWR0aDogOTUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0aXRsZTogJ+S6jOe6p+i/lOS9oyjlhYMpJywKICAgICAgICAgIHNsb3Q6ICdicm9rZXJhZ2VfdHdvJywKICAgICAgICAgIGFsaWduOiAnY2VudGVyJywKICAgICAgICAgIHdpZHRoOiA5NSwKICAgICAgICB9LAogICAgICBdLAogICAgICBtZW1iZXI6IFsKICAgICAgICB7CiAgICAgICAgICB0aXRsZTogJ+S8muWRmOS7tycsCiAgICAgICAgICBzbG90OiAndmlwX3ByaWNlJywKICAgICAgICAgIGFsaWduOiAnY2VudGVyJywKICAgICAgICAgIHdpZHRoOiA5NSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAn5Lya5ZGY5oqY5omjJywKICAgICAgICAgIHNsb3Q6ICd2aXBfcHJvcG9ydGlvbicsCiAgICAgICAgICBhbGlnbjogJ2NlbnRlcicsCiAgICAgICAgICB3aWR0aDogOTUsCiAgICAgICAgfSwKICAgICAgXSwKICAgICAgY29sdW1uc0luc3RhbE06IFtdLAogICAgICBtb3ZlSW5kZXg6ICcnLAogICAgICBhZGRWYWx1ZTogJycsCiAgICAgIHZpc2libGU6IGZhbHNlLAogICAgICB0eXBlQ29uZmlnOiBbXSwKICAgICAgZ29vZHNUeXBlOiBbXSwKICAgICAgcGFyYW1zVHlwZUxpc3Q6IFtdLAogICAgICBwYXJhbXNUeXBlOiBudWxsLAogICAgICBjYW5TZWw6IHRydWUsIC8vIOinhOagvOWbvueJh+a3u+WKoOWIpOaWrQogICAgICBjaGFuZ2VBdHRyVmFsdWU6ICcnLCAvL+S/ruaUueeahOinhOagvOWAvAogICAgICB0YWJsZUtleTogMCwKICAgICAgcHJvdGVjdGlvbkxpc3Q6IFtdLCAvLyDmnI3liqHkv53pmpwKICAgICAgbGFiZWxMaXN0OiBbXSwKICAgICAgdGlsZUxhYmVsTGlzdDogW10sCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKCdtZWRpYScsIFsnaXNNb2JpbGUnXSksCiAgICBsYWJlbFdpZHRoKCkgewogICAgICByZXR1cm4gdGhpcy5pc01vYmlsZSA/IHVuZGVmaW5lZCA6ICcxMjBweCc7CiAgICB9LAogICAgbGFiZWxQb3NpdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNNb2JpbGUgPyAndG9wJyA6ICdyaWdodCc7CiAgICB9LAogICAgbGFiZWxCb3R0b20oKSB7CiAgICAgIHJldHVybiB0aGlzLmlzTW9iaWxlID8gdW5kZWZpbmVkIDogJzE1cHgnOwogICAgfSwKICB9LAogIHdhdGNoOiB7CiAgICB0eXBlQ29uZmlnKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIC8vIOWvuXZpcnR1YWzkuK3nmoRpZOetieS6jnZhbOS4reeahGlk55qECiAgICAgICAgdGhpcy5nb29kc1R5cGUgPSB0aGlzLnZpcnR1YWwuZmlsdGVyKChpdGVtKSA9PiB7CiAgICAgICAgICByZXR1cm4gdmFsLmluY2x1ZGVzKGl0ZW0uaWQgKyAnJyk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5nb29kc1R5cGUgPSB0aGlzLnZpcnR1YWw7CiAgICAgIH0KICAgIH0sCiAgfSwKICBiZWZvcmVSb3V0ZVVwZGF0ZSh0bywgZnJvbSwgbmV4dCkgewogICAgdGhpcy5idXMuJGVtaXQoJ29uVGFnc1ZpZXdSZWZyZXNoUm91dGVyVmlldycsIHRoaXMuJHJvdXRlLnBhdGgpOwogICAgbmV4dCgpOwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuY29sdW1ucyA9IHRoaXMuY29sdW1uczIuc2xpY2UoMCwgOCk7CiAgICB0aGlzLmdldFRva2VuKCk7CiAgfSwKICBhc3luYyBtb3VudGVkKCkgewogICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCAhPT0gJzAnICYmIHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICBhd2FpdCB0aGlzLmdldEluZm8oKTsKICAgIH0gZWxzZSBpZiAodGhpcy4kcm91dGUucGFyYW1zLmlkID09PSAnMCcpIHsKICAgICAgdGhpcy5nZXRQcm9kdWN0Q2FjaGUoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZ2V0cHJvZHVjdExhYmVsVXNlTGlzdEFwaSgpOwogICAgfQogICAgaWYgKHRoaXMuJHJvdXRlLnF1ZXJ5LnR5cGUpIHsKICAgICAgdGhpcy5tb2RhbHMgPSB0cnVlOwogICAgICB0aGlzLnR5cGUgPSB0aGlzLiRyb3V0ZS5xdWVyeS50eXBlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy50eXBlID0gMDsKICAgIH0KICAgIHRoaXMuZ29vZHNDYXRlZ29yeSgpOwogICAgdGhpcy5wcm9kdWN0R2V0UnVsZSgpOwogICAgdGhpcy5wcm9kdWN0R2V0VGVtcGxhdGUoKTsKICAgIHRoaXMucGFyYW1zR2V0VGVtcGxhdGUoKTsKICAgIHRoaXMudXBsb2FkVHlwZSgpOwogICAgdGhpcy5wcm9kdWN0Q29uZmlnKCk7CiAgICB0aGlzLndhdGNoQWN0aXZpdHkoKTsKICAgIHRoaXMuZ2V0UHJvdGVjdGlvbkxpc3QoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGdldFByb2R1Y3RDYWNoZSgpIHsKICAgICAgcHJvZHVjdENhY2hlKCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICBsZXQgZGF0YSA9IHJlcy5kYXRhLmluZm87CiAgICAgICAgICB0aGlzLmdldHByb2R1Y3RMYWJlbFVzZUxpc3RBcGkoKTsKCiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGF0YSkpIHsKICAgICAgICAgICAgbGV0IGNhdGVfaWQgPSBkYXRhLmNhdGVfaWQubWFwKE51bWJlcik7CiAgICAgICAgICAgIGxldCBsYWJlbF9pZCA9IGRhdGEubGFiZWxfaWQubWFwKE51bWJlcik7CiAgICAgICAgICAgIHRoaXMuYXR0cnMgPSBkYXRhLml0ZW1zIHx8IFtdOwogICAgICAgICAgICBsZXQgaWRzID0gW107CiAgICAgICAgICAgIGlmIChkYXRhLmNvdXBvbnMpIHsKICAgICAgICAgICAgICBkYXRhLmNvdXBvbnMubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICBpZHMucHVzaChpdGVtLmlkKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLmNvdXBvbk5hbWUgPSBkYXRhLmNvdXBvbnM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlID0gZGF0YTsKICAgICAgICAgICAgdGhpcy5kYXRhTGFiZWwgPSBkYXRhLmxhYmVsX2lkOwogICAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5jb3Vwb25faWRzID0gaWRzOwogICAgICAgICAgICB0aGlzLnVwZGF0ZUlkcyA9IGlkczsKICAgICAgICAgICAgdGhpcy51cGRhdGVOYW1lID0gZGF0YS5jb3Vwb25zOwogICAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5jYXRlX2lkID0gY2F0ZV9pZDsKICAgICAgICAgICAgdGhpcy5vbmVGb3JtVmFsaWRhdGUgPSBkYXRhLmF0dHJzOwogICAgICAgICAgICB0aGlzLmdlbmVyYXRlSGVhZGVyKHRoaXMuYXR0cnMpOwogICAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5sb2dpc3RpY3MgPSBkYXRhLmxvZ2lzdGljcyB8fCBbJzEnXTsKICAgICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuaGVhZGVyID0gW107CiAgICAgICAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZSA9IGRhdGEuYXR0cnM7CiAgICAgICAgICAgIHRoaXMuc3BlY190eXBlID0gZGF0YS5zcGVjX3R5cGU7CiAgICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmlzX3ZpcnR1YWwgPSBkYXRhLmlzX3ZpcnR1YWw7CiAgICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtID0gZGF0YS5jdXN0b21fZm9ybSB8fCBbXTsKICAgICAgICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5jdXN0b21CdG4gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYXR0cnMubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgaWYgKGl0ZW0uYWRkX3BpYykgdGhpcy5jYW5TZWwgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMudmlydHVhbGJ0bihkYXRhLnZpcnR1YWxfdHlwZSwgMSk7CiAgICAgICAgICAgIGlmIChkYXRhLnNwZWNfdHlwZSA9PT0gMCkgewogICAgICAgICAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZSA9IFtdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuY3JlYXRlQm50ID0gdHJ1ZTsKICAgICAgICAgICAgICB0aGlzLm9uZUZvcm1WYWxpZGF0ZSA9IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcGljOiBkYXRhLmltYWdlLAogICAgICAgICAgICAgICAgICBwcmljZTogMCwKICAgICAgICAgICAgICAgICAgY29zdDogMCwKICAgICAgICAgICAgICAgICAgb3RfcHJpY2U6IDAsCiAgICAgICAgICAgICAgICAgIHN0b2NrOiAwLAogICAgICAgICAgICAgICAgICBiYXJfY29kZTogJycsCiAgICAgICAgICAgICAgICAgIGJhcl9jb2RlX251bWJlcjogJycsCiAgICAgICAgICAgICAgICAgIHdlaWdodDogMCwKICAgICAgICAgICAgICAgICAgdm9sdW1lOiAwLAogICAgICAgICAgICAgICAgICBicm9rZXJhZ2U6IDAsCiAgICAgICAgICAgICAgICAgIGJyb2tlcmFnZV90d286IDAsCiAgICAgICAgICAgICAgICAgIHZpcF9wcmljZTogMCwKICAgICAgICAgICAgICAgICAgdmlydHVhbF9saXN0OiBbXSwKICAgICAgICAgICAgICAgICAgY291cG9uX2lkOiAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMud2F0Y2hBY3Rpdml0eSgpOwogICAgICAgICAgICB0aGlzLnNwaW5TaG93ID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycikgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihlcnIubXNnKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBnZXRQcm90ZWN0aW9uTGlzdCgpIHsKICAgICAgcHJvZHVjdFByb3RlY3Rpb25MaXN0QXBpKHsgcGFnZTogMCwgbGltaXQ6IDAsIHN0YXR1czogMSB9KS50aGVuKChyZXMpID0+IHsKICAgICAgICB0aGlzLnByb3RlY3Rpb25MaXN0ID0gcmVzLmRhdGEubGlzdDsKICAgICAgfSk7CiAgICB9LAogICAgZ2V0cHJvZHVjdExhYmVsVXNlTGlzdEFwaSgpIHsKICAgICAgcHJvZHVjdExhYmVsVXNlTGlzdEFwaSgpLnRoZW4oKHJlcykgPT4gewogICAgICAgIC8vIOWQiOW5tuaVsOe7hOS4reaJgOacieeahGxpc3QKICAgICAgICB0aGlzLnRpbGVMYWJlbExpc3QgPSByZXMuZGF0YS5mbGF0TWFwKChpdGVtKSA9PiBpdGVtLmxpc3QpOwogICAgICAgIGxldCBsYWJlbExpc3QgPSByZXMuZGF0YTsKICAgICAgICBpZiAodGhpcy5mb3JtVmFsaWRhdGUubGFiZWxfbGlzdC5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmxhYmVsX2xpc3QubWFwKChlbCkgPT4gewogICAgICAgICAgICBsYWJlbExpc3QubWFwKChyZSkgPT4gewogICAgICAgICAgICAgIHJlLmxpc3QubWFwKChsYWJlbCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGxhYmVsLmlkID09PSBlbCkgewogICAgICAgICAgICAgICAgICBsYWJlbC5hY3RpdmUgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgbGFiZWwuYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxhYmVsTGlzdC5tYXAoKGVsKSA9PiB7CiAgICAgICAgICAgIGVsLmxpc3QubWFwKChsYWJlbCkgPT4gewogICAgICAgICAgICAgIGxhYmVsLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB0aGlzLmxhYmVsTGlzdCA9IGxhYmVsTGlzdDsKICAgICAgfSk7CiAgICB9LAogICAgYWRkUHJvdGVjdGlvbigpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBwYXRoOiB0aGlzLiRyb3V0ZVByb1N0ciArICcvcHJvZHVjdC9wcm90ZWN0aW9uL2xpc3QnIH0pOwogICAgfSwKICAgIHByb2R1Y3RDb25maWcoKSB7CiAgICAgIGdldFByb2R1Y3RUeXBlQ29uZmlnKCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy50eXBlQ29uZmlnID0gcmVzLmRhdGE7CiAgICAgIH0pOwogICAgfSwKICAgIGJlZm9yZVVwbG9hZChmaWxlKSB7CiAgICAgIHJldHVybiBpc0ZpbGVVcGxvYWQoZmlsZSk7CiAgICB9LAogICAgLy8g5YiG54mH5LiK5LygCiAgICB2aWRlb1NhdmVUb1VybChmaWxlKSB7CiAgICAgIGlmIChpc1ZpZGVvVXBsb2FkKGZpbGUpKSB7CiAgICAgICAgdXBsb2FkQnlQaWVjZXMoewogICAgICAgICAgZmlsZTogZmlsZSwgLy8g6KeG6aKR5a6e5L2TCiAgICAgICAgICBwaWVjZVNpemU6IDMsIC8vIOWIhueJh+Wkp+WwjwogICAgICAgICAgc3VjY2VzczogKGRhdGEpID0+IHsKICAgICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUudmlkZW9fbGluayA9IGRhdGEuZmlsZV9wYXRoOwogICAgICAgICAgICB0aGlzLnByb2dyZXNzID0gMTAwOwogICAgICAgICAgfSwKICAgICAgICAgIGVycm9yOiAoZSkgPT4gewogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGUubXNnKTsKICAgICAgICAgIH0sCiAgICAgICAgICB1cGxvYWRpbmc6IChjaHVuaywgYWxsQ2h1bmspID0+IHsKICAgICAgICAgICAgdGhpcy52aWRlb0luZyA9IHRydWU7CiAgICAgICAgICAgIGxldCBzdCA9IE1hdGguZmxvb3IoKGNodW5rIC8gYWxsQ2h1bmspICogMTAwKTsKICAgICAgICAgICAgdGhpcy5wcm9ncmVzcyA9IHN0OwogICAgICAgICAgfSwKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgLy8g57G75Z6L6YCJ5oupL+Whq+WFpeWGheWuueWIpOaWrQogICAgdmlydHVhbGJ0bihpbmRleCwgdHlwZSkgewogICAgICBpZiAodHlwZSAhPSAxKSB7CiAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+e8lui+keWVhuWTgeS4jeaUr+aMgeWIh+aNouWVhuWTgeexu+WeiycpOwogICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmlzX3N1YiA9IFtdOwogICAgICAgIGxldCBpZCA9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgICAgICBpZiAoaWQpIHsKICAgICAgICAgIGNoZWNrQWN0aXZpdHlBcGkoaWQpCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHt9KQogICAgICAgICAgICAuY2F0Y2goKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnNwZWNfdHlwZSA9IHRoaXMuc3BlY190eXBlOwogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1zZyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5mb3JtVmFsaWRhdGUuc3BlY190eXBlID09IDEpIHsKICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZSgxKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgLy8g5a6a5LmJ5Z+656GA5ZWG5ZOB5ZKM6Jma5ouf5ZWG5ZOB55qE5qCH562+6aG16YWN572uCiAgICAgIGNvbnN0IGJhc2VIZWFkVGFicyA9IFsKICAgICAgICB7IHRpdDogJ+WfuuehgOS/oeaBrycsIG5hbWU6ICcxJyB9LAogICAgICAgIHsgdGl0OiAn6KeE5qC85bqT5a2YJywgbmFtZTogJzInIH0sCiAgICAgICAgeyB0aXQ6ICfllYblk4Hor6bmg4UnLCBuYW1lOiAnMycgfSwKICAgICAgICB7IHRpdDogJ+eJqea1geiuvue9ricsIG5hbWU6ICc0JyB9LAogICAgICAgIHsgdGl0OiAn5Lya5ZGY5Lu3L+S9o+mHkScsIG5hbWU6ICc1JyB9LAogICAgICAgIHsgdGl0OiAn6JCl6ZSA6K6+572uJywgbmFtZTogJzYnIH0sCiAgICAgICAgeyB0aXQ6ICflhbbku5borr7nva4nLCBuYW1lOiAnNycgfSwKICAgICAgXTsKICAgICAgY29uc3QgdmlydHVhbEhlYWRUYWJzID0gWwogICAgICAgIHsgdGl0OiAn5Z+656GA5L+h5oGvJywgbmFtZTogJzEnIH0sCiAgICAgICAgeyB0aXQ6ICfop4TmoLzlupPlrZgnLCBuYW1lOiAnMicgfSwKICAgICAgICB7IHRpdDogJ+WVhuWTgeivpuaDhScsIG5hbWU6ICczJyB9LAogICAgICAgIHsgdGl0OiAn5Lya5ZGY5Lu3L+S9o+mHkScsIG5hbWU6ICc0JyB9LAogICAgICAgIHsgdGl0OiAn6JCl6ZSA6K6+572uJywgbmFtZTogJzUnIH0sCiAgICAgICAgeyB0aXQ6ICflhbbku5borr7nva4nLCBuYW1lOiAnNicgfSwKICAgICAgXTsKCiAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICBjYXNlIDA6IC8vIOaZrumAmuWVhuWTgQogICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUudmlydHVhbF90eXBlID0gMDsKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmlzX3ZpcnR1YWwgPSAwOwogICAgICAgICAgdGhpcy5oZWFkVGFiID0gYmFzZUhlYWRUYWJzOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMTogLy8g5Y2h5a+GL+e9keebmOWVhuWTgQogICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUudmlydHVhbF90eXBlID0gMTsKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnBvc3RhZ2UgPSAwOwogICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuaXNfdmlydHVhbCA9IDE7CiAgICAgICAgICB0aGlzLmhlYWRUYWIgPSB2aXJ0dWFsSGVhZFRhYnM7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAyOiAvLyDkvJjmg6DliLjllYblk4EKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSA9IDI7CiAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5pc192aXJ0dWFsID0gMTsKICAgICAgICAgIHRoaXMuaGVhZFRhYiA9IHZpcnR1YWxIZWFkVGFiczsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDM6IC8vIOiZmuaLn+WVhuWTgQogICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUudmlydHVhbF90eXBlID0gMzsKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmlzX3ZpcnR1YWwgPSAxOwogICAgICAgICAgdGhpcy5oZWFkVGFiID0gdmlydHVhbEhlYWRUYWJzOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCiAgICAvLyDmlrDlop7liIbnsbsKICAgIGFkZENhdGUoKSB7CiAgICAgIHRoaXMuJG1vZGFsRm9ybShwcm9kdWN0Q3JlYXRlQXBpKCkpLnRoZW4oKCkgPT4gdGhpcy5nb29kc0NhdGVnb3J5KCkpOwogICAgfSwKICAgIC8vIOeJqea1geaWueW8j+mAieaLqQogICAgbG9naXN0aWNzQnRuKGUpIHsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUubG9naXN0aWNzID0gZTsKICAgIH0sCiAgICAvLyDmlrDlop7moIfnrb4KICAgIGFkZExhYmVsKCkgewogICAgICB0aGlzLiRtb2RhbEZvcm0odXNlckxhYmVsQWRkQXBpKDApKS50aGVuKCgpID0+IHRoaXMudXNlckxhYmVsKCkpOwogICAgfSwKICAgIC8vIOmAieaLqeagh+etvgogICAgYWRkR29vZHNUYWcoKSB7CiAgICAgIHRoaXMudGFnU2hvdyA9IHRydWU7CiAgICB9LAogICAgLy8g6Ieq5a6a5LmJ55WZ6KiAIOW8gOWQr+WFs+mXrQogICAgY3VzdG9tTWVzc0J0bihlKSB7CiAgICAgIGlmICghZSkgewogICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtID0gW107CiAgICAgIH0KICAgICAgdGhpcy5jdXN0b21CdG4gPSBlOwogICAgfSwKICAgIC8vIOiHquWumuS5ieeVmeiogCDmlrDlop7ooajljZUKICAgIGFkZGN1c3RvbSgpIHsKICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtLmxlbmd0aCA+IDkpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+acgOWkmua3u+WKoDEw5p2hJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuY3VzdG9tX2Zvcm0ucHVzaCh7CiAgICAgICAgICB0aXRsZTogJycsCiAgICAgICAgICBsYWJlbDogJ3RleHQnLAogICAgICAgICAgdmFsdWU6ICcnLAogICAgICAgICAgc3RhdHVzOiBmYWxzZSwKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIC8vIOWIoOmZpAogICAgZGVsY3VzdG9tKGluZGV4KSB7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtLnNwbGljZShpbmRleCwgMSk7CiAgICB9LAogICAgLy8g6aKE5ZSu5YW35L2T5pel5pyfCiAgICBvbmNoYW5nZVRpbWUoZSkgewogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5wcmVzYWxlX3RpbWUgPSBlOwogICAgfSwKICAgIC8vIOWVhuWTgeivpuaDhQogICAgZ2V0RWRpdG9yQ29udGVudChkYXRhKSB7CiAgICAgIHRoaXMuY29udGVudCA9IGRhdGE7CiAgICB9LAogICAgY2FuY2VsKCkgewogICAgICB0aGlzLm1vZGFscyA9IGZhbHNlOwogICAgfSwKICAgIC8vIOS4iuS8oOWktOmDqHRva2VuCiAgICBnZXRUb2tlbigpIHsKICAgICAgdGhpcy5oZWFkZXJbJ0F1dGhvcmktemF0aW9uJ10gPSAnQmVhcmVyICcgKyBnZXRDb29raWVzKCd0b2tlbicpOwogICAgfSwKICAgIC8vIOWvvOWFpeWNoeWvhgogICAgdXBGaWxlKHJlcykgewogICAgICBpbXBvcnRDYXJkKHsgZmlsZTogcmVzLmRhdGEuc3JjIH0pLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoaXMudmlydHVhbExpc3QgPSB0aGlzLnZpcnR1YWxMaXN0LmNvbmNhdChyZXMuZGF0YSk7CiAgICAgIH0pOwogICAgfSwKICAgIC8v6I635Y+W6KeG6aKR5LiK5Lyg57G75Z6LCiAgICB1cGxvYWRUeXBlKCkgewogICAgICB1cGxvYWRUeXBlKCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy51cGxvYWRfdHlwZSA9IHJlcy5kYXRhLnVwbG9hZF90eXBlOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDliJ3lp4vljJbmlbDmja7lsZXnpLoKICAgIGluZm9EYXRhKGRhdGEsIGlzQ29weSkgewogICAgICBsZXQgY2F0ZV9pZCA9IGRhdGEuY2F0ZV9pZC5tYXAoTnVtYmVyKTsKICAgICAgbGV0IGxhYmVsX2lkID0gZGF0YS5sYWJlbF9pZC5tYXAoTnVtYmVyKTsKICAgICAgdGhpcy5hdHRycyA9IGRhdGEuaXRlbXMgfHwgW107CiAgICAgIGxldCBpZHMgPSBbXTsKICAgICAgZGF0YS5jb3Vwb25zLm1hcCgoaXRlbSkgPT4gewogICAgICAgIGlkcy5wdXNoKGl0ZW0uaWQpOwogICAgICB9KTsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUgPSBkYXRhOwogICAgICB0aGlzLnNlbGV0VmlkZW8gPSBkYXRhLnNlbGV0VmlkZW87CiAgICAgIHRoaXMuY29udGVudHMgPSBkYXRhLmRlc2NyaXB0aW9uOwogICAgICB0aGlzLmNvdXBvbk5hbWUgPSBkYXRhLmNvdXBvbnM7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmNvdXBvbl9pZHMgPSBpZHM7CiAgICAgIHRoaXMudXBkYXRlSWRzID0gaWRzOwogICAgICB0aGlzLmRhdGFMYWJlbCA9IGRhdGEubGFiZWxfaWQ7CiAgICAgIHRoaXMudXBkYXRlTmFtZSA9IGRhdGEuY291cG9uczsKICAgICAgdGhpcy52aXJ0dWFsYnRuKGRhdGEudmlydHVhbF90eXBlLCAxKTsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUubG9naXN0aWNzID0gZGF0YS5sb2dpc3RpY3MgfHwgWycxJ107CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtID0gZGF0YS5jdXN0b21fZm9ybSB8fCBbXTsKICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLmN1c3RvbV9mb3JtLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgdGhpcy5jdXN0b21CdG4gPSAxOwogICAgICB9CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmNhdGVfaWQgPSBjYXRlX2lkOwogICAgICBpZiAoZGF0YS5hdHRyKSB7CiAgICAgICAgdGhpcy5vbmVGb3JtVmFsaWRhdGUgPSBbZGF0YS5hdHRyXTsKICAgICAgICB0aGlzLm9uZUZvcm1WYWxpZGF0ZVswXS52aXBfcHJvcG9ydGlvbiA9ICgKICAgICAgICAgICh0aGlzLm9uZUZvcm1WYWxpZGF0ZVswXS52aXBfcHJpY2UgLyB0aGlzLm9uZUZvcm1WYWxpZGF0ZVswXS5wcmljZSkgKgogICAgICAgICAgMTAwCiAgICAgICAgKS50b0ZpeGVkKDIpOwogICAgICB9CiAgICAgIHRoaXMuZ2V0cHJvZHVjdExhYmVsVXNlTGlzdEFwaSgpOwoKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuaGVhZGVyID0gW107CiAgICAgIHRoaXMuc3BlY190eXBlID0gZGF0YS5zcGVjX3R5cGU7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnNwZWNfdHlwZSA9IHRoaXMuc3BlY190eXBlOwogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5pc192aXJ0dWFsID0gZGF0YS5pc192aXJ0dWFsOwogICAgICB0aGlzLmF0dHJzLm1hcCgoaXRlbSkgPT4gewogICAgICAgIGlmIChpdGVtLmFkZF9waWMpIHRoaXMuY2FuU2VsID0gZmFsc2U7CiAgICAgIH0pOwogICAgICBpZiAoZGF0YS5zcGVjX3R5cGUgPT09IDApIHsKICAgICAgICB0aGlzLm1hbnlGb3JtVmFsaWRhdGUgPSBbXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNyZWF0ZUJudCA9IHRydWU7CiAgICAgICAgdGhpcy5vbmVGb3JtVmFsaWRhdGUgPSBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHBpYzogJycsCiAgICAgICAgICAgIHByaWNlOiAwLAogICAgICAgICAgICBjb3N0OiAwLAogICAgICAgICAgICBvdF9wcmljZTogMCwKICAgICAgICAgICAgc3RvY2s6IDAsCiAgICAgICAgICAgIGJhcl9jb2RlOiAnJywKICAgICAgICAgICAgYmFyX2NvZGVfbnVtYmVyOiAnJywKICAgICAgICAgICAgd2VpZ2h0OiAwLAogICAgICAgICAgICB2b2x1bWU6IDAsCiAgICAgICAgICAgIGJyb2tlcmFnZTogMCwKICAgICAgICAgICAgYnJva2VyYWdlX3R3bzogMCwKICAgICAgICAgICAgdmlwX3ByaWNlOiAwLAogICAgICAgICAgICB2aXJ0dWFsX2xpc3Q6IFtdLAogICAgICAgICAgICBjb3Vwb25faWQ6IDAsCiAgICAgICAgICB9LAogICAgICAgIF07CgogICAgICAgIHRoaXMuZ2VuZXJhdGVIZWFkZXIodGhpcy5hdHRycyk7CiAgICAgICAgdGhpcy5tYW55Rm9ybVZhbGlkYXRlID0gWy4uLnRoaXMub25lRm9ybUJhdGNoLCAuLi5kYXRhLmF0dHJzXTsKICAgICAgfQoKICAgICAgc2V0VGltZW91dCgoZSkgPT4gewogICAgICAgIHRoaXMuY2hlY2tBbGxHcm91cChkYXRhLmlzX3N1Yik7CiAgICAgIH0sIDEwMDApOwogICAgICB0aGlzLndhdGNoQWN0aXZpdHkoKTsKICAgIH0sCiAgICAvL+WFs+mXrea3mOWuneW8ueeql+W5tueUn+aIkOaVsOaNru+8mwogICAgb25DbG9zZShkYXRhKSB7CiAgICAgIHRoaXMubW9kYWxzID0gZmFsc2U7CiAgICAgIHRoaXMuaW5mb0RhdGEoZGF0YSwgMSk7CiAgICB9LAoKICAgIGNoZWNrTW92ZShldnQpIHsKICAgICAgdGhpcy5tb3ZlSW5kZXggPSBldnQuZHJhZ2dlZENvbnRleHQuaW5kZXg7CiAgICB9LAogICAgZW5kKCkgewogICAgICB0aGlzLm1vdmVJbmRleCA9ICcnOwogICAgICB0aGlzLmdlbmVyYXRlKDEpOwogICAgfSwKICAgIC8vIOWNleeLrOiuvue9ruS8muWRmOiuvue9rgogICAgY2hlY2tBbGxHcm91cENoYW5nZShkYXRhKSB7CiAgICAgIHRoaXMuY2hlY2tBbGxHcm91cChkYXRhKTsKICAgIH0sCiAgICBjaGVja0FsbEdyb3VwKGRhdGEpIHsKICAgICAgbGV0IGVuZExlbmd0aCA9IHRoaXMuYXR0cnMubGVuZ3RoICsgMzsKICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLnNwZWNfdHlwZSA9PT0gMCkgewogICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgdGhpcy5jb2x1bW5zSW5zdGFsbCA9IHRoaXMuY29sdW1uczIuc2xpY2UoMCwgZW5kTGVuZ3RoKS5jb25jYXQodGhpcy5yYWtlQmFjaykuY29uY2F0KHRoaXMubWVtYmVyKTsKICAgICAgICB9IGVsc2UgaWYgKGRhdGEuaW5kZXhPZigwKSA+IC0xKSB7CiAgICAgICAgICB0aGlzLmNvbHVtbnNJbnN0YWxsID0gdGhpcy5jb2x1bW5zMi5zbGljZSgwLCBlbmRMZW5ndGgpLmNvbmNhdCh0aGlzLm1lbWJlcik7CiAgICAgICAgfSBlbHNlIGlmIChkYXRhLmluZGV4T2YoMSkgPiAtMSkgewogICAgICAgICAgdGhpcy5jb2x1bW5zSW5zdGFsbCA9IHRoaXMuY29sdW1uczIuc2xpY2UoMCwgZW5kTGVuZ3RoKS5jb25jYXQodGhpcy5yYWtlQmFjayk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuY29sdW1uc0luc3RhbGwgPSB0aGlzLmNvbHVtbnMyLnNsaWNlKDAsIGVuZExlbmd0aCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgdGhpcy5jb2x1bW5zSW5zdGFsMiA9IHRoaXMuY29sdW1uc0luc3RhbE0KICAgICAgICAgICAgLnNsaWNlKDAsIGVuZExlbmd0aCArIDEpCiAgICAgICAgICAgIC5jb25jYXQodGhpcy5yYWtlQmFjaykKICAgICAgICAgICAgLmNvbmNhdCh0aGlzLm1lbWJlcik7CiAgICAgICAgfSBlbHNlIGlmIChkYXRhLmluZGV4T2YoMCkgPiAtMSkgewogICAgICAgICAgdGhpcy5jb2x1bW5zSW5zdGFsMiA9IHRoaXMuY29sdW1uc0luc3RhbE0uc2xpY2UoMCwgZW5kTGVuZ3RoKS5jb25jYXQodGhpcy5tZW1iZXIpOwogICAgICAgIH0gZWxzZSBpZiAoZGF0YS5pbmRleE9mKDEpID4gLTEpIHsKICAgICAgICAgIHRoaXMuY29sdW1uc0luc3RhbDIgPSB0aGlzLmNvbHVtbnNJbnN0YWxNLnNsaWNlKDAsIGVuZExlbmd0aCkuY29uY2F0KHRoaXMucmFrZUJhY2spOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmNvbHVtbnNJbnN0YWwyID0gdGhpcy5jb2x1bW5zSW5zdGFsTS5zbGljZSgwLCBlbmRMZW5ndGgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIOa3u+WKoOS8mOaDoOWIuAogICAgYWRkQ291cG9uKCkgewogICAgICB0aGlzLiRyZWZzLmNvdXBvblRlbXBsYXRlcy5pc1RlbXBsYXRlID0gdHJ1ZTsKICAgICAgdGhpcy4kcmVmcy5jb3Vwb25UZW1wbGF0ZXMudGFibGVMaXN0KCk7CiAgICB9LAogICAgLy8g6KeE5qC85Lit5LyY5oOg5Yi45p+l55yLCiAgICBzZWUoZGF0YSwgbmFtZSwgaW5kZXgpIHsKICAgICAgdGhpcy50YWJOYW1lID0gbmFtZTsKICAgICAgdGhpcy50YWJJbmRleCA9IGluZGV4OwoKICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSA9PT0gMSkgewogICAgICAgIGlmIChkYXRhLmRpc2tfaW5mbyAhPSAnJykgewogICAgICAgICAgdGhpcy5kaXNrX3R5cGUgPSAxOwogICAgICAgICAgdGhpcy5kaXNrX2luZm8gPSBkYXRhLmRpc2tfaW5mbzsKICAgICAgICAgIHRoaXMuc3RvY2sgPSBkYXRhLnN0b2NrOwogICAgICAgIH0gZWxzZSBpZiAoZGF0YS52aXJ0dWFsX2xpc3QubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmRpc2tfdHlwZSA9IDI7CiAgICAgICAgICB0aGlzLnZpcnR1YWxMaXN0ID0gZGF0YS52aXJ0dWFsX2xpc3Q7CiAgICAgICAgfQogICAgICAgIHRoaXMuYWRkVmlydHVhbE1vZGVsID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRyZWZzLmdvb2RzQ291cG9uLmlzVGVtcGxhdGUgPSB0cnVlOwogICAgICAgIHRoaXMuJHJlZnMuZ29vZHNDb3Vwb24udGFibGVMaXN0KDMpOwogICAgICB9CiAgICB9LAogICAgLy8g5L+u5pS55YiG5L2j5q+U5L6LCiAgICBjaGFuZ2VEaXNjb3VudChpbmRleCwgdHlwZSA9ICdtYW55Rm9ybVZhbGlkYXRlJykgewogICAgICAvLyDmoLnmja7liIbkvaPmr5TkvosgdmlwX3Byb3BvcnRpb24g5L+u5pS55Lya5ZGY5Lu3IOS/neeVmTLkvY3lsI/mlbAKICAgICAgdGhpc1t0eXBlXVtpbmRleF0udmlwX3ByaWNlID0gKHRoaXNbdHlwZV1baW5kZXhdLnByaWNlICogKHRoaXNbdHlwZV1baW5kZXhdLnZpcF9wcm9wb3J0aW9uIC8gMTAwKSkudG9GaXhlZCgyKTsKICAgIH0sCiAgICAvLyDkv67mlLnkvJrlkZjku7cKICAgIGNoYW5nZVZpcFByaWNlKGluZGV4LCB0eXBlID0gJ21hbnlGb3JtVmFsaWRhdGUnKSB7CiAgICAgIC8vIOagueaNruS8muWRmOS7t+iuoeeul+WHuuWIhuS9o+avlOS+iwogICAgICB0aGlzW3R5cGVdW2luZGV4XS52aXBfcHJvcG9ydGlvbiA9ICgodGhpc1t0eXBlXVtpbmRleF0udmlwX3ByaWNlIC8gdGhpc1t0eXBlXVtpbmRleF0ucHJpY2UpICogMTAwKS50b0ZpeGVkKDIpOwogICAgfSwKICAgIC8vIOa3u+WKoOS8mOaDoOWIuAogICAgYWRkR29vZHNDb3Vwb24oaW5kZXgsIG5hbWUpIHsKICAgICAgdGhpcy50YWJJbmRleCA9IGluZGV4OwogICAgICB0aGlzLnRhYk5hbWUgPSBuYW1lOwogICAgICB0aGlzLiRyZWZzLmdvb2RzQ291cG9uLmlzVGVtcGxhdGUgPSB0cnVlOwogICAgICB0aGlzLiRyZWZzLmdvb2RzQ291cG9uLnRhYmxlTGlzdCgzKTsKICAgIH0sCiAgICBhZGRWaXJ0dWFsKGluZGV4LCBuYW1lKSB7CiAgICAgIHRoaXMudGFiSW5kZXggPSBpbmRleDsKICAgICAgdGhpcy50YWJOYW1lID0gbmFtZTsKICAgICAgdGhpcy5hZGRWaXJ0dWFsTW9kZWwgPSB0cnVlOwogICAgfSwKICAgIC8vIOaPkOS6pOWNoeWvhuS/oeaBrwogICAgdXBWaXJ0dWFsKCkgewogICAgICBpZiAodGhpcy5kaXNrX3R5cGUgPT0gMikgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy52aXJ0dWFsTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMudmlydHVhbExpc3RbaV07CiAgICAgICAgICBpZiAoIWVsZW1lbnQudmFsdWUpIHsKICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign6K+36L6T5YWl5omA5pyJ5Y2h5a+GJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy4kc2V0KHRoaXNbdGhpcy50YWJOYW1lXVt0aGlzLnRhYkluZGV4XSwgJ3ZpcnR1YWxfbGlzdCcsIHRoaXMudmlydHVhbExpc3QpOwogICAgICAgIHRoaXMuJHNldCh0aGlzW3RoaXMudGFiTmFtZV1bdGhpcy50YWJJbmRleF0sICdzdG9jaycsIHRoaXMudmlydHVhbExpc3QubGVuZ3RoKTsKICAgICAgICB0aGlzLnZpcnR1YWxMaXN0ID0gWwogICAgICAgICAgewogICAgICAgICAgICBrZXk6ICcnLAogICAgICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgICB9LAogICAgICAgIF07CiAgICAgICAgdGhpcy4kc2V0KHRoaXNbdGhpcy50YWJOYW1lXVt0aGlzLnRhYkluZGV4XSwgJ2Rpc2tfaW5mbycsICcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXRoaXMuZGlza19pbmZvLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+Whq+WGmeWNoeWvhuS/oeaBrycpOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuc3RvY2spIHsKICAgICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfor7floavlhpnlupPlrZjmlbDph48nKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4kc2V0KHRoaXNbdGhpcy50YWJOYW1lXVt0aGlzLnRhYkluZGV4XSwgJ3N0b2NrJywgTnVtYmVyKHRoaXMuc3RvY2spKTsKICAgICAgICB0aGlzLiRzZXQodGhpc1t0aGlzLnRhYk5hbWVdW3RoaXMudGFiSW5kZXhdLCAnc3RvY2snLCBOdW1iZXIodGhpcy5zdG9jaykpOwogICAgICAgIHRoaXMuJHNldCh0aGlzW3RoaXMudGFiTmFtZV1bdGhpcy50YWJJbmRleF0sICdkaXNrX2luZm8nLCB0aGlzLmRpc2tfaW5mbyk7CiAgICAgICAgdGhpcy4kc2V0KHRoaXNbdGhpcy50YWJOYW1lXVt0aGlzLnRhYkluZGV4XSwgJ3ZpcnR1YWxfbGlzdCcsIFtdKTsKICAgICAgfQogICAgICB0aGlzLmFkZFZpcnR1YWxNb2RlbCA9IGZhbHNlOwogICAgICB0aGlzLmNsb3NlVmlydHVhbCgpOwogICAgfSwKICAgIC8vICDliJ3lp4vljJbljaHlr4bmlbDmja7kv6Hmga8KICAgIGNsb3NlVmlydHVhbCgpIHsKICAgICAgdGhpcy5hZGRWaXJ0dWFsTW9kZWwgPSBmYWxzZTsKICAgICAgdGhpcy52aXJ0dWFsTGlzdCA9IFsKICAgICAgICB7CiAgICAgICAgICBrZXk6ICcnLAogICAgICAgICAgdmFsdWU6ICcnLAogICAgICAgIH0sCiAgICAgIF07CiAgICAgIHRoaXMuZGlza19pbmZvID0gJyc7CiAgICAgIHRoaXMuc3RvY2sgPSAwOwogICAgfSwKICAgIC8v5a+56LGh5pWw57uE5Y676YeN77ybCiAgICB1bmlxdWVBcnJheShhcnIpIHsKICAgICAgY29uc3Qgc2VlbiA9IHt9OwogICAgICByZXR1cm4gYXJyLmZpbHRlcigoaXRlbSkgPT4gewogICAgICAgIGNvbnN0IGtleSA9IEpTT04uc3RyaW5naWZ5KGl0ZW0pOyAvLyDkvb/nlKggSlNPTi5zdHJpbmdpZnkg55Sf5oiQ5ZSv5LiA6ZSuCiAgICAgICAgaWYgKHNlZW5ba2V5XSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWVuW2tleV0gPSB0cnVlOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAvLyDojrflj5bkvJjmg6DliLhpZOaVsOaNrgogICAgbmFtZUlkKGlkLCBuYW1lcykgewogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5jb3Vwb25faWRzID0gaWQ7CiAgICAgIHRoaXMuY291cG9uTmFtZSA9IHRoaXMudW5pcXVlQXJyYXkobmFtZXMpOwogICAgfSwKICAgIC8vIOiOt+WPluS8mOaDoOWIuOS/oeaBrwogICAgZ29vZHNDb3Vwb25JZChkYXRhKSB7CiAgICAgIHRoaXMuJHNldCh0aGlzW3RoaXMudGFiTmFtZV1bdGhpcy50YWJJbmRleF0sICdjb3Vwb25faWQnLCBkYXRhLmlkKTsKICAgICAgdGhpcy4kc2V0KHRoaXNbdGhpcy50YWJOYW1lXVt0aGlzLnRhYkluZGV4XSwgJ2NvdXBvbl9uYW1lJywgZGF0YS50aXRsZSk7CiAgICAgIHRoaXMuJHJlZnMuZ29vZHNDb3Vwb24uaXNUZW1wbGF0ZSA9IGZhbHNlOwogICAgfSwKICAgIGhhbmRsZUNsb3NlKG5hbWUpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5jb3Vwb25OYW1lLmluZGV4T2YobmFtZSk7CiAgICAgIHRoaXMuY291cG9uTmFtZS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICBsZXQgY291cG9uSWRzID0gdGhpcy5mb3JtVmFsaWRhdGUuY291cG9uX2lkczsKICAgICAgY291cG9uSWRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMudXBkYXRlSWRzID0gY291cG9uSWRzOwogICAgICB0aGlzLnVwZGF0ZU5hbWUgPSB0aGlzLmNvdXBvbk5hbWU7CiAgICB9LAogICAgLy8g5re75Yqg6L+Q6LS55qih5p2/CiAgICBhZGRUZW1wKCkgewogICAgICB0aGlzLiRyZWZzLnRlbXBsYXRlcy5pc1RlbXBsYXRlID0gdHJ1ZTsKICAgIH0sCiAgICBhZGRWaWRlbygpIHsKICAgICAgdGhpcy4kdmlkZW9Nb2RhbCgoZSkgPT4gewogICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnZpZGVvX2xpbmsgPSBlOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDliKDpmaTop4bpopHvvJsKICAgIGRlbFZpZGVvKCkgewogICAgICB0aGlzLiRzZXQodGhpcy5mb3JtVmFsaWRhdGUsICd2aWRlb19saW5rJywgJycpOwogICAgICB0aGlzLiRzZXQodGhpcywgJ3Byb2dyZXNzJywgMCk7CiAgICAgIHRoaXMudmlkZW9JbmcgPSBmYWxzZTsKICAgICAgdGhpcy51cGxvYWQudmlkZW9JbmcgPSBmYWxzZTsKICAgIH0sCiAgICB6aF91cGxvYWRGaWxlKCkgewogICAgICBpZiAodGhpcy5zZWxldFZpZGVvID09IDEpIHsKICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS52aWRlb19saW5rID0gdGhpcy52aWRlb0xpbms7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kcmVmcy5yZWZpZC5jbGljaygpOwogICAgICB9CiAgICB9LAogICAgLy8g5LiK5Lyg6KeG6aKRCiAgICB6aF91cGxvYWRGaWxlX2NoYW5nZShldmZpbGUpIHsKICAgICAgbGV0IHN1ZmZpeCA9IGV2ZmlsZS50YXJnZXQuZmlsZXNbMF0ubmFtZS5zdWJzdHIoZXZmaWxlLnRhcmdldC5maWxlc1swXS5uYW1lLmluZGV4T2YoJy4nKSk7CiAgICAgIGlmIChzdWZmaXguaW5kZXhPZignLm1wNCcpID09PSAtMSkgewogICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCflj6rog73kuIrkvKBNUDTmlofku7YnKTsKICAgICAgfQogICAgICBsZXQgdHlwZXMgPSB7CiAgICAgICAga2V5OiBldmZpbGUudGFyZ2V0LmZpbGVzWzBdLm5hbWUsCiAgICAgICAgY29udGVudFR5cGU6IGV2ZmlsZS50YXJnZXQuZmlsZXNbMF0udHlwZSwKICAgICAgfTsKICAgICAgcHJvZHVjdEdldFRlbXBLZXlzQXBpKHR5cGVzKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuJHZpZGVvQ2xvdWQKICAgICAgICAgICAgLnZpZGVvVXBsb2FkKHsKICAgICAgICAgICAgICB0eXBlOiByZXMuZGF0YS50eXBlLAogICAgICAgICAgICAgIGV2ZmlsZTogZXZmaWxlLAogICAgICAgICAgICAgIHJlczogcmVzLAogICAgICAgICAgICAgIHVwbG9hZGluZyhzdGF0dXMsIHByb2dyZXNzKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZC52aWRlb0luZyA9IHN0YXR1czsKICAgICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09IDIwMCkgewogICAgICAgICAgICAgICAgICB0aGlzLnByb2dyZXNzID0gMTAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS52aWRlb19saW5rID0gcmVzLnVybDsKICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+inhumikeS4iuS8oOaIkOWKnycpOwogICAgICAgICAgICAgIHRoaXMudXBsb2FkLnZpZGVvSW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICAgIH0pOwogICAgfSwKICAgIC8vIOS4iuS4gOmhte+8mwogICAgdXBUYWIoKSB7CiAgICAgIHRoaXMuY3VycmVudFRhYiA9IChOdW1iZXIodGhpcy5jdXJyZW50VGFiKSAtIDEpLnRvU3RyaW5nKCk7CiAgICB9LAogICAgLy8g5LiL5LiA6aG177ybCiAgICBkb3duVGFiKCkgewogICAgICB0aGlzLmN1cnJlbnRUYWIgPSAoTnVtYmVyKHRoaXMuY3VycmVudFRhYikgKyAxKS50b1N0cmluZygpOwogICAgfSwKICAgIC8vIOWxnuaAp+W8ueeql+Wbnuiwg+WHveaVsO+8mwogICAgdXNlclNlYXJjaHMoKSB7CiAgICAgIHRoaXMucHJvZHVjdEdldFJ1bGUoKTsKICAgIH0sCiAgICAvLyDmt7vliqDop4TliJnvvJsKICAgIGFkZFJ1bGUoKSB7CiAgICAgIHRoaXMuJHJlZnMuYWRkYXR0ci5tb2RhbCA9IHRydWU7CiAgICB9LAogICAgLy8g5om56YeP6K6+572u5YiG5L2j77ybCiAgICBicm9rZXJhZ2VTZXRVcCgpIHsKICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLmlzX3N1Yi5pbmRleE9mKDEpID4gLTEpIHsKICAgICAgICBpZiAodGhpcy5tYW55QnJva2VyYWdlIDw9IDAgfHwgdGhpcy5tYW55QnJva2VyYWdlVHdvIDw9IDApIHsKICAgICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfor7floavlhpnov5TkvaPph5Hpop3lkI7ov5vooYzmibnph4/mt7vliqAnKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5mb3JtVmFsaWRhdGUuaXNfc3ViLmluZGV4T2YoMCkgPiAtMSkgewogICAgICAgIGlmICh0aGlzLm1hbnlWaXBQcmljZSA8PSAwKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign6K+35aGr5YaZ5Lya5ZGY5Lu35ZCO6L+b6KGM5om56YeP5re75YqgJyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS5pc19zdWIubGVuZ3RoID09PSAyKSB7CiAgICAgICAgaWYgKHRoaXMubWFueUJyb2tlcmFnZSA8PSAwIHx8IHRoaXMubWFueUJyb2tlcmFnZVR3byA8PSAwKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign6K+35aGr5YaZ5a6M6YeR6aKd5ZCO6L+b6KGM5om56YeP5re75YqgJyk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLm1hbnlWaXBQcmljZSA+IDAgJiYgdGhpcy5tYW55VmlwRGlzY291bnQgPiAwKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign5Lya5ZGY5Lu35ZKM5Lya5ZGY5oqY5omj5Y+q6IO95LqM6YCJ5LiA5re75YqgJyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobGV0IHZhbCBvZiB0aGlzLm1hbnlGb3JtVmFsaWRhdGUpIHsKICAgICAgICB0aGlzLm1hbnlCcm9rZXJhZ2UgIT0gdW5kZWZpbmVkICYmIHRoaXMuJHNldCh2YWwsICdicm9rZXJhZ2UnLCB0aGlzLm1hbnlCcm9rZXJhZ2UpOwogICAgICAgIHRoaXMubWFueUJyb2tlcmFnZVR3byAhPSB1bmRlZmluZWQgJiYgdGhpcy4kc2V0KHZhbCwgJ2Jyb2tlcmFnZV90d28nLCB0aGlzLm1hbnlCcm9rZXJhZ2VUd28pOwogICAgICAgIGlmICh0aGlzLm1hbnlWaXBQcmljZSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuJHNldCh2YWwsICd2aXBfcHJpY2UnLCB0aGlzLm1hbnlWaXBQcmljZSk7CiAgICAgICAgICB0aGlzLiRzZXQodmFsLCAndmlwX3Byb3BvcnRpb24nLCAoKHZhbC52aXBfcHJpY2UgLyB2YWwucHJpY2UpICogMTAwKS50b0ZpeGVkKDIpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kc2V0KHZhbCwgJ3ZpcF9wcm9wb3J0aW9uJywgdGhpcy5tYW55VmlwRGlzY291bnQpOwogICAgICAgICAgdGhpcy4kc2V0KHZhbCwgJ3ZpcF9wcmljZScsICh2YWwucHJpY2UgKiAodGhpcy5tYW55VmlwRGlzY291bnQgLyAxMDApKS50b0ZpeGVkKDIpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDmibnph4/orr7nva7kvJrlkZjku7cKICAgIHZpcFByaWNlU2V0VXAoKSB7CiAgICAgIGlmICh0aGlzLm1hbnlWaXBQcmljZSA8PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+Whq+WGmeS8muWRmOS7t+WcqOi/m+ihjOaJuemHj+a3u+WKoCcpOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAobGV0IHZhbCBvZiB0aGlzLm1hbnlGb3JtVmFsaWRhdGUpIHsKICAgICAgICAgIHRoaXMuJHNldCh2YWwsICd2aXBfcHJpY2UnLCB0aGlzLm1hbnlWaXBQcmljZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8g5paw5aKe5Y2h5a+GCiAgICBoYW5kbGVBZGQoKSB7CiAgICAgIHRoaXMudmlydHVhbExpc3QucHVzaCh7CiAgICAgICAga2V5OiAnJywKICAgICAgICB2YWx1ZTogJycsCiAgICAgIH0pOwogICAgfSwKICAgIC8vIOWIneWni+WMluWNoeWvhuS/oeaBrwogICAgaW5pdFZpcnR1YWxEYXRhKHN0YXR1cykgewogICAgICB0aGlzLnZpcnR1YWxMaXN0ID0gWwogICAgICAgIHsKICAgICAgICAgIGtleTogJycsCiAgICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgfSwKICAgICAgXTsKICAgIH0sCiAgICByZW1vdmVWaXJ0dWFsKGluZGV4KSB7CiAgICAgIHRoaXMudmlydHVhbExpc3Quc3BsaWNlKGluZGV4LCAxKTsKICAgIH0sCiAgICAvLyDmuIXnqbrmibnph4/op4TmoLzkv6Hmga8KICAgIGJhdGNoRGVsKCkgewogICAgICB0aGlzLm9uZUZvcm1CYXRjaCA9IFsKICAgICAgICB7CiAgICAgICAgICBwaWM6ICcnLAogICAgICAgICAgcHJpY2U6IHZvaWQgMCwKICAgICAgICAgIGNvc3Q6IHZvaWQgMCwKICAgICAgICAgIG90X3ByaWNlOiB2b2lkIDAsCiAgICAgICAgICBzdG9jazogdm9pZCAwLAogICAgICAgICAgYmFyX2NvZGU6ICcnLAogICAgICAgICAgYmFyX2NvZGVfbnVtYmVyOiAnJywKICAgICAgICAgIHdlaWdodDogdm9pZCAwLAogICAgICAgICAgdm9sdW1lOiB2b2lkIDAsCiAgICAgICAgICB2aXJ0dWFsX2xpc3Q6IFtdLAogICAgICAgIH0sCiAgICAgIF07CiAgICB9LAogICAgY29uZmlybShuYW1lKSB7CiAgICAgIHRoaXMuY3JlYXRlQm50ID0gdHJ1ZTsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuc2VsZWN0UnVsZSA9IG5hbWU7CiAgICAgIHRoaXMuYXR0cnMgPSBbXTsKICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLnNlbGVjdFJ1bGUudHJpbSgpLmxlbmd0aCA8PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+mAieaLqeWxnuaApycpOwogICAgICB9CiAgICAgIHRoaXMucnVsZUxpc3QuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsKICAgICAgICBpZiAoaXRlbS5ydWxlX25hbWUgPT09IHRoaXMuZm9ybVZhbGlkYXRlLnNlbGVjdFJ1bGUpIHsKICAgICAgICAgIHRoaXMuYXR0cnMgPSBbLi4uaXRlbS5ydWxlX3ZhbHVlXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmNhblNlbCA9IHRydWU7CiAgICAgIHRoaXMuZ2VuZXJhdGVBdHRyKHRoaXMuYXR0cnMpOwogICAgfSwKICAgIC8vIOmAieaLqeinhOagvOaooeadvwogICAgaGFuZGxlQ29tbWFuZChlKSB7fSwKICAgIC8vIOiOt+WPluWVhuWTgeWxnuaAp+aooeadv++8mwogICAgcHJvZHVjdEdldFJ1bGUoKSB7CiAgICAgIHByb2R1Y3RHZXRSdWxlQXBpKCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy5ydWxlTGlzdCA9IHJlcy5kYXRhOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDojrflj5bov5DotLnmqKHmnb/vvJsKICAgIHByb2R1Y3RHZXRUZW1wbGF0ZSgpIHsKICAgICAgcHJvZHVjdEdldFRlbXBsYXRlQXBpKCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy50ZW1wbGF0ZUxpc3QgPSByZXMuZGF0YTsKICAgICAgfSk7CiAgICB9LAogICAgcGFyYW1zR2V0VGVtcGxhdGUoKSB7CiAgICAgIHBhcmFtTGlzdEFwaSgpLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoaXMucGFyYW1zVHlwZUxpc3QgPSByZXMuZGF0YS5saXN0OwogICAgICB9KTsKICAgIH0sCiAgICBjaGFuZ2VQYXJhbXNUeXBlKGUpIHsKICAgICAgZSA/IHRoaXMuZ2V0UGFyYW1zKGUpIDogKHRoaXMuZm9ybVZhbGlkYXRlLnBhcmFtc19saXN0ID0gW10pOwogICAgfSwKICAgIGdldFBhcmFtcyhpZCkgewogICAgICBwYXJhbUluZm9BcGkoaWQpLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnBhcmFtc19saXN0ID0gcmVzLmRhdGEudmFsdWU7CiAgICAgIH0pOwogICAgfSwKICAgIGlzU3Vic2V0KGFycjEsIGFycjIpIHsKICAgICAgLy8g5bCG5pWw57uE6L2s5o2i5Li6IFNldO+8jOS7peS+v+i/m+ihjOmrmOaViOeahOWMheWQq+ajgOafpQogICAgICBjb25zdCBzZXQxID0gbmV3IFNldChhcnIxKTsKICAgICAgY29uc3Qgc2V0MiA9IG5ldyBTZXQoYXJyMik7CgogICAgICAvLyDmo4Dmn6Ugc2V0MiDkuK3nmoTmr4/kuKrlhYPntKDmmK/lkKbpg73lnKggc2V0MSDkuK0KICAgICAgZm9yIChsZXQgZWxlbSBvZiBzZXQyKSB7CiAgICAgICAgaWYgKCFzZXQxLmhhcyhlbGVtKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICAvLyDmibnph4/mt7vliqAKICAgIGJhdGNoQWRkKCkgewogICAgICBsZXQgYXJyID0gW107CiAgICAgIGZvciAobGV0IHZhbCBvZiB0aGlzLmF0dHJzKSB7CiAgICAgICAgaWYgKHRoaXMub25lRm9ybUJhdGNoWzBdW3ZhbC52YWx1ZV0pIHsKICAgICAgICAgIGFyci5wdXNoKHRoaXMub25lRm9ybUJhdGNoWzBdW3ZhbC52YWx1ZV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8g5om56YeP6K6+572u5ZWG5ZOB6KeE5qC85bGe5oCnCiAgICAgIGNvbnN0IGJhdGNoRmllbGRzID0gWwogICAgICAgICdwaWMnLAogICAgICAgICdwcmljZScsCiAgICAgICAgJ2Nvc3QnLAogICAgICAgICdvdF9wcmljZScsCiAgICAgICAgJ3N0b2NrJywKICAgICAgICAnd2VpZ2h0JywKICAgICAgICAndm9sdW1lJywKICAgICAgICAnYmFyX2NvZGUnLAogICAgICAgICdiYXJfY29kZV9udW1iZXInLAogICAgICBdOwogICAgICAvLyBjb25zdCBkZWZhdWx0RmllbGRzID0gWydiYXJfY29kZScsICdiYXJfY29kZV9udW1iZXInXTsKCiAgICAgIGZvciAobGV0IHZhbCBvZiB0aGlzLm1hbnlGb3JtVmFsaWRhdGUpIHsKICAgICAgICBjb25zdCBiYXRjaCA9IHRoaXMub25lRm9ybUJhdGNoWzBdOwogICAgICAgIC8vIOWmguaenOWtmOWcqOetm+mAieadoeS7tuS4lOa7oei2s+adoeS7tizmiJbml6DnrZvpgInmnaHku7bml7YKICAgICAgICBpZiAoIWFyci5sZW5ndGggfHwgdGhpcy5pc1N1YnNldCh2YWwuYXR0cl9hcnIsIGFycikpIHsKICAgICAgICAgIC8vIOiuvue9ruacieWAvOeahOaJuemHj+Wtl+autQogICAgICAgICAgYmF0Y2hGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHsKICAgICAgICAgICAgaWYgKGJhdGNoW2ZpZWxkXSAmJiBiYXRjaFtmaWVsZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGlmIChmaWVsZCA9PT0gJ3BpYycgJiYgYmF0Y2hbZmllbGRdKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRzZXQodmFsLCBmaWVsZCwgYmF0Y2hbZmllbGRdKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkICE9ICdwaWMnKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRzZXQodmFsLCBmaWVsZCwgYmF0Y2hbZmllbGRdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIOiuvue9rum7mOiupOWtl+autQogICAgICAgICAgLy8gZGVmYXVsdEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4gewogICAgICAgICAgLy8gICB0aGlzLiRzZXQodmFsLCBmaWVsZCwgYmF0Y2hbZmllbGRdKTsKICAgICAgICAgIC8vIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNoYW5nZVNwZWNJbWcoYXJyLCBpbWcpIHsKICAgICAgLy8g5Yik5pat5piv5ZCm5a2Y5Zyo6KeE5qC85Zu+CiAgICAgIGxldCBpc0hhcyA9IGZhbHNlOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMubWFueUZvcm1WYWxpZGF0ZS5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCBpdGVtID0gdGhpcy5tYW55Rm9ybVZhbGlkYXRlW2ldOwogICAgICAgIGlmIChpdGVtLnBpYyAmJiB0aGlzLmlzU3Vic2V0KGl0ZW0uYXR0cl9hcnIsIGFycikpIHsKICAgICAgICAgIGlzSGFzID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaXNIYXMpIHsKICAgICAgICB0aGlzLiRjb25maXJtKCflj6/ku6XlkIzmraXkv67mlLnkuIvmlrnor6Xop4TmoLzlm77niYfvvIznoa7lrpropoHmm7/mjaLlkJfvvJ8nLCAn5o+Q56S6JywgewogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfmm7/mjaInLAogICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+aaguS4jScsCiAgICAgICAgICB0eXBlOiAnd2FybmluZycsCiAgICAgICAgfSkKICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgZm9yIChsZXQgdmFsIG9mIHRoaXMubWFueUZvcm1WYWxpZGF0ZSkgewogICAgICAgICAgICAgIGlmICh0aGlzLmlzU3Vic2V0KHZhbC5hdHRyX2FyciwgYXJyKSkgewogICAgICAgICAgICAgICAgdGhpcy4kc2V0KHZhbCwgJ3BpYycsIGltZyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHt9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGxldCB2YWwgb2YgdGhpcy5tYW55Rm9ybVZhbGlkYXRlKSB7CiAgICAgICAgICBpZiAodGhpcy5pc1N1YnNldCh2YWwuYXR0cl9hcnIsIGFycikpIHsKICAgICAgICAgICAgdGhpcy4kc2V0KHZhbCwgJ3BpYycsIGltZyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8g56uL5Y2z55Sf5oiQCiAgICBnZW5lcmF0ZSh0eXBlLCBpc0NvcHksIGFycikgewogICAgICB0aGlzLm1hbnlGb3JtVmFsaWRhdGUgPSBbXTsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuaGVhZGVyID0gW107CiAgICB9LAogICAgY2xlYXJBdHRyKCkgewogICAgICB0aGlzLmZvcm1EeW5hbWljLmF0dHJzTmFtZSA9ICcnOwogICAgICB0aGlzLmZvcm1EeW5hbWljLmF0dHJzVmFsID0gJyc7CiAgICB9LAoKICAgIC8vIOWIoOmZpOinhOagvAogICAgaGFuZGxlUmVtb3ZlUm9sZShpbmRleCkgewogICAgICB0aGlzLmF0dHJzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICBpZiAoIXRoaXMuYXR0cnMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuaGVhZGVyID0gW107CiAgICAgICAgdGhpcy5tYW55Rm9ybVZhbGlkYXRlID0gW107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5nZW5lcmF0ZUF0dHIodGhpcy5hdHRycyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDliKDpmaTooajmoLzkuK0g5a+55bqU5bGe5oCnCiAgICBkZWxBdHRyVGFibGUodmFsKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tYW55Rm9ybVZhbGlkYXRlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLm1hbnlGb3JtVmFsaWRhdGVbaV07CiAgICAgICAgaWYgKGl0ZW0uYXR0cl9hcnIgJiYgaXRlbS5hdHRyX2Fyci5pbmNsdWRlcyh2YWwpKSB7CiAgICAgICAgICB0aGlzLm1hbnlGb3JtVmFsaWRhdGUuc3BsaWNlKGksIDEpOwogICAgICAgICAgaS0tOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIOWIoOmZpOWxnuaApwogICAgaGFuZGxlUmVtb3ZlMihpdGVtLCBpbmRleCwgdmFsKSB7CiAgICAgIC8vIOWIoOmZpCBtYW55Rm9ybVZhbGlkYXRl5LitIHRpdGxlID0gaXRlbS52YWx1ZSDnmoTlsZ7mgKflgLwKICAgICAgaXRlbS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAvLyB0aGlzLmdlbmVyYXRlQXR0cih0aGlzLmF0dHJzKTsKICAgICAgdGhpcy5kZWxBdHRyVGFibGUodmFsKTsKICAgIH0sCiAgICAvLyDmlrDlop7op4TmoLwKICAgIGhhbmRsZUFkZFJvbGUoKSB7CiAgICAgIGxldCBkYXRhID0gewogICAgICAgIHZhbHVlOiB0aGlzLmZvcm1EeW5hbWljLmF0dHJzTmFtZSwKICAgICAgICBhZGRfcGljOiAwLAogICAgICAgIGRldGFpbDogW10sCiAgICAgIH07CiAgICAgIHRoaXMuYXR0cnMucHVzaChkYXRhKTsKICAgIH0sCiAgICBoYW5kbGVBZGRQYXJhbXMoKSB7CiAgICAgIGxldCBkYXRhID0gewogICAgICAgIG5hbWU6ICcnLAogICAgICAgIHZhbHVlOiAnJywKICAgICAgfTsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUucGFyYW1zX2xpc3QucHVzaChkYXRhKTsKICAgIH0sCiAgICBoYW5kbGVTYXZlQXNUZW1wbGF0ZSgpIHsKICAgICAgdGhpcy4kcHJvbXB0KCcnLCAn6K+36L6T5YWl5qih5p2/5ZCN56ewJywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgfSkKICAgICAgICAudGhlbigoeyB2YWx1ZSB9KSA9PiB7CiAgICAgICAgICBsZXQgc3BlYyA9IHRoaXMuYXR0cnMubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0udmFsdWUsCiAgICAgICAgICAgICAgZGV0YWlsOiBpdGVtLmRldGFpbC5tYXAoKGUpID0+IGUudmFsdWUpLAogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgZm9ybUR5bmFtaWMgPSB7CiAgICAgICAgICAgIHJ1bGVfbmFtZTogdmFsdWUsCiAgICAgICAgICAgIHNwZWM6IHNwZWMsCiAgICAgICAgICB9OwogICAgICAgICAgcnVsZUFkZEFwaShmb3JtRHluYW1pYywgMCkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2VzcyhyZXMubXNnKTsKICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RHZXRSdWxlKCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4ge30pOwogICAgfSwKICAgIC8vIOaWsOWinuS4gOadoeWxnuaApwogICAgYWRkT25lQXR0cih2YWwsIHZhbDIpIHsKICAgICAgdGhpcy5nZW5lcmF0ZUF0dHIodGhpcy5hdHRycywgdmFsMik7CiAgICB9LAogICAgaGFuZGxlRm9jdXModmFsKSB7CiAgICAgIHRoaXMuY2hhbmdlQXR0clZhbHVlID0gdmFsOwogICAgfSwKICAgIGhhbmRsZUJsdXIoKSB7CiAgICAgIHRoaXMuY2hhbmdlQXR0clZhbHVlID0gJyc7CiAgICB9LAogICAgaGFuZGxlU2VsSW1nKGl0ZW0pIHsKICAgICAgdGhpcy4kaW1nTW9kYWwoKGUpID0+IHsKICAgICAgICBpdGVtLnBpYyA9IGUuYXR0X2RpcjsKICAgICAgICB0aGlzLmNoYW5nZVNwZWNJbWcoW2l0ZW0udmFsdWVdLCBlLmF0dF9kaXIpOwogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVSZW1vdmVJbWcoaXRlbSkgewogICAgICBpdGVtLnBpYyA9ICcnOwogICAgfSwKICAgIC8vIOinhOagvOWQjeensOaUueWPmAogICAgYXR0ckNoYW5nZVZhbHVlKGksIHZhbCkgewogICAgICBpZiAodmFsLnRyaW0oKS5sZW5ndGggJiYgdGhpcy5hdHRyc1tpXS5kZXRhaWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5nZW5lcmF0ZUhlYWRlcih0aGlzLmF0dHJzKTsKICAgICAgICBpZiAodGhpcy5tYW55Rm9ybVZhbGlkYXRlLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5tYW55Rm9ybVZhbGlkYXRlLm1hcCgoaXRlbSwgaSkgPT4gewogICAgICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoaXRlbS5kZXRhaWwpLmluY2x1ZGVzKHRoaXMuY2hhbmdlQXR0clZhbHVlKSkgewogICAgICAgICAgICAgICAgaXRlbS5kZXRhaWxbdmFsXSA9IGl0ZW0uZGV0YWlsW3RoaXMuY2hhbmdlQXR0clZhbHVlXTsKICAgICAgICAgICAgICAgIGl0ZW1bdmFsXSA9IGl0ZW1bdGhpcy5jaGFuZ2VBdHRyVmFsdWVdOwogICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uZGV0YWlsW3RoaXMuY2hhbmdlQXR0clZhbHVlXTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtW3RoaXMuY2hhbmdlQXR0clZhbHVlXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGFuZ2VBdHRyVmFsdWUgPSB2YWw7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZ2VuZXJhdGVBdHRyKHRoaXMuYXR0cnMpOwogICAgICB9CiAgICB9LAogICAgLy8g6KeE5qC85YC85pS55Y+YCiAgICBhdHRyRGV0YWlsQ2hhbmdlVmFsdWUodmFsLCBpKSB7CiAgICAgIGlmICh0aGlzLm1hbnlGb3JtVmFsaWRhdGUubGVuZ3RoKSB7CiAgICAgICAgbGV0IGtleSA9IHRoaXMuYXR0cnNbaV0udmFsdWU7CiAgICAgICAgdGhpcy5tYW55Rm9ybVZhbGlkYXRlLm1hcCgoaXRlbSwgaSkgPT4gewogICAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhpdGVtLmRldGFpbCkuaW5jbHVkZXMoa2V5KSAmJiBpdGVtLmRldGFpbFtrZXldID09PSB0aGlzLmNoYW5nZUF0dHJWYWx1ZSkgewogICAgICAgICAgICAgIGl0ZW0uZGV0YWlsW2tleV0gPSB2YWw7CiAgICAgICAgICAgICAgbGV0IGluZGV4ID0gaXRlbS5hdHRyX2Fyci5maW5kSW5kZXgoKGl0ZW0pID0+IGl0ZW0gPT09IHRoaXMuY2hhbmdlQXR0clZhbHVlKTsKICAgICAgICAgICAgICBpdGVtLmF0dHJfYXJyW2luZGV4XSA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY2hhbmdlQXR0clZhbHVlID0gdmFsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZ2VuZXJhdGVBdHRyKHRoaXMuYXR0cnMsIDEpOwogICAgICB9CiAgICB9LAogICAgLy8g6KeE5qC85Zu+54mH5re75Yqg5byA5YWzCiAgICBhZGRQaWMoZSwgaSkgewogICAgICBpZiAoZSkgewogICAgICAgIHRoaXMuYXR0cnMubWFwKChpdGVtLCBpaSkgPT4gewogICAgICAgICAgaWYgKGlpICE9PSBpKSB7CiAgICAgICAgICAgIHRoaXMuJHNldChpdGVtLCAnYWRkX3BpYycsIDApOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY2FuU2VsID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jYW5TZWwgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgLy8g6KeE5qC85ouW5ou95o6S5bqP5ZCOCiAgICBvbk1vdmVTcGVjKCkgewogICAgICB0aGlzLmdlbmVyYXRlQXR0cih0aGlzLmF0dHJzKTsKICAgIH0sCiAgICBjaGFuZ2VDdXJyZW50SW5kZXgoaSkgewogICAgICB0aGlzLmN1cnJlbnRJbmRleCA9IGk7CiAgICB9LAogICAgLy8g55Sf5oiQ5ZWG5ZOB6KeE5qC86KGo5aS0CiAgICBnZW5lcmF0ZUhlYWRlcihkYXRhKSB7CiAgICAgIGxldCBzcGVjaWZpY2F0aW9uc0NvbHVtbnMgPSBkYXRhLm1hcCgoaXRlbSkgPT4gKHsKICAgICAgICB0aXRsZTogaXRlbS52YWx1ZSwKICAgICAgICBrZXk6IGl0ZW0udmFsdWUsCiAgICAgICAgbWluV2lkdGg6IDE0MCwKICAgICAgICBmaXhlZDogJ2xlZnQnLAogICAgICB9KSk7CiAgICAgIGxldCBhcnI7CiAgICAgIGlmIChbMSwgMl0uaW5jbHVkZXMoTnVtYmVyKHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSkpKSB7CiAgICAgICAgYXJyID0gWy4uLnNwZWNpZmljYXRpb25zQ29sdW1ucywgLi4uVmlydHVhbFRhYmxlSGVhZF07CiAgICAgICAgLy8g5om+5Yiwc2xvdCDnrYnkuo4gZmljdGl0aW91cyDlsIZ0aXRsZeaUueS4uuinhOagvOWQjeensAogICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmhlYWRlci5tYXAoKGl0ZW0pID0+IHsKICAgICAgICAgIGlmIChpdGVtLnNsb3QgPT09ICdmaWN0aXRpb3VzJykgewogICAgICAgICAgICBpdGVtLnRpdGxlID0gdGhpcy5mb3JtVmFsaWRhdGUudmlydHVhbF90eXBlID09IDEgPyAn5re75Yqg5Y2h5a+GL+e9keebmCcgOiAn6YCJ5oup5LyY5oOg5Yi4JzsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS52aXJ0dWFsX3R5cGUgPT0gMykgewogICAgICAgIGFyciA9IFsuLi5zcGVjaWZpY2F0aW9uc0NvbHVtbnMsIC4uLlZpcnR1YWxUYWJsZUhlYWQyXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhcnIgPSBbLi4uc3BlY2lmaWNhdGlvbnNDb2x1bW5zLCAuLi5Hb29kc1RhYmxlSGVhZF07CiAgICAgIH0KICAgICAgdGhpcy4kc2V0KHRoaXMuZm9ybVZhbGlkYXRlLCAnaGVhZGVyJywgYXJyKTsKICAgICAgdGhpcy50YWJsZUtleSArPSAxOwogICAgICB0aGlzLmNvbHVtbnNJbnN0YWxNID0gYXJyOwogICAgfSwKICAgIC8qCiAgICAgKiDnlJ/miJDlsZ7mgKcKICAgICAqIEBwYXJhbSB7QXJyYXl9IGRhdGEg6KeE5qC85pWw5o2uCiAgICAgKiAqLwogICAgZ2VuZXJhdGVBdHRyKGRhdGEsIHZhbCkgewogICAgICB0aGlzLmdlbmVyYXRlSGVhZGVyKGRhdGEpOwogICAgICBjb25zdCBjb21iaW5hdGlvbnMgPSB0aGlzLmdlbmVyYXRlQ29tYmluYXRpb25zKGRhdGEpOwogICAgICBjb25zb2xlLmxvZygn6KeE5qC857uE5ZCI5oC75pWw77yaJyArIGNvbWJpbmF0aW9ucy5sZW5ndGgpOwogICAgICBjb25zdCB2aXJ0dWFsVHlwZSA9IHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZTsKICAgICAgLy8g5aaC5p6cY29tYmluYXRpb25z5pWw6YeP6LaF6L+HIDUwMO+8jOWImeWIhuaJueasoeeUn+aIkOWxnuaApwogICAgICBsZXQgcm93cyA9IFtdOwogICAgICBpZiAoY29tYmluYXRpb25zLmxlbmd0aCA+IDUwMCkgewogICAgICAgIGNvbnN0IGJhdGNoU2l6ZSA9IE1hdGguY2VpbChjb21iaW5hdGlvbnMubGVuZ3RoIC8gNTAwKTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbWJpbmF0aW9ucy5sZW5ndGg7IGkgKz0gYmF0Y2hTaXplKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KChlKSA9PiB7CiAgICAgICAgICAgIGxldCBkID0gdGhpcy5nZW5lcmF0ZUF0dHJCYXRjaChkYXRhLCBjb21iaW5hdGlvbnMuc2xpY2UoaSwgaSArIGJhdGNoU2l6ZSksIHZhbCk7CiAgICAgICAgICAgIHJvd3MgPSBbLi4ucm93cywgLi4uZF07CiAgICAgICAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZSA9IFsuLi50aGlzLm9uZUZvcm1CYXRjaCwgLi4ucm93c107CiAgICAgICAgICB9LCAwKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcm93cyA9IHRoaXMuZ2VuZXJhdGVBdHRyQmF0Y2goZGF0YSwgY29tYmluYXRpb25zLCB2YWwpOwogICAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZSA9IFsuLi50aGlzLm9uZUZvcm1CYXRjaCwgLi4ucm93c107CiAgICAgIH0KICAgIH0sCiAgICAvLyDnlJ/miJDlsZ7mgKfmibnmrKEKICAgIGdlbmVyYXRlQXR0ckJhdGNoKGRhdGEsIGNvbWJpbmF0aW9ucywgdmFsKSB7CiAgICAgIGNvbnN0IGV4aXN0aW5nSXRlbXMgPSB0aGlzLm1hbnlGb3JtVmFsaWRhdGUuc2xpY2UoMSk7IC8vIOaOkumZpOesrOS4gOmhuem7mOiupOaVsOaNrgoKICAgICAgY29uc3Qgcm93cyA9IGNvbWJpbmF0aW9ucy5tYXAoKGNvbWJpbmF0aW9uKSA9PiB7CiAgICAgICAgY29uc3Qgcm93ID0gewogICAgICAgICAgYXR0cl9hcnI6IGNvbWJpbmF0aW9uLAogICAgICAgICAgZGV0YWlsOiB7fSwKICAgICAgICAgIHRpdGxlOiAnJywKICAgICAgICAgIGtleTogJycsCiAgICAgICAgICBwcmljZTogMCwKICAgICAgICAgIHBpYzogJycsCiAgICAgICAgICBvdF9wcmljZTogMCwKICAgICAgICAgIGNvc3Q6IDAsCiAgICAgICAgICBzdG9jazogMCwKICAgICAgICAgIGlzX3Nob3c6IDEsCiAgICAgICAgICBpc19kZWZhdWx0X3NlbGVjdDogMCwKICAgICAgICAgIHVuaXF1ZTogJycsCiAgICAgICAgICB3ZWlnaHQ6ICcnLAogICAgICAgICAgdm9sdW1lOiAnJywKICAgICAgICAgIGJyb2tlcmFnZTogMCwKICAgICAgICAgIGJyb2tlcmFnZV90d286IDAsCiAgICAgICAgICB2aXBfcHJpY2U6IDAsCiAgICAgICAgICB2aXBfcHJvcG9ydGlvbjogMCwKICAgICAgICB9OwoKICAgICAgICAvLyDorr7nva7omZrmi5/nsbvlnovnm7jlhbPlsZ7mgKcKICAgICAgICBpZiAodGhpcy5mb3JtVmFsaWRhdGUudmlydHVhbF90eXBlID09PSAxKSB7CiAgICAgICAgICByb3cudmlydHVhbF9saXN0ID0gW107CiAgICAgICAgICByb3cuZGlza19pbmZvID0gJyc7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS52aXJ0dWFsX3R5cGUgPT09IDIpIHsKICAgICAgICAgIHJvdy5jb3Vwb25faWQgPSAwOwogICAgICAgICAgcm93LmNvdXBvbl9uYW1lID0gJyc7CiAgICAgICAgfQoKICAgICAgICAvLyDlpITnkIbop4TmoLzlsZ7mgKcKICAgICAgICBkYXRhLmZvckVhY2goKGl0ZW0sIGkpID0+IHsKICAgICAgICAgIGNvbnN0IHZhbHVlID0gY29tYmluYXRpb25baV07CiAgICAgICAgICByb3dbaXRlbS52YWx1ZV0gPSB2YWx1ZTsKICAgICAgICAgIHJvdy50aXRsZSA9IGl0ZW0udmFsdWU7CiAgICAgICAgICByb3cua2V5ID0gaXRlbS52YWx1ZTsKICAgICAgICAgIHJvdy5kZXRhaWxbaXRlbS52YWx1ZV0gPSB2YWx1ZTsKCiAgICAgICAgICAvLyDmn6Xmib7ljLnphY3nmoTnjrDmnInop4TmoLzpobkKICAgICAgICAgIGNvbnN0IG1hdGNoZWRJdGVtID0gZXhpc3RpbmdJdGVtcy5maW5kKChpdGVtKSA9PiBpdGVtLmF0dHJfYXJyICYmIGFycmF5c0VxdWFsKGl0ZW0uYXR0cl9hcnIsIGNvbWJpbmF0aW9uKSk7CgogICAgICAgICAgaWYgKG1hdGNoZWRJdGVtKSB7CiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocm93LCB7CiAgICAgICAgICAgICAgcHJpY2U6IG1hdGNoZWRJdGVtLnByaWNlLAogICAgICAgICAgICAgIGNvc3Q6IG1hdGNoZWRJdGVtLmNvc3QsCiAgICAgICAgICAgICAgb3RfcHJpY2U6IG1hdGNoZWRJdGVtLm90X3ByaWNlLAogICAgICAgICAgICAgIHN0b2NrOiBtYXRjaGVkSXRlbS5zdG9jaywKICAgICAgICAgICAgICBwaWM6IG1hdGNoZWRJdGVtLnBpYywKICAgICAgICAgICAgICB1bmlxdWU6IG1hdGNoZWRJdGVtLnVuaXF1ZSB8fCAnJywKICAgICAgICAgICAgICB3ZWlnaHQ6IG1hdGNoZWRJdGVtLndlaWdodCB8fCAnJywKICAgICAgICAgICAgICB2b2x1bWU6IG1hdGNoZWRJdGVtLnZvbHVtZSB8fCAnJywKICAgICAgICAgICAgICBpc19zaG93OiBtYXRjaGVkSXRlbS5pc19zaG93IHx8IDEsCiAgICAgICAgICAgICAgaXNfZGVmYXVsdF9zZWxlY3Q6IG1hdGNoZWRJdGVtLmlzX2RlZmF1bHRfc2VsZWN0IHx8IDAsCiAgICAgICAgICAgICAgdm9sdW1lOiBtYXRjaGVkSXRlbS52b2x1bWUgfHwgMCwKICAgICAgICAgICAgICBiYXJfY29kZV9udW1iZXI6IG1hdGNoZWRJdGVtLmJhcl9jb2RlX251bWJlciB8fCAwLAogICAgICAgICAgICAgIGlzX3ZpcnR1YWw6IG1hdGNoZWRJdGVtLmlzX3ZpcnR1YWwsCiAgICAgICAgICAgICAgYnJva2VyYWdlOiBtYXRjaGVkSXRlbS5icm9rZXJhZ2UsCiAgICAgICAgICAgICAgYnJva2VyYWdlX3R3bzogbWF0Y2hlZEl0ZW0uYnJva2VyYWdlX3R3bywKICAgICAgICAgICAgICB2aXBfcHJpY2U6IG1hdGNoZWRJdGVtLnZpcF9wcmljZSwKICAgICAgICAgICAgICB2aXBfcHJvcG9ydGlvbjogbWF0Y2hlZEl0ZW0udmlwX3Byb3BvcnRpb24sCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLnZpcnR1YWxfdHlwZSA9PT0gMSkgewogICAgICAgICAgICAgIHJvdy52aXJ0dWFsX2xpc3QgPSBtYXRjaGVkSXRlbS52aXJ0dWFsX2xpc3Q7CiAgICAgICAgICAgICAgcm93LmRpc2tfaW5mbyA9IG1hdGNoZWRJdGVtLmRpc2tfaW5mbzsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS52aXJ0dWFsX3R5cGUgPT09IDIgJiYgbWF0Y2hlZEl0ZW0uY291cG9uX2lkKSB7CiAgICAgICAgICAgICAgcm93LmNvdXBvbl9pZCA9IG1hdGNoZWRJdGVtLmNvdXBvbl9pZDsKICAgICAgICAgICAgICByb3cuY291cG9uX25hbWUgPSBtYXRjaGVkSXRlbS5jb3Vwb25fbmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmFkZF9waWMgJiYgY29tYmluYXRpb24uaW5jbHVkZXModmFsKSkgewogICAgICAgICAgICBjb25zdCBwaWNJdGVtID0gaXRlbS5kZXRhaWwuZmluZCgoZSkgPT4gY29tYmluYXRpb24uaW5jbHVkZXMoZS52YWx1ZSkpOwogICAgICAgICAgICBpZiAocGljSXRlbSkgcm93LnBpYyA9IHBpY0l0ZW0ucGljOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByb3c7CiAgICAgIH0pOwogICAgICByZXR1cm4gcm93czsKICAgIH0sCiAgICAvLyDliIfmjaLpu5jorqTpgInkuK3op4TmoLwKICAgIGNoYW5nZURlZmF1bHRTZWxlY3QoZSwgaW5kZXgpIHsKICAgICAgLy8g5LiA5Liq5byA5ZCvIOWFtuS7luWFs+mXrQogICAgICB0aGlzLm1hbnlGb3JtVmFsaWRhdGUubWFwKChpdGVtLCBpKSA9PiB7CiAgICAgICAgaWYgKGkgIT09IGluZGV4KSB7CiAgICAgICAgICBpdGVtLmlzX2RlZmF1bHRfc2VsZWN0ID0gMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBpZiAoZSkgdGhpcy5tYW55Rm9ybVZhbGlkYXRlW2luZGV4XS5pc19zaG93ID0gMTsKICAgIH0sCiAgICAvLyDmlLnlj5jmmK/lkKbmmL7npLoKICAgIGNoYW5nZURlZmF1bHRTaG93KGluZGV4KSB7CiAgICAgIC8vIOWmguaenOm7mOiupOmAieS4reW8gOWQryDliJnkuI3lj6/pmpDol48KICAgICAgaWYgKHRoaXMubWFueUZvcm1WYWxpZGF0ZVtpbmRleF0uaXNfZGVmYXVsdF9zZWxlY3QgPT09IDEpIHsKICAgICAgICB0aGlzLm1hbnlGb3JtVmFsaWRhdGVbaW5kZXhdLmlzX3Nob3cgPSAxOwogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+m7mOiupOinhOagvOS4jeWPr+makOiXjycpOwogICAgICB9CiAgICB9LAogICAgLy8g55Sf5oiQ6KeE5qC857uE5ZCICiAgICBnZW5lcmF0ZUNvbWJpbmF0aW9ucyhhcnIsIHByZWZpeCA9IFtdKSB7CiAgICAgIGlmIChhcnIubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIFtwcmVmaXhdOwogICAgICB9CiAgICAgIGNvbnN0IFtmaXJzdCwgLi4ucmVzdF0gPSBhcnI7CiAgICAgIHJldHVybiBmaXJzdC5kZXRhaWwuZmxhdE1hcCgoZGV0YWlsKSA9PiB0aGlzLmdlbmVyYXRlQ29tYmluYXRpb25zKHJlc3QsIFsuLi5wcmVmaXgsIGRldGFpbC52YWx1ZV0pKTsKICAgIH0sCiAgICAvLyDmt7vliqDlsZ7mgKcKICAgIGNyZWF0ZUF0dHIobnVtLCBpZHgpIHsKICAgICAgaWYgKG51bSkgewogICAgICAgIC8vIOWIpOaWreaYr+WQpuWtmOWcqOWQjOagt+eGn+aCiQogICAgICAgIHZhciBpc0V4aXN0ID0gdGhpcy5hdHRyc1tpZHhdLmRldGFpbC5zb21lKChpdGVtKSA9PiBpdGVtLnZhbHVlID09PSBudW0pOwogICAgICAgIGlmIChpc0V4aXN0KSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfop4TmoLzlgLzlt7LlrZjlnKgnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5hdHRyc1tpZHhdLmRldGFpbC5wdXNoKHsgdmFsdWU6IG51bSwgcGljOiAnJyB9KTsKICAgICAgICBpZiAodGhpcy5tYW55Rm9ybVZhbGlkYXRlLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5hZGRPbmVBdHRyKHRoaXMuYXR0cnNbaWR4XS52YWx1ZSwgbnVtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5nZW5lcmF0ZUF0dHIodGhpcy5hdHRycyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRyZWZzLnNwZWNTdG9jay4kcmVmc1sncG9wb3ZlclJlZl8nICsgaWR4XVswXS5kb0Nsb3NlKCk7IC8v5YWz6Zet55qECiAgICAgICAgdGhpcy5jbGVhckF0dHIoKTsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIGlmICh0aGlzLiRyZWZzLnNwZWNTdG9jay4kcmVmc1sncG9wb3ZlclJlZl8nICsgaWR4XSkgewogICAgICAgICAgICAvL+mHjeeCueaYr+S7peS4i+S4pOWPpQogICAgICAgICAgICB0aGlzLiRyZWZzLnNwZWNTdG9jay4kcmVmc1sncG9wb3ZlclJlZl8nICsgaWR4XVswXS5kb1Nob3coKTsgLy/miZPlvIDnmoQKICAgICAgICAgICAgLy/ph43ngrnmmK/ku6XkuIrkuKTlj6UKICAgICAgICAgIH0KICAgICAgICB9LCAyMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kcmVmcy5zcGVjU3RvY2suJHJlZnNbJ3BvcG92ZXJSZWZfJyArIGlkeF1bMF0uZG9DbG9zZSgpOyAvL+WFs+mXreeahAogICAgICB9CiAgICB9LAogICAgaGFuZGxlU2hvd1BvcChpbmRleCkgewogICAgICB0aGlzLiRyZWZzLnNwZWNTdG9jay4kcmVmc1snaW5wdXRSZWZfJyArIGluZGV4XVswXS5mb2N1cygpOwogICAgfSwKICAgIC8vIOWVhuWTgeWIhuexu++8mwogICAgZ29vZHNDYXRlZ29yeSgpIHsKICAgICAgY2FzY2FkZXJMaXN0QXBpKDEpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy50cmVlU2VsZWN0ID0gcmVzLmRhdGE7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKHJlcykgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICB9KTsKICAgIH0sCiAgICAvLyDmlLnlj5jop4TmoLwKICAgIGNoYW5nZVNwZWMoKSB7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmlzX3N1YiA9IFtdOwogICAgICBsZXQgaWQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQ7CiAgICAgIGlmIChpZCkgewogICAgICAgIGNoZWNrQWN0aXZpdHlBcGkoaWQpCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7fSkKICAgICAgICAgIC5jYXRjaCgocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnNwZWNfdHlwZSA9IHRoaXMuc3BlY190eXBlOwogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDor6bmg4UKICAgIGdldEluZm8oKSB7CiAgICAgIHRoaXMuc3BpblNob3cgPSB0cnVlOwogICAgICBwcm9kdWN0SW5mb0FwaSh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQpCiAgICAgICAgLnRoZW4oYXN5bmMgKHJlcykgPT4gewogICAgICAgICAgbGV0IGRhdGEgPSByZXMuZGF0YS5wcm9kdWN0SW5mbzsKICAgICAgICAgIHRoaXMuaW5mb0RhdGEoZGF0YSk7CiAgICAgICAgICB0aGlzLnNwaW5TaG93ID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKHJlcykgPT4gewogICAgICAgICAgdGhpcy5zcGluU2hvdyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVSZW1vdmUoaSkgewogICAgICB0aGlzLmltYWdlcy5zcGxpY2UoaSwgMSk7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZS5zcGxpY2UoaSwgMSk7CiAgICAgIHRoaXMub25lRm9ybVZhbGlkYXRlWzBdLnBpYyA9IHRoaXMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZVswXTsKICAgIH0sCiAgICAvLyDlhbPpl63lm77niYfkuIrkvKDmqKHmgIHmoYYKICAgIGNoYW5nZUNhbmNlbChtc2cpIHsKICAgICAgdGhpcy5tb2RhbFBpYyA9IGZhbHNlOwogICAgfSwKICAgIC8vIOeCueWHu+WVhuWTgeWbvgogICAgbW9kYWxQaWNUYXAodGl0LCBwaWNUaXQgPSAnJywgaW5kZXggPSAwKSB7CiAgICAgIHRoaXMubW9kYWxQaWMgPSB0cnVlOwogICAgICB0aGlzLmlzQ2hvaWNlID0gdGl0ID09PSAnZGFuJyA/ICfljZXpgIknIDogJ+WkmumAiSc7CiAgICAgIHRoaXMucGljVGl0ID0gcGljVGl0OwogICAgICB0aGlzLnRhYmxlSW5kZXggPSBpbmRleDsKICAgIH0sCiAgICAvLyDojrflj5bljZXlvKDlm77niYfkv6Hmga8KICAgIGdldFBpYyhwYykgewogICAgICBzd2l0Y2ggKHRoaXMucGljVGl0KSB7CiAgICAgICAgY2FzZSAnZGFuRnJvbSc6CiAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5pbWFnZSA9IHBjLmF0dF9kaXI7CiAgICAgICAgICBpZiAoIXRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgICBpZiAodGhpcy5mb3JtVmFsaWRhdGUuc3BlY190eXBlID09PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5vbmVGb3JtVmFsaWRhdGVbMF0ucGljID0gcGMuYXR0X2RpcjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLm1hbnlGb3JtVmFsaWRhdGUubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICBpdGVtLnBpYyA9IHBjLmF0dF9kaXI7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy5vbmVGb3JtQmF0Y2hbMF0ucGljID0gcGMuYXR0X2RpcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnZGFuVGFibGUnOgogICAgICAgICAgdGhpcy5vbmVGb3JtVmFsaWRhdGVbdGhpcy50YWJsZUluZGV4XS5waWMgPSBwYy5hdHRfZGlyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnZHVvcGknOgogICAgICAgICAgdGhpcy5vbmVGb3JtQmF0Y2hbdGhpcy50YWJsZUluZGV4XS5waWMgPSBwYy5hdHRfZGlyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAncmVjb21tZW5kX2ltYWdlJzoKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnJlY29tbWVuZF9pbWFnZSA9IHBjLmF0dF9kaXI7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKHRoaXMubWFueUZvcm1WYWxpZGF0ZS5sZW5ndGgpIHRoaXMubWFueUZvcm1WYWxpZGF0ZVt0aGlzLnRhYmxlSW5kZXhdLnBpYyA9IHBjLmF0dF9kaXI7CiAgICAgIH0KICAgICAgdGhpcy5tb2RhbFBpYyA9IGZhbHNlOwogICAgfSwKICAgIGRlbGV0ZVJvdyhpbmRleCkgewogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5wYXJhbXNfbGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgfSwKICAgIC8vIOiOt+WPluWkmuW8oOWbvuS/oeaBrwogICAgZ2V0UGljRChwYykgewogICAgICB0aGlzLmltYWdlcyA9IHBjOwogICAgICB0aGlzLmltYWdlcy5tYXAoKGl0ZW0pID0+IHsKICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5zbGlkZXJfaW1hZ2UucHVzaChpdGVtLmF0dF9kaXIpOwogICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZSA9IHRoaXMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZS5zcGxpY2UoMCwgMTApOwogICAgICB9KTsKICAgICAgdGhpcy5vbmVGb3JtVmFsaWRhdGVbMF0ucGljID0gdGhpcy5mb3JtVmFsaWRhdGUuc2xpZGVyX2ltYWdlWzBdOwogICAgICB0aGlzLm1vZGFsUGljID0gZmFsc2U7CiAgICB9LAogICAgLy8g5o+Q5LqkCiAgICBoYW5kbGVTdWJtaXQobmFtZSkgewogICAgICB0aGlzLiRyZWZzW25hbWVdLnZhbGlkYXRlKCh2YWxpZCkgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUudHlwZSA9IHRoaXMudHlwZTsKICAgICAgICAgIGxldCBhcnIgPSB0aGlzLmZvcm1WYWxpZGF0ZS5zcGVjX3R5cGUgPT09IDAgPyB0aGlzLm9uZUZvcm1WYWxpZGF0ZSA6IHRoaXMubWFueUZvcm1WYWxpZGF0ZTsKICAgICAgICAgIGxldCBpdGVtID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShhcnIpKTsKICAgICAgICAgIGlmICh0aGlzLmZvcm1WYWxpZGF0ZS5zcGVjX3R5cGUgPT09IDEpIHsKICAgICAgICAgICAgaWYgKGl0ZW0ubGVuZ3RoIDwgMikgcmV0dXJuIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn5ZWG5ZOB6KeE5qC8LeinhOagvOaVsOmHj+acgOWwkTHkuKonKTsKICAgICAgICAgICAgLy8g5Yig6Zmk56ys5LiA6aG5CiAgICAgICAgICAgIGl0ZW0uc2hpZnQoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaXRlbVtpXS5zdG9jayA+IDEwMDAwMDApIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign6KeE5qC85bqT5a2YLeW6k+WtmOi2heWHuuezu+e7n+iMg+WbtCgxMDAwMDAwKScpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5mb3JtVmFsaWRhdGUuaXNfc3ViWzBdID09PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmIChpdGVtW2ldLmJyb2tlcmFnZSA9PT0gbnVsbCB8fCBpdGVtW2ldLmJyb2tlcmFnZV90d28gPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfokKXplIDorr7nva4tIOS4gOS6jOe6p+i/lOS9o+S4jeiDveS4uuepuicpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKGl0ZW1baV0udmlwX3ByaWNlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign6JCl6ZSA6K6+572uLeS8muWRmOS7t+S4jeiDveS4uuepuicpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLmlzX3N1Yi5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKGl0ZW1baV0uYnJva2VyYWdlID09PSBudWxsIHx8IGl0ZW1baV0uYnJva2VyYWdlX3R3byA9PT0gbnVsbCB8fCBpdGVtW2ldLnZpcF9wcmljZSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+iQpemUgOiuvue9ri0g5LiA5LqM57qn6L+U5L2j5ZKM5Lya5ZGY5Lu35LiN6IO95Li656m6Jyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5mb3JtVmFsaWRhdGUuZnJlaWdodCA9PSAzICYmICF0aGlzLmZvcm1WYWxpZGF0ZS50ZW1wX2lkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLndhcm5pbmcoJ+WVhuWTgeS/oeaBry3ov5DotLnmqKHmnb/kuI3og73kuLrnqbonKTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBhY3RpdmVJZHMgPSBbXTsKICAgICAgICAgIHRoaXMuZGF0YUxhYmVsLmZvckVhY2goKGl0ZW0pID0+IHsKICAgICAgICAgICAgYWN0aXZlSWRzLnB1c2goaXRlbS5pZCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmxhYmVsX2lkID0gYWN0aXZlSWRzOwogICAgICAgICAgaWYgKHRoaXMub3BlblN1YmltaXQpIHJldHVybjsKICAgICAgICAgIHRoaXMub3BlblN1YmltaXQgPSB0cnVlOwogICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuZGVzY3JpcHRpb24gPSBmb3JtYXRSaWNoVGV4dCh0aGlzLmNvbnRlbnQpOwogICAgICAgICAgaWYgKHRoaXMuZm9ybVZhbGlkYXRlLnNwZWNfdHlwZSA9PT0gMCkgewogICAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5hdHRycyA9IGl0ZW07CiAgICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmhlYWRlciA9IFtdOwogICAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5pdGVtcyA9IFtdOwogICAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5pc19jb3B5ID0gMDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLml0ZW1zID0gdGhpcy5hdHRyczsKICAgICAgICAgICAgdGhpcy5mb3JtVmFsaWRhdGUuYXR0cnMgPSBpdGVtOwogICAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5pc19jb3B5ID0gMTsKICAgICAgICAgIH0KICAgICAgICAgIHByb2R1Y3RBZGRBcGkodGhpcy5mb3JtVmFsaWRhdGUpCiAgICAgICAgICAgIC50aGVuKGFzeW5jIChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLm9wZW5TdWJpbWl0ID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHJlcy5tc2cpOwogICAgICAgICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMuaWQgPT09ICcwJykgewogICAgICAgICAgICAgICAgY2FjaGVEZWxldGUoKS5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoZXJyLm1zZyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLm9wZW5TdWJpbWl0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6IHRoaXMuJHJvdXRlUHJvU3RyICsgJy9wcm9kdWN0L3Byb2R1Y3RfbGlzdCcgfSk7CiAgICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKChyZXMpID0+IHsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KChlKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLm9wZW5TdWJpbWl0ID0gZmFsc2U7CiAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICghdGhpcy5mb3JtVmFsaWRhdGUuc3RvcmVfbmFtZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfllYblk4Hkv6Hmga8t5ZWG5ZOB5ZCN56ew5LiN6IO95Li656m6Jyk7CiAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLmZvcm1WYWxpZGF0ZS5jYXRlX2lkLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfllYblk4Hkv6Hmga8t5ZWG5ZOB5YiG57G75LiN6IO95Li656m6Jyk7CiAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLmZvcm1WYWxpZGF0ZS51bml0X25hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn5ZWG5ZOB5L+h5oGvLeWVhuWTgeWNleS9jeS4jeiDveS4uuepuicpOwogICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5mb3JtVmFsaWRhdGUuc2xpZGVyX2ltYWdlLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfllYblk4Hkv6Hmga8t5ZWG5ZOB6L2u5pKt5Zu+5LiN6IO95Li656m6Jyk7CiAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLmZvcm1WYWxpZGF0ZS5sb2dpc3RpY3MubGVuZ3RoICYmICF0aGlzLmZvcm1WYWxpZGF0ZS52aXJ0dWFsX3R5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn54mp5rWB6K6+572uLeiHs+WwkemAieaLqeS4gOenjeeJqea1geaWueW8jycpOwogICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5mb3JtVmFsaWRhdGUudGVtcF9pZCAmJiB0aGlzLmZvcm1WYWxpZGF0ZS5mcmVpZ2h0ID09IDMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn5ZWG5ZOB5L+h5oGvLei/kOi0ueaooeadv+S4jeiDveS4uuepuicpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY2hhbmdlVGVtcGxhdGUobXNnKSB7CiAgICAgIHRoaXMudGVtcGxhdGUgPSBtc2c7CiAgICB9LAogICAgLy8g6KGo5Y2V6aqM6K+BCiAgICB2YWxpZGF0ZShwcm9wLCBzdGF0dXMsIGVycm9yKSB7CiAgICAgIGlmIChzdGF0dXMgPT09IGZhbHNlKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKGVycm9yKTsKICAgICAgfQogICAgfSwKICAgIC8vIOenu+WKqAogICAgaGFuZGxlRHJhZ1N0YXJ0KGUsIGl0ZW0pIHsKICAgICAgdGhpcy5kcmFnZ2luZyA9IGl0ZW07CiAgICB9LAogICAgaGFuZGxlRHJhZ0VuZChlLCBpdGVtKSB7CiAgICAgIHRoaXMuZHJhZ2dpbmcgPSBudWxsOwogICAgfSwKICAgIGhhbmRsZURyYWdPdmVyKGUpIHsKICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9ICdtb3ZlJzsKICAgIH0sCiAgICBoYW5kbGVEcmFnRW50ZXIoZSwgaXRlbSkgewogICAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gJ21vdmUnOwogICAgICBpZiAoaXRlbSA9PT0gdGhpcy5kcmFnZ2luZykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBuZXdJdGVtcyA9IFsuLi50aGlzLmZvcm1WYWxpZGF0ZS5zbGlkZXJfaW1hZ2VdOwogICAgICBjb25zdCBzcmMgPSBuZXdJdGVtcy5pbmRleE9mKHRoaXMuZHJhZ2dpbmcpOwogICAgICBjb25zdCBkc3QgPSBuZXdJdGVtcy5pbmRleE9mKGl0ZW0pOwogICAgICBuZXdJdGVtcy5zcGxpY2UoZHN0LCAwLCAuLi5uZXdJdGVtcy5zcGxpY2Uoc3JjLCAxKSk7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLnNsaWRlcl9pbWFnZSA9IG5ld0l0ZW1zOwogICAgfSwKICAgIC8v5a+56LGh5pWw57uE5Y676YeN77ybCiAgICB1bmlxdWUoYXJyKSB7CiAgICAgIGNvbnN0IHJlcyA9IG5ldyBNYXAoKTsKICAgICAgcmV0dXJuIGFyci5maWx0ZXIoKGFycikgPT4gIXJlcy5oYXMoYXJyLnByb2R1Y3RfaWQpICYmIHJlcy5zZXQoYXJyLnByb2R1Y3RfaWQsIDEpKTsKICAgIH0sCiAgICAvLyDllYblk4FpZAogICAgZ2V0UHJvZHVjdElkKGRhdGEpIHsKICAgICAgdGhpcy5nb29kc19tb2RhbHMgPSBmYWxzZTsKICAgICAgdGhpcy5mb3JtVmFsaWRhdGUucmVjb21tZW5kX2xpc3QgPSB0aGlzLnVuaXF1ZSh0aGlzLmZvcm1WYWxpZGF0ZS5yZWNvbW1lbmRfbGlzdC5jb25jYXQoZGF0YSkpOwogICAgfSwKICAgIC8vIOmAieaLqeaOqOiNkOWVhuWTgQogICAgY2hhbmdlR29vZHMoKSB7CiAgICAgIHRoaXMuZ29vZHNfbW9kYWxzID0gdHJ1ZTsKICAgICAgdGhpcy4kcmVmcy5nb29kc2xpc3QuZ2V0TGlzdCgpOwogICAgICB0aGlzLiRyZWZzLmdvb2RzbGlzdC5nb29kc0NhdGVnb3J5KCk7CiAgICB9LAogICAgLy8g6YCJ5oup55So5oi35qCH562+CiAgICBhY3RpdmVEYXRhKGRhdGFMYWJlbCkgewogICAgICB0aGlzLmxhYmVsU2hvdyA9IGZhbHNlOwogICAgICB0aGlzLmRhdGFMYWJlbCA9IGRhdGFMYWJlbDsKICAgIH0sCiAgICAvLyDpgInmi6nllYblk4HmoIfnrb4KICAgIGFjdGl2ZUxhYmVsKGRhdGEpIHsKICAgICAgdGhpcy50YWdTaG93ID0gZmFsc2U7CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmxhYmVsX2xpc3QgPSBBcnJheS5mcm9tKG5ldyBTZXQoZGF0YSkpOwogICAgfSwKICAgIC8vIOagh+etvuW8ueeql+WFs+mXrQogICAgbGFiZWxDbG9zZSgpIHsKICAgICAgdGhpcy5sYWJlbFNob3cgPSBmYWxzZTsKICAgICAgdGhpcy50YWdTaG93ID0gZmFsc2U7CiAgICB9LAogICAgLy8g5Yig6Zmk55So5oi35qCH562+CiAgICBjbG9zZUxhYmVsKGxhYmVsKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMuZGF0YUxhYmVsLmluZGV4T2YodGhpcy5kYXRhTGFiZWwuZmlsdGVyKChkKSA9PiBkLmlkID09IGxhYmVsLmlkKVswXSk7CiAgICAgIHRoaXMuZGF0YUxhYmVsLnNwbGljZShpbmRleCwgMSk7CiAgICB9LAogICAgLy8g5omT5byA6YCJ5oup55So5oi35qCH562+CiAgICBvcGVuTGFiZWwocm93KSB7CiAgICAgIHRoaXMubGFiZWxTaG93ID0gdHJ1ZTsKICAgIH0sCiAgICBoYW5kbGVSZW1vdmVSZWNvbW1lbmQoaSkgewogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5yZWNvbW1lbmRfbGlzdC5zcGxpY2UoaSwgMSk7CiAgICB9LAogICAgLy8g5omT5byA55qE6JCl6ZSA5rS75Yqo5qCH562+CiAgICB3YXRjaEFjdGl2aXR5KCkgewogICAgICBsZXQgbWFya2V0aW5nID0gW107CiAgICAgIC8vIOS9v+eUqOWvueixoeaYoOWwhOS8mOWMluadg+mZkOWIpOaWremAu+i+kQogICAgICBjb25zdCBwZXJtaXNzaW9uTWFwID0gewogICAgICAgIOm7mOiupDogdHJ1ZSwKICAgICAgICDnp5LmnYA6ICdzZWNraWxsJywKICAgICAgICDnoI3ku7c6ICdiYXJnYWluJywKICAgICAgICDmi7zlm6I6ICdjb21iaW5hdGlvbicsCiAgICAgIH07CiAgICAgIHRoaXMuZm9ybVZhbGlkYXRlLmFjdGl2aXR5LmZvckVhY2goKGVsKSA9PiB7CiAgICAgICAgaWYgKHBlcm1pc3Npb25NYXBbZWxdID09PSB0cnVlIHx8IChwZXJtaXNzaW9uTWFwW2VsXSAmJiBjaGVja0FycmF5KHBlcm1pc3Npb25NYXBbZWxdKSkpIHsKICAgICAgICAgIG1hcmtldGluZy5wdXNoKGVsKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5hY3Rpdml0eSA9IG1hcmtldGluZzsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAgUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/product/productAdd","sourcesContent":["<template>\n  <div class=\"\" id=\"shopp-manager\" v-loading=\"spinShow\">\n    <pages-header\n      ref=\"pageHeader\"\n      :title=\"$route.params.id ? '编辑商品' : '添加商品'\"\n      :backUrl=\"$routeProStr + '/product/product_list'\"\n    ></pages-header>\n    <el-card :bordered=\"false\" shadow=\"never\" class=\"mt16\" :body-style=\"{ padding: '0px 20px' }\">\n      <el-tabs v-model=\"currentTab\">\n        <el-tab-pane v-for=\"(item, index) in headTab\" :key=\"index\" :label=\"item.tit\" :name=\"item.name\"></el-tab-pane>\n      </el-tabs>\n      <el-form\n        class=\"formValidate mt20\"\n        ref=\"formValidate\"\n        :rules=\"ruleValidate\"\n        :model=\"formValidate\"\n        :label-width=\"labelWidth\"\n        :label-position=\"labelPosition\"\n        @submit.native.prevent\n      >\n        <!-- 基础信息-->\n        <basic-info\n          v-show=\"currentTab === '1'\"\n          :isCai=\"type\"\n          :formValidate=\"formValidate\"\n          :goodsType=\"goodsType\"\n          :treeSelect=\"treeSelect\"\n          :tileLabelList=\"tileLabelList\"\n          :progress=\"progress\"\n          :upload=\"upload\"\n          :videoIng=\"videoIng\"\n          @virtualbtn=\"virtualbtn\"\n          @handleDragStart=\"handleDragStart\"\n          @handleDragOver=\"handleDragOver\"\n          @handleDragEnter=\"handleDragEnter\"\n          @handleDragEnd=\"handleDragEnd\"\n          @handleRemove=\"handleRemove\"\n          @modalPicTap=\"modalPicTap\"\n          @addVideo=\"addVideo\"\n          @delVideo=\"delVideo\"\n          @addCate=\"addCate\"\n          @addGoodsTag=\"addGoodsTag\"\n        ></basic-info>\n\n        <!-- 规格库存-->\n        <spec-stock\n          ref=\"specStock\"\n          v-show=\"currentTab === '2'\"\n          :formValidate=\"formValidate\"\n          :ruleList=\"ruleList\"\n          :attrs=\"attrs\"\n          :manyFormValidate=\"manyFormValidate\"\n          :oneFormValidate=\"oneFormValidate\"\n          :tableKey=\"tableKey\"\n          :oneFormBatch=\"oneFormBatch\"\n          :formDynamic=\"formDynamic\"\n          :canSel=\"canSel\"\n          @changeSpec=\"changeSpec\"\n          @confirm=\"confirm\"\n          @onMoveSpec=\"onMoveSpec\"\n          @changeCurrentIndex=\"changeCurrentIndex\"\n          @handleRemoveRole=\"handleRemoveRole\"\n          @attrChangeValue=\"attrChangeValue\"\n          @handleFocus=\"handleFocus\"\n          @addPic=\"addPic\"\n          @handleRemove2=\"handleRemove2\"\n          @attrDetailChangeValue=\"attrDetailChangeValue\"\n          @handleBlur=\"handleBlur\"\n          @handleSelImg=\"handleSelImg\"\n          @handleRemoveImg=\"handleRemoveImg\"\n          @handleShowPop=\"handleShowPop\"\n          @createAttr=\"createAttr\"\n          @handleAddRole=\"handleAddRole\"\n          @handleSaveAsTemplate=\"handleSaveAsTemplate\"\n          @batchAdd=\"batchAdd\"\n          @batchDel=\"batchDel\"\n          @modalPicTap=\"modalPicTap\"\n          @changeDefaultSelect=\"changeDefaultSelect\"\n          @changeDefaultShow=\"changeDefaultShow\"\n          @addGoodsCoupon=\"addGoodsCoupon\"\n          @see=\"see\"\n          @addVirtual=\"addVirtual\"\n        ></spec-stock>\n\n        <!-- 商品详情-->\n        <product-detail\n          v-show=\"currentTab === '3'\"\n          :contents=\"contents\"\n          :content=\"content\"\n          @getEditorContent=\"getEditorContent\"\n        ></product-detail>\n\n        <!-- 物流设置-->\n        <logistics-setting\n          v-show=\"headTab.length === 7 ? currentTab === '4' : false\"\n          :formValidate=\"formValidate\"\n          :templateList=\"templateList\"\n          @logisticsBtn=\"logisticsBtn\"\n          @addTemp=\"addTemp\"\n        ></logistics-setting>\n\n        <!-- 会员价/佣金 -->\n        <price-commission\n          v-show=\"headTab.length === 7 ? currentTab === '5' : currentTab === '4'\"\n          :formValidate=\"formValidate\"\n          :oneFormValidate=\"oneFormValidate\"\n          :manyFormValidate=\"manyFormValidate\"\n          :columnsInstall=\"columnsInstall\"\n          :columnsInstal2=\"columnsInstal2\"\n          :manyBrokerage.sync=\"manyBrokerage\"\n          :manyBrokerageTwo.sync=\"manyBrokerageTwo\"\n          :manyVipPrice.sync=\"manyVipPrice\"\n          :manyVipDiscount.sync=\"manyVipDiscount\"\n          @checkAllGroupChange=\"checkAllGroupChange\"\n          @changeVipPrice=\"changeVipPrice\"\n          @changeDiscount=\"changeDiscount\"\n          @brokerageSetUp=\"brokerageSetUp\"\n        ></price-commission>\n\n        <!-- 营销设置-->\n        <marketing-setting\n          v-show=\"headTab.length === 7 ? currentTab === '6' : currentTab === '5'\"\n          :formValidate=\"formValidate\"\n          :couponName=\"couponName\"\n          :dataLabel=\"dataLabel\"\n          :activity=\"activity\"\n          @handleClose=\"handleClose\"\n          @addCoupon=\"addCoupon\"\n          @openLabel=\"openLabel\"\n          @closeLabel=\"closeLabel\"\n          @addLabel=\"addLabel\"\n          @onchangeTime=\"onchangeTime\"\n          @handleRemoveRecommend=\"handleRemoveRecommend\"\n          @changeGoods=\"changeGoods\"\n        ></marketing-setting>\n\n        <!-- 其他设置-->\n        <other-setting\n          v-show=\"headTab.length === 7 ? currentTab === '7' : currentTab === '6'\"\n          :formValidate=\"formValidate\"\n          :customBtn.sync=\"customBtn\"\n          :paramsType=\"paramsType\"\n          :paramsTypeList=\"paramsTypeList\"\n          :protectionList=\"protectionList\"\n          :CustomList=\"CustomList\"\n          @modalPicTap=\"modalPicTap\"\n          @changeParamsType=\"changeParamsType\"\n          @deleteRow=\"deleteRow\"\n          @handleAddParams=\"handleAddParams\"\n          @addProtection=\"addProtection\"\n          @customMessBtn=\"customMessBtn\"\n          @delcustom=\"delcustom\"\n          @addcustom=\"addcustom\"\n        ></other-setting>\n\n        <el-form-item>\n          <el-button v-if=\"currentTab !== '1'\" v-db-click @click=\"upTab\">上一步</el-button>\n          <el-button\n            class=\"submission\"\n            v-if=\"currentTab !== '7' && formValidate.virtual_type == 0\"\n            v-db-click\n            @click=\"downTab\"\n            >下一步</el-button\n          >\n          <el-button\n            class=\"submission\"\n            v-if=\"currentTab !== '6' && formValidate.virtual_type != 0\"\n            v-db-click\n            @click=\"downTab\"\n            >下一步</el-button\n          >\n          <el-button\n            type=\"primary\"\n            class=\"submission\"\n            v-db-click\n            @click=\"handleSubmit('formValidate')\"\n            v-if=\"$route.params.id || currentTab !== '1'\"\n            >保存</el-button\n          >\n        </el-form-item>\n      </el-form>\n      <el-dialog :visible.sync=\"modalPic\" width=\"950px\" scrollable title=\"上传商品图\" :close-on-click-modal=\"false\">\n        <uploadPictures\n          :isChoice=\"isChoice\"\n          @getPic=\"getPic\"\n          @getPicD=\"getPicD\"\n          :gridBtn=\"gridBtn\"\n          :gridPic=\"gridPic\"\n          v-if=\"modalPic\"\n        ></uploadPictures>\n      </el-dialog>\n      <el-dialog\n        :visible.sync=\"addVirtualModel\"\n        width=\"720px\"\n        title=\"添加卡密\"\n        :show-close=\"true\"\n        :close-on-click-modal=\"false\"\n        @closed=\"initVirtualData\"\n      >\n        <div class=\"trip\"></div>\n        <div class=\"type-radio\">\n          <el-form label-width=\"85px\">\n            <el-form-item label=\"卡密类型：\">\n              <el-radio-group v-model=\"disk_type\" size=\"large\">\n                <el-radio :label=\"1\">固定卡密</el-radio>\n                <el-radio :label=\"2\">一次性卡密</el-radio>\n              </el-radio-group>\n              <div v-if=\"disk_type == 1\">\n                <div class=\"stock-disk\">\n                  <el-input v-model=\"disk_info\" size=\"large\" type=\"textarea\" :rows=\"4\" placeholder=\"填写卡密信息\" />\n                </div>\n                <div class=\"stock-input\">\n                  <!-- <el-input type=\"number\" v-model=\"stock\" size=\"large\" :min='0' placeholder=\"填写库存数量\">\n                    <span slot=\"append\">件</span>\n                  </el-input> -->\n                  <el-input-number :controls=\"false\" :max=\"100000\" :min=\"1\" :step=\"1\" :precision=\"0\" v-model=\"stock\" />\n                  <span class=\"pl10\">件</span>\n                </div>\n              </div>\n              <div class=\"scroll-virtual\" v-if=\"disk_type == 2\">\n                <div class=\"virtual-data mb10\" v-for=\"(item, index) in virtualList\" :key=\"index\">\n                  <span class=\"mr10 virtual-title\">卡号{{ index + 1 }}：</span>\n                  <el-input\n                    class=\"mr10\"\n                    type=\"text\"\n                    v-model.trim=\"item.key\"\n                    style=\"width: 150px\"\n                    placeholder=\"请输入卡号(非必填)\"\n                  ></el-input>\n                  <span class=\"mr10 virtual-title\">卡密{{ index + 1 }}：</span>\n                  <el-input\n                    class=\"mr10\"\n                    type=\"text\"\n                    v-model.trim=\"item.value\"\n                    style=\"width: 150px\"\n                    placeholder=\"请输入卡密\"\n                  ></el-input>\n                  <span class=\"deteal-btn\" v-db-click @click=\"removeVirtual(index)\">删除</span>\n                </div>\n              </div>\n              <div class=\"add-more\" v-if=\"disk_type == 2\">\n                <el-button class=\"h-33\" type=\"primary\" v-db-click @click=\"handleAdd\">新增</el-button>\n                <el-upload\n                  class=\"ml10\"\n                  :action=\"cardUrl\"\n                  :data=\"uploadData\"\n                  :headers=\"header\"\n                  :on-success=\"upFile\"\n                  :before-upload=\"beforeUpload\"\n                >\n                  <el-button>导入卡密</el-button>\n                </el-upload>\n              </div>\n            </el-form-item>\n          </el-form>\n        </div>\n        <span slot=\"footer\" class=\"dialog-footer\">\n          <el-button v-db-click @click=\"closeVirtual\">取 消</el-button>\n          <el-button type=\"primary\" v-db-click @click=\"upVirtual\">确 定</el-button>\n        </span>\n      </el-dialog>\n    </el-card>\n    <freightTemplate\n      :template=\"template\"\n      v-on:changeTemplate=\"changeTemplate\"\n      @addSuccess=\"productGetTemplate\"\n      ref=\"templates\"\n    ></freightTemplate>\n    <add-attr ref=\"addattr\" @getList=\"userSearchs\"></add-attr>\n    <coupon-list\n      ref=\"couponTemplates\"\n      @nameId=\"nameId\"\n      :couponids=\"formValidate.coupon_ids\"\n      :updateIds=\"updateIds\"\n      :updateName=\"updateName\"\n    ></coupon-list>\n    <coupon-list ref=\"goodsCoupon\" many=\"one\" :luckDraw=\"true\" @getCouponId=\"goodsCouponId\"></coupon-list>\n    <!-- 生成淘宝京东表单-->\n    <el-dialog\n      :visible.sync=\"modals\"\n      @closed=\"cancel\"\n      class=\"Box\"\n      title=\"复制淘宝、天猫、京东、苏宁、1688\"\n      :close-on-click-modal=\"false\"\n      width=\"720px\"\n    >\n      <tao-bao ref=\"taobaos\" v-if=\"modals\" @on-close=\"onClose\"></tao-bao>\n    </el-dialog>\n    <el-dialog :visible.sync=\"goods_modals\" title=\"商品列表\" footerHide class=\"paymentFooter\" scrollable width=\"1000px\">\n      <goods-list v-if=\"goods_modals\" ref=\"goodslist\" :ischeckbox=\"true\" @getProductId=\"getProductId\"></goods-list>\n    </el-dialog>\n    <!-- 用户标签 -->\n    <el-dialog\n      :visible.sync=\"labelShow\"\n      title=\"请选择用户标签\"\n      :show-close=\"true\"\n      width=\"540px\"\n      :close-on-click-modal=\"false\"\n    >\n      <userLabel ref=\"userLabel\" @activeData=\"activeData\" @close=\"labelClose\"></userLabel>\n    </el-dialog>\n    <!-- 商品标签 -->\n    <el-dialog\n      :visible.sync=\"tagShow\"\n      title=\"请选择商品标签\"\n      :show-close=\"true\"\n      width=\"540px\"\n      :close-on-click-modal=\"false\"\n    >\n      <goodsLabel\n        ref=\"goodsLabel\"\n        :defaultLabelList=\"labelList\"\n        @activeLabel=\"activeLabel\"\n        @close=\"labelClose\"\n      ></goodsLabel>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport userLabel from '@/components/labelList';\nimport useLabel from '@/components/goodsLabel/useLabel';\nimport goodsLabel from '@/components/goodsLabel';\nimport { mapState } from 'vuex';\nimport uploadPictures from '@/components/uploadPictures';\nimport freightTemplate from '@/components/freightTemplate';\nimport couponList from '@/components/couponList';\nimport addAttr from '../productAttr/addAttr';\nimport goodsList from '@/components/goodsList/index';\nimport taoBao from './taoBao';\nimport { userLabelAddApi } from '@/api/user';\nimport {\n  productInfoApi,\n  cascaderListApi,\n  productAddApi,\n  generateAttrApi,\n  productGetRuleApi,\n  productGetTemplateApi,\n  productGetTempKeysApi,\n  checkActivityApi,\n  productCache,\n  cacheDelete,\n  uploadType,\n  importCard,\n  productCreateApi,\n  getProductTypeConfig,\n  ruleAddApi,\n  paramListApi,\n  paramInfoApi,\n  productProtectionListApi,\n  productLabelUseListApi,\n} from '@/api/product';\nimport Setting from '@/setting';\nimport { getCookies } from '@/libs/util';\nimport { uploadByPieces } from '@/utils/upload'; //引入uploadByPieces方法\nimport { isFileUpload, isVideoUpload, arraysEqual } from '@/utils';\nimport checkArray from '@/libs/permission';\nimport {\n  GoodsTableHead,\n  VirtualTableHead,\n  VirtualTableHead2,\n  columns2,\n  columns3,\n  CustomList,\n  RuleValidate,\n} from './defaultData.js';\nimport BasicInfo from './components/BasicInfo.vue';\nimport SpecStock from './components/SpecStock.vue';\nimport ProductDetail from './components/ProductDetail.vue';\nimport LogisticsSetting from './components/LogisticsSetting.vue';\nimport PriceCommission from './components/PriceCommission.vue';\nimport MarketingSetting from './components/MarketingSetting.vue';\nimport OtherSetting from './components/OtherSetting.vue';\nimport { formatRichText } from '@/utils/editorImg';\n\nexport default {\n  name: 'ProductAdd',\n  components: {\n    uploadPictures,\n    freightTemplate,\n    addAttr,\n    couponList,\n    taoBao,\n    goodsList,\n    userLabel,\n    goodsLabel,\n    useLabel,\n    BasicInfo,\n    SpecStock,\n    ProductDetail,\n    LogisticsSetting,\n    PriceCommission,\n    MarketingSetting,\n    OtherSetting,\n  },\n  data() {\n    return {\n      labelShow: false,\n      tagShow: false,\n      dataLabel: [],\n      headTab: [\n        { tit: '基础信息', name: '1' },\n        { tit: '规格库存', name: '2' },\n        { tit: '商品详情', name: '3' },\n        { tit: '物流设置', name: '4' },\n        { tit: '会员价/佣金', name: '5' },\n        { tit: '营销设置', name: '6' },\n        { tit: '其他设置', name: '7' },\n      ],\n      virtual: [\n        { tit: '普通商品', id: 0, tit2: '物流发货' },\n        { tit: '卡密/网盘', id: 1, tit2: '自动发货' },\n        { tit: '优惠券', id: 2, tit2: '自动发货' },\n        { tit: '虚拟商品', id: 3, tit2: '虚拟发货' },\n      ],\n      seletVideo: 0, //选择视频类型\n      customBtn: 0, //自定义留言开关\n      content: '',\n      contents: '',\n      fileUrl: Setting.apiBaseURL + '/file/upload',\n      fileUrl2: Setting.apiBaseURL + '/file/video_upload',\n      cardUrl: Setting.apiBaseURL + '/file/upload/1',\n      upload_type: '', //视频上传类型 1 本地上传 2 3 4 OSS上传\n      uploadData: {}, // 上传参数\n      header: {},\n      type: 0,\n      modals: false,\n      goods_modals: false,\n      spinShow: false,\n      openSubimit: false,\n      virtualList: [\n        {\n          key: '',\n          value: '',\n        },\n      ],\n      // 批量设置表格data\n      oneFormBatch: [\n        {\n          pic: '',\n          price: void 0,\n          cost: void 0,\n          ot_price: void 0,\n          stock: void 0,\n          bar_code: '',\n          bar_code_number: '',\n          weight: void 0,\n          volume: void 0,\n          virtual_list: [],\n        },\n      ],\n\n      // 规格数据\n      formDynamic: {\n        attrsName: '',\n        attrsVal: '',\n      },\n      disk_type: 1, //卡密类型\n      tabIndex: 0,\n      tabName: '',\n      formDynamicNameData: [],\n      isBtn: false,\n      columns2: columns2,\n      columns3: columns3,\n      columns: [],\n      columnsInstall: [],\n      columnsInstal2: [],\n      gridPic: {\n        xl: 6,\n        lg: 8,\n        md: 12,\n        sm: 12,\n        xs: 12,\n      },\n      gridBtn: {\n        xl: 4,\n        lg: 8,\n        md: 8,\n        sm: 8,\n        xs: 8,\n      },\n      //自定义留言下拉选择\n      CustomList: CustomList,\n      //自定义留言内容\n      currentIndex: 0,\n\n      formValidate: {\n        disk_info: '', //卡密类型\n        logistics: ['1'], //选择物流方式\n        freight: 2, //运费设置\n        postage: 0, //设置运费金额\n        recommend: [], //商品推荐\n        presale_day: 1, //预售发货时间-结束\n        presale: false, //预售商品开关\n        is_limit: false,\n        limit_type: 0,\n        limit_num: 0,\n        vip_product: false, //付费会员专属开关\n        custom_form: [], //自定义留言\n        store_name: '',\n        cate_id: [],\n        label_id: [],\n        keyword: '',\n        unit_name: '',\n        store_info: '',\n        image: '',\n        recommend_image: '',\n        slider_image: [],\n        description: '',\n        ficti: 0,\n        give_integral: 0,\n        sort: 0,\n        is_show: 1,\n        is_gift: 0, // 开启送礼品\n        gift_price: 0,\n        is_hot: 0,\n        is_benefit: 0,\n        is_best: 0,\n        is_new: 0,\n        is_good: 0,\n        is_postage: 0,\n        is_sub: [],\n        recommend_list: [],\n        params_list: [], //商品参数\n        virtual_type: 0,\n        // is_sub: 0,\n        id: 0,\n        spec_type: 0,\n        is_virtual: 0,\n        video_link: '',\n        // postage: 0,\n        temp_id: '',\n        attrs: [],\n        items: [\n          {\n            pic: '',\n            price: 0,\n            cost: 0,\n            ot_price: 0,\n            stock: 0,\n            bar_code: '',\n            bar_code_number: '',\n          },\n        ],\n        activity: ['默认', '秒杀', '砍价', '拼团'],\n        couponName: [],\n        header: [],\n        selectRule: '',\n        coupon_ids: [],\n        command_word: '',\n        min_qty: 1,\n        label_list: [],\n        protection_list: [],\n      },\n      ruleList: [],\n      templateList: [],\n      createBnt: true,\n      showIput: false,\n      manyFormValidate: [],\n      // 单规格表格data\n      oneFormValidate: [\n        {\n          pic: '',\n          price: 0,\n          cost: 0,\n          ot_price: 0,\n          stock: 0,\n          bar_code: '',\n          bar_code_number: '',\n          weight: 0,\n          volume: 0,\n          brokerage: 0,\n          brokerage_two: 0,\n          vip_price: 0,\n          virtual_list: [],\n          coupon_id: 0,\n        },\n      ],\n      images: [],\n      imagesTable: '',\n      currentTab: '1',\n      isChoice: '',\n      loading: false,\n      modalPic: false,\n      addVirtualModel: false,\n      template: false,\n      uploadList: [],\n      treeSelect: [],\n      picTit: '',\n      tableIndex: 0,\n      ruleValidate: RuleValidate,\n      manyBrokerage: undefined,\n      manyBrokerageTwo: undefined,\n      manyVipPrice: undefined,\n      manyVipDiscount: undefined,\n      upload: {\n        videoIng: false, // 是否显示进度条；\n      },\n      videoIng: false, // 是否显示进度条；\n      progress: 0, // 进度条默认0\n      stock: 0,\n      disk_info: '',\n      videoLink: '',\n      attrs: [],\n      activity: { 默认: 'red', 秒杀: 'blue', 砍价: 'green', 拼团: 'yellow' },\n      couponName: [],\n      updateIds: [],\n      updateName: [],\n      couponIds: '',\n      couponNames: [],\n      rakeBack: [\n        {\n          title: '一级返佣(元)',\n          slot: 'brokerage',\n          align: 'center',\n          width: 95,\n        },\n        {\n          title: '二级返佣(元)',\n          slot: 'brokerage_two',\n          align: 'center',\n          width: 95,\n        },\n      ],\n      member: [\n        {\n          title: '会员价',\n          slot: 'vip_price',\n          align: 'center',\n          width: 95,\n        },\n        {\n          title: '会员折扣',\n          slot: 'vip_proportion',\n          align: 'center',\n          width: 95,\n        },\n      ],\n      columnsInstalM: [],\n      moveIndex: '',\n      addValue: '',\n      visible: false,\n      typeConfig: [],\n      goodsType: [],\n      paramsTypeList: [],\n      paramsType: null,\n      canSel: true, // 规格图片添加判断\n      changeAttrValue: '', //修改的规格值\n      tableKey: 0,\n      protectionList: [], // 服务保障\n      labelList: [],\n      tileLabelList: [],\n    };\n  },\n  computed: {\n    ...mapState('media', ['isMobile']),\n    labelWidth() {\n      return this.isMobile ? undefined : '120px';\n    },\n    labelPosition() {\n      return this.isMobile ? 'top' : 'right';\n    },\n    labelBottom() {\n      return this.isMobile ? undefined : '15px';\n    },\n  },\n  watch: {\n    typeConfig(val) {\n      if (val.length) {\n        // 对virtual中的id等于val中的id的\n        this.goodsType = this.virtual.filter((item) => {\n          return val.includes(item.id + '');\n        });\n      } else {\n        this.goodsType = this.virtual;\n      }\n    },\n  },\n  beforeRouteUpdate(to, from, next) {\n    this.bus.$emit('onTagsViewRefreshRouterView', this.$route.path);\n    next();\n  },\n  created() {\n    this.columns = this.columns2.slice(0, 8);\n    this.getToken();\n  },\n  async mounted() {\n    if (this.$route.params.id !== '0' && this.$route.params.id) {\n      await this.getInfo();\n    } else if (this.$route.params.id === '0') {\n      this.getProductCache();\n    } else {\n      this.getproductLabelUseListApi();\n    }\n    if (this.$route.query.type) {\n      this.modals = true;\n      this.type = this.$route.query.type;\n    } else {\n      this.type = 0;\n    }\n    this.goodsCategory();\n    this.productGetRule();\n    this.productGetTemplate();\n    this.paramsGetTemplate();\n    this.uploadType();\n    this.productConfig();\n    this.watchActivity();\n    this.getProtectionList();\n  },\n  methods: {\n    getProductCache() {\n      productCache()\n        .then((res) => {\n          let data = res.data.info;\n          this.getproductLabelUseListApi();\n\n          if (!Array.isArray(data)) {\n            let cate_id = data.cate_id.map(Number);\n            let label_id = data.label_id.map(Number);\n            this.attrs = data.items || [];\n            let ids = [];\n            if (data.coupons) {\n              data.coupons.map((item) => {\n                ids.push(item.id);\n              });\n              this.couponName = data.coupons;\n            }\n\n            this.formValidate = data;\n            this.dataLabel = data.label_id;\n            this.formValidate.coupon_ids = ids;\n            this.updateIds = ids;\n            this.updateName = data.coupons;\n            this.formValidate.cate_id = cate_id;\n            this.oneFormValidate = data.attrs;\n            this.generateHeader(this.attrs);\n            this.formValidate.logistics = data.logistics || ['1'];\n            this.formValidate.header = [];\n            this.manyFormValidate = data.attrs;\n            this.spec_type = data.spec_type;\n            this.formValidate.is_virtual = data.is_virtual;\n            this.formValidate.custom_form = data.custom_form || [];\n            if (this.formValidate.custom_form.length != 0) {\n              this.customBtn = 1;\n            }\n            this.attrs.map((item) => {\n              if (item.add_pic) this.canSel = false;\n            });\n            this.virtualbtn(data.virtual_type, 1);\n            if (data.spec_type === 0) {\n              this.manyFormValidate = [];\n            } else {\n              this.createBnt = true;\n              this.oneFormValidate = [\n                {\n                  pic: data.image,\n                  price: 0,\n                  cost: 0,\n                  ot_price: 0,\n                  stock: 0,\n                  bar_code: '',\n                  bar_code_number: '',\n                  weight: 0,\n                  volume: 0,\n                  brokerage: 0,\n                  brokerage_two: 0,\n                  vip_price: 0,\n                  virtual_list: [],\n                  coupon_id: 0,\n                },\n              ];\n            }\n            this.watchActivity();\n            this.spinShow = false;\n          }\n        })\n        .catch((err) => {\n          this.$message.error(err.msg);\n        });\n    },\n    getProtectionList() {\n      productProtectionListApi({ page: 0, limit: 0, status: 1 }).then((res) => {\n        this.protectionList = res.data.list;\n      });\n    },\n    getproductLabelUseListApi() {\n      productLabelUseListApi().then((res) => {\n        // 合并数组中所有的list\n        this.tileLabelList = res.data.flatMap((item) => item.list);\n        let labelList = res.data;\n        if (this.formValidate.label_list.length) {\n          this.formValidate.label_list.map((el) => {\n            labelList.map((re) => {\n              re.list.map((label) => {\n                if (label.id === el) {\n                  label.active = true;\n                } else {\n                  label.active = false;\n                }\n              });\n            });\n          });\n        } else {\n          labelList.map((el) => {\n            el.list.map((label) => {\n              label.active = false;\n            });\n          });\n        }\n        this.labelList = labelList;\n      });\n    },\n    addProtection() {\n      this.$router.push({ path: this.$routeProStr + '/product/protection/list' });\n    },\n    productConfig() {\n      getProductTypeConfig().then((res) => {\n        this.typeConfig = res.data;\n      });\n    },\n    beforeUpload(file) {\n      return isFileUpload(file);\n    },\n    // 分片上传\n    videoSaveToUrl(file) {\n      if (isVideoUpload(file)) {\n        uploadByPieces({\n          file: file, // 视频实体\n          pieceSize: 3, // 分片大小\n          success: (data) => {\n            this.formValidate.video_link = data.file_path;\n            this.progress = 100;\n          },\n          error: (e) => {\n            this.$message.error(e.msg);\n          },\n          uploading: (chunk, allChunk) => {\n            this.videoIng = true;\n            let st = Math.floor((chunk / allChunk) * 100);\n            this.progress = st;\n          },\n        });\n      }\n      return false;\n    },\n    // 类型选择/填入内容判断\n    virtualbtn(index, type) {\n      if (type != 1) {\n        if (this.$route.params.id) return this.$message.error('编辑商品不支持切换商品类型');\n        this.formValidate.is_sub = [];\n        let id = this.$route.params.id;\n        if (id) {\n          checkActivityApi(id)\n            .then((res) => {})\n            .catch((res) => {\n              this.formValidate.spec_type = this.spec_type;\n              this.$message.error(res.msg);\n            });\n        } else {\n          if (this.formValidate.spec_type == 1) {\n            this.generate(1);\n          }\n        }\n      }\n      // 定义基础商品和虚拟商品的标签页配置\n      const baseHeadTabs = [\n        { tit: '基础信息', name: '1' },\n        { tit: '规格库存', name: '2' },\n        { tit: '商品详情', name: '3' },\n        { tit: '物流设置', name: '4' },\n        { tit: '会员价/佣金', name: '5' },\n        { tit: '营销设置', name: '6' },\n        { tit: '其他设置', name: '7' },\n      ];\n      const virtualHeadTabs = [\n        { tit: '基础信息', name: '1' },\n        { tit: '规格库存', name: '2' },\n        { tit: '商品详情', name: '3' },\n        { tit: '会员价/佣金', name: '4' },\n        { tit: '营销设置', name: '5' },\n        { tit: '其他设置', name: '6' },\n      ];\n\n      switch (index) {\n        case 0: // 普通商品\n          this.formValidate.virtual_type = 0;\n          this.formValidate.is_virtual = 0;\n          this.headTab = baseHeadTabs;\n          break;\n\n        case 1: // 卡密/网盘商品\n          this.formValidate.virtual_type = 1;\n          this.formValidate.postage = 0;\n          this.formValidate.is_virtual = 1;\n          this.headTab = virtualHeadTabs;\n          break;\n\n        case 2: // 优惠券商品\n          this.formValidate.virtual_type = 2;\n          this.formValidate.is_virtual = 1;\n          this.headTab = virtualHeadTabs;\n          break;\n\n        case 3: // 虚拟商品\n          this.formValidate.virtual_type = 3;\n          this.formValidate.is_virtual = 1;\n          this.headTab = virtualHeadTabs;\n          break;\n      }\n    },\n    // 新增分类\n    addCate() {\n      this.$modalForm(productCreateApi()).then(() => this.goodsCategory());\n    },\n    // 物流方式选择\n    logisticsBtn(e) {\n      this.formValidate.logistics = e;\n    },\n    // 新增标签\n    addLabel() {\n      this.$modalForm(userLabelAddApi(0)).then(() => this.userLabel());\n    },\n    // 选择标签\n    addGoodsTag() {\n      this.tagShow = true;\n    },\n    // 自定义留言 开启关闭\n    customMessBtn(e) {\n      if (!e) {\n        this.formValidate.custom_form = [];\n      }\n      this.customBtn = e;\n    },\n    // 自定义留言 新增表单\n    addcustom() {\n      if (this.formValidate.custom_form.length > 9) {\n        this.$message.warning('最多添加10条');\n      } else {\n        this.formValidate.custom_form.push({\n          title: '',\n          label: 'text',\n          value: '',\n          status: false,\n        });\n      }\n    },\n    // 删除\n    delcustom(index) {\n      this.formValidate.custom_form.splice(index, 1);\n    },\n    // 预售具体日期\n    onchangeTime(e) {\n      this.formValidate.presale_time = e;\n    },\n    // 商品详情\n    getEditorContent(data) {\n      this.content = data;\n    },\n    cancel() {\n      this.modals = false;\n    },\n    // 上传头部token\n    getToken() {\n      this.header['Authori-zation'] = 'Bearer ' + getCookies('token');\n    },\n    // 导入卡密\n    upFile(res) {\n      importCard({ file: res.data.src }).then((res) => {\n        this.virtualList = this.virtualList.concat(res.data);\n      });\n    },\n    //获取视频上传类型\n    uploadType() {\n      uploadType().then((res) => {\n        this.upload_type = res.data.upload_type;\n      });\n    },\n    // 初始化数据展示\n    infoData(data, isCopy) {\n      let cate_id = data.cate_id.map(Number);\n      let label_id = data.label_id.map(Number);\n      this.attrs = data.items || [];\n      let ids = [];\n      data.coupons.map((item) => {\n        ids.push(item.id);\n      });\n      this.formValidate = data;\n      this.seletVideo = data.seletVideo;\n      this.contents = data.description;\n      this.couponName = data.coupons;\n      this.formValidate.coupon_ids = ids;\n      this.updateIds = ids;\n      this.dataLabel = data.label_id;\n      this.updateName = data.coupons;\n      this.virtualbtn(data.virtual_type, 1);\n      this.formValidate.logistics = data.logistics || ['1'];\n      this.formValidate.custom_form = data.custom_form || [];\n      if (this.formValidate.custom_form.length != 0) {\n        this.customBtn = 1;\n      }\n      this.formValidate.cate_id = cate_id;\n      if (data.attr) {\n        this.oneFormValidate = [data.attr];\n        this.oneFormValidate[0].vip_proportion = (\n          (this.oneFormValidate[0].vip_price / this.oneFormValidate[0].price) *\n          100\n        ).toFixed(2);\n      }\n      this.getproductLabelUseListApi();\n\n      this.formValidate.header = [];\n      this.spec_type = data.spec_type;\n      this.formValidate.spec_type = this.spec_type;\n      this.formValidate.is_virtual = data.is_virtual;\n      this.attrs.map((item) => {\n        if (item.add_pic) this.canSel = false;\n      });\n      if (data.spec_type === 0) {\n        this.manyFormValidate = [];\n      } else {\n        this.createBnt = true;\n        this.oneFormValidate = [\n          {\n            pic: '',\n            price: 0,\n            cost: 0,\n            ot_price: 0,\n            stock: 0,\n            bar_code: '',\n            bar_code_number: '',\n            weight: 0,\n            volume: 0,\n            brokerage: 0,\n            brokerage_two: 0,\n            vip_price: 0,\n            virtual_list: [],\n            coupon_id: 0,\n          },\n        ];\n\n        this.generateHeader(this.attrs);\n        this.manyFormValidate = [...this.oneFormBatch, ...data.attrs];\n      }\n\n      setTimeout((e) => {\n        this.checkAllGroup(data.is_sub);\n      }, 1000);\n      this.watchActivity();\n    },\n    //关闭淘宝弹窗并生成数据；\n    onClose(data) {\n      this.modals = false;\n      this.infoData(data, 1);\n    },\n\n    checkMove(evt) {\n      this.moveIndex = evt.draggedContext.index;\n    },\n    end() {\n      this.moveIndex = '';\n      this.generate(1);\n    },\n    // 单独设置会员设置\n    checkAllGroupChange(data) {\n      this.checkAllGroup(data);\n    },\n    checkAllGroup(data) {\n      let endLength = this.attrs.length + 3;\n      if (this.formValidate.spec_type === 0) {\n        if (data.length === 2) {\n          this.columnsInstall = this.columns2.slice(0, endLength).concat(this.rakeBack).concat(this.member);\n        } else if (data.indexOf(0) > -1) {\n          this.columnsInstall = this.columns2.slice(0, endLength).concat(this.member);\n        } else if (data.indexOf(1) > -1) {\n          this.columnsInstall = this.columns2.slice(0, endLength).concat(this.rakeBack);\n        } else {\n          this.columnsInstall = this.columns2.slice(0, endLength);\n        }\n      } else {\n        if (data.length === 2) {\n          this.columnsInstal2 = this.columnsInstalM\n            .slice(0, endLength + 1)\n            .concat(this.rakeBack)\n            .concat(this.member);\n        } else if (data.indexOf(0) > -1) {\n          this.columnsInstal2 = this.columnsInstalM.slice(0, endLength).concat(this.member);\n        } else if (data.indexOf(1) > -1) {\n          this.columnsInstal2 = this.columnsInstalM.slice(0, endLength).concat(this.rakeBack);\n        } else {\n          this.columnsInstal2 = this.columnsInstalM.slice(0, endLength);\n        }\n      }\n    },\n    // 添加优惠券\n    addCoupon() {\n      this.$refs.couponTemplates.isTemplate = true;\n      this.$refs.couponTemplates.tableList();\n    },\n    // 规格中优惠券查看\n    see(data, name, index) {\n      this.tabName = name;\n      this.tabIndex = index;\n\n      if (this.formValidate.virtual_type === 1) {\n        if (data.disk_info != '') {\n          this.disk_type = 1;\n          this.disk_info = data.disk_info;\n          this.stock = data.stock;\n        } else if (data.virtual_list.length) {\n          this.disk_type = 2;\n          this.virtualList = data.virtual_list;\n        }\n        this.addVirtualModel = true;\n      } else {\n        this.$refs.goodsCoupon.isTemplate = true;\n        this.$refs.goodsCoupon.tableList(3);\n      }\n    },\n    // 修改分佣比例\n    changeDiscount(index, type = 'manyFormValidate') {\n      // 根据分佣比例 vip_proportion 修改会员价 保留2位小数\n      this[type][index].vip_price = (this[type][index].price * (this[type][index].vip_proportion / 100)).toFixed(2);\n    },\n    // 修改会员价\n    changeVipPrice(index, type = 'manyFormValidate') {\n      // 根据会员价计算出分佣比例\n      this[type][index].vip_proportion = ((this[type][index].vip_price / this[type][index].price) * 100).toFixed(2);\n    },\n    // 添加优惠券\n    addGoodsCoupon(index, name) {\n      this.tabIndex = index;\n      this.tabName = name;\n      this.$refs.goodsCoupon.isTemplate = true;\n      this.$refs.goodsCoupon.tableList(3);\n    },\n    addVirtual(index, name) {\n      this.tabIndex = index;\n      this.tabName = name;\n      this.addVirtualModel = true;\n    },\n    // 提交卡密信息\n    upVirtual() {\n      if (this.disk_type == 2) {\n        for (let i = 0; i < this.virtualList.length; i++) {\n          const element = this.virtualList[i];\n          if (!element.value) {\n            this.$message.error('请输入所有卡密');\n            return;\n          }\n        }\n        this.$set(this[this.tabName][this.tabIndex], 'virtual_list', this.virtualList);\n        this.$set(this[this.tabName][this.tabIndex], 'stock', this.virtualList.length);\n        this.virtualList = [\n          {\n            key: '',\n            value: '',\n          },\n        ];\n        this.$set(this[this.tabName][this.tabIndex], 'disk_info', '');\n      } else {\n        if (!this.disk_info.length) {\n          return this.$message.error('请填写卡密信息');\n        }\n        if (!this.stock) {\n          return this.$message.error('请填写库存数量');\n        }\n        this.$set(this[this.tabName][this.tabIndex], 'stock', Number(this.stock));\n        this.$set(this[this.tabName][this.tabIndex], 'stock', Number(this.stock));\n        this.$set(this[this.tabName][this.tabIndex], 'disk_info', this.disk_info);\n        this.$set(this[this.tabName][this.tabIndex], 'virtual_list', []);\n      }\n      this.addVirtualModel = false;\n      this.closeVirtual();\n    },\n    //  初始化卡密数据信息\n    closeVirtual() {\n      this.addVirtualModel = false;\n      this.virtualList = [\n        {\n          key: '',\n          value: '',\n        },\n      ];\n      this.disk_info = '';\n      this.stock = 0;\n    },\n    //对象数组去重；\n    uniqueArray(arr) {\n      const seen = {};\n      return arr.filter((item) => {\n        const key = JSON.stringify(item); // 使用 JSON.stringify 生成唯一键\n        if (seen[key]) {\n          return false;\n        } else {\n          seen[key] = true;\n          return true;\n        }\n      });\n    },\n    // 获取优惠券id数据\n    nameId(id, names) {\n      this.formValidate.coupon_ids = id;\n      this.couponName = this.uniqueArray(names);\n    },\n    // 获取优惠券信息\n    goodsCouponId(data) {\n      this.$set(this[this.tabName][this.tabIndex], 'coupon_id', data.id);\n      this.$set(this[this.tabName][this.tabIndex], 'coupon_name', data.title);\n      this.$refs.goodsCoupon.isTemplate = false;\n    },\n    handleClose(name) {\n      let index = this.couponName.indexOf(name);\n      this.couponName.splice(index, 1);\n      let couponIds = this.formValidate.coupon_ids;\n      couponIds.splice(index, 1);\n      this.updateIds = couponIds;\n      this.updateName = this.couponName;\n    },\n    // 添加运费模板\n    addTemp() {\n      this.$refs.templates.isTemplate = true;\n    },\n    addVideo() {\n      this.$videoModal((e) => {\n        this.formValidate.video_link = e;\n      });\n    },\n    // 删除视频；\n    delVideo() {\n      this.$set(this.formValidate, 'video_link', '');\n      this.$set(this, 'progress', 0);\n      this.videoIng = false;\n      this.upload.videoIng = false;\n    },\n    zh_uploadFile() {\n      if (this.seletVideo == 1) {\n        this.formValidate.video_link = this.videoLink;\n      } else {\n        this.$refs.refid.click();\n      }\n    },\n    // 上传视频\n    zh_uploadFile_change(evfile) {\n      let suffix = evfile.target.files[0].name.substr(evfile.target.files[0].name.indexOf('.'));\n      if (suffix.indexOf('.mp4') === -1) {\n        return this.$message.error('只能上传MP4文件');\n      }\n      let types = {\n        key: evfile.target.files[0].name,\n        contentType: evfile.target.files[0].type,\n      };\n      productGetTempKeysApi(types)\n        .then((res) => {\n          this.$videoCloud\n            .videoUpload({\n              type: res.data.type,\n              evfile: evfile,\n              res: res,\n              uploading(status, progress) {\n                this.upload.videoIng = status;\n                if (res.status == 200) {\n                  this.progress = 100;\n                }\n              },\n            })\n            .then((res) => {\n              this.formValidate.video_link = res.url;\n              this.$message.success('视频上传成功');\n              this.upload.videoIng = false;\n            })\n            .catch((res) => {\n              this.$message.error(res);\n            });\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    // 上一页；\n    upTab() {\n      this.currentTab = (Number(this.currentTab) - 1).toString();\n    },\n    // 下一页；\n    downTab() {\n      this.currentTab = (Number(this.currentTab) + 1).toString();\n    },\n    // 属性弹窗回调函数；\n    userSearchs() {\n      this.productGetRule();\n    },\n    // 添加规则；\n    addRule() {\n      this.$refs.addattr.modal = true;\n    },\n    // 批量设置分佣；\n    brokerageSetUp() {\n      if (this.formValidate.is_sub.indexOf(1) > -1) {\n        if (this.manyBrokerage <= 0 || this.manyBrokerageTwo <= 0) {\n          return this.$message.error('请填写返佣金额后进行批量添加');\n        }\n      } else if (this.formValidate.is_sub.indexOf(0) > -1) {\n        if (this.manyVipPrice <= 0) {\n          return this.$message.error('请填写会员价后进行批量添加');\n        }\n      }\n      if (this.formValidate.is_sub.length === 2) {\n        if (this.manyBrokerage <= 0 || this.manyBrokerageTwo <= 0) {\n          return this.$message.error('请填写完金额后进行批量添加');\n        }\n        if (this.manyVipPrice > 0 && this.manyVipDiscount > 0) {\n          return this.$message.error('会员价和会员折扣只能二选一添加');\n        }\n      }\n      for (let val of this.manyFormValidate) {\n        this.manyBrokerage != undefined && this.$set(val, 'brokerage', this.manyBrokerage);\n        this.manyBrokerageTwo != undefined && this.$set(val, 'brokerage_two', this.manyBrokerageTwo);\n        if (this.manyVipPrice != undefined) {\n          this.$set(val, 'vip_price', this.manyVipPrice);\n          this.$set(val, 'vip_proportion', ((val.vip_price / val.price) * 100).toFixed(2));\n        } else {\n          this.$set(val, 'vip_proportion', this.manyVipDiscount);\n          this.$set(val, 'vip_price', (val.price * (this.manyVipDiscount / 100)).toFixed(2));\n        }\n      }\n    },\n    // 批量设置会员价\n    vipPriceSetUp() {\n      if (this.manyVipPrice <= 0) {\n        return this.$message.error('请填写会员价在进行批量添加');\n      } else {\n        for (let val of this.manyFormValidate) {\n          this.$set(val, 'vip_price', this.manyVipPrice);\n        }\n      }\n    },\n    // 新增卡密\n    handleAdd() {\n      this.virtualList.push({\n        key: '',\n        value: '',\n      });\n    },\n    // 初始化卡密信息\n    initVirtualData(status) {\n      this.virtualList = [\n        {\n          key: '',\n          value: '',\n        },\n      ];\n    },\n    removeVirtual(index) {\n      this.virtualList.splice(index, 1);\n    },\n    // 清空批量规格信息\n    batchDel() {\n      this.oneFormBatch = [\n        {\n          pic: '',\n          price: void 0,\n          cost: void 0,\n          ot_price: void 0,\n          stock: void 0,\n          bar_code: '',\n          bar_code_number: '',\n          weight: void 0,\n          volume: void 0,\n          virtual_list: [],\n        },\n      ];\n    },\n    confirm(name) {\n      this.createBnt = true;\n      this.formValidate.selectRule = name;\n      this.attrs = [];\n      if (this.formValidate.selectRule.trim().length <= 0) {\n        return this.$message.error('请选择属性');\n      }\n      this.ruleList.forEach((item, index) => {\n        if (item.rule_name === this.formValidate.selectRule) {\n          this.attrs = [...item.rule_value];\n        }\n      });\n      this.canSel = true;\n      this.generateAttr(this.attrs);\n    },\n    // 选择规格模板\n    handleCommand(e) {},\n    // 获取商品属性模板；\n    productGetRule() {\n      productGetRuleApi().then((res) => {\n        this.ruleList = res.data;\n      });\n    },\n    // 获取运费模板；\n    productGetTemplate() {\n      productGetTemplateApi().then((res) => {\n        this.templateList = res.data;\n      });\n    },\n    paramsGetTemplate() {\n      paramListApi().then((res) => {\n        this.paramsTypeList = res.data.list;\n      });\n    },\n    changeParamsType(e) {\n      e ? this.getParams(e) : (this.formValidate.params_list = []);\n    },\n    getParams(id) {\n      paramInfoApi(id).then((res) => {\n        this.formValidate.params_list = res.data.value;\n      });\n    },\n    isSubset(arr1, arr2) {\n      // 将数组转换为 Set，以便进行高效的包含检查\n      const set1 = new Set(arr1);\n      const set2 = new Set(arr2);\n\n      // 检查 set2 中的每个元素是否都在 set1 中\n      for (let elem of set2) {\n        if (!set1.has(elem)) {\n          return false;\n        }\n      }\n      return true;\n    },\n    // 批量添加\n    batchAdd() {\n      let arr = [];\n      for (let val of this.attrs) {\n        if (this.oneFormBatch[0][val.value]) {\n          arr.push(this.oneFormBatch[0][val.value]);\n        }\n      }\n\n      // 批量设置商品规格属性\n      const batchFields = [\n        'pic',\n        'price',\n        'cost',\n        'ot_price',\n        'stock',\n        'weight',\n        'volume',\n        'bar_code',\n        'bar_code_number',\n      ];\n      // const defaultFields = ['bar_code', 'bar_code_number'];\n\n      for (let val of this.manyFormValidate) {\n        const batch = this.oneFormBatch[0];\n        // 如果存在筛选条件且满足条件,或无筛选条件时\n        if (!arr.length || this.isSubset(val.attr_arr, arr)) {\n          // 设置有值的批量字段\n          batchFields.forEach((field) => {\n            if (batch[field] && batch[field] !== undefined) {\n              if (field === 'pic' && batch[field]) {\n                this.$set(val, field, batch[field]);\n              } else if (field != 'pic') {\n                this.$set(val, field, batch[field]);\n              }\n            }\n          });\n\n          // 设置默认字段\n          // defaultFields.forEach((field) => {\n          //   this.$set(val, field, batch[field]);\n          // });\n        }\n      }\n    },\n    changeSpecImg(arr, img) {\n      // 判断是否存在规格图\n      let isHas = false;\n      for (let i = 1; i < this.manyFormValidate.length; i++) {\n        let item = this.manyFormValidate[i];\n        if (item.pic && this.isSubset(item.attr_arr, arr)) {\n          isHas = true;\n          break;\n        }\n      }\n      if (isHas) {\n        this.$confirm('可以同步修改下方该规格图片，确定要替换吗？', '提示', {\n          confirmButtonText: '替换',\n          cancelButtonText: '暂不',\n          type: 'warning',\n        })\n          .then(() => {\n            for (let val of this.manyFormValidate) {\n              if (this.isSubset(val.attr_arr, arr)) {\n                this.$set(val, 'pic', img);\n              }\n            }\n          })\n          .catch(() => {});\n      } else {\n        for (let val of this.manyFormValidate) {\n          if (this.isSubset(val.attr_arr, arr)) {\n            this.$set(val, 'pic', img);\n          }\n        }\n      }\n    },\n    // 立即生成\n    generate(type, isCopy, arr) {\n      this.manyFormValidate = [];\n      this.formValidate.header = [];\n    },\n    clearAttr() {\n      this.formDynamic.attrsName = '';\n      this.formDynamic.attrsVal = '';\n    },\n\n    // 删除规格\n    handleRemoveRole(index) {\n      this.attrs.splice(index, 1);\n      this.manyFormValidate.splice(index, 1);\n      if (!this.attrs.length) {\n        this.formValidate.header = [];\n        this.manyFormValidate = [];\n      } else {\n        this.generateAttr(this.attrs);\n      }\n    },\n    // 删除表格中 对应属性\n    delAttrTable(val) {\n      for (let i = 0; i < this.manyFormValidate.length; i++) {\n        let item = this.manyFormValidate[i];\n        if (item.attr_arr && item.attr_arr.includes(val)) {\n          this.manyFormValidate.splice(i, 1);\n          i--;\n        }\n      }\n    },\n    // 删除属性\n    handleRemove2(item, index, val) {\n      // 删除 manyFormValidate中 title = item.value 的属性值\n      item.splice(index, 1);\n      // this.generateAttr(this.attrs);\n      this.delAttrTable(val);\n    },\n    // 新增规格\n    handleAddRole() {\n      let data = {\n        value: this.formDynamic.attrsName,\n        add_pic: 0,\n        detail: [],\n      };\n      this.attrs.push(data);\n    },\n    handleAddParams() {\n      let data = {\n        name: '',\n        value: '',\n      };\n      this.formValidate.params_list.push(data);\n    },\n    handleSaveAsTemplate() {\n      this.$prompt('', '请输入模板名称', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n      })\n        .then(({ value }) => {\n          let spec = this.attrs.map((item) => {\n            return {\n              value: item.value,\n              detail: item.detail.map((e) => e.value),\n            };\n          });\n          let formDynamic = {\n            rule_name: value,\n            spec: spec,\n          };\n          ruleAddApi(formDynamic, 0)\n            .then((res) => {\n              this.$message.success(res.msg);\n              this.productGetRule();\n            })\n            .catch((res) => {\n              this.$message.error(res.msg);\n            });\n        })\n        .catch(() => {});\n    },\n    // 新增一条属性\n    addOneAttr(val, val2) {\n      this.generateAttr(this.attrs, val2);\n    },\n    handleFocus(val) {\n      this.changeAttrValue = val;\n    },\n    handleBlur() {\n      this.changeAttrValue = '';\n    },\n    handleSelImg(item) {\n      this.$imgModal((e) => {\n        item.pic = e.att_dir;\n        this.changeSpecImg([item.value], e.att_dir);\n      });\n    },\n    handleRemoveImg(item) {\n      item.pic = '';\n    },\n    // 规格名称改变\n    attrChangeValue(i, val) {\n      if (val.trim().length && this.attrs[i].detail.length) {\n        this.generateHeader(this.attrs);\n        if (this.manyFormValidate.length) {\n          this.manyFormValidate.map((item, i) => {\n            if (i > 0) {\n              if (Object.keys(item.detail).includes(this.changeAttrValue)) {\n                item.detail[val] = item.detail[this.changeAttrValue];\n                item[val] = item[this.changeAttrValue];\n                delete item.detail[this.changeAttrValue];\n                delete item[this.changeAttrValue];\n              }\n            }\n          });\n          this.changeAttrValue = val;\n        }\n      } else {\n        this.generateAttr(this.attrs);\n      }\n    },\n    // 规格值改变\n    attrDetailChangeValue(val, i) {\n      if (this.manyFormValidate.length) {\n        let key = this.attrs[i].value;\n        this.manyFormValidate.map((item, i) => {\n          if (i > 0) {\n            if (Object.keys(item.detail).includes(key) && item.detail[key] === this.changeAttrValue) {\n              item.detail[key] = val;\n              let index = item.attr_arr.findIndex((item) => item === this.changeAttrValue);\n              item.attr_arr[index] = val;\n            }\n          }\n        });\n        this.changeAttrValue = val;\n      } else {\n        this.generateAttr(this.attrs, 1);\n      }\n    },\n    // 规格图片添加开关\n    addPic(e, i) {\n      if (e) {\n        this.attrs.map((item, ii) => {\n          if (ii !== i) {\n            this.$set(item, 'add_pic', 0);\n          }\n        });\n        this.canSel = false;\n      } else {\n        this.canSel = true;\n      }\n    },\n    // 规格拖拽排序后\n    onMoveSpec() {\n      this.generateAttr(this.attrs);\n    },\n    changeCurrentIndex(i) {\n      this.currentIndex = i;\n    },\n    // 生成商品规格表头\n    generateHeader(data) {\n      let specificationsColumns = data.map((item) => ({\n        title: item.value,\n        key: item.value,\n        minWidth: 140,\n        fixed: 'left',\n      }));\n      let arr;\n      if ([1, 2].includes(Number(this.formValidate.virtual_type))) {\n        arr = [...specificationsColumns, ...VirtualTableHead];\n        // 找到slot 等于 fictitious 将title改为规格名称\n        this.formValidate.header.map((item) => {\n          if (item.slot === 'fictitious') {\n            item.title = this.formValidate.virtual_type == 1 ? '添加卡密/网盘' : '选择优惠券';\n          }\n        });\n      } else if (this.formValidate.virtual_type == 3) {\n        arr = [...specificationsColumns, ...VirtualTableHead2];\n      } else {\n        arr = [...specificationsColumns, ...GoodsTableHead];\n      }\n      this.$set(this.formValidate, 'header', arr);\n      this.tableKey += 1;\n      this.columnsInstalM = arr;\n    },\n    /*\n     * 生成属性\n     * @param {Array} data 规格数据\n     * */\n    generateAttr(data, val) {\n      this.generateHeader(data);\n      const combinations = this.generateCombinations(data);\n      console.log('规格组合总数：' + combinations.length);\n      const virtualType = this.formValidate.virtual_type;\n      // 如果combinations数量超过 500，则分批次生成属性\n      let rows = [];\n      if (combinations.length > 500) {\n        const batchSize = Math.ceil(combinations.length / 500);\n        for (let i = 0; i < combinations.length; i += batchSize) {\n          setTimeout((e) => {\n            let d = this.generateAttrBatch(data, combinations.slice(i, i + batchSize), val);\n            rows = [...rows, ...d];\n            this.manyFormValidate = [...this.oneFormBatch, ...rows];\n          }, 0);\n        }\n      } else {\n        rows = this.generateAttrBatch(data, combinations, val);\n        this.manyFormValidate = [...this.oneFormBatch, ...rows];\n      }\n    },\n    // 生成属性批次\n    generateAttrBatch(data, combinations, val) {\n      const existingItems = this.manyFormValidate.slice(1); // 排除第一项默认数据\n\n      const rows = combinations.map((combination) => {\n        const row = {\n          attr_arr: combination,\n          detail: {},\n          title: '',\n          key: '',\n          price: 0,\n          pic: '',\n          ot_price: 0,\n          cost: 0,\n          stock: 0,\n          is_show: 1,\n          is_default_select: 0,\n          unique: '',\n          weight: '',\n          volume: '',\n          brokerage: 0,\n          brokerage_two: 0,\n          vip_price: 0,\n          vip_proportion: 0,\n        };\n\n        // 设置虚拟类型相关属性\n        if (this.formValidate.virtual_type === 1) {\n          row.virtual_list = [];\n          row.disk_info = '';\n        } else if (this.formValidate.virtual_type === 2) {\n          row.coupon_id = 0;\n          row.coupon_name = '';\n        }\n\n        // 处理规格属性\n        data.forEach((item, i) => {\n          const value = combination[i];\n          row[item.value] = value;\n          row.title = item.value;\n          row.key = item.value;\n          row.detail[item.value] = value;\n\n          // 查找匹配的现有规格项\n          const matchedItem = existingItems.find((item) => item.attr_arr && arraysEqual(item.attr_arr, combination));\n\n          if (matchedItem) {\n            Object.assign(row, {\n              price: matchedItem.price,\n              cost: matchedItem.cost,\n              ot_price: matchedItem.ot_price,\n              stock: matchedItem.stock,\n              pic: matchedItem.pic,\n              unique: matchedItem.unique || '',\n              weight: matchedItem.weight || '',\n              volume: matchedItem.volume || '',\n              is_show: matchedItem.is_show || 1,\n              is_default_select: matchedItem.is_default_select || 0,\n              volume: matchedItem.volume || 0,\n              bar_code_number: matchedItem.bar_code_number || 0,\n              is_virtual: matchedItem.is_virtual,\n              brokerage: matchedItem.brokerage,\n              brokerage_two: matchedItem.brokerage_two,\n              vip_price: matchedItem.vip_price,\n              vip_proportion: matchedItem.vip_proportion,\n            });\n\n            if (this.formValidate.virtual_type === 1) {\n              row.virtual_list = matchedItem.virtual_list;\n              row.disk_info = matchedItem.disk_info;\n            } else if (this.formValidate.virtual_type === 2 && matchedItem.coupon_id) {\n              row.coupon_id = matchedItem.coupon_id;\n              row.coupon_name = matchedItem.coupon_name;\n            }\n          } else if (item.add_pic && combination.includes(val)) {\n            const picItem = item.detail.find((e) => combination.includes(e.value));\n            if (picItem) row.pic = picItem.pic;\n          }\n        });\n        return row;\n      });\n      return rows;\n    },\n    // 切换默认选中规格\n    changeDefaultSelect(e, index) {\n      // 一个开启 其他关闭\n      this.manyFormValidate.map((item, i) => {\n        if (i !== index) {\n          item.is_default_select = 0;\n        }\n      });\n      if (e) this.manyFormValidate[index].is_show = 1;\n    },\n    // 改变是否显示\n    changeDefaultShow(index) {\n      // 如果默认选中开启 则不可隐藏\n      if (this.manyFormValidate[index].is_default_select === 1) {\n        this.manyFormValidate[index].is_show = 1;\n        this.$message.error('默认规格不可隐藏');\n      }\n    },\n    // 生成规格组合\n    generateCombinations(arr, prefix = []) {\n      if (arr.length === 0) {\n        return [prefix];\n      }\n      const [first, ...rest] = arr;\n      return first.detail.flatMap((detail) => this.generateCombinations(rest, [...prefix, detail.value]));\n    },\n    // 添加属性\n    createAttr(num, idx) {\n      if (num) {\n        // 判断是否存在同样熟悉\n        var isExist = this.attrs[idx].detail.some((item) => item.value === num);\n        if (isExist) {\n          this.$message.error('规格值已存在');\n          return;\n        }\n        this.attrs[idx].detail.push({ value: num, pic: '' });\n        if (this.manyFormValidate.length) {\n          this.addOneAttr(this.attrs[idx].value, num);\n        } else {\n          this.generateAttr(this.attrs);\n        }\n\n        this.$refs.specStock.$refs['popoverRef_' + idx][0].doClose(); //关闭的\n        this.clearAttr();\n        setTimeout(() => {\n          if (this.$refs.specStock.$refs['popoverRef_' + idx]) {\n            //重点是以下两句\n            this.$refs.specStock.$refs['popoverRef_' + idx][0].doShow(); //打开的\n            //重点是以上两句\n          }\n        }, 20);\n      } else {\n        this.$refs.specStock.$refs['popoverRef_' + idx][0].doClose(); //关闭的\n      }\n    },\n    handleShowPop(index) {\n      this.$refs.specStock.$refs['inputRef_' + index][0].focus();\n    },\n    // 商品分类；\n    goodsCategory() {\n      cascaderListApi(1)\n        .then((res) => {\n          this.treeSelect = res.data;\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    // 改变规格\n    changeSpec() {\n      this.formValidate.is_sub = [];\n      let id = this.$route.params.id;\n      if (id) {\n        checkActivityApi(id)\n          .then((res) => {})\n          .catch((res) => {\n            this.formValidate.spec_type = this.spec_type;\n            this.$message.error(res.msg);\n          });\n      }\n    },\n    // 详情\n    getInfo() {\n      this.spinShow = true;\n      productInfoApi(this.$route.params.id)\n        .then(async (res) => {\n          let data = res.data.productInfo;\n          this.infoData(data);\n          this.spinShow = false;\n        })\n        .catch((res) => {\n          this.spinShow = false;\n          this.$message.error(res.msg);\n        });\n    },\n    handleRemove(i) {\n      this.images.splice(i, 1);\n      this.formValidate.slider_image.splice(i, 1);\n      this.oneFormValidate[0].pic = this.formValidate.slider_image[0];\n    },\n    // 关闭图片上传模态框\n    changeCancel(msg) {\n      this.modalPic = false;\n    },\n    // 点击商品图\n    modalPicTap(tit, picTit = '', index = 0) {\n      this.modalPic = true;\n      this.isChoice = tit === 'dan' ? '单选' : '多选';\n      this.picTit = picTit;\n      this.tableIndex = index;\n    },\n    // 获取单张图片信息\n    getPic(pc) {\n      switch (this.picTit) {\n        case 'danFrom':\n          this.formValidate.image = pc.att_dir;\n          if (!this.$route.params.id) {\n            if (this.formValidate.spec_type === 0) {\n              this.oneFormValidate[0].pic = pc.att_dir;\n            } else {\n              this.manyFormValidate.map((item) => {\n                item.pic = pc.att_dir;\n              });\n              this.oneFormBatch[0].pic = pc.att_dir;\n            }\n          }\n          break;\n        case 'danTable':\n          this.oneFormValidate[this.tableIndex].pic = pc.att_dir;\n          break;\n        case 'duopi':\n          this.oneFormBatch[this.tableIndex].pic = pc.att_dir;\n          break;\n        case 'recommend_image':\n          this.formValidate.recommend_image = pc.att_dir;\n          break;\n        default:\n          if (this.manyFormValidate.length) this.manyFormValidate[this.tableIndex].pic = pc.att_dir;\n      }\n      this.modalPic = false;\n    },\n    deleteRow(index) {\n      this.formValidate.params_list.splice(index, 1);\n    },\n    // 获取多张图信息\n    getPicD(pc) {\n      this.images = pc;\n      this.images.map((item) => {\n        this.formValidate.slider_image.push(item.att_dir);\n        this.formValidate.slider_image = this.formValidate.slider_image.splice(0, 10);\n      });\n      this.oneFormValidate[0].pic = this.formValidate.slider_image[0];\n      this.modalPic = false;\n    },\n    // 提交\n    handleSubmit(name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n          this.formValidate.type = this.type;\n          let arr = this.formValidate.spec_type === 0 ? this.oneFormValidate : this.manyFormValidate;\n          let item = JSON.parse(JSON.stringify(arr));\n          if (this.formValidate.spec_type === 1) {\n            if (item.length < 2) return this.$message.warning('商品规格-规格数量最少1个');\n            // 删除第一项\n            item.shift();\n          }\n          for (let i = 0; i < item.length; i++) {\n            if (item[i].stock > 1000000) {\n              return this.$message.error('规格库存-库存超出系统范围(1000000)');\n            }\n          }\n          if (this.formValidate.is_sub[0] === 1) {\n            for (let i = 0; i < item.length; i++) {\n              if (item[i].brokerage === null || item[i].brokerage_two === null) {\n                return this.$message.error('营销设置- 一二级返佣不能为空');\n              }\n            }\n          } else {\n            for (let i = 0; i < item.length; i++) {\n              if (item[i].vip_price === null) {\n                return this.$message.error('营销设置-会员价不能为空');\n              }\n            }\n          }\n          if (this.formValidate.is_sub.length === 2) {\n            for (let i = 0; i < item.length; i++) {\n              if (item[i].brokerage === null || item[i].brokerage_two === null || item[i].vip_price === null) {\n                return this.$message.error('营销设置- 一二级返佣和会员价不能为空');\n              }\n            }\n          }\n          if (this.formValidate.freight == 3 && !this.formValidate.temp_id) {\n            return this.$message.warning('商品信息-运费模板不能为空');\n          }\n          let activeIds = [];\n          this.dataLabel.forEach((item) => {\n            activeIds.push(item.id);\n          });\n          this.formValidate.label_id = activeIds;\n          if (this.openSubimit) return;\n          this.openSubimit = true;\n          this.formValidate.description = formatRichText(this.content);\n          if (this.formValidate.spec_type === 0) {\n            this.formValidate.attrs = item;\n            this.formValidate.header = [];\n            this.formValidate.items = [];\n            this.formValidate.is_copy = 0;\n          } else {\n            this.formValidate.items = this.attrs;\n            this.formValidate.attrs = item;\n            this.formValidate.is_copy = 1;\n          }\n          productAddApi(this.formValidate)\n            .then(async (res) => {\n              this.openSubimit = false;\n              this.$message.success(res.msg);\n              if (this.$route.params.id === '0') {\n                cacheDelete().catch((err) => {\n                  this.$message.error(err.msg);\n                });\n              }\n              setTimeout(() => {\n                this.openSubimit = false;\n                this.$router.push({ path: this.$routeProStr + '/product/product_list' });\n              }, 500);\n            })\n            .catch((res) => {\n              setTimeout((e) => {\n                this.openSubimit = false;\n              }, 1000);\n              this.$message.error(res.msg);\n            });\n        } else {\n          if (!this.formValidate.store_name) {\n            return this.$message.warning('商品信息-商品名称不能为空');\n          } else if (!this.formValidate.cate_id.length) {\n            return this.$message.warning('商品信息-商品分类不能为空');\n          } else if (!this.formValidate.unit_name) {\n            return this.$message.warning('商品信息-商品单位不能为空');\n          } else if (!this.formValidate.slider_image.length) {\n            return this.$message.warning('商品信息-商品轮播图不能为空');\n          } else if (!this.formValidate.logistics.length && !this.formValidate.virtual_type) {\n            return this.$message.warning('物流设置-至少选择一种物流方式');\n          } else if (!this.formValidate.temp_id && this.formValidate.freight == 3) {\n            return this.$message.warning('商品信息-运费模板不能为空');\n          }\n        }\n      });\n    },\n    changeTemplate(msg) {\n      this.template = msg;\n    },\n    // 表单验证\n    validate(prop, status, error) {\n      if (status === false) {\n        this.$message.warning(error);\n      }\n    },\n    // 移动\n    handleDragStart(e, item) {\n      this.dragging = item;\n    },\n    handleDragEnd(e, item) {\n      this.dragging = null;\n    },\n    handleDragOver(e) {\n      e.dataTransfer.dropEffect = 'move';\n    },\n    handleDragEnter(e, item) {\n      e.dataTransfer.effectAllowed = 'move';\n      if (item === this.dragging) {\n        return;\n      }\n      const newItems = [...this.formValidate.slider_image];\n      const src = newItems.indexOf(this.dragging);\n      const dst = newItems.indexOf(item);\n      newItems.splice(dst, 0, ...newItems.splice(src, 1));\n      this.formValidate.slider_image = newItems;\n    },\n    //对象数组去重；\n    unique(arr) {\n      const res = new Map();\n      return arr.filter((arr) => !res.has(arr.product_id) && res.set(arr.product_id, 1));\n    },\n    // 商品id\n    getProductId(data) {\n      this.goods_modals = false;\n      this.formValidate.recommend_list = this.unique(this.formValidate.recommend_list.concat(data));\n    },\n    // 选择推荐商品\n    changeGoods() {\n      this.goods_modals = true;\n      this.$refs.goodslist.getList();\n      this.$refs.goodslist.goodsCategory();\n    },\n    // 选择用户标签\n    activeData(dataLabel) {\n      this.labelShow = false;\n      this.dataLabel = dataLabel;\n    },\n    // 选择商品标签\n    activeLabel(data) {\n      this.tagShow = false;\n      this.formValidate.label_list = Array.from(new Set(data));\n    },\n    // 标签弹窗关闭\n    labelClose() {\n      this.labelShow = false;\n      this.tagShow = false;\n    },\n    // 删除用户标签\n    closeLabel(label) {\n      let index = this.dataLabel.indexOf(this.dataLabel.filter((d) => d.id == label.id)[0]);\n      this.dataLabel.splice(index, 1);\n    },\n    // 打开选择用户标签\n    openLabel(row) {\n      this.labelShow = true;\n    },\n    handleRemoveRecommend(i) {\n      this.formValidate.recommend_list.splice(i, 1);\n    },\n    // 打开的营销活动标签\n    watchActivity() {\n      let marketing = [];\n      // 使用对象映射优化权限判断逻辑\n      const permissionMap = {\n        默认: true,\n        秒杀: 'seckill',\n        砍价: 'bargain',\n        拼团: 'combination',\n      };\n      this.formValidate.activity.forEach((el) => {\n        if (permissionMap[el] === true || (permissionMap[el] && checkArray(permissionMap[el]))) {\n          marketing.push(el);\n        }\n      });\n      this.formValidate.activity = marketing;\n    },\n  },\n};\n</script>\n<style lang=\"scss\" scoped>\n@use './productAdd.scss' as *;\n</style>\n"]}]}