{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\kefu\\pc\\components\\chatList.vue?vue&type=style&index=0&id=40859aa5&lang=scss&scoped=true","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\kefu\\pc\\components\\chatList.vue","mtime":1731313973072},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\css-loader\\index.js","mtime":1753254259822},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1753254262918},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1753254258547},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1753254255270},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5jaGF0TGlzdCB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIHdpZHRoOiAzMjBweDsKICBoZWlnaHQ6IDc0MnB4OwogIGJvcmRlci1yaWdodDogMXB4IHNvbGlkICNlY2VjZWM7CiAgLnRhYi1oZWFkIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgaGVpZ2h0OiA1MHB4OwogICAgZmxleC1zaHJpbms6IDA7CiAgICBwYWRkaW5nOiAwIDUycHg7CiAgICBmb250LXNpemU6IDE0cHg7CiAgICBjb2xvcjogIzAwMDAwMDsKICAgIC5pdGVtIHsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICY6YWZ0ZXIgewogICAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICAgICAgY29udGVudDogJyAnOwogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICBsZWZ0OiA1MCU7CiAgICAgICAgYm90dG9tOiAtMTVweDsKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgICAgICAgaGVpZ2h0OiAycHg7CiAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tcHJldi1jb2xvci1wcmltYXJ5KTsKICAgICAgfQogICAgICAmLmFjdGl2ZSB7CiAgICAgICAgY29sb3I6IHZhcigtLXByZXYtY29sb3ItcHJpbWFyeSk7CiAgICAgICAgJjphZnRlciB7CiAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgLnNjcm9sbC1ib3ggewogICAgZmxleDogMTsKICAgIGhlaWdodDogNTAwcHg7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogIH0KICAuY2hhdC1pdGVtIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgcGFkZGluZzogMTJweCAxMHB4OwogICAgaGVpZ2h0OiA3NHB4OwogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgIGJvcmRlci1sZWZ0OiAzcHggc29saWQgdHJhbnNwYXJlbnQ7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAmLmFjdGl2ZSB7CiAgICAgIGJhY2tncm91bmQ6ICNlZmYwZjE7CiAgICAgIGJvcmRlci1sZWZ0OiAzcHggc29saWQgdmFyKC0tcHJldi1jb2xvci1wcmltYXJ5KTsKICAgIH0KICAgIC5hdmF0YXIgewogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIHdpZHRoOiA0MHB4OwogICAgICBoZWlnaHQ6IDQwcHg7CiAgICAgIGltZyB7CiAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgfQogICAgICAuc3RhdHVzIHsKICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgcmlnaHQ6IDNweDsKICAgICAgICBib3R0b206IDA7CiAgICAgICAgd2lkdGg6IDhweDsKICAgICAgICBoZWlnaHQ6IDhweDsKICAgICAgICBiYWNrZ3JvdW5kOiAjNDhkNDUyOwogICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNmZmY7CiAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICYub2ZmIHsKICAgICAgICAgIGJhY2tncm91bmQ6ICM5OTk5OTk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAudXNlci1pbmZvIHsKICAgICAgd2lkdGg6IDE1NXB4OwogICAgICBtYXJnaW4tbGVmdDogMTJweDsKICAgICAgbWFyZ2luLXRvcDogNXB4OwogICAgICBmb250LXNpemU6IDE2cHg7CiAgICAgIC5oZCB7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIGNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNjUpOwogICAgICAgIC5uYW1lIHsKICAgICAgICAgIG1heC13aWR0aDogNjclOwogICAgICAgIH0KICAgICAgICAubGFiZWwgewogICAgICAgICAgbWFyZ2luLWxlZnQ6IDVweDsKICAgICAgICAgIGNvbG9yOiAjMzg3NWVhOwogICAgICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICAgICAgYmFja2dyb3VuZDogI2Q4ZTVmZjsKICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDJweDsKICAgICAgICAgIHBhZGRpbmc6IDFweCA1cHg7CiAgICAgICAgICAmLkg1IHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZhZjFkMDsKICAgICAgICAgICAgY29sb3I6ICNkYzlhMDQ7CiAgICAgICAgICB9CiAgICAgICAgICAmLndlY2hhdCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoNjQsIDE5NCwgNzMsIDAuMTYpOwogICAgICAgICAgICBjb2xvcjogIzQwYzI0OTsKICAgICAgICAgIH0KICAgICAgICAgICYucGMgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDEwMCwgNjQsIDE5NCwgMC4xNik7CiAgICAgICAgICAgIGNvbG9yOiAjNjQ0MGMyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAuYmQgewogICAgICAgIG1hcmdpbi10b3A6IDNweDsKICAgICAgICBmb250LXNpemU6IDEycHg7CiAgICAgICAgY29sb3I6ICM4ZTk1OWU7CiAgICAgIH0KICAgIH0KICAgIC5yaWdodC1ib3ggewogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIGZsZXg6IDE7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIGFsaWduLWl0ZW1zOiBmbGV4LWVuZDsKICAgICAgY29sb3I6ICM4ZTk1OWU7CiAgICAgIC5udW0gewogICAgICAgIG1hcmdpbi1yaWdodDogMTJweDsKICAgICAgfQogICAgfQogIH0KfQouY2hhcnQtc2Nyb2xsIHsKICBtYXJnaW4tdG9wOiAtMTBweDsKfQo="},{"version":3,"sources":["chatList.vue"],"names":[],"mappings":";AAmSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"chatList.vue","sourceRoot":"src/pages/kefu/pc/components","sourcesContent":["<template>\n  <div class=\"chatList\">\n    <!-- <div class=\"tab-head\">\n      <div\n        class=\"item\"\n        :class=\"{ active: item.key == hdTabCur }\"\n        v-for=\"(item, index) in hdTab\"\n        :key=\"index\"\n        v-db-click @click=\"changeTab(item)\"\n      >\n        {{ item.title }}\n      </div>\n    </div> -->\n    <div class=\"scroll-box\">\n      <vue-scroll :ops=\"ops\" @handle-scroll=\"handleScroll\" v-if=\"userList.length > 0\">\n        <div\n          class=\"chat-item\"\n          v-for=\"(item, index) in userList\"\n          :key=\"index\"\n          :class=\"{ active: curId == item.id }\"\n          v-db-click\n          @click=\"selectUser(item)\"\n        >\n          <div class=\"avatar\">\n            <img v-lazy=\"item.wx_avatar\" alt=\"\" />\n            <div class=\"status\" :class=\"{ off: item.online == 0 }\"></div>\n          </div>\n          <div class=\"user-info\">\n            <div class=\"hd\">\n              <span class=\"name line1\">{{ item.nickname }}</span>\n              <template v-if=\"item.type == 2\">\n                <span class=\"label\">小程序</span>\n              </template>\n              <template v-if=\"item.type == 3\">\n                <span class=\"label H5\">H5</span>\n              </template>\n              <template v-if=\"item.type == 1\">\n                <span class=\"label wechat\">公众号</span>\n              </template>\n              <template v-if=\"item.type == 0\">\n                <span class=\"label pc\">PC端</span>\n              </template>\n            </div>\n            <div class=\"bd line1\">\n              <template v-if=\"item.message_type <= 2\">{{ item.message }}</template>\n              <template v-if=\"item.message_type == 3\">[图片]</template>\n              <template v-if=\"item.message_type == 5\">[商品]</template>\n              <template v-if=\"item.message_type == 6\">[订单]</template>\n            </div>\n          </div>\n          <div class=\"right-box\">\n            <div class=\"time\">{{ item.update_time | toDay }}</div>\n            <div class=\"num\" v-if=\"item.mssage_num > 0\">\n              <el-badge :value=\"item.mssage_num\">\n                <a href=\"#\" class=\"demo-badge\"></a>\n              </el-badge>\n            </div>\n          </div>\n        </div>\n      </vue-scroll>\n      <empty v-else msg=\"暂无用户列表\" status=\"1\"></empty>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Socket } from '@/libs/socket';\nimport dayjs from 'dayjs';\nimport { record } from '@/api/kefu';\nimport { HappyScroll } from 'vue-happy-scroll';\nimport empty from '../../components/empty';\nimport { forEach } from '../../../../libs/tools';\nexport default {\n  name: 'chatList',\n  props: {\n    userOnline: {\n      type: Object,\n      default: function () {\n        return {};\n      },\n    },\n    newRecored: {\n      type: Object,\n      default: function () {\n        return {};\n      },\n    },\n    searchData: {\n      type: String,\n      default: '',\n    },\n  },\n  components: {\n    HappyScroll,\n    empty,\n  },\n  watch: {\n    userOnline: {\n      handler(nVal, oVal) {\n        if (nVal.hasOwnProperty('to_uid')) {\n          this.userList.forEach((el, index) => {\n            if (el.to_uid == nVal.to_uid) {\n              el.online = nVal.online;\n              if (nVal.online == 1) {\n                this.$notify.info({\n                  title: '上线通知',\n                  message: `${el.nickname}上线`,\n                });\n              }\n            }\n          });\n        }\n      },\n      deep: true,\n    },\n    searchData: {\n      handler(nVal, oVal) {\n        if (nVal != oVal) {\n          this.nickname = nVal;\n          this.page = 1;\n          this.isScroll = true;\n          this.userList = [];\n          this.getList();\n        }\n      },\n      deep: true,\n    },\n  },\n  data() {\n    return {\n      hdTabCur: 0,\n      hdTab: [\n        {\n          key: 0,\n          title: '用户列表',\n        },\n      ],\n      userList: [],\n      curId: '',\n      page: 1,\n      limit: 15,\n      isScroll: true,\n      nickname: '',\n      isSearch: false,\n      ops: {\n        vuescroll: {\n          mode: 'native',\n          enable: false,\n          tips: {\n            deactive: 'Push to Load',\n            active: 'Release to Load',\n            start: 'Loading...',\n            beforeDeactive: 'Load Successfully!',\n          },\n          auto: false,\n          autoLoadDistance: 0,\n          pullRefresh: {\n            enable: false,\n          },\n          pushLoad: {\n            enable: true,\n            auto: true,\n            autoLoadDistance: 10,\n          },\n        },\n        bar: {\n          background: '#393232',\n          opacity: '.5',\n          size: '5px',\n        },\n      },\n    };\n  },\n  filters: {\n    toDay: function (value) {\n      if (!value) return '';\n      return dayjs.unix(value).format('M月D日 HH:mm');\n    },\n  },\n  mounted() {\n    let that = this;\n    Socket.then((ws) => {\n      //用户转接\n      ws.$on('transfer', (data) => {\n        let status = false;\n        that.userList.forEach((el, index, arr) => {\n          if (data.recored.id == el.id) {\n            status = true;\n            if (data.recored.is_tourist == that.hdTabCur) {\n              let oldVal = data.recored;\n              arr.splice(index, 1);\n\n              if (index == 0) {\n                this.$emit('setDataId', oldVal);\n                oldVal.mssage_num = 0;\n              }\n              arr.unshift(oldVal);\n            }\n            this.$notify.info({\n              title: '您有一条转接消息！',\n            });\n          }\n        });\n        if (!status) {\n          if (data.recored.is_tourist == this.hdTabCur) this.userList.unshift(data.recored);\n        }\n      });\n      ws.$on('mssage_num', (data) => {\n        if (data.recored.id) {\n          let status = false;\n          that.userList.forEach((el, index, arr) => {\n            if (data.recored.id == el.id) {\n              status = true;\n              if (data.recored.is_tourist == that.hdTabCur) {\n                let oldVal = data.recored;\n                arr.splice(index, 1);\n                arr.unshift(oldVal);\n              }\n            }\n          });\n          if (!status) {\n            if (data.recored.is_tourist == this.hdTabCur) this.userList.unshift(data.recored);\n          }\n        }\n        if (data.recored.is_tourist != this.hdTabCur && data.recored.id) {\n          this.$notify.info({\n            title: this.hdTabCur ? '用户发来消息啦！' : '游客发来消息啦！',\n          });\n        }\n      });\n    });\n    this.bus.$on('change', (data) => {\n      this.nickname = data;\n    });\n    this.getList();\n  },\n  methods: {\n    //切换\n    changeTab(item) {\n      if (this.hdTabCur == item.key) return;\n      this.hdTabCur = item.key;\n      this.isScroll = true;\n      this.page = 1;\n      this.userList = [];\n      this.$emit('changeType', item.key);\n      this.getList();\n    },\n    getList() {\n      if (!this.isScroll) return;\n      record({\n        nickname: this.nickname,\n        page: this.page,\n        limit: this.limit,\n        is_tourist: this.hdTabCur,\n      }).then((res) => {\n        if (res.data.length > 0) {\n          res.data[0].mssage_num = 0;\n          this.isScroll = res.data.length >= this.limit;\n\n          this.userList = this.userList.concat(res.data);\n\n          if (this.page == 1 && res.data.length > 0 && !this.isSearch) {\n            this.curId = res.data[0].id;\n            this.$emit('setDataId', res.data[0]);\n          }\n          this.page++;\n        } else {\n          this.$emit('setDataId', 0);\n        }\n      });\n    },\n    chartReachBottom() {\n      this.getList();\n    },\n    // 选择用户\n    selectUser(item) {\n      if (this.curId == item.id) return;\n      item.mssage_num = 0;\n      this.curId = item.id;\n      this.$emit('setDataId', item);\n    },\n    handleScroll(vertical, horizontal, nativeEvent) {\n      if (vertical.process == 1) {\n        this.getList();\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.chatList {\n  display: flex;\n  flex-direction: column;\n  width: 320px;\n  height: 742px;\n  border-right: 1px solid #ececec;\n  .tab-head {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 50px;\n    flex-shrink: 0;\n    padding: 0 52px;\n    font-size: 14px;\n    color: #000000;\n    .item {\n      position: relative;\n      cursor: pointer;\n      &:after {\n        display: none;\n        content: ' ';\n        position: absolute;\n        left: 50%;\n        bottom: -15px;\n        transform: translateX(-50%);\n        height: 2px;\n        width: 100%;\n        background: var(--prev-color-primary);\n      }\n      &.active {\n        color: var(--prev-color-primary);\n        &:after {\n          display: block;\n        }\n      }\n    }\n  }\n  .scroll-box {\n    flex: 1;\n    height: 500px;\n    overflow: hidden;\n  }\n  .chat-item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 10px;\n    height: 74px;\n    box-sizing: border-box;\n    border-left: 3px solid transparent;\n    cursor: pointer;\n    &.active {\n      background: #eff0f1;\n      border-left: 3px solid var(--prev-color-primary);\n    }\n    .avatar {\n      position: relative;\n      width: 40px;\n      height: 40px;\n      img {\n        display: block;\n        width: 100%;\n        height: 100%;\n        border-radius: 50%;\n      }\n      .status {\n        position: absolute;\n        right: 3px;\n        bottom: 0;\n        width: 8px;\n        height: 8px;\n        background: #48d452;\n        border: 1px solid #fff;\n        border-radius: 50%;\n        &.off {\n          background: #999999;\n        }\n      }\n    }\n    .user-info {\n      width: 155px;\n      margin-left: 12px;\n      margin-top: 5px;\n      font-size: 16px;\n      .hd {\n        display: flex;\n        align-items: center;\n        color: rgba(0, 0, 0, 0.65);\n        .name {\n          max-width: 67%;\n        }\n        .label {\n          margin-left: 5px;\n          color: #3875ea;\n          font-size: 12px;\n          background: #d8e5ff;\n          border-radius: 2px;\n          padding: 1px 5px;\n          &.H5 {\n            background: #faf1d0;\n            color: #dc9a04;\n          }\n          &.wechat {\n            background: rgba(64, 194, 73, 0.16);\n            color: #40c249;\n          }\n          &.pc {\n            background: rgba(100, 64, 194, 0.16);\n            color: #6440c2;\n          }\n        }\n      }\n      .bd {\n        margin-top: 3px;\n        font-size: 12px;\n        color: #8e959e;\n      }\n    }\n    .right-box {\n      position: relative;\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      align-items: flex-end;\n      color: #8e959e;\n      .num {\n        margin-right: 12px;\n      }\n    }\n  }\n}\n.chart-scroll {\n  margin-top: -10px;\n}\n</style>\n"]}]}