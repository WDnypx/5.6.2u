{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\user\\grade\\card\\index.vue?vue&type=style&index=0&id=eef20e8a&lang=scss&scoped=true","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\user\\grade\\card\\index.vue","mtime":1729039381110},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\css-loader\\index.js","mtime":1753254259822},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1753254262918},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1753254258547},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1753254255270},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5lbC1pbnB1dC1udW1iZXItLXNtYWxsIHsKICB3aWR0aDogMTAwJTsKfQouUVJwaWMgewogIHdpZHRoOiAxODBweDsKICBoZWlnaHQ6IDE4MHB4OwoKICBpbWcgewogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgfQp9Ci53NDE0IHsKICB3aWR0aDogNDE0cHg7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAoWA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/user/grade/card","sourcesContent":["<template>\n  <div>\n    <el-card :bordered=\"false\" shadow=\"never\" class=\"ivu-mt\" :body-style=\"{ padding: 0 }\">\n      <div class=\"padding-add\">\n        <el-form\n          :model=\"gradeFrom\"\n          inline\n          :label-width=\"labelWidth\"\n          :label-position=\"labelPosition\"\n          @submit.native.prevent\n        >\n          <el-form-item label=\"批次名称：\" label-for=\"title\">\n            <el-input clearable v-model=\"gradeFrom.title\" placeholder=\"请输入批次名称\" class=\"form_content_width\" />\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" v-db-click @click=\"userSearchs\">查询</el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </el-card>\n    <el-card :bordered=\"false\" shadow=\"never\" class=\"mt16\">\n      <el-button type=\"primary\" v-db-click @click=\"addBatch\">添加批次</el-button>\n      <el-button v-db-click @click=\"getMemberScan\">卡密使用页面二维码</el-button>\n      <el-table\n        class=\"mt14\"\n        :data=\"tbody\"\n        v-loading=\"loading\"\n        highlight-current-row\n        no-userFrom-text=\"暂无数据\"\n        no-filtered-userFrom-text=\"暂无筛选结果\"\n      >\n        <el-table-column label=\"编号\" width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.id }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"批次名称\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.title }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"体验天数\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.use_day }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"发卡总数量\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.total_num }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"使用数量\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.use_num }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"制卡时间\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.add_time }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"是否激活\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <el-switch\n              :active-value=\"1\"\n              :inactive-value=\"0\"\n              v-model=\"scope.row.status\"\n              :value=\"scope.row.status\"\n              @change=\"onchangeIsShow(scope.row)\"\n              size=\"large\"\n            >\n            </el-switch>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"备注\" min-width=\"120\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.remark }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"制卡时间\" min-width=\"100\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.add_time }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" fixed=\"right\" width=\"120\">\n          <template slot-scope=\"scope\">\n            <el-dropdown size=\"small\" @command=\"changeMenu(scope.row, $event, scope.$index)\" :transfer=\"true\">\n              <span class=\"el-dropdown-link\">更多<i class=\"el-icon-arrow-down el-icon--right\"></i> </span>\n              <el-dropdown-menu slot=\"dropdown\">\n                <el-dropdown-item command=\"1\">编辑批次名</el-dropdown-item>\n                <el-dropdown-item command=\"2\">查看卡列表</el-dropdown-item>\n                <el-dropdown-item command=\"3\">导出</el-dropdown-item>\n              </el-dropdown-menu>\n            </el-dropdown>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div class=\"acea-row row-right page\">\n        <pagination\n          v-if=\"total\"\n          :total=\"total\"\n          :page.sync=\"gradeFrom.page\"\n          :limit.sync=\"gradeFrom.limit\"\n          @pagination=\"getMemberBatch\"\n        />\n      </div>\n    </el-card>\n    <el-dialog :visible.sync=\"modal\" width=\"540px\" :title=\"`${formValidate.id ? '编辑' : '添加'}批次`\">\n      <!-- <form-create v-model=\"fapi\" :rule=\"rule\" @submit=\"onSubmit\"></form-create> -->\n      <el-form ref=\"formValidate\" :model=\"formValidate\" label-width=\"80px\" @submit.native.prevent>\n        <el-form-item label=\"批次名称：\">\n          <el-input placeholder=\"请输入批次名称\" element-id=\"unit_name\" v-model=\"formValidate.title\" class=\"w100\" />\n        </el-form-item>\n        <el-form-item label=\"备注：\" v-if=\"formValidate.id\">\n          <el-input type=\"textarea\" placeholder=\"请输入备注\" v-model=\"formValidate.remark\" class=\"w100\" />\n        </el-form-item>\n        <template v-if=\"!formValidate.id\">\n          <el-form-item label=\"制卡数量：\">\n            <el-input-number\n              :controls=\"false\"\n              placeholder=\"请输入制卡数量\"\n              element-id=\"sort\"\n              :precision=\"0\"\n              :max=\"100000\"\n              :min=\"1\"\n              v-model=\"formValidate.total_num\"\n              class=\"perW10\"\n            />\n          </el-form-item>\n          <el-form-item label=\"体验天数：\">\n            <el-input-number\n              :controls=\"false\"\n              placeholder=\"请输入体验天数\"\n              element-id=\"sort\"\n              :precision=\"0\"\n              :max=\"100000\"\n              :min=\"1\"\n              v-model=\"formValidate.use_day\"\n              class=\"perW10\"\n            />\n          </el-form-item>\n          <el-form-item label=\"是否激活：\">\n            <el-radio-group element-id=\"status\" v-model=\"formValidate.status\">\n              <el-radio :label=\"1\" class=\"radio\">激活</el-radio>\n              <el-radio :label=\"0\">冻结</el-radio>\n            </el-radio-group>\n          </el-form-item>\n          <el-form-item label=\"备注：\">\n            <el-input type=\"textarea\" placeholder=\"请输入备注\" v-model=\"formValidate.remark\" class=\"w100\" />\n          </el-form-item>\n        </template>\n      </el-form>\n      <div class=\"acea-row row-right\">\n        <el-button v-db-click @click=\"modal = false\">取消</el-button>\n        <el-button type=\"primary\" v-db-click @click=\"onSubmit()\">提交</el-button>\n      </div>\n    </el-dialog>\n    <el-dialog :visible.sync=\"cardModal\" title=\"卡列表\" width=\"1000px\">\n      <cardList v-if=\"cardModal\" :id=\"id\"></cardList>\n    </el-dialog>\n    <el-dialog :visible.sync=\"modal3\" title=\"二维码\" width=\"540px\">\n      <div v-if=\"qrcode\" class=\"acea-row row-around\">\n        <div v-if=\"qrcode && qrcode.wechat_img\" class=\"acea-row row-column-around row-between-wrapper\">\n          <div v-viewer class=\"QRpic\">\n            <img v-lazy=\"qrcode.wechat_img\" />\n          </div>\n          <span class=\"mt10\">公众号二维码</span>\n        </div>\n        <div v-if=\"qrcode && qrcode.routine\" class=\"acea-row row-column-around row-between-wrapper\">\n          <div v-viewer class=\"QRpic\">\n            <img v-lazy=\"qrcode.routine\" />\n          </div>\n          <span class=\"mt10\">小程序二维码</span>\n        </div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex';\nimport cardList from './list.vue';\nimport { userMemberBatch, memberBatchSave, memberBatchSetValue, exportMemberCard, userMemberScan } from '@/api/user';\nimport { exportmberCardList } from '@/api/export.js';\n\nexport default {\n  name: 'index',\n  components: { cardList },\n  data() {\n    return {\n      cardModal: false,\n      id: 0,\n      grid: {\n        xl: 7,\n        lg: 7,\n        md: 12,\n        sm: 24,\n        xs: 24,\n      },\n      tbody: [],\n      total: 0,\n      gradeFrom: {\n        title: '',\n        page: 1,\n        limit: 15,\n      },\n      loading: false,\n      modal: false,\n\n      formValidate: {\n        id: 0,\n        title: '',\n        total_num: 1,\n        use_day: 1,\n        status: 1,\n        remark: '',\n      },\n      modal2: false,\n      modal3: false,\n      qrcode: null,\n      fapi: {},\n    };\n  },\n  computed: {\n    ...mapState('media', ['isMobile']),\n    labelWidth() {\n      return this.isMobile ? undefined : '80px';\n    },\n    labelPosition() {\n      return this.isMobile ? 'top' : 'right';\n    },\n  },\n  created() {\n    this.getMemberBatch(this.gradeFrom);\n  },\n  methods: {\n    // 批次列表\n    getMemberBatch() {\n      this.loading = true;\n      userMemberBatch(this.gradeFrom)\n        .then((res) => {\n          this.loading = false;\n          this.tbody = res.data.list;\n          this.total = res.data.count;\n        })\n        .catch((err) => {\n          this.loading = false;\n          this.$message.error(err.msg);\n        });\n    },\n    // 批次名称查询\n    userSearchs() {\n      this.gradeFrom.page = 1;\n      this.getMemberBatch();\n    },\n    // 激活 | 冻结\n    onchangeIsShow(row) {\n      memberBatchSetValue(row.id, {\n        field: 'status',\n        value: row.status,\n      })\n        .then((res) => {\n          this.$message.success(res.msg);\n        })\n        .catch((err) => {\n          this.$message.error(err.msg);\n        });\n    },\n    // 导出\n    async export(row) {\n      let [th, filekey, data, fileName] = [[], [], [], ''];\n      let lebData = await this.getExcelData(row.id);\n      if (!fileName) fileName = lebData.filename;\n      if (!filekey.length) {\n        filekey = lebData.fileKey;\n      }\n      if (!th.length) th = lebData.header;\n      data = data.concat(lebData.export);\n      this.$exportExcel(th, filekey, fileName, data);\n    },\n    getExcelData(excelData) {\n      return new Promise((resolve, reject) => {\n        exportmberCardList(excelData).then((res) => {\n          resolve(res.data);\n        });\n      });\n    },\n    // 更多\n    changeMenu(row, name) {\n      switch (name) {\n        case '1':\n          this.formValidate.id = row.id;\n          this.formValidate.title = row.title;\n          this.modal = true;\n          break;\n        case '2':\n          this.id = row.id;\n          this.cardModal = true;\n          break;\n        case '3':\n          this.export(row);\n          break;\n      }\n    },\n    // 添加批次弹窗\n    addBatch() {\n      // this.fapi.resetFields();\n      this.modal = true;\n      this.formValidate.id = 0;\n      this.formValidate.title = '';\n    },\n    // 提交批次\n    onSubmit() {\n      if (this.formValidate.id) {\n        memberBatchSetValue(this.formValidate.id, {\n          field: 'title',\n          value: this.formValidate.title,\n          remark: this.formValidate.remark,\n        })\n          .then((res) => {\n            this.modal = false;\n            this.$message.success(res.msg);\n            this.getMemberBatch();\n          })\n          .catch((err) => {\n            this.$message.error(err.msg);\n          });\n      } else {\n        memberBatchSave(this.formValidate.id, this.formValidate)\n          .then((res) => {\n            this.modal = false;\n            this.$message.success(res.msg);\n            this.getMemberBatch();\n          })\n          .catch((err) => {\n            this.$message.error(err.msg);\n          });\n      }\n    },\n    onSubmit2(formData) {},\n    // 会员卡二维码\n    getMemberScan() {\n      userMemberScan()\n        .then((res) => {\n          this.qrcode = res.data;\n          this.modal3 = true;\n        })\n        .catch((err) => {\n          this.$message.error(err.msg);\n        });\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.el-input-number--small {\n  width: 100%;\n}\n.QRpic {\n  width: 180px;\n  height: 180px;\n\n  img {\n    width: 100%;\n    height: 100%;\n  }\n}\n.w414 {\n  width: 414px;\n}\n</style>\n"]}]}