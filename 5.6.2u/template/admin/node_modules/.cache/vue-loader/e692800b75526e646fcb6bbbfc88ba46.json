{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\setting\\systemRole\\index.vue?vue&type=style&index=0&id=24a55c6b&scoped=true&lang=scss","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\setting\\systemRole\\index.vue","mtime":1729039381105},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\css-loader\\index.js","mtime":1753254259822},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1753254262918},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1753254258547},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1753254255270},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci50cmVlcy1jb2FkZCB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAzODVweDsKICBkaXNwbGF5OiBmbGV4OwogIC5zY29sbGhpZGUgewogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBtYXJnaW4tdG9wOiA0cHg7CiAgICBvdmVyZmxvdy15OiBzY3JvbGw7CiAgfQogIC5pY29ubGlzdC1idG4gewogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGNvbG9yOiB2YXIoLS1wcmV2LWNvbG9yLXByaW1hcnkpOwogIH0KfQovLyBtYXJnaW4tbGVmdDogMThweDsKLnNjb2xsaGlkZTo6LXdlYmtpdC1zY3JvbGxiYXIgewogIGRpc3BsYXk6IG5vbmU7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA4eA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/setting/systemRole","sourcesContent":["<template>\n  <div>\n    <el-card :bordered=\"false\" shadow=\"never\" class=\"ivu-mb-16\" :body-style=\"{ padding: 0 }\">\n      <div class=\"padding-add\">\n        <el-form\n          ref=\"formValidate\"\n          :model=\"formValidate\"\n          :label-width=\"labelWidth\"\n          :label-position=\"labelPosition\"\n          @submit.native.prevent\n          inline\n        >\n          <el-form-item label=\"状态：\" label-for=\"status\">\n            <el-select\n              v-model=\"formValidate.status\"\n              placeholder=\"请选择\"\n              @change=\"userSearchs\"\n              clearable\n              class=\"form_content_width\"\n            >\n              <el-option value=\"1\" label=\"显示\"></el-option>\n              <el-option value=\"0\" label=\"不显示\"></el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"身份昵称：\" label-for=\"role_name\">\n            <el-input\n              clearable\n              placeholder=\"请输入身份昵称\"\n              v-model=\"formValidate.role_name\"\n              class=\"form_content_width\"\n            />\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" v-db-click @click=\"userSearchs\">查询</el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </el-card>\n    <el-card :bordered=\"false\" shadow=\"never\" v-loading=\"spinShow\">\n      <el-button v-auth=\"['setting-system_role-add']\" type=\"primary\" v-db-click @click=\"add('添加')\"\n        >添加身份</el-button\n      >\n      <el-table\n        :data=\"tableList\"\n        ref=\"table\"\n        class=\"mt14\"\n        v-loading=\"loading\"\n        highlight-current-row\n        no-userFrom-text=\"暂无数据\"\n        no-filtered-userFrom-text=\"暂无筛选结果\"\n      >\n        <el-table-column label=\"ID\" min-width=\"80\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.id }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"身份昵称\" min-width=\"130\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.role_name }}</span>\n          </template>\n        </el-table-column>\n        <!-- <el-table-column label=\"权限\" min-width=\"1000\">\n          <template slot-scope=\"scope\">\n            <span class=\"line1\">{{ scope.row.rules }}</span>\n          </template>\n        </el-table-column> -->\n        <el-table-column label=\"状态\" min-width=\"120\">\n          <template slot-scope=\"scope\">\n            <el-switch\n              class=\"defineSwitch\"\n              :active-value=\"1\"\n              :inactive-value=\"0\"\n              v-model=\"scope.row.status\"\n              :value=\"scope.row.status\"\n              @change=\"onchangeIsShow(scope.row)\"\n              size=\"large\"\n              active-text=\"显示\"\n              inactive-text=\"隐藏\"\n            >\n            </el-switch>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" fixed=\"right\" width=\"120\">\n          <template slot-scope=\"scope\">\n            <a v-db-click @click=\"edit(scope.row, '编辑')\">编辑</a>\n            <el-divider direction=\"vertical\"></el-divider>\n            <a v-db-click @click=\"del(scope.row, '删除', scope.$index)\">删除</a>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div class=\"acea-row row-right page\">\n        <pagination\n          v-if=\"total\"\n          :total=\"total\"\n          :page.sync=\"formValidate.page\"\n          :limit.sync=\"formValidate.limit\"\n          @pagination=\"getList\"\n        />\n      </div>\n    </el-card>\n    <!-- 新增编辑-->\n    <el-dialog\n      :visible.sync=\"modals\"\n      :title=\"`${modelTit}身份`\"\n      :close-on-click-modal=\"false\"\n      :show-close=\"true\"\n      width=\"540px\"\n      @closed=\"closed\"\n    >\n      <el-form\n        ref=\"formInline\"\n        :model=\"formInline\"\n        :rules=\"ruleValidate\"\n        label-width=\"100px\"\n        :label-position=\"labelPosition2\"\n        @submit.native.prevent\n      >\n        <el-form-item label=\"身份名称：\" label-for=\"role_name\" prop=\"role_name\">\n          <el-input placeholder=\"请输入身份昵称\" v-model=\"formInline.role_name\" />\n        </el-form-item>\n        <el-form-item label=\"是否开启：\" prop=\"status\">\n          <el-radio-group v-model=\"formInline.status\">\n            <el-radio :label=\"1\">开启</el-radio>\n            <el-radio :label=\"0\">关闭</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item label=\"权限：\">\n          <div class=\"trees-coadd\">\n            <div class=\"scollhide\">\n              <div class=\"iconlist\">\n                <el-tree\n                  :data=\"menusList\"\n                  node-key=\"id\"\n                  check-strictly\n                  show-checkbox\n                  highlight-current\n                  ref=\"tree\"\n                  :default-checked-keys=\"selectIds\"\n                  :props=\"defaultProps\"\n                  @check=\"clickDeal\"\n                  :default-expand-all=\"defaultExpandAll\"\n                ></el-tree>\n              </div>\n            </div>\n            <span class=\"iconlist-btn\" @click=\"changeExpandAll\">{{ defaultExpandAll ? '折叠' : '展开' }}</span>\n          </div>\n        </el-form-item>\n      </el-form>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button v-db-click @click=\"onCancel\">取 消</el-button>\n        <el-button type=\"primary\" v-db-click @click=\"handleSubmit('formInline')\">提 交</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n<script>\nimport { mapState } from 'vuex';\nimport { roleListApi, roleSetStatusApi, menusListApi, roleCreateApi, roleInfoApi } from '@/api/setting';\nexport default {\n  name: 'systemrRole',\n  data() {\n    return {\n      spinShow: false,\n      modals: false,\n      total: 0,\n      grid: {\n        xl: 7,\n        lg: 7,\n        md: 12,\n        sm: 24,\n        xs: 24,\n      },\n      loading: false,\n      defaultExpandAll: false,\n      formValidate: {\n        status: '',\n        role_name: '',\n        page: 1,\n        limit: 20,\n      },\n      tableList: [],\n      formInline: {\n        role_name: '',\n        status: 0,\n        checked_menus: [],\n        id: 0,\n      },\n      menusList: [],\n      selectIds: [],\n      modelTit: '',\n      ruleValidate: {\n        role_name: [{ required: true, message: '请输入身份昵称', trigger: 'blur' }],\n        status: [{ required: true, type: 'number', message: '请选择是否开启', trigger: 'change' }],\n        // checked_menus: [\n        //     { required: true, validator: validateStatus, trigger: 'change' }\n        // ]\n      },\n      defaultProps: {\n        children: 'children',\n        label: 'title',\n      },\n    };\n  },\n  computed: {\n    ...mapState('media', ['isMobile']),\n    labelWidth() {\n      return this.isMobile ? undefined : '80px';\n    },\n    labelPosition() {\n      return this.isMobile ? 'top' : 'right';\n    },\n    labelPosition2() {\n      return this.isMobile ? 'top' : 'right';\n    },\n  },\n  created() {\n    this.getList();\n  },\n  methods: {\n    changeExpandAll() {\n      // 控制按钮点击之后失焦\n      if (this.defaultExpandAll) {\n        this.defaultExpandAll = false;\n        for (let key in this.$refs.tree.store.nodesMap) {\n          this.$refs.tree.store.nodesMap[key].expanded = false;\n        }\n      } else {\n        this.defaultExpandAll = true;\n        for (let key in this.$refs.tree.store.nodesMap) {\n          this.$refs.tree.store.nodesMap[key].expanded = true;\n        }\n      }\n    },\n    closed() {\n      this.formInline = {\n        role_name: '',\n        status: 0,\n        checked_menus: [],\n        id: 0,\n      };\n      this.selectIds = [];\n    },\n    // 添加\n    add(name) {\n      this.formInline.id = 0;\n      this.modelTit = name;\n      this.modals = true;\n      this.getmenusList();\n    },\n    // 删除\n    del(row, tit, num) {\n      let delfromData = {\n        title: tit,\n        num: num,\n        url: `setting/role/${row.id}`,\n        method: 'DELETE',\n        ids: '',\n      };\n      this.$modalSure(delfromData)\n        .then((res) => {\n          this.$message.success(res.msg);\n          this.tableList.splice(num, 1);\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    // 修改是否显示\n    onchangeIsShow(row) {\n      let data = {\n        id: row.id,\n        status: row.status,\n      };\n      roleSetStatusApi(data)\n        .then(async (res) => {\n          this.$message.success(res.msg);\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    // 列表\n    getList() {\n      this.loading = true;\n      this.formValidate.status = this.formValidate.status || '';\n      roleListApi(this.formValidate)\n        .then(async (res) => {\n          let data = res.data;\n          this.tableList = data.list;\n          this.total = res.data.count;\n          this.loading = false;\n        })\n        .catch((res) => {\n          this.loading = false;\n          this.$message.error(res.msg);\n        });\n    },\n    // 表格搜索\n    userSearchs() {\n      this.formValidate.page = 1;\n      this.getList();\n    },\n    // 编辑\n    edit(row, name) {\n      this.modelTit = name;\n      this.formInline.id = row.id;\n      this.modals = true;\n      this.rows = row;\n      this.getIofo(row);\n    },\n    // 菜单列表\n    getmenusList() {\n      this.spinShow = true;\n      menusListApi()\n        .then(async (res) => {\n          let data = res.data;\n          this.menusList = data.menus;\n          this.menusList.map((item, index) => {\n            if (item.title === '主页') {\n              // item.checked = true;\n              // item.disableCheckbox = true;\n              if (item.children.length) {\n                item.children.map((v) => {\n                  // v.checked = true;\n                  // v.disableCheckbox = true;\n                });\n              }\n            }\n            item.expand = false;\n          });\n          this.spinShow = false;\n        })\n        .catch((res) => {\n          this.spinShow = false;\n          this.$message.error(res.msg);\n        });\n    },\n    // 详情\n    getIofo(row) {\n      this.spinShow = true;\n      roleInfoApi(row.id)\n        .then(async (res) => {\n          let data = res.data;\n          this.formInline = data.role || this.formInline;\n          this.formInline.checked_menus = this.formInline.rules;\n          this.$nextTick((e) => {\n            this.selectIds = this.formInline.rules.split(',');\n            this.tidyRes(data.menus);\n            // this.$refs.tree.setCheckedKeys(Array(arr));\n          });\n          this.spinShow = false;\n        })\n        .catch((res) => {\n          this.spinShow = false;\n          this.$message.error(res.msg);\n        });\n    },\n    forChildrenChecked(arr, status, pid) {\n      if (arr.length) {\n        let len = arr.length;\n        for (var j = 0; j < len; j++) {\n          var childNode = this.$refs.tree.getNode(arr[j].id).data;\n          if (status) {\n            this.$refs.tree.setChecked(childNode.id, true);\n            childNode.checked = true;\n          }\n          if (!status) {\n            this.$refs.tree.setChecked(childNode.id, false);\n            childNode.checked = false;\n          }\n          if (childNode.children.length) {\n            this.forChildrenChecked(childNode.children, status);\n          }\n        }\n      }\n    },\n\n    clickDeal(currentObj, treeStatus, ccc) {\n      // 用于：父子节点严格互不关联时，父节点勾选变化时通知子节点同步变化，实现单向关联。\n      let selected = treeStatus.checkedKeys.indexOf(currentObj.id); // -1未选中\n      // 选中\n      if (selected !== -1) {\n        // 子节点只要被选中父节点就被选中\n        this.selectedParent(currentObj);\n        // 统一处理子节点为相同的勾选状态\n        this.uniteChildSame(currentObj, true);\n      } else {\n        // 未选中 处理子节点全部未选中\n        if (currentObj.children.length !== 0) {\n          this.uniteChildSame(currentObj, false);\n        }\n        let selParent = false;\n        let parentNode = currentObj.pid ? this.$refs.tree.getNode(currentObj.pid).data : undefined;\n        if (parentNode && parentNode.children.length) {\n          for (let i = 0; i < parentNode.children.length; i++) {\n            if (treeStatus.checkedKeys.includes(parentNode.children[i].id)) {\n              selParent = true;\n            }\n          }\n        }\n        if (!selParent && currentObj.pid) this.$refs.tree.setChecked(currentObj.pid, false);\n      }\n    },\n    // 统一处理子节点为相同的勾选状态\n    uniteChildSame(treeList, isSelected) {\n      this.$refs.tree.setChecked(treeList.id, isSelected);\n      for (let i = 0; i < treeList.children.length; i++) {\n        this.uniteChildSame(treeList.children[i], isSelected);\n      }\n    },\n    // 统一处理父节点为选中\n    selectedParent(currentObj) {\n      let currentNode = this.$refs.tree.getNode(currentObj);\n      if (currentNode.parent.key !== undefined) {\n        this.$refs.tree.setChecked(currentNode.parent, true);\n        this.selectedParent(currentNode.parent);\n      }\n    },\n    tidyRes(menus) {\n      let data = [];\n      menus.map((menu) => {\n        if (menu.title === '主页') {\n          menu.checked = true;\n          // menu.disabled = true;\n          if (menu.children.length) {\n            menu.children.map((v) => {\n              v.checked = true;\n            });\n          }\n          data.push(menu);\n        } else {\n          data.push(this.initMenu(menu));\n        }\n      });\n      this.$set(this, 'menusList', data);\n    },\n    initMenu(menu) {\n      let data = {},\n        checkMenus = ',' + this.formInline.checked_menus + ',';\n      data.title = menu.title;\n      data.id = menu.id;\n      data.pid = menu.pid;\n      data.children = menu.children;\n      data.checked = menu.checked;\n\n      if (menu.children && menu.children.length > 0) {\n        data.children = [];\n        menu.children.map((child) => {\n          data.children.push(this.initMenu(child));\n        });\n      } else {\n        data.checked = checkMenus.indexOf(String(',' + data.id + ',')) !== -1;\n        data.expand = !data.checked;\n      }\n      return data;\n    },\n    // 提交\n    handleSubmit(name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n          this.formInline.checked_menus = [\n            ...this.$refs.tree.getCheckedKeys(),\n            ...this.$refs.tree.getHalfCheckedKeys(),\n          ];\n          if (this.formInline.checked_menus.length === 0) return this.$message.warning('请至少选择一个权限');\n          roleCreateApi(this.formInline)\n            .then(async (res) => {\n              this.$message.success(res.msg);\n              this.modals = false;\n              this.getList();\n              this.$refs[name].resetFields();\n              this.formInline.checked_menus = [];\n            })\n            .catch((res) => {\n              this.$message.error(res.msg);\n            });\n        } else {\n          return false;\n        }\n      });\n    },\n    onCancel() {\n      this.$refs['formInline'].resetFields();\n      this.formInline.checked_menus = [];\n      this.selectIds = [];\n      this.modals = false;\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n.trees-coadd {\n  width: 100%;\n  height: 385px;\n  display: flex;\n  .scollhide {\n    position: relative;\n    width: 100%;\n    height: 100%;\n    margin-top: 4px;\n    overflow-y: scroll;\n  }\n  .iconlist-btn {\n    white-space: nowrap;\n    cursor: pointer;\n    color: var(--prev-color-primary);\n  }\n}\n// margin-left: 18px;\n.scollhide::-webkit-scrollbar {\n  display: none;\n}\n</style>\n"]}]}