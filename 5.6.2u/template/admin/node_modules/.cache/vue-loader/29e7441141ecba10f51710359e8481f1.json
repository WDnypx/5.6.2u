{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\setting\\notification\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\setting\\notification\\index.vue","mtime":1731313973095},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1753254258567},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IGdldE5vdGlmaWNhdGlvbkxpc3QsIGdldE5vdGlmaWNhdGlvbkluZm8sIG5vdGljZVN0YXR1cywgbm90aWZpY2F0aW9uRm9ybSB9IGZyb20gJ0AvYXBpL25vdGlmaWNhdGlvbi5qcyc7CmltcG9ydCB7IHJvdXRpbmVTeW5jVGVtcGxhdGUsIHdlY2hhdFN5bmNUZW1wbGF0ZSB9IGZyb20gJ0AvYXBpL2FwcCc7CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbW9kYWxUaXRsZTogJycsCiAgICAgIG5vdGlmaWNhdGlvbk1vZGFsOiBmYWxzZSwKICAgICAgaGVhZGVyTGlzdDogWwogICAgICAgIHsgbGFiZWw6ICfkvJrlkZjpgJrnn6UnLCB2YWx1ZTogJzEnIH0sCiAgICAgICAgeyBsYWJlbDogJ+W5s+WPsOmAmuefpScsIHZhbHVlOiAnMicgfSwKICAgICAgICB7IGxhYmVsOiAn6Ieq5a6a5LmJ6YCa55+lJywgdmFsdWU6ICczJyB9LAogICAgICBdLAogICAgICBsZXZlbExpc3RzOiBbXSwKICAgICAgY3VycmVudFRhYjogJzEnLAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgZm9ybURhdGE6IHt9LAogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmNoYW5nZVRhYih0aGlzLmN1cnJlbnRUYWIpOwogIH0sCiAgbWV0aG9kczogewogICAgY2hhbmdlU3dpdGNoKGUsIHJvdywgdHlwZSkgewogICAgICBub3RpY2VTdGF0dXModHlwZSwgcm93W3R5cGVdLCByb3cuaWQpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHJlcy5tc2cpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnIpID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoZXJyLm1zZyk7CiAgICAgICAgfSk7CiAgICB9LAogICAgbm90aWZpY2F0aW9uRm9ybShpZCkgewogICAgICB0aGlzLiRtb2RhbEZvcm0obm90aWZpY2F0aW9uRm9ybShpZCkpLnRoZW4oKCkgPT4gdGhpcy5jaGFuZ2VUYWIoKSk7CiAgICB9LAogICAgY2hhbmdlVGFiKCkgewogICAgICBnZXROb3RpZmljYXRpb25MaXN0KHRoaXMuY3VycmVudFRhYikudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy5sZXZlbExpc3RzID0gcmVzLmRhdGE7CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOWQjOatpeiuoumYhea2iOaBrwogICAgcm91dGluZVRlbXBsYXRlKCkgewogICAgICByb3V0aW5lU3luY1RlbXBsYXRlKCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MocmVzLm1zZyk7CiAgICAgICAgICB0aGlzLmNoYW5nZVRhYih0aGlzLmN1cnJlbnRUYWIpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1zZyk7CiAgICAgICAgfSk7CiAgICB9LAogICAgLy8g5ZCM5q2l5b6u5L+h5qih54mI5raI5oGvCiAgICB3ZWNoYXRUZW1wbGF0ZSgpIHsKICAgICAgd2VjaGF0U3luY1RlbXBsYXRlKCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MocmVzLm1zZyk7CiAgICAgICAgICB0aGlzLmNoYW5nZVRhYih0aGlzLmN1cnJlbnRUYWIpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1zZyk7CiAgICAgICAgfSk7CiAgICB9LAogICAgLy8g5byA5ZCv5YWz6ZetCiAgICBjaGFuZ2VTdGF0dXMoKSB7fSwKICAgIC8vIOWIl+ihqAogICAgbm90aWNlKCkge30sCiAgICAvLyDorr7nva4KICAgIHNldHRpbmcocm93KSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBwYXRoOiB0aGlzLiRyb3V0ZVByb1N0ciArICcvc2V0dGluZy9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uRWRpdD9pZD0nICsgcm93LmlkLAogICAgICB9KTsKICAgIH0sCiAgICBnZXREYXRhKGtleXMsIHJvdywgaXRlbSkgewogICAgICB0aGlzLmZvcm1EYXRhID0ge307CiAgICAgIGdldE5vdGlmaWNhdGlvbkluZm8ocm93LmlkLCBpdGVtKS50aGVuKChyZXMpID0+IHsKICAgICAgICBrZXlzLm1hcCgoaSwgdikgPT4gewogICAgICAgICAgdGhpcy5mb3JtRGF0YVtpXSA9IHJlcy5kYXRhW2ldOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuZm9ybURhdGEudHlwZSA9IGl0ZW07CiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25Nb2RhbCA9IHRydWU7CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOWIoOmZpAogICAgZGVsKHJvdywgdGl0LCBudW0pIHsKICAgICAgbGV0IGRlbGZyb21EYXRhID0gewogICAgICAgIHRpdGxlOiB0aXQsCiAgICAgICAgbnVtOiBudW0sCiAgICAgICAgdXJsOiBgc2V0dGluZy9ub3RpZmljYXRpb24vZGVsX25vdC8ke3Jvdy5pZH1gLAogICAgICAgIG1ldGhvZDogJ0RFTEVURScsCiAgICAgICAgaWRzOiAnJywKICAgICAgfTsKICAgICAgdGhpcy4kbW9kYWxTdXJlKGRlbGZyb21EYXRhKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2VzcyhyZXMubXNnKTsKICAgICAgICAgIHRoaXMubGV2ZWxMaXN0cy5zcGxpY2UobnVtLCAxKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICAgIH0pOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAgKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/setting/notification","sourcesContent":["<template>\n  <div class=\"message\">\n    <el-card :bordered=\"false\" shadow=\"never\" class=\"ivu-mt\" :body-style=\"{ padding: '0 20px 20px' }\">\n      <div>\n        <el-tabs v-model=\"currentTab\" @tab-click=\"changeTab\">\n          <el-tab-pane\n            :label=\"item.label\"\n            :name=\"item.value.toString()\"\n            v-for=\"(item, index) in headerList\"\n            :key=\"index\"\n          />\n        </el-tabs>\n      </div>\n      <el-row class=\"mb14\" v-if=\"currentTab == 1\">\n        <el-col>\n          <el-button v-auth=\"['app-wechat-template-sync']\" type=\"primary\" v-db-click @click=\"routineTemplate\"\n            >同步小程序订阅消息</el-button\n          >\n          <el-button v-auth=\"['app-wechat-template-sync']\" type=\"primary\" v-db-click @click=\"wechatTemplate\"\n            >同步微信模版消息</el-button\n          >\n        </el-col>\n      </el-row>\n      <el-row class=\"mb14\" v-if=\"currentTab == 3\">\n        <el-col>\n          <el-button type=\"primary\" v-db-click @click=\"notificationForm(0)\">添加通知</el-button>\n        </el-col>\n      </el-row>\n      <el-alert v-if=\"currentTab == 1\" type=\"warning\" :closable=\"false\">\n        <template slot=\"title\">\n          <p class=\"alert_title\">小程序订阅消息</p>\n          登录微信小程序后台，基本设置，服务类目增加《生活服务 > 百货/超市/便利店》 (否则同步小程序订阅消息会报错)<br />\n          同步小程序订阅消息，是在小程序后台未添加订阅消息模板的前提下使用的，会新增一个模板消息并把信息同步过来，并新本项目数据库。<br />\n          <br />\n          <p class=\"alert_title\">微信模板消息</p>\n          登录微信公众号后台，选择模板消息，在账号详情下的服务类目中手动设置服务类目，《生活服务 >\n          百货/超市/便利店》(否则同步模板消息不成功)<br />\n          同步公众号模板消息，同步公众号模板会删除公众号后台现有的模板，并重新添加新的模板，然后同步信息到数据库，如果多个项目使用同一个公众号的模板，请谨慎操作。\n        </template>\n      </el-alert>\n      <el-table\n        :data=\"levelLists\"\n        ref=\"table\"\n        class=\"mt14\"\n        v-loading=\"loading\"\n        highlight-current-row\n        no-userFrom-text=\"暂无数据\"\n        no-filtered-userFrom-text=\"暂无筛选结果\"\n      >\n        <el-table-column label=\"ID\" width=\"80\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.id }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"通知类型\" min-width=\"130\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.name }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"通知场景说明\" min-width=\"130\">\n          <template slot-scope=\"scope\">\n            <span>{{ scope.row.title }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"站内信\" min-width=\"130\">\n          <template slot-scope=\"scope\">\n            <el-switch\n              v-if=\"scope.row.is_system !== 0\"\n              :active-value=\"1\"\n              :inactive-value=\"2\"\n              v-model=\"scope.row.is_system\"\n              :value=\"scope.row.is_system\"\n              @change=\"changeSwitch($event, scope.row, 'is_system')\"\n              size=\"large\"\n              :disabled=\"scope.row.is_system == 0\"\n            >\n            </el-switch>\n            <div v-else>-</div>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"公众号模板\" min-width=\"130\">\n          <template slot-scope=\"scope\">\n            <el-switch\n              v-if=\"scope.row.is_wechat !== 0\"\n              :active-value=\"1\"\n              :inactive-value=\"2\"\n              v-model=\"scope.row.is_wechat\"\n              :value=\"scope.row.is_wechat\"\n              @change=\"changeSwitch($event, scope.row, 'is_wechat')\"\n              size=\"large\"\n              :disabled=\"scope.row.is_wechat == 0\"\n            >\n            </el-switch>\n            <div v-else>-</div>\n          </template>\n        </el-table-column>\n\n        <el-table-column label=\"发送短信\" min-width=\"130\">\n          <template slot-scope=\"scope\">\n            <el-switch\n              v-if=\"scope.row.is_sms !== 0\"\n              :active-value=\"1\"\n              :inactive-value=\"2\"\n              v-model=\"scope.row.is_sms\"\n              :value=\"scope.row.is_sms\"\n              @change=\"changeSwitch($event, scope.row, 'is_sms')\"\n              size=\"large\"\n            >\n            </el-switch>\n            <div v-else>-</div>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"企业微信\" min-width=\"130\" v-if=\"currentTab != 1\">\n          <template slot-scope=\"scope\">\n            <el-switch\n              v-if=\"scope.row.is_ent_wechat !== 0\"\n              :active-value=\"1\"\n              :inactive-value=\"2\"\n              v-model=\"scope.row.is_ent_wechat\"\n              :value=\"scope.row.is_ent_wechat\"\n              @change=\"changeSwitch($event, scope.row, 'is_ent_wechat')\"\n              size=\"large\"\n            >\n            </el-switch>\n            <div v-else>-</div>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"小程序订阅\" min-width=\"130\" v-if=\"currentTab == 1 || currentTab == 3\">\n          <template slot-scope=\"scope\">\n            <el-switch\n              v-if=\"scope.row.is_routine !== 0\"\n              :active-value=\"1\"\n              :inactive-value=\"2\"\n              v-model=\"scope.row.is_routine\"\n              :value=\"scope.row.is_routine\"\n              @change=\"changeSwitch($event, scope.row, 'is_routine')\"\n              size=\"large\"\n              :disabled=\"scope.row.is_routine == 0\"\n            >\n            </el-switch>\n            <div v-else>-</div>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" fixed=\"right\" :width=\"currentTab == 3 ? 130 : 70\">\n          <template slot-scope=\"scope\">\n            <a class=\"setting btn\" v-db-click @click=\"setting(scope.row)\">设置</a>\n            <template v-if=\"currentTab == 3\">\n              <el-divider direction=\"vertical\"></el-divider>\n              <a class=\"setting btn\" v-db-click @click=\"notificationForm(scope.row.id)\">编辑</a>\n              <el-divider direction=\"vertical\"></el-divider>\n              <a class=\"setting btn\" v-db-click @click=\"del(scope.row, '删除', scope.$index)\">删除</a>\n            </template>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { getNotificationList, getNotificationInfo, noticeStatus, notificationForm } from '@/api/notification.js';\nimport { routineSyncTemplate, wechatSyncTemplate } from '@/api/app';\nexport default {\n  data() {\n    return {\n      modalTitle: '',\n      notificationModal: false,\n      headerList: [\n        { label: '会员通知', value: '1' },\n        { label: '平台通知', value: '2' },\n        { label: '自定义通知', value: '3' },\n      ],\n      levelLists: [],\n      currentTab: '1',\n      loading: false,\n      formData: {},\n    };\n  },\n  created() {\n    this.changeTab(this.currentTab);\n  },\n  methods: {\n    changeSwitch(e, row, type) {\n      noticeStatus(type, row[type], row.id)\n        .then((res) => {\n          this.$message.success(res.msg);\n        })\n        .catch((err) => {\n          this.$message.error(err.msg);\n        });\n    },\n    notificationForm(id) {\n      this.$modalForm(notificationForm(id)).then(() => this.changeTab());\n    },\n    changeTab() {\n      getNotificationList(this.currentTab).then((res) => {\n        this.levelLists = res.data;\n      });\n    },\n    // 同步订阅消息\n    routineTemplate() {\n      routineSyncTemplate()\n        .then((res) => {\n          this.$message.success(res.msg);\n          this.changeTab(this.currentTab);\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    // 同步微信模版消息\n    wechatTemplate() {\n      wechatSyncTemplate()\n        .then((res) => {\n          this.$message.success(res.msg);\n          this.changeTab(this.currentTab);\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    // 开启关闭\n    changeStatus() {},\n    // 列表\n    notice() {},\n    // 设置\n    setting(row) {\n      this.$router.push({\n        path: this.$routeProStr + '/setting/notification/notificationEdit?id=' + row.id,\n      });\n    },\n    getData(keys, row, item) {\n      this.formData = {};\n      getNotificationInfo(row.id, item).then((res) => {\n        keys.map((i, v) => {\n          this.formData[i] = res.data[i];\n        });\n        this.formData.type = item;\n        this.notificationModal = true;\n      });\n    },\n    // 删除\n    del(row, tit, num) {\n      let delfromData = {\n        title: tit,\n        num: num,\n        url: `setting/notification/del_not/${row.id}`,\n        method: 'DELETE',\n        ids: '',\n      };\n      this.$modalSure(delfromData)\n        .then((res) => {\n          this.$message.success(res.msg);\n          this.levelLists.splice(num, 1);\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n::v-deep .el-tabs__item {\n  height: 54px !important;\n  line-height: 54px !important;\n}\n.message ::v-deep .ivu-table-header thead tr th {\n  padding: 8px 16px;\n}\n.message ::v-deep .ivu-tabs-tab {\n  border-radius: 0 !important;\n}\n.table-box {\n  padding: 20px;\n}\n.is-table {\n  display: flex;\n  /* justify-content: space-around; */\n  justify-content: center;\n}\n.btn {\n  padding: 6px 0px;\n  cursor: pointer;\n  font-size: 12px;\n  border-radius: 3px;\n}\n.is-switch-close {\n  background-color: #504444;\n}\n.is-switch {\n  background-color: #eb5252;\n}\n.notice-list {\n  background-color: #308cf5;\n  margin: 0 15px;\n}\n.table {\n  padding: 0 18px;\n}\n.alert_title {\n  margin-bottom: 5px;\n  font-weight: 700;\n}\n</style>\n"]}]}