{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\order\\orderList\\handle\\orderRefund.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\order\\orderList\\handle\\orderRefund.vue","mtime":1739963172876},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1753254258567},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7CiAgZ2V0RXhwcmVzc0RhdGEsCiAgcHV0RGVsaXZlcnksCiAgc3BsaXREZWxpdmVyeSwKICBvcmRlckV4cHJlc3NUZW1wLAogIG9yZGVyRGVsaXZlcnlMaXN0LAogIG9yZGVyU2hlZXRJbmZvLAogIHNwbGl0Q2FydEluZm8sCiAgb3JkZXJQcmljZSwKICByZWZ1bmRQcmljZSwKfSBmcm9tICdAL2FwaS9vcmRlcic7CmltcG9ydCBwcmludEpTIGZyb20gJ3ByaW50LWpzJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdvcmRlclNlbmQnLAogIHByb3BzOiB7CiAgICBvcmRlcklkOiBOdW1iZXIsCiAgICBzdGF0dXM6IE51bWJlciwKICAgIC8vIHRvdGFsX251bTogTnVtYmVyLAogICAgcGF5X3R5cGU6IFN0cmluZywKICAgIHZpcnR1YWxfdHlwZTogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDAsCiAgICB9LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG9yZGVyU3RhdHVzOiAwLAogICAgICB0b3RhbF9udW06IDAsCiAgICAgIHNwbGl0U3dpdGNoOiB0cnVlLAogICAgICBvcmRlcl9pZDogJycsCiAgICAgIGZvcm1JdGVtOiB7CiAgICAgICAgcmVmdW5kX3ByaWNlOiAnJywKICAgICAgICBjYXJ0X2lkczogW10sCiAgICAgIH0sCiAgICAgIG1vZGFsczogZmFsc2UsCiAgICAgIGV4cHJlc3M6IFtdLAogICAgICBrdWFpZGlFeHByZXNzOiBbXSwKICAgICAgZXhwcmVzc1RlbXA6IFtdLAogICAgICBkZWxpdmVyeUxpc3Q6IFtdLAogICAgICB0ZW1wOiB7fSwKICAgICAgZXhwb3J0X29wZW46IGZhbHNlLAogICAgICBtYW55Rm9ybVZhbGlkYXRlOiBbXSwKICAgICAgc2VsZWN0RGF0YTogW10sCiAgICAgIHNlbmRQcmljZTogMCwKICAgICAgcnVsZVZhbGlkYXRlOiB7IHNoX2RlbGl2ZXJ5OiBbeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpemAgei0p+S6uicsIHRyaWdnZXI6ICdjaGFuZ2UnIH1dIH0sCiAgICAgIGRlbGl2ZXJ5RXJyb3JNc2c6ICcnLAogICAgICBpc0xvYWRpbmc6IHRydWUsCiAgICAgIHVzZXJTZW5kbXNnOiB7fSwKICAgIH07CiAgfSwKICBtb3VudGVkKCkge30sCiAgbWV0aG9kczogewogICAgaGFuZGxlQ2hhbmdlKGUsIHBhcmFtcywgaW5kZXgpIHsKICAgICAgbGV0IHRvdGFsID0gMDsKICAgICAgdGhpcy5zZWxlY3REYXRhLmZvckVhY2goKHYsIGkpID0+IHsKICAgICAgICBjb25zb2xlLmxvZyh2Lm51bSkKICAgICAgICB0b3RhbCArPSB2Lm51bSAqIHYuY2FydF9pbmZvLnRydWVQcmljZTsKICAgICAgfSk7CiAgICAgIHRoaXMuZm9ybUl0ZW0ucmVmdW5kX3ByaWNlID0gdG90YWw7CiAgICB9LAogICAgc2VsZWN0T25lKGRhdGEpIHsKICAgICAgdGhpcy5zZWxlY3REYXRhID0gZGF0YTsKICAgICAgaWYgKHRoaXMuc2VsZWN0RGF0YS5sZW5ndGgpIHsKICAgICAgICBsZXQgdG90YWwgPSAwOwogICAgICAgIHRoaXMuc2VsZWN0RGF0YS5mb3JFYWNoKCh2LCBpKSA9PiB7CiAgICAgICAgICB0b3RhbCArPSB2Lm51bSAqIHYuY2FydF9pbmZvLnRydWVQcmljZTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmZvcm1JdGVtLnJlZnVuZF9wcmljZSA9IHRvdGFsLnRvRml4ZWQoMik7CiAgICAgIH0KICAgIH0sCiAgICBjaGFuZ2VNb2RhbCgpIHsKICAgICAgdGhpcy5jYW5jZWwoKTsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgfSwKICAgIGNoYW5nZVNwbGl0U3RhdHVzKHN0YXR1cykgewogICAgICAvLyB0aGlzLnNwbGl0U3dpdGNoID0gc3RhdHVzOwogICAgICBpZiAoc3RhdHVzKSB7CiAgICAgICAgc3BsaXRDYXJ0SW5mbyh0aGlzLm9yZGVySWQpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5tYW55Rm9ybVZhbGlkYXRlID0gW107CiAgICAgICAgICBPYmplY3Qua2V5cyhyZXMuZGF0YSkuZm9yRWFjaCgoa2V5KSA9PiB7CiAgICAgICAgICAgIHRoaXMubWFueUZvcm1WYWxpZGF0ZS5wdXNoKHJlcy5kYXRhW2tleV0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5mb3JtSXRlbS5jYXJ0X2lkcyA9IFtdOwogICAgICAgIHRoaXMuc2VsZWN0RGF0YSA9IFtdOwogICAgICB9CiAgICB9LAogICAgcmVzZXQoKSB7CiAgICAgIHRoaXMuZm9ybUl0ZW0gPSB7CiAgICAgICAgcmVmdW5kX3ByaWNlOiAnJywKICAgICAgICBjYXJ0X2lkczogW10sCiAgICAgIH07CiAgICB9LAogICAgLy8g5o+Q5LqkCiAgICBwdXRTZW5kKG5hbWUpIHsKICAgICAgdGhpcy5mb3JtSXRlbS5jYXJ0X2lkcyA9IFtdOwogICAgICBsZXQgc3BsaXROdW1TdGF0dXMgPSB0cnVlOwogICAgICBpZiAodGhpcy5zcGxpdFN3aXRjaCkgewogICAgICAgIHRoaXMuc2VsZWN0RGF0YS5mb3JFYWNoKCh2KSA9PiB7CiAgICAgICAgICBpZiAoIXYubnVtKSB7CiAgICAgICAgICAgIHNwbGl0TnVtU3RhdHVzID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmZvcm1JdGVtLmNhcnRfaWRzLnB1c2goewogICAgICAgICAgICBjYXJ0X2lkOiB2LmNhcnRfaWQsCiAgICAgICAgICAgIGNhcnRfbnVtOiB2Lm51bSB8fCB2LnN1cnBsdXNfbnVtLAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKCFzcGxpdE51bVN0YXR1cykgewogICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfor7fpgInmi6npgIDmrL7mlbDph48nKTsKICAgICAgfQogICAgICByZWZ1bmRQcmljZSh0aGlzLm9yZGVySWQsIHRoaXMuZm9ybUl0ZW0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5tb2RhbHMgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2VzcyhyZXMubXNnKTsKICAgICAgICAgIHRoaXMuJGVtaXQoJ3N1Ym1pdEZhaWwnKTsKICAgICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICAgIHRoaXMuc3BsaXRTd2l0Y2ggPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXMuZGF0YS5sYWJlbCkgdGhpcy5wcmludEltZyhyZXMuZGF0YS5sYWJlbCk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKHJlcykgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBjYW5jZWwobmFtZSkgewogICAgICB0aGlzLm1vZGFscyA9IGZhbHNlOwogICAgICB0aGlzLm9yZGVyU3RhdHVzID0gMDsKICAgICAgdGhpcy5zZW5kUHJpY2UgPSAwOwogICAgICB0aGlzLmRlbGl2ZXJ5RXJyb3JNc2cgPSAnJzsKICAgICAgdGhpcy5zcGxpdFN3aXRjaCA9IGZhbHNlOwogICAgICB0aGlzLnNlbGVjdERhdGEgPSBbXTsKICAgICAgdGhpcy5mb3JtSXRlbS50eXBlID0gJzEnOwogICAgICB0aGlzLiRlbWl0KCdjbGVhcklkJyk7CiAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgLy8gdGhpcy4kcmVmc1tuYW1lXS5yZXNldEZpZWxkcygpOwogICAgICAvLyB0aGlzLmZvcm1JdGVtLnR5cGUgPSAnMSc7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["orderRefund.vue"],"names":[],"mappings":";AA8GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"orderRefund.vue","sourceRoot":"src/pages/order/orderList/handle","sourcesContent":["<template>\n  <el-dialog\n    :visible.sync=\"modals\"\n    title=\"订单退款\"\n    class=\"order_box\"\n    :show-close=\"true\"\n    width=\"1000px\"\n    @closed=\"changeModal\"\n  >\n    <el-form\n      v-if=\"modals\"\n      ref=\"formItem\"\n      :rules=\"ruleValidate\"\n      :model=\"formItem\"\n      label-width=\"100px\"\n      @submit.native.prevent\n    >\n      <el-form-item label=\"订单号：\">\n        <el-input v-model=\"order_id\" disabled placeholder=\"请输入订单号\" style=\"width: 60%\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"退款金额：\">\n        <el-input-number\n          v-model=\"formItem.refund_price\"\n          placeholder=\"请输入退款金额\"\n          style=\"width: 60%\"\n        ></el-input-number>\n      </el-form-item>\n      <div v-if=\"total_num > 1\">\n        <el-form-item label=\"分单退款：\">\n          <el-switch\n            :active-value=\"1\"\n            :inactive-value=\"0\"\n            size=\"large\"\n            v-model=\"splitSwitch\"\n            :disabled=\"orderStatus === 8 || orderStatus === 11\"\n            @change=\"changeSplitStatus\"\n          >\n            <span slot=\"open\">开启</span>\n            <span slot=\"close\">关闭</span>\n          </el-switch>\n          <div class=\"trips\">\n            <p>可选择表格中的商品单独退款，请谨慎操作！</p>\n          </div>\n          <el-table\n            v-if=\"splitSwitch && manyFormValidate.length\"\n            ref=\"table\"\n            :data=\"manyFormValidate\"\n            @selection-change=\"selectOne\"\n          >\n            <el-table-column type=\"selection\" width=\"55\"> </el-table-column>\n            <el-table-column label=\"商品信息\" width=\"200\">\n              <template slot-scope=\"scope\">\n                <div class=\"product-data\">\n                  <img class=\"image\" :src=\"scope.row.cart_info.productInfo.image\" />\n                  <div class=\"line2\">\n                    {{ scope.row.cart_info.productInfo.store_name }}\n                  </div>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"规格\" min-width=\"120\">\n              <template slot-scope=\"scope\">\n                <div>{{ scope.row.cart_info.productInfo.attrInfo.suk }}</div>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"价格\" min-width=\"120\">\n              <template slot-scope=\"scope\">\n                <div class=\"product-data\">\n                  <div>{{ scope.row.cart_info.truePrice }}</div>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"总数\" min-width=\"120\">\n              <template slot-scope=\"scope\">\n                <div>{{ scope.row.cart_num }}</div>\n              </template>\n            </el-table-column>\n            <el-table-column label=\"退款数量\" width=\"180\">\n              <template slot-scope=\"scope\">\n                <el-input-number\n                  v-model=\"scope.row.num\"\n                  :controls=\"false\"\n                  :min=\"1\"\n                  :max=\"scope.row.cart_num\"\n                  @change=\"\n                    (e) => {\n                      handleChange(e, scope.row, scope.$index);\n                    }\n                  \"\n                ></el-input-number>\n              </template>\n            </el-table-column>\n          </el-table>\n        </el-form-item>\n      </div>\n    </el-form>\n    <div slot=\"footer\">\n      <el-button v-db-click @click=\"cancel\">取消</el-button>\n      <el-button type=\"primary\" v-db-click @click=\"putSend\">提交</el-button>\n    </div>\n    <!-- <viewer @inited=\"inited\">\n            <img :src=\"temp.pic\" style=\"display:none\" />\n        </viewer> -->\n    <div ref=\"viewer\" v-viewer>\n      <img :src=\"temp.pic\" style=\"display: none\" />\n    </div>\n  </el-dialog>\n</template>\n\n<script>\nimport {\n  getExpressData,\n  putDelivery,\n  splitDelivery,\n  orderExpressTemp,\n  orderDeliveryList,\n  orderSheetInfo,\n  splitCartInfo,\n  orderPrice,\n  refundPrice,\n} from '@/api/order';\nimport printJS from 'print-js';\nexport default {\n  name: 'orderSend',\n  props: {\n    orderId: Number,\n    status: Number,\n    // total_num: Number,\n    pay_type: String,\n    virtual_type: {\n      type: Number,\n      default: 0,\n    },\n  },\n  data() {\n    return {\n      orderStatus: 0,\n      total_num: 0,\n      splitSwitch: true,\n      order_id: '',\n      formItem: {\n        refund_price: '',\n        cart_ids: [],\n      },\n      modals: false,\n      express: [],\n      kuaidiExpress: [],\n      expressTemp: [],\n      deliveryList: [],\n      temp: {},\n      export_open: false,\n      manyFormValidate: [],\n      selectData: [],\n      sendPrice: 0,\n      ruleValidate: { sh_delivery: [{ required: true, message: '请输入送货人', trigger: 'change' }] },\n      deliveryErrorMsg: '',\n      isLoading: true,\n      userSendmsg: {},\n    };\n  },\n  mounted() {},\n  methods: {\n    handleChange(e, params, index) {\n      let total = 0;\n      this.selectData.forEach((v, i) => {\n        console.log(v.num)\n        total += v.num * v.cart_info.truePrice;\n      });\n      this.formItem.refund_price = total;\n    },\n    selectOne(data) {\n      this.selectData = data;\n      if (this.selectData.length) {\n        let total = 0;\n        this.selectData.forEach((v, i) => {\n          total += v.num * v.cart_info.truePrice;\n        });\n        this.formItem.refund_price = total.toFixed(2);\n      }\n    },\n    changeModal() {\n      this.cancel();\n      this.isLoading = true;\n    },\n    changeSplitStatus(status) {\n      // this.splitSwitch = status;\n      if (status) {\n        splitCartInfo(this.orderId).then((res) => {\n          this.manyFormValidate = [];\n          Object.keys(res.data).forEach((key) => {\n            this.manyFormValidate.push(res.data[key]);\n          });\n        });\n      } else {\n        this.formItem.cart_ids = [];\n        this.selectData = [];\n      }\n    },\n    reset() {\n      this.formItem = {\n        refund_price: '',\n        cart_ids: [],\n      };\n    },\n    // 提交\n    putSend(name) {\n      this.formItem.cart_ids = [];\n      let splitNumStatus = true;\n      if (this.splitSwitch) {\n        this.selectData.forEach((v) => {\n          if (!v.num) {\n            splitNumStatus = false;\n          }\n          this.formItem.cart_ids.push({\n            cart_id: v.cart_id,\n            cart_num: v.num || v.surplus_num,\n          });\n        });\n      }\n      if (!splitNumStatus) {\n        return this.$message.error('请选择退款数量');\n      }\n      refundPrice(this.orderId, this.formItem)\n        .then((res) => {\n          this.modals = false;\n          this.$message.success(res.msg);\n          this.$emit('submitFail');\n          this.reset();\n          this.splitSwitch = false;\n          if (res.data.label) this.printImg(res.data.label);\n        })\n        .catch((res) => {\n          this.$message.error(res.msg);\n        });\n    },\n    cancel(name) {\n      this.modals = false;\n      this.orderStatus = 0;\n      this.sendPrice = 0;\n      this.deliveryErrorMsg = '';\n      this.splitSwitch = false;\n      this.selectData = [];\n      this.formItem.type = '1';\n      this.$emit('clearId');\n      this.reset();\n      // this.$refs[name].resetFields();\n      // this.formItem.type = '1';\n    },\n  },\n};\n</script>\n\n<style scoped>\n.express_temp_id {\n  position: relative;\n}\n\n.express_temp_id button {\n  position: absolute;\n  top: 50%;\n  left: 61%;\n  padding: 0;\n  border: none;\n  background: none;\n  transform: translateY(-50%);\n  color: #57a3f3;\n}\n\n.ivu-btn-text:focus {\n  box-shadow: none;\n}\n.trips {\n  color: #ccc;\n  font-size: 12px;\n}\n.product-data {\n  display: flex;\n  align-items: center;\n  /* width: 200px; */\n}\n.product-data .image {\n  width: 50px !important;\n  height: 50px !important;\n  margin-right: 10px;\n}\n.line2 {\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n.from-box {\n  position: relative;\n}\n.trip {\n  position: absolute;\n  bottom: -26px;\n  left: 0;\n  color: red;\n  font-size: 12px;\n}\n.coumped {\n  font-size: 12px;\n}\n</style>\n"]}]}