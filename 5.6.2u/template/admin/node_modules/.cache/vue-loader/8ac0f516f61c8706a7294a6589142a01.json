{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\marketing\\storeCouponIssue\\create.vue?vue&type=style&index=0&id=0b90723c&scoped=true&lang=scss","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\marketing\\storeCouponIssue\\create.vue","mtime":1746771908482},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\css-loader\\index.js","mtime":1753254259822},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1753254262918},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1753254258547},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1753254255270},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5jb250ZW50X3dpZHRoIHsKICB3aWR0aDogNDE0cHg7Cn0KCi5pbmZvIHsKICBjb2xvcjogIzg4ODsKICBmb250LXNpemU6IDEycHg7Cn0KCi5waWN0cnVlIHsKICB3aWR0aDogNjBweDsKICBoZWlnaHQ6IDYwcHg7CiAgYm9yZGVyOiAxcHggZG90dGVkIHJnYmEoMCwgMCwgMCwgMC4xKTsKICBtYXJnaW4tcmlnaHQ6IDE1cHg7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBjdXJzb3I6IHBvaW50ZXI7CgogIGltZyB7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKICB9CgogIC5idG5kZWwgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgei1pbmRleDogMTsKICAgIHdpZHRoOiAyMHB4ICFpbXBvcnRhbnQ7CiAgICBoZWlnaHQ6IDIwcHggIWltcG9ydGFudDsKICAgIGxlZnQ6IDQ2cHg7CiAgICB0b3A6IC00cHg7CiAgfQp9CgoudXBMb2FkIHsKICB3aWR0aDogNThweDsKICBoZWlnaHQ6IDU4cHg7CiAgbGluZS1oZWlnaHQ6IDU4cHg7CiAgYm9yZGVyOiAxcHggZG90dGVkIHJnYmEoMCwgMCwgMCwgMC4xKTsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjAyKTsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KCi5pdnUtaWNvbi1pb3MtY2xvc2UtY2lyY2xlIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwOwogIHJpZ2h0OiAwOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlKDUwJSwgLTUwJSk7Cn0KCi50aXAgewogIGNvbG9yOiAjODg4OwogIGZvbnQtc2l6ZTogMTJweDsKICBsaW5lLWhlaWdodDogMTZweDsKfQo="},{"version":3,"sources":["create.vue"],"names":[],"mappings":";AA8cA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"create.vue","sourceRoot":"src/pages/marketing/storeCouponIssue","sourcesContent":["<template>\n  <div>\n    <pages-header\n      ref=\"pageHeader\"\n      :title=\"$route.params.id ? '编辑优惠券' : '添加优惠券'\"\n      :backUrl=\"$routeProStr + '/marketing/store_coupon_issue/index'\"\n    ></pages-header>\n    <el-card :bordered=\"false\" shadow=\"never\" class=\"mt16\">\n      <el-form :model=\"formData\" label-width=\"160px\">\n        <el-form-item label=\"优惠券名称：\">\n          <el-input\n            v-model=\"formData.coupon_title\"\n            maxlength=\"18\"\n            show-word-limit\n            placeholder=\"请输入优惠券名称\"\n            class=\"content_width\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"优惠券面值：\">\n          <el-input-number\n            :controls=\"false\"\n            :min=\"1\"\n            :max=\"9999999999\"\n            v-model=\"formData.coupon_price\"\n            class=\"content_width input-number-unit-class\"\n            class-unit=\"元\"\n            :disabled=\"isEdit\"\n          ></el-input-number>\n        </el-form-item>\n        <el-form-item label=\"用户类型：\">\n          <el-radio-group v-model=\"formData.user_type\" :disabled=\"isEdit\" @input=\"changeUserType\">\n            <el-radio :label=\"1\">普通用户</el-radio>\n            <el-radio :label=\"2\">付费会员用户</el-radio>\n          </el-radio-group>\n          <div class=\"tip\">\n            普通用户：所有用户都能获取到的优惠券；<br />\n            付费会员用户：仅付费会员才能领取的优惠券；\n          </div>\n        </el-form-item>\n        <el-form-item label=\"发送方式：\" v-show=\"formData.user_type == 1\">\n          <el-radio-group v-model=\"formData.receive_type\" :disabled=\"isEdit\">\n            <el-radio :label=\"1\">用户领取</el-radio>\n            <el-radio :label=\"3\">系统赠送</el-radio>\n          </el-radio-group>\n          <div class=\"tip\">\n            用户领取：用户需要手动领取优惠券；<br />\n            系统赠送：1.后台发放指定用户。2.添加到商品里面用户购买该商品获得。3.设置新人礼页面新用户注册赠送优惠券；\n          </div>\n        </el-form-item>\n        <el-form-item label=\"优惠劵类型：\">\n          <el-radio-group v-model=\"formData.type\" :disabled=\"isEdit\">\n            <el-radio :label=\"0\">通用券</el-radio>\n            <el-radio :label=\"1\">品类券</el-radio>\n            <el-radio :label=\"2\">商品券</el-radio>\n            <!--                        <el-radio :label=\"3\">会员券</el-radio>-->\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item v-show=\"formData.type === 2\">\n          <template>\n            <div class=\"acea-row\">\n              <div v-for=\"(item, index) in productList\" :key=\"index\" class=\"pictrue\">\n                <img v-lazy=\"item.image\" />\n                <i  v-if=\"formData.type == 2 && !formData.id\" class=\"el-icon-error btndel\" v-db-click @click=\"remove(item.product_id)\"></i>\n              </div>\n              <div v-if=\"formData.type == 2 && !formData.id\" class=\"upLoad acea-row row-center-wrapper\" v-db-click @click=\"modals = true\">\n                <i class=\"el-icon-goods\" style=\"font-size: 24px\"></i>\n              </div>\n            </div>\n          </template>\n        </el-form-item>\n        <el-form-item v-show=\"formData.type === 1\">\n          <el-cascader\n            v-model=\"formData.category_id\"\n            size=\"small\"\n            :options=\"categoryList\"\n            :props=\"{ multiple: true, emitPath: false, checkStrictly: true }\"\n            clearable\n            style=\"width: 320px\"\n            :disabled=\"isEdit\"\n          ></el-cascader>\n          <div class=\"info\">选择商品的品类</div>\n        </el-form-item>\n        <el-form-item label=\"使用门槛：\">\n          <el-radio-group v-model=\"isMinPrice\" :disabled=\"isEdit\">\n            <el-radio :label=\"0\">无门槛</el-radio>\n            <el-radio :label=\"1\">有门槛</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item v-if=\"isMinPrice\">\n          <el-input-number\n            :controls=\"false\"\n            :min=\"0\"\n            :max=\"9999999999\"\n            v-model=\"formData.use_min_price\"\n            class=\"content_width input-number-unit-class\"\n            :disabled=\"isEdit\"\n            class-unit=\"元\"\n          ></el-input-number>\n          <div class=\"info\">填写优惠券的最低消费金额</div>\n        </el-form-item>\n        <el-form-item label=\"有效期：\">\n          <el-radio-group v-model=\"isCouponTime\" :disabled=\"isEdit\">\n            <el-radio :label=\"1\">天数</el-radio>\n            <el-radio :label=\"0\">时间段</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item v-show=\"isCouponTime\" label=\"\">\n          <el-input-number\n            :controls=\"false\"\n            :min=\"0\"\n            v-model=\"formData.coupon_time\"\n            :precision=\"0\"\n            class=\"content_width input-number-unit-class\"\n            :disabled=\"isEdit\"\n            class-unit=\"天\"\n          ></el-input-number>\n          <div class=\"info\">领取后多少天内有效</div>\n        </el-form-item>\n        <el-form-item v-show=\"!isCouponTime\" label=\"\">\n          <el-date-picker\n            v-model=\"datetime1\"\n            :disabled=\"isEdit\"\n            clearable\n            :editable=\"false\"\n            type=\"datetimerange\"\n            value-format=\"yyyy-MM-dd HH:mm:ss\"\n            style=\"width: 380px\"\n            range-separator=\"-\"\n            start-placeholder=\"开始日期\"\n            end-placeholder=\"结束日期\"\n            @change=\"dateChange\"\n          ></el-date-picker>\n        </el-form-item>\n\n        <el-form-item label=\"领取时间：\" v-if=\"formData.receive_type != 2 && formData.receive_type != 3\">\n          <el-radio-group v-model=\"isReceiveTime\" :disabled=\"isEdit\">\n            <el-radio :label=\"1\">限时</el-radio>\n            <el-radio :label=\"0\">不限时</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item v-show=\"isReceiveTime\" label=\"\">\n          <el-date-picker\n            clearable\n            v-model=\"datetime2\"\n            type=\"datetimerange\"\n            value-format=\"yyyy/MM/dd HH:mm:ss\"\n            style=\"width: 380px\"\n            range-separator=\"-\"\n            start-placeholder=\"开始日期\"\n            end-placeholder=\"结束日期\"\n            @change=\"timeChange\"\n            :disabled=\"isEdit\"\n          ></el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"优惠券发布数量：\" v-show=\"formData.receive_type == 1\">\n          <el-radio-group v-model=\"formData.is_permanent\" :disabled=\"isEdit\">\n            <el-radio :label=\"0\">限量</el-radio>\n            <el-radio :label=\"1\">不限量</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item v-show=\"!formData.is_permanent\" label=\"\">\n          <el-input-number\n            :controls=\"false\"\n            :min=\"isEdit ? formData.total_count : 1\"\n            :max=\"9999999999\"\n            v-model=\"formData.total_count\"\n            :precision=\"0\"\n            class=\"content_width input-number-unit-class\"\n            class-unit=\"张\"\n          ></el-input-number>\n          <div class=\"info\">填写优惠券的发布数量</div>\n        </el-form-item>\n        <el-form-item label=\"用户领取数量：\" v-if=\"formData.receive_type != 2 && formData.receive_type != 3\">\n          <el-input-number\n            :controls=\"false\"\n            :min=\"isEdit ? formData.receive_limit : 1\"\n            :max=\"9999999999\"\n            v-model=\"formData.receive_limit\"\n            :precision=\"0\"\n            class=\"content_width input-number-unit-class\"\n            class-unit=\"张\"\n          ></el-input-number>\n          <div class=\"info\">填写每个用户可以领取多少张</div>\n        </el-form-item>\n        <el-form-item label=\"状态：\">\n          <el-radio-group v-model=\"formData.status\">\n            <el-radio :label=\"1\">开启</el-radio>\n            <el-radio :label=\"0\">关闭</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" v-db-click @click=\"save\" :disabled=\"disabled\">{{\n            isEdit ? '立即保存' : '立即创建'\n          }}</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n    <el-dialog :visible.sync=\"modals\" title=\"商品列表\" class=\"paymentFooter\" width=\"1000px\">\n      <goods-list ref=\"goodslist\" v-if=\"modals\" :ischeckbox=\"true\" @getProductId=\"getProductId\"></goods-list>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex';\nimport goodsList from '@/components/goodsList/index';\nimport { couponSaveApi, couponDetailApi } from '@/api/marketing';\nimport { cascaderListApi } from '@/api/product';\nexport default {\n  name: 'storeCouponCreate',\n  components: {\n    goodsList,\n  },\n  data() {\n    return {\n      disabled: false,\n      formData: {\n        coupon_title: '',\n        coupon_price: 0,\n        type: 0,\n        use_min_price: 0,\n        coupon_time: 0,\n        start_use_time: 0,\n        end_use_time: 0,\n        start_time: 0,\n        end_time: 0,\n        user_type: 1,\n        receive_type: 1,\n        is_permanent: 1,\n        total_count: 1,\n        sort: 0,\n        status: 1,\n        product_id: '',\n        category_id: 0,\n        receive_limit: 1,\n      },\n      categoryList: [],\n      productList: [],\n      isMinPrice: 0,\n      isCouponTime: 1,\n      isReceiveTime: 0,\n      modals: false,\n      datetime1: ['2023-10-18 00:00:00', '2023-11-22 00:00:00'],\n      datetime2: [],\n    };\n  },\n  computed: {\n    ...mapState('media', ['isMobile']),\n    isEdit() {\n      return !!this.$route.params.edit;\n    },\n  },\n  created() {\n    this.getCategoryList();\n    if (this.$route.params.id) {\n      this.formData.id = (this.isEdit && Number(this.$route.params.id)) || 0;\n      this.getCouponDetail();\n    }\n  },\n  methods: {\n    changeUserType() {\n      if (this.formData.user_type == 2) {\n        this.formData.receive_type = 1;\n      }\n    },\n    // 品类\n    getCategoryList() {\n      cascaderListApi(1).then(async (res) => {\n        this.categoryList = res.data;\n      });\n    },\n    // 优惠券\n    getCouponDetail() {\n      couponDetailApi(this.$route.params.id)\n        .then((res) => {\n          let data = res.data;\n          this.formData.coupon_title = data.coupon_title;\n          this.formData.type = data.type;\n          this.formData.category_id = data.category_id;\n          this.formData.coupon_price = parseFloat(data.coupon_price);\n          this.formData.use_min_price = parseFloat(data.use_min_price);\n          if (this.formData.use_min_price) {\n            this.isMinPrice = 1;\n          }\n          this.formData.coupon_time = data.coupon_time;\n          this.formData.receive_type = data.receive_type;\n          this.formData.user_type = data.user_type;\n          this.formData.is_permanent = data.is_permanent;\n          this.formData.status = data.status;\n          this.formData.product_id = data.product_id;\n          this.formData.start_time = data.start_time;\n          this.formData.end_time = data.end_time;\n          this.formData.total_count = data.total_count;\n          this.formData.sort = data.sort;\n          this.formData.receive_limit = data.receive_limit;\n          if ('productInfo' in data) {\n            this.productList = data.productInfo;\n          }\n          if (!data.coupon_time) {\n            this.isCouponTime = 0;\n            this.datetime1 = [this.makeDate(data.start_use_time * 1000), this.makeDate(data.end_use_time * 1000)];\n            this.formData.start_use_time = this.makeDate(data.start_use_time * 1000);\n            this.formData.end_use_time = this.makeDate(data.end_use_time * 1000);\n          }\n          if (data.start_time) {\n            this.isReceiveTime = 1;\n            this.datetime2 = [data.start_time * 1000, data.end_time * 1000];\n            this.formData.start_time = this.makeDate(data.start_time * 1000);\n            this.formData.end_time = this.makeDate(data.end_time * 1000);\n          }\n        })\n        .catch((err) => {\n          this.$message.error(err.msg);\n        });\n    },\n    makeDate(data) {\n      let date = new Date(data);\n      let YY = date.getFullYear() + '-';\n      let MM = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';\n      let DD = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();\n      let hh = (date.getHours() < 10 ? '0' + date.getHours() : date.getHours()) + ':';\n      let mm = (date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes()) + ':';\n      let ss = date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds();\n      return YY + MM + DD + ' ' + hh + mm + ss;\n    },\n    // 创建\n    save() {\n      if (!this.formData.coupon_title) {\n        return this.$message.error('请输入优惠券名称');\n      }\n      if (this.formData.type === 2) {\n        if (!this.formData.product_id) {\n          return this.$message.error('请选择商品');\n        }\n      }\n      if (this.formData.type === 1) {\n        if (!this.formData.category_id) {\n          return this.$message.error('请选择品类');\n        }\n      }\n      if (this.formData.coupon_price <= 0) {\n        return this.$message.error('优惠券面值不能小于0');\n      }\n      if (!this.isMinPrice) {\n        this.formData.use_min_price = 0;\n      } else {\n        if (this.formData.use_min_price < 1) {\n          return this.$message.error('优惠券最低消费不能小于0');\n        }\n      }\n      if (this.isCouponTime) {\n        this.formData.start_use_time = 0;\n        this.formData.end_use_time = 0;\n        if (this.formData.coupon_time < 1) {\n          return this.$message.error('使用有效期限不能小于1天');\n        }\n      } else {\n        this.formData.coupon_time = 0;\n        if (!this.formData.start_use_time) {\n          return this.$message.error('请选择使用有效期限');\n        }\n      }\n      if (this.isReceiveTime) {\n        if (!this.formData.start_time) {\n          return this.$message.error('请选择领取时间');\n        }\n      } else {\n        this.formData.start_time = 0;\n        this.formData.end_time = 0;\n      }\n      // if (this.formData.receive_type == 2 || this.formData.receive_type == 3) {\n      //   this.formData.is_permanent = 1;\n      // }\n      if (this.formData.is_permanent) {\n        this.formData.total_count = 0;\n      } else {\n        if (this.formData.total_count < 1) {\n          return this.$message.error('发布数量不能小于1');\n        }\n      }\n      if (this.formData.receive_limit < 1) {\n        return this.$message.error('每个用户可以领取数量不能小于1');\n      }\n      if (this.formData.type == 0) {\n        this.formData.product_id = '';\n        this.formData.category_id = '';\n        this.productList = [];\n      } else if (this.formData.type == 1) {\n        this.formData.product_id = '';\n        this.productList = [];\n      } else if (this.formData.type == 2) {\n        this.formData.category_id = '';\n      }\n      if (this.disabled) return;\n      this.disabled = true;\n      couponSaveApi(this.formData)\n        .then((res) => {\n          this.$message.success(res.msg);\n          setTimeout(() => {\n            this.disabled = false;\n            this.$router.push({\n              path: this.$routeProStr + '/marketing/store_coupon_issue/index',\n            });\n          }, 1000);\n        })\n        .catch((err) => {\n          this.disabled = false;\n          this.$message.error(err.msg);\n        });\n    },\n    // 使用有效期--时间段\n    dateChange(time) {\n      this.formData.start_use_time = time[0];\n      this.formData.end_use_time = time[1];\n    },\n    // 限时\n    timeChange(time) {\n      this.formData.start_time = time[0];\n      this.formData.end_time = time[1];\n    },\n    //对象数组去重；\n    unique(arr) {\n      const res = new Map();\n      return arr.filter((arr) => !res.has(arr.product_id) && res.set(arr.product_id, 1));\n    },\n    // 选择的商品\n    getProductId(productList) {\n      this.modals = false;\n      this.productList = this.unique(this.productList.concat(productList));\n      this.formData.product_id = '';\n      this.productList.forEach((value) => {\n        if (this.formData.product_id) {\n          this.formData.product_id += `,${value.product_id}`;\n        } else {\n          this.formData.product_id += `${value.product_id}`;\n        }\n      });\n    },\n    cancel() {\n      this.modals = false;\n    },\n    // 删除商品\n    remove(productId) {\n      for (let index = 0; index < this.productList.length; index++) {\n        if (this.productList[index].product_id == productId) {\n          this.productList.splice(index, 1);\n        }\n      }\n      this.formData.product_id = '';\n      this.productList.forEach((value) => {\n        if (this.formData.product_id) {\n          this.formData.product_id += `,${value.product_id}`;\n        } else {\n          this.formData.product_id += `${value.product_id}`;\n        }\n      });\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n.content_width {\n  width: 414px;\n}\n\n.info {\n  color: #888;\n  font-size: 12px;\n}\n\n.pictrue {\n  width: 60px;\n  height: 60px;\n  border: 1px dotted rgba(0, 0, 0, 0.1);\n  margin-right: 15px;\n  display: inline-block;\n  position: relative;\n  cursor: pointer;\n\n  img {\n    width: 100%;\n    height: 100%;\n  }\n\n  .btndel {\n    position: absolute;\n    z-index: 1;\n    width: 20px !important;\n    height: 20px !important;\n    left: 46px;\n    top: -4px;\n  }\n}\n\n.upLoad {\n  width: 58px;\n  height: 58px;\n  line-height: 58px;\n  border: 1px dotted rgba(0, 0, 0, 0.1);\n  border-radius: 4px;\n  background: rgba(0, 0, 0, 0.02);\n  cursor: pointer;\n}\n\n.ivu-icon-ios-close-circle {\n  position: absolute;\n  top: 0;\n  right: 0;\n  transform: translate(50%, -50%);\n}\n\n.tip {\n  color: #888;\n  font-size: 12px;\n  line-height: 16px;\n}\n</style>\n"]}]}