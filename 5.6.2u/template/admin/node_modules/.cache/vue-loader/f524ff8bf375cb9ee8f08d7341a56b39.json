{"remainingRequest":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\setting\\notification\\notificationEdit.vue?vue&type=style&index=0&id=6aa879e6&scoped=true&lang=scss","dependencies":[{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\src\\pages\\setting\\notification\\notificationEdit.vue","mtime":1725344852908},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\css-loader\\index.js","mtime":1753254259822},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1753254262918},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1753254258547},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1753254255270},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1753254255279},{"path":"D:\\pc\\zm\\昆明阔翔科技有限公司\\源码\\CRMEB-BZ v5.6.2(20250630)\\template\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1753254260598}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5lZGl0IHsKfQouaGVhZGVyX3RvcCB7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKfQouZGVtby10YWJzLXN0eWxlMSA+IC5pdnUtdGFicy1jYXJkID4gLml2dS10YWJzLWNvbnRlbnQgewogIGhlaWdodDogMTIwcHg7CiAgbWFyZ2luLXRvcDogLTE2cHg7Cn0KCi5kZW1vLXRhYnMtc3R5bGUxID4gLml2dS10YWJzLWNhcmQgPiAuaXZ1LXRhYnMtY29udGVudCA+IC5pdnUtdGFicy10YWJwYW5lIHsKICBiYWNrZ3JvdW5kOiAjZmZmOwogIHBhZGRpbmc6IDE2cHg7Cn0KCi5kZW1vLXRhYnMtc3R5bGUxID4gLml2dS10YWJzLml2dS10YWJzLWNhcmQgPiAuaXZ1LXRhYnMtYmFyIC5pdnUtdGFicy10YWIgewogIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KCi5kZW1vLXRhYnMtc3R5bGUxID4gLml2dS10YWJzLWNhcmQgPiAuaXZ1LXRhYnMtYmFyIC5pdnUtdGFicy10YWItYWN0aXZlIHsKICBib3JkZXItY29sb3I6ICNmZmY7Cn0KCi50YWJzIHsKICBwYWRkaW5nOiAwIDMwcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKfQoKLnRyaXAgewogIGNvbG9yOiByZ2IoMTQ2LCAxMzksIDEzOSk7CiAgYmFja2dyb3VuZC1jb2xvcjogI2YyZjJmMjsKICBtYXJnaW4tbGVmdDogODBweDsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgcGFkZGluZzogMTVweDsKfQoKLmNvbnRlbnQgewogIGRpc3BsYXk6IGZsZXg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9CgouZm9ybS1zdHkgewogIG1hcmdpbi10b3A6IDIwcHg7Cn0KLnZhbHVlLWxpc3QgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICByaWdodDogN3B4OwogIGJvdHRvbTogN3B4OwogIHdpZHRoOiAyMnB4OwogIGhlaWdodDogMjJweDsKICBsaW5lLWhlaWdodDogMjJweDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgYmFja2dyb3VuZDogdmFyKC0tcHJldi1jb2xvci1wcmltYXJ5KTsKICBjb2xvcjogI2VkZWRlZDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9Ci52YXJpYWJsZSB7CiAgLml0ZW0gewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgcGFkZGluZzogNXB4IDEwcHg7CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlOwogIH0KICAuaXRlbTpob3ZlciB7CiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmV2LWNvbG9yLXByaW1hcnktbGlnaHQtOSk7CiAgICBjb2xvcjogdmFyKC0tcHJldi1jb2xvci1wcmltYXJ5KTsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICB9Cn0KLy8g5rua5Yqo5p2h5qC35byPCi52YXJpYWJsZTo6LXdlYmtpdC1zY3JvbGxiYXIgewogIHdpZHRoOiA0cHg7CiAgaGVpZ2h0OiA0cHg7Cn0KLnZhcmlhYmxlOjotd2Via2l0LXNjcm9sbGJhci10aHVtYiB7CiAgYmFja2dyb3VuZDogdmFyKC0tcHJldi1jb2xvci1wcmltYXJ5LWxpZ2h0LTkpOwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQoudmFyaWFibGU6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHsKICBiYWNrZ3JvdW5kOiAjZjJmMmYyOwp9Cg=="},{"version":3,"sources":["notificationEdit.vue"],"names":[],"mappings":";AA2ZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"notificationEdit.vue","sourceRoot":"src/pages/setting/notification","sourcesContent":["<template>\n  <div class=\"edit\">\n    <pages-header\n      ref=\"pageHeader\"\n      :title=\"$route.meta.title\"\n      :backUrl=\"$routeProStr + '/setting/notification/index'\"\n    ></pages-header>\n    <div class=\"tabs mt16\">\n      <el-row :gutter=\"32\">\n        <el-col :span=\"32\" class=\"demo-tabs-style1\" style=\"padding: 16px\">\n          <el-tabs v-model=\"tagName\" @tab-click=\"changeTabs\">\n            <el-tab-pane v-for=\"(item, index) in tabsList\" :key=\"index\" :name=\"item.slot\" :label=\"item.title\">\n              <el-form class=\"form-sty\" ref=\"formData\" :model=\"formData\" :rules=\"ruleValidate\" label-width=\"85px\">\n                <div v-if=\"item.slot === 'is_system' && !loading\">\n                  <el-form-item label=\"通知标题：\">\n                    <el-input\n                      v-model=\"formData.system_title\"\n                      placeholder=\"请输入通知标题\"\n                      style=\"width: 500px\"\n                    ></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"通知内容：\">\n                    <div class=\"content\">\n                      <el-input\n                        ref=\"system_text\"\n                        id=\"system_text\"\n                        v-model=\"formData.system_text\"\n                        type=\"textarea\"\n                        :autosize=\"{ minRows: 5, maxRows: 8 }\"\n                        placeholder=\"请输入通知内容\"\n                        style=\"width: 500px\"\n                      >\n                      </el-input>\n                      <div class=\"value-list\" v-if=\"formData.type_n == 3\">\n                        <el-popover placement=\"right\" width=\"200\" trigger=\"click\">\n                          <div class=\"variable\">\n                            <div\n                              class=\"item\"\n                              v-db-click\n                              @click=\"changeValue(i.value, 'system_text')\"\n                              v-for=\"(i, index) in formData.custom_variable\"\n                              :key=\"index\"\n                            >\n                              {{ i.label }}\n                            </div>\n                          </div>\n\n                          <i class=\"el-icon-link\" slot=\"reference\"></i>\n                        </el-popover>\n                      </div>\n                    </div>\n                    <div class=\"tips-info\" v-if=\"formData.type_n == 3\">可点击右下角图标,插入自定义变量</div>\n                  </el-form-item>\n                  <el-form-item label=\"状态：\" prop=\"is_system\">\n                    <el-radio-group v-model=\"formData.is_system\">\n                      <el-radio :label=\"1\">开启</el-radio>\n                      <el-radio :label=\"2\">关闭</el-radio>\n                    </el-radio-group>\n                  </el-form-item>\n                </div>\n                <div v-if=\"item.slot === 'is_sms' && !loading\">\n                  <el-form-item label=\"短信模版ID：\">\n                    <el-input v-model=\"formData.sms_id\" placeholder=\"短信模版ID\" style=\"width: 500px\"></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"通知内容：\">\n                    <div class=\"content\">\n                      <el-input\n                        id=\"sms_text\"\n                        v-model=\"formData.sms_text\"\n                        type=\"textarea\"\n                        :disabled=\"formData.type_n != 3\"\n                        :autosize=\"{ minRows: 5, maxRows: 8 }\"\n                        placeholder=\"请输入通知内容\"\n                        style=\"width: 500px\"\n                      ></el-input>\n                      <div class=\"value-list\" v-if=\"formData.type_n == 3\">\n                        <el-popover placement=\"right\" width=\"200\" trigger=\"click\">\n                          <div class=\"variable\">\n                            <div\n                              class=\"item\"\n                              v-db-click\n                              @click=\"changeValue(i.value, 'sms_text')\"\n                              v-for=\"(i, index) in formData.custom_variable\"\n                              :key=\"index\"\n                            >\n                              {{ i.label }}\n                            </div>\n                          </div>\n\n                          <i class=\"el-icon-link\" slot=\"reference\"></i>\n                        </el-popover>\n                      </div>\n                    </div>\n                    <div class=\"tips-info\" v-if=\"formData.type_n == 3\">可点击右下角图标,插入自定义变量</div>\n                  </el-form-item>\n                  <el-form-item label=\"状态：\" prop=\"is_sms\">\n                    <el-radio-group v-model=\"formData.is_sms\">\n                      <el-radio :label=\"1\">开启</el-radio>\n                      <el-radio :label=\"2\">关闭</el-radio>\n                    </el-radio-group>\n                  </el-form-item>\n                </div>\n                <div v-else-if=\"item.slot === 'is_wechat' && !loading\">\n                  <el-form-item label=\"模板编号：\">\n                    <el-input\n                      v-model=\"formData.tempkey\"\n                      :disabled=\"formData.type_n !== 3\"\n                      placeholder=\"请输入通模板编号\"\n                      style=\"width: 500px\"\n                    ></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"模板ID：\">\n                    <el-input v-model=\"formData.tempid\" placeholder=\"请输入模板ID\" style=\"width: 500px\"></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"模板：\">\n                    <div class=\"content\">\n                      <el-input\n                        :disabled=\"formData.type_n !== 3\"\n                        v-model=\"formData.content\"\n                        type=\"textarea\"\n                        :autosize=\"{ minRows: 5, maxRows: 8 }\"\n                        placeholder=\"请输入模板\"\n                        style=\"width: 500px\"\n                        @input=\"handleContentChange\"\n                      ></el-input>\n                    </div>\n                  </el-form-item>\n                  <el-form-item label=\"字段：\" v-if=\"formData.type_n == 3 && keyList.length\">\n                    <div class=\"content\">\n                      <keys-list\n                        :key-list=\"keyList\"\n                        :variableList=\"formData.custom_variable\"\n                        @add=\"handleAdd\"\n                        @remove=\"handleRemove\"\n                      />\n                    </div>\n                  </el-form-item>\n                  <el-form-item label=\"跳转链接：\">\n                    <el-input\n                      v-model=\"formData.wechat_link\"\n                      placeholder=\"请输入模版跳转链接，可携带参数\"\n                      style=\"width: 500px\"\n                    ></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"跳转小程序：\" prop=\"wechat_to_routine\">\n                    <el-radio-group v-model=\"formData.wechat_to_routine\">\n                      <el-radio :label=\"1\">开启</el-radio>\n                      <el-radio :label=\"0\">关闭</el-radio>\n                    </el-radio-group>\n                    <div class=\"tips-info\">\n                      开启之后，点击模版消息，跳转小程序对应的页面，需要小程序已经审核上线才可使用\n                    </div>\n                  </el-form-item>\n                  <el-form-item label=\"状态：\" prop=\"is_wechat\">\n                    <el-radio-group v-model=\"formData.is_wechat\">\n                      <el-radio :label=\"1\">开启</el-radio>\n                      <el-radio :label=\"2\">关闭</el-radio>\n                    </el-radio-group>\n                  </el-form-item>\n                </div>\n                <div v-else-if=\"item.slot === 'is_routine' && !loading\">\n                  <el-form-item label=\"模板编号：\">\n                    <el-input\n                      v-model=\"formData.tempkey\"\n                      :disabled=\"formData.type_n !== 3\"\n                      placeholder=\"请输入通模板编号\"\n                      style=\"width: 500px\"\n                    ></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"模板ID：\">\n                    <el-input v-model=\"formData.tempid\" placeholder=\"请输入模板ID\" style=\"width: 500px\"></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"模板：\">\n                    <div class=\"content\">\n                      <el-input\n                        :disabled=\"formData.type_n !== 3\"\n                        v-model=\"formData.content\"\n                        type=\"textarea\"\n                        :autosize=\"{ minRows: 5, maxRows: 8 }\"\n                        placeholder=\"请输入模板\"\n                        style=\"width: 500px\"\n                        @input=\"handleContentChange\"\n                      ></el-input>\n                    </div>\n                  </el-form-item>\n                  <el-form-item label=\"字段：\" v-if=\"formData.type_n == 3 && keyList.length\">\n                    <div class=\"content\">\n                      <keys-list\n                        :key-list=\"keyList\"\n                        :variableList=\"formData.custom_variable\"\n                        @add=\"handleAdd\"\n                        @remove=\"handleRemove\"\n                      />\n                    </div>\n                  </el-form-item>\n                  <el-form-item label=\"跳转链接：\">\n                    <el-input\n                      v-model=\"formData.routine_link\"\n                      placeholder=\"请输入模版跳转链接，可携带参数\"\n                      style=\"width: 500px\"\n                    ></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"状态：\" prop=\"is_routine\">\n                    <el-radio-group v-model=\"formData.is_routine\">\n                      <el-radio :label=\"1\">开启</el-radio>\n                      <el-radio :label=\"2\">关闭</el-radio>\n                    </el-radio-group>\n                  </el-form-item>\n                </div>\n\n                <div v-else-if=\"item.slot === 'is_ent_wechat' && !loading\">\n                  <el-form-item label=\"通知内容：\">\n                    <div class=\"content\">\n                      <el-input\n                        id=\"ent_wechat_text\"\n                        v-model=\"formData.ent_wechat_text\"\n                        type=\"textarea\"\n                        :autosize=\"{ minRows: 5, maxRows: 8 }\"\n                        placeholder=\"请输入通知内容\"\n                        style=\"width: 500px\"\n                      ></el-input>\n                      <div class=\"value-list\" v-if=\"formData.type_n == 3\">\n                        <el-popover placement=\"right\" width=\"200\" trigger=\"click\">\n                          <div class=\"variable\">\n                            <div\n                              class=\"item\"\n                              v-db-click\n                              @click=\"changeValue(i.value, 'ent_wechat_text')\"\n                              v-for=\"(i, index) in formData.custom_variable\"\n                              :key=\"index\"\n                            >\n                              {{ i.label }}\n                            </div>\n                          </div>\n\n                          <i class=\"el-icon-link\" slot=\"reference\"></i>\n                        </el-popover>\n                      </div>\n                    </div>\n                    <div class=\"tips-info\" v-if=\"formData.type_n == 3\">可点击右下角图标,插入自定义变量</div>\n                  </el-form-item>\n                  <el-form-item label=\"机器人链接：\">\n                    <div class=\"content\">\n                      <el-input v-model=\"formData.url\" placeholder=\"请输入机器人链接\" style=\"width: 500px\"></el-input>\n                    </div>\n                  </el-form-item>\n                  <el-form-item label=\"状态：\" prop=\"is_ent_wechat\">\n                    <el-radio-group v-model=\"formData.is_ent_wechat\">\n                      <el-radio :label=\"1\">开启</el-radio>\n                      <el-radio :label=\"2\">关闭</el-radio>\n                    </el-radio-group>\n                  </el-form-item>\n                </div>\n                <el-form-item>\n                  <el-button type=\"primary\" v-db-click @click=\"handleSubmit('formData')\">提交</el-button>\n                </el-form-item>\n              </el-form>\n            </el-tab-pane>\n          </el-tabs>\n        </el-col>\n      </el-row>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { getNotificationInfo, getNotificationSave } from '@/api/notification.js';\nimport keysList from './components/keysList.vue';\nexport default {\n  components: { keysList },\n  data() {\n    return {\n      tabs: [\n        {\n          title: '系统通知',\n          slot: 'is_system',\n        },\n        {\n          title: '短信通知',\n          slot: 'is_sms',\n        },\n        {\n          title: '微信模板消息',\n          slot: 'is_wechat',\n        },\n        {\n          title: '微信小程序提醒',\n          slot: 'is_routine',\n        },\n        {\n          title: '企业微信',\n          slot: 'is_ent_wechat',\n        },\n      ],\n      tabsList: [],\n      formData: {},\n      id: 0,\n      loading: true,\n      tagName: 'is_system',\n      ruleValidate: {\n        name: [\n          {\n            required: true,\n            message: '请输入通知场景',\n            trigger: 'blur',\n          },\n        ],\n        title: [\n          {\n            required: true,\n            message: '请输入通知场景',\n            trigger: 'blur',\n          },\n        ],\n        content: [\n          {\n            required: true,\n            message: '请输入通知内容',\n            trigger: 'blur',\n          },\n        ],\n      },\n      keyList: [],\n    };\n  },\n  created() {\n    this.id = this.$route.query.id;\n    this.getData(this.id, this.tagName, 1);\n  },\n  methods: {\n    handleContentChange(e) {\n      if (this.formData.type_n == 3) {\n        const regex = /{{(.*?)\\./g;\n        let match;\n        this.keyList = [];\n        while ((match = regex.exec(e))) {\n          this.keyList.push({\n            key: match[1],\n            value: '',\n          });\n        }\n      }\n    },\n    handleRemove(index) {\n      this.keyList.splice(index, 1);\n    },\n    // 新增卡密\n    handleAdd() {\n      this.keyList.push({\n        key: '',\n        value: '',\n      });\n    },\n    changeTabs() {\n      this.getData(this.id, this.tagName);\n    },\n    getData(id, name, init) {\n      this.loading = true;\n      this.formData = {};\n      getNotificationInfo(id, name)\n        .then((res) => {\n          if (!this.tabsList.length) {\n            this.tabs.map((v) => {\n              if (res.data[v.slot]) {\n                this.tabsList.push(v);\n              }\n            });\n          }\n          if (init) this.tagName = this.tabsList[0].slot;\n          this.formData = res.data;\n          this.formData.type_n = res.data.type; // - -!\n          this.formData.type = name; // 类型名称\n          this.formData.id = id;\n          this.keyList = res.data.key_list || [];\n          this.loading = false;\n        })\n        .catch((err) => {\n          this.$message.error(err.msg);\n        });\n    },\n    handleSubmit(name) {\n      this.formData.key_list = this.keyList;\n      getNotificationSave(this.formData)\n        .then((res) => {\n          this.$message.success('设置成功');\n        })\n        .catch((err) => {\n          this.$message.error(err);\n        });\n    },\n    handleReset(name) {\n      this.$emit('close');\n    },\n    changeValue(e, name) {\n      // 获取dom元素\n      let textInput = document.getElementById(name);\n      // 获取光标初始索引\n      let index = textInput.selectionStart;\n      // 拼接字符串的形式来得到需要的内容\n      this.formData[name] = this.formData[name].substring(0, index) + e + this.formData[name].substring(index);\n      this.$nextTick(() => {\n        textInput.selectionStart = index + e.length;\n        textInput.selectionEnd = index + e.length;\n        textInput.focus();\n      });\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n.edit {\n}\n.header_top {\n  margin-bottom: 10px;\n}\n.demo-tabs-style1 > .ivu-tabs-card > .ivu-tabs-content {\n  height: 120px;\n  margin-top: -16px;\n}\n\n.demo-tabs-style1 > .ivu-tabs-card > .ivu-tabs-content > .ivu-tabs-tabpane {\n  background: #fff;\n  padding: 16px;\n}\n\n.demo-tabs-style1 > .ivu-tabs.ivu-tabs-card > .ivu-tabs-bar .ivu-tabs-tab {\n  border-color: transparent;\n}\n\n.demo-tabs-style1 > .ivu-tabs-card > .ivu-tabs-bar .ivu-tabs-tab-active {\n  border-color: #fff;\n}\n\n.tabs {\n  padding: 0 30px;\n  background-color: #fff;\n}\n\n.trip {\n  color: rgb(146, 139, 139);\n  background-color: #f2f2f2;\n  margin-left: 80px;\n  border-radius: 4px;\n  padding: 15px;\n}\n\n.content {\n  display: flex;\n  position: relative;\n}\n\n.form-sty {\n  margin-top: 20px;\n}\n.value-list {\n  position: absolute;\n  right: 7px;\n  bottom: 7px;\n  width: 22px;\n  height: 22px;\n  line-height: 22px;\n  text-align: center;\n  background: var(--prev-color-primary);\n  color: #ededed;\n  cursor: pointer;\n  border-radius: 4px;\n}\n.variable {\n  .item {\n    cursor: pointer;\n    padding: 5px 10px;\n    transition: all 0.3s ease;\n  }\n  .item:hover {\n    background: var(--prev-color-primary-light-9);\n    color: var(--prev-color-primary);\n    border-radius: 4px;\n  }\n}\n// 滚动条样式\n.variable::-webkit-scrollbar {\n  width: 4px;\n  height: 4px;\n}\n.variable::-webkit-scrollbar-thumb {\n  background: var(--prev-color-primary-light-9);\n  border-radius: 4px;\n}\n.variable::-webkit-scrollbar-track {\n  background: #f2f2f2;\n}\n</style>\n"]}]}